import"./disclose-version.BDr9Qe-U.js";import{p as V,o as M,j as D,g as m,U as a,W as t,R as E,T as I,a as X,P as R,Q as ee}from"./index-client.CzqVbBUo.js";import{s as g}from"./render.CK5MTJQL.js";import{p as N,i as U}from"./if.BnegfJmL.js";import{a as f,t as k,c as se}from"./template.io25wnf1.js";import{c as re,s as ae,L as te}from"./Button.JzTZa4bh.js";import{s as ie,p as y,a as oe}from"./props.C_MHtC74.js";import{t as de}from"./tweened.x1rdCnFk.js";import{D as ce,G as W,H as w,$ as ne,a0 as le}from"./dataFetching.Br47vc1D.js";import{u as ve}from"./i18n.svelte.C_qSL0ZA.js";async function pe(u,d,h){let o=await ce(u,d);if(o.status===200){let r=await o.json(),c=r.rcr;c.publicKey.challenge=W(c.publicKey.challenge);for(let n of c.publicKey.allowCredentials)n.id=W(n.id);let i;try{i=await navigator.credentials.get(c)}catch(n){return console.error(n),{err:!0,msg:h||"Invalid Key"}}let j={code:r.code,data:{id:i.id,rawId:w(i.rawId),response:{authenticatorData:w(i.response.authenticatorData),clientDataJSON:w(i.response.clientDataJSON),signature:w(i.response.signature)},type:i.type}};return o=await ne(u,j),o.status===202?{err:!1,msg:"Authentication successful",body:await o.json()}:(console.error(o),{err:!0,msg:"Authentication Error"})}else return console.error(o),{err:!0,msg:"Error starting the Authentication"}}var ue=k('<div class="good svelte-jsdqii"> </div>'),me=k('<div class="err svelte-jsdqii"> </div>'),ge=k('<div class="wrapperOuter svelte-jsdqii"><div class="wrapperInner svelte-jsdqii"><div class="content svelte-jsdqii"><div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div></div> <div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div> <div><progress class="svelte-jsdqii"></progress></div></div> <div class="contentRow svelte-jsdqii"><!></div></div></div></div>');function fe(u,d){V(d,!0);const h=ie(),o=()=>oe(L,"$progress",h);let r=y(d,"data",15),c=y(d,"purpose",3,"Login"),i=y(d,"onError",3,e=>{}),j=y(d,"onSuccess",3,e=>{}),n=R(!1),z=R(""),q=R(!1),l=ve(),L=de(r().exp,{duration:r().exp*1e3});M(()=>{let e=setTimeout(()=>{r(void 0)},r().exp*1e3);return L.set(0),()=>clearTimeout(e)}),M(async()=>{let e;c()==="Login"?e={purpose:{Login:r().code}}:e={purpose:c()};let s={};try{s=await le(pe(r().user_id,e,(l==null?void 0:l.authorize.invalidKeyUsed)||"Invalid Key"),r().exp*1e3-1e3)}catch(p){console.error(p),s.err=!0,s.msg="Timeout",i()("Passkey Error")}D(n,N(s.err)),D(q,!s.err),D(z,N(s.msg)),m(q)?j()(s.body):setTimeout(()=>{i()()},3e3)});var x=ge(),H=a(x),O=a(H),b=a(O),P=a(b),C=a(P,!0);t(P),t(b);var A=E(b,2),K=a(A),F=a(K);t(K);var S=E(K,2),$=a(S);t(S),t(A);var J=E(A,2),_=a(J);{var B=e=>{var s=ue(),p=a(s,!0);t(s),I(()=>g(p,l.authorize.mfaAck||"Acknowledged")),f(e,s)},G=e=>{var s=se(),p=ee(s);{var Q=v=>{var T=me(),Z=a(T,!0);t(T),I(()=>g(Z,m(z))),f(v,T)},Y=v=>{te(v,{background:!1})};U(p,v=>{m(n)?v(Q):v(Y,!1)},!0)}f(e,s)};U(_,e=>{m(q)?e(B):e(G,!1)})}t(J),t(O),t(H),t(x),I(()=>{g(C,l.authorize.provideMfa||"Please login with your MFA device"),g(F,`${l.authorize.requestExpires||"Request expires"}
                    :`),re($,o()),ae($,"max",r().exp)}),f(u,x),X()}export{fe as W};
