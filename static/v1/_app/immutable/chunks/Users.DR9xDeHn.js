import"./disclose-version.BDr9Qe-U.js";import{p as he,i as p,_ as ha,g as e,h as t,ao as Pe,c as n,s as i,r as v,aq as Y,t as Z,a as ge,a9 as Me,f as le}from"./index-client.CzvcfCLI.js";import{s as ee}from"./render.BJBkrb2f.js";import{i as R}from"./if.Dlf0zx3_.js";import{e as Te,i as ga}from"./each.BtetwUOf.js";import{d as F,a as l,t as x,e as ye}from"./template.CQASMEo4.js";import{p as r}from"./proxy.CHyqegA9.js";import{D as Ke,E as ya,F as wa,G as $a,j as ba,H as _a,I as Ea,J as xa,K as ka,s as Ia,n as Sa,L as Qe}from"./dataFetchingAdmin.D6QJ_imf.js";import{s as xe,t as ve,a as ne}from"./index.CqGLefLa.js";import{p as $e}from"./props.BRvF51YW.js";import{r as Ue}from"./legacy-client.CQT_jR_Y.js";import{E as Ze}from"./ExpandContainer.96GzOZVL.js";import{O as ea,T as aa,a as La,P as qa}from"./Pagination.B865uVVG.js";import{c as Re,a as fe,b as Pa,I as ie}from"./Input.BmqIhqeF.js";import{k as Se,a2 as Ae,a3 as Ma,a4 as Ta,a5 as Na,a6 as ja,a7 as ta,M as sa,B as ra,o as Ge,a8 as Oa,z as za}from"./helpers.kNqlWGzE.js";import{S as Ne}from"./Switch.CwDfiuqK.js";import{g as Ye,a as Be,b as Ca,c as Da}from"./admin.B6BqYZ1F.js";import{B as we}from"./Button.BMVss8ej.js";import{C as Fa}from"./CheckIcon.DLVsj7KZ.js";import{I as je}from"./ItemTiles.BFL7MIZJ.js";import{T as Ua}from"./TabBar.DO8vwRCx.js";import{P as la}from"./PasswordInput.DZqvQQpj.js";import{P as Ra}from"./PasswordPolicy.is5FGLX9.js";import{f as Aa,h as Ga,w as Ya,i as Ba}from"./dataFetching.CtZWuJFH.js";import{L as Va}from"./Loading.DqrV7Awu.js";import{D as Xa}from"./Devices.DBXSUquq.js";import{P as Wa}from"./PaginationServer.CM_YZH4t.js";var Ha=x('<div class="success svelte-tl4x7h">Success</div>'),Ja=x('<div class="err svelte-tl4x7h"> </div>'),Ka=x('<div class="container svelte-tl4x7h"><div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">USER ID</div> <div class="value font-mono svelte-tl4x7h"> </div></div> <div class="row svelte-tl4x7h"><div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">ENABLED</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">E-MAIL VERIFIED</div> <div class="value svelte-tl4x7h"><!></div></div></div> <!> <!> <!> <div class="unit language svelte-tl4x7h"><div class="label svelte-tl4x7h">LANGUAGE</div> <div style="margin-top: .085rem"><!></div></div> <!> <!> <!> <!> <!> <!> <div class="unit svelte-tl4x7h"><div class="label svelte-tl4x7h">ROLES</div> <!></div> <div class="unit svelte-tl4x7h"><div class="label svelte-tl4x7h">GROUPS</div> <!></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">LIMIT LIFETIME</div> <div class="value svelte-tl4x7h"><!></div></div> <!> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">CREATED</div> <div class="value svelte-tl4x7h"> </div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">LAST LOGIN</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">PASSWORD EXPIRES</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">MFA ACTIVE</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><!> <!> <!></div></div>');function Qa(K,P){he(P,!0);let s=$e(P,"user",31,()=>r({}));s().roles===void 0&&s(s().roles=[],!0),s().groups===void 0&&s(s().groups=[],!0);let _=p(""),f=p(!1),b=p(void 0),S=p(r(s().language.toUpperCase())),T=p(!!s().user_expires),k=p(r(ha(()=>e(T))?Se(s().user_expires,!0):void 0)),N=p(r([]));Ye.subscribe(a=>{t(N,r(a))});let y=p(r([]));Be.subscribe(a=>{t(y,r(a))}),Ue(()=>{e(f)&&t(b,r(setTimeout(()=>{t(f,!1),P.onSave()},3e3)))});let g=p(r({}));const E=Re().shape({email:fe().required("E-Mail is required").email("Bad E-Mail format"),given_name:fe().trim().required("Given Name is required").matches(Ae,"Invalid characters"),family_name:fe().nullable().trim().matches(Ma,"Invalid characters")});let u=p(r({}));const w=Re().shape({birthdate:fe().nullable().trim().matches(Ta,"Invalid characters"),phone:fe().nullable().trim().matches(Na,"Format: +..."),street:fe().nullable().trim().matches(ja,"Invalid characters"),zip:Pa().nullable().min(1e3).max(999999),city:fe().nullable().trim().matches(ta,"Invalid characters"),country:fe().nullable().trim().matches(ta,"Invalid characters")});Pe(()=>()=>clearTimeout(e(b)));function m(a){a.code==="Enter"&&z()}async function z(){if(!await c())return;t(_,""),console.log(s().user_values);const a={email:s().email,given_name:s().given_name,family_name:s().family_name||null,language:e(S).toLowerCase(),roles:s().roles,groups:s().groups,enabled:s().enabled,email_verified:s().email_verified,user_expires:null,user_values:s().user_values};if(a.user_values.phone&&(a.user_values.phone=a.user_values.phone.replaceAll(" ","")),a.user_values.zip&&(a.user_values.zip=Number.parseInt(a.user_values.zip)),e(T)){let U=ra(e(k));if(!U){t(_,"Invalid Date Input: User Expires");return}a.user_expires=U}let O=await Ke(s().id,a);if(O.ok)t(f,!0);else{let U=await O.json();t(_,r(U.message))}}async function c(){let a=!0;try{await E.validate(s(),{abortEarly:!1}),t(g,r({}))}catch(O){t(g,r(Ge(O))),a=!1}try{await w.validate(s().user_values,{abortEarly:!1}),t(u,r({}))}catch(O){t(u,r(Ge(O))),a=!1}return a}var L=Ka(),M=n(L),j=i(n(M),2),D=n(j,!0);v(j),v(M);var X=i(M,2);xe(X,"margin-top","-5px");var H=n(X);xe(H,"width","107px");var oe=i(n(H),2),V=n(oe);Ne(V,{get selected(){return s().enabled},set selected(a){s(s().enabled=a,!0)}}),v(oe),v(H);var W=i(H,2);xe(W,"width","135px");var te=i(n(W),2),se=n(te);Ne(se,{get selected(){return s().email_verified},set selected(a){s(s().email_verified=a,!0)}}),v(te),v(W),v(X);var I=i(X,2);ie(I,{type:"email",autocomplete:"off",placeholder:"E-Mail",get value(){return s().email},set value(a){s(s().email=a,!0)},get error(){return e(g).email},set error(a){e(g).email=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("E-MAIL");l(a,U)},$$slots:{default:!0}});var $=i(I,2);ie($,{autocomplete:"off",placeholder:"Given Name",get value(){return s().given_name},set value(a){s(s().given_name=a,!0)},get error(){return e(g).given_name},set error(a){e(g).given_name=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("GIVEN NAME");l(a,U)},$$slots:{default:!0}});var A=i($,2);ie(A,{autocomplete:"off",placeholder:"Family Name",get value(){return s().family_name},set value(a){s(s().family_name=a,!0)},get error(){return e(g).family_name},set error(a){e(g).family_name=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("FAMILY NAME");l(a,U)},$$slots:{default:!0}});var Q=i(A,2),o=i(n(Q),2),h=n(o);ea(h,{options:sa,get value(){return e(S)},set value(a){t(S,r(a))}}),v(o),v(Q);var G=i(Q,2);ie(G,{autocomplete:"off",placeholder:"Street",get value(){return s().user_values.street},set value(a){s(s().user_values.street=a,!0)},get error(){return e(u).street},set error(a){e(u).street=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("STREET");l(a,U)},$$slots:{default:!0}});var d=i(G,2);ie(d,{type:"number",autocomplete:"off",placeholder:"ZIP",min:1e3,max:999999,get value(){return s().user_values.zip},set value(a){s(s().user_values.zip=a,!0)},get error(){return e(u).zip},set error(a){e(u).zip=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("ZIP");l(a,U)},$$slots:{default:!0}});var q=i(d,2);ie(q,{autocomplete:"off",placeholder:"City",get value(){return s().user_values.city},set value(a){s(s().user_values.city=a,!0)},get error(){return e(u).city},set error(a){e(u).city=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("CITY");l(a,U)},$$slots:{default:!0}});var C=i(q,2);ie(C,{autocomplete:"off",placeholder:"Country",get value(){return s().user_values.country},set value(a){s(s().user_values.country=a,!0)},get error(){return e(u).country},set error(a){e(u).country=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("COUNTRY");l(a,U)},$$slots:{default:!0}});var ue=i(C,2);ie(ue,{autocomplete:"off",placeholder:"Phone",get value(){return s().user_values.phone},set value(a){s(s().user_values.phone=a,!0)},get error(){return e(u).phone},set error(a){e(u).phone=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("PHONE");l(a,U)},$$slots:{default:!0}});var de=i(ue,2);ie(de,{type:"date",autocomplete:"off",placeholder:"Birthdate",get value(){return s().user_values.birthdate},set value(a){s(s().user_values.birthdate=a,!0)},get error(){return e(u).birthdate},set error(a){e(u).birthdate=a},$$events:{keypress:m,input:c},children:(a,O)=>{Y();var U=F("BIRTHDATE");l(a,U)},$$slots:{default:!0}});var re=i(de,2);xe(re,"margin-top","-3px");var be=i(n(re),2);je(be,{get options(){return e(N)},searchThreshold:4,get items(){return s().roles},set items(a){s(s().roles=a,!0)}}),v(re);var ce=i(re,2),B=i(n(ce),2);je(B,{get options(){return e(y)},searchThreshold:4,get items(){return s().groups},set items(a){s(s().groups=a,!0)}}),v(ce);var ae=i(ce,2);xe(ae,"margin-top","12px");var J=i(n(ae),2),Le=n(J);Ne(Le,{get selected(){return e(T)},set selected(a){t(T,r(a))}}),v(J),v(ae);var ke=i(ae,2);{var Oe=a=>{var O=Me(()=>Oa(new Date));ie(a,{type:"datetime-local",step:"60",width:"16rem",get min(){return e(O)},max:"2099-01-01T00:00",get value(){return e(k)},set value(U){t(k,r(U))},$$events:{input:c},children:(U,Vt)=>{Y();var fa=F("USER EXPIRES");l(U,fa)},$$slots:{default:!0}})};R(ke,a=>{e(T)&&a(Oe)})}var me=i(ke,2);xe(me,"margin-top","12px");var pe=i(n(me),2),qe=n(pe,!0);Z(()=>ee(qe,Se(s().created_at))),v(pe),v(me);var _e=i(me,2),Ie=i(n(_e),2),Ee=n(Ie);{var ze=a=>{var O=F();Z(()=>ee(O,Se(s().last_login))),l(a,O)},Ce=a=>{var O=F("Never");l(a,O)};R(Ee,a=>{s().last_login?a(ze):a(Ce,!1)})}v(Ie),v(_e);var De=i(_e,2),Ve=i(n(De),2),va=n(Ve);{var na=a=>{var O=F();Z(()=>ee(O,Se(s().password_expires))),l(a,O)},oa=a=>{var O=F("Never");l(a,O)};R(va,a=>{s().password_expires?a(na):a(oa,!1)})}v(Ve),v(De);var Fe=i(De,2),Xe=i(n(Fe),2),ua=n(Xe),da=Me(()=>!!s().webauthn_user_id);Fa(ua,{get check(){return e(da)}}),v(Xe),v(Fe);var We=i(Fe,2),He=n(We);we(He,{level:1,width:"4rem",$$events:{click:z},children:(a,O)=>{Y();var U=F("SAVE");l(a,U)},$$slots:{default:!0}});var Je=i(He,2);{var ca=a=>{var O=Ha();l(a,O)};R(Je,a=>{e(f)&&a(ca)})}var ma=i(Je,2);{var pa=a=>{var O=Ja(),U=n(O,!0);v(O),Z(()=>ee(U,e(_))),l(a,O)};R(ma,a=>{e(_)&&a(pa)})}v(We),v(L),Z(()=>ee(D,s().id)),l(K,L),ge()}var Za=x('<div class="desc svelte-8ppjyk"><p><b>The user has not initialized this account yet.</b></p> <p>You may send out a new Reset E-Mail, if the user has not received one.</p></div> <!>',1),et=x(`<div class="desc svelte-8ppjyk"><p><b>This is a passkey only account type.</b></p> <p>This means, that this user is using the passwordless login flow only and does not have any password.</p> <p>If the user has lost all his keys and you have verified everything, you may reset his account type and
                send out a new reset E-Mail, so the user can get access again.</p> <p>To reset the account, navigate to 'MFA' and delete all registered keys for this user.</p></div>`),at=x(`<!> <!> <!> <!> <div class="desc svelte-8ppjyk">You can either set and reset a user's password<br> or send out a new reset E-Mail for self-service.</div> <!> <!>`,1),tt=x('<div class="success svelte-8ppjyk">Success</div>'),st=x('<div class="err svelte-8ppjyk"> </div>'),rt=x('<div class="err svelte-8ppjyk"> </div>'),lt=x('<div class="container svelte-8ppjyk"><!> <!> <!> <!></div>');function it(K,P){he(P,!0);let s=$e(P,"user",27,()=>r({}));const _="inherit";let f=p(!1),b=p(""),S=p(""),T=p(!1),k=p(!1),N=p(void 0),y="330px",g=p(void 0),E=p(!1),u=r({new:"",verify:""});Ue(()=>{e(k)&&t(N,r(setTimeout(()=>{t(k,!1),P.onSave()},3e3)))}),Pe(async()=>{if(!e(g)){let I=await Aa(),$=await I.json();I.ok?t(g,r($)):t(S,r($.message))}});async function w(){return t(S,""),await m()?e(E)?!0:(t(S,"You must follow the password policy"),!1):!1}async function m(){return t(S,""),u.new.length>256?(t(S,"max 256 characters"),!1):u.new!==u.verify?(t(S,"New passwords do not match"),!1):!0}async function z(){let I={email:s().email};t(b,""),t(f,!0);let $=await ya(I);if($.ok)t(T,!0);else{let A=await $.json();t(b,r(A.message))}t(f,!1)}async function c(){let I={email:s().email,given_name:s().given_name,family_name:s().family_name,roles:s().roles,groups:s().groups,enabled:s().enabled,email_verified:s().email_verified};if(u.new.length>0){if(!(await m()&&await w()))return;I.password=u.new}t(S,""),t(f,!0);let $=await Ke(s().id,I);if($.ok)t(k,!0);else{let A=await $.json();t(S,r(A.message))}t(f,!1)}function L(){const I=e(g).length_min>24?e(g).length_min:24;let $=za(I,e(g).include_lower_case,e(g).include_upper_case,e(g).include_digits,e(g).include_special);u.new=$,u.verify=$}var M=lt(),j=n(M);{var D=I=>{var $=Za(),A=i(le($),2);we(A,{width:_,level:2,get isLoading(){return e(f)},set isLoading(Q){t(f,r(Q))},$$events:{click:z},children:(Q,o)=>{Y();var h=F("SEND RESET E-MAIL");l(Q,h)},$$slots:{default:!0}}),l(I,$)},X=I=>{var $=ye(),A=le($);{var Q=h=>{var G=et();l(h,G)},o=h=>{var G=at(),d=le(G);{var q=B=>{Ra(B,{get password(){return u.new},get policy(){return e(g)},get accepted(){return e(E)},set accepted(ae){t(E,r(ae))}})};R(d,B=>{e(g)&&B(q)})}var C=i(d,2),ue=Me(()=>u.new.length>0&&u.new===u.verify);la(C,{type:"password",get width(){return y},autocomplete:"off",get showCopy(){return e(ue)},get value(){return u.new},set value(B){u.new=B},$$events:{blur:m},children:(B,ae)=>{Y();var J=F("New Password");l(B,J)},$$slots:{default:!0}});var de=i(C,2);la(de,{type:"password",get width(){return y},autocomplete:"off",get value(){return u.verify},set value(B){u.verify=B},$$events:{blur:m},children:(B,ae)=>{Y();var J=F("New Password");l(B,J)},$$slots:{default:!0}});var re=i(de,2);we(re,{width:_,level:3,$$events:{click:L},children:(B,ae)=>{Y();var J=F("GENERATE RANDOM");l(B,J)},$$slots:{default:!0}});var be=i(re,4);we(be,{width:_,level:1,get isLoading(){return e(f)},set isLoading(B){t(f,r(B))},$$events:{click:z},children:(B,ae)=>{Y();var J=F("SEND RESET E-MAIL");l(B,J)},$$slots:{default:!0}});var ce=i(be,2);we(ce,{width:_,get isLoading(){return e(f)},set isLoading(B){t(f,r(B))},$$events:{click:c},children:(B,ae)=>{Y();var J=F("SAVE PASSWORD");l(B,J)},$$slots:{default:!0}}),l(h,G)};R(A,h=>{s().account_type==="passkey"?h(Q):h(o,!1)},!0)}l(I,$)};R(j,I=>{s().account_type==="new"?I(D):I(X,!1)})}var H=i(j,2);{var oe=I=>{var $=tt();l(I,$)};R(H,I=>{(e(k)||e(T))&&I(oe)})}var V=i(H,2);{var W=I=>{var $=st(),A=n($,!0);v($),Z(()=>ee(A,e(S))),l(I,$)};R(V,I=>{e(S)&&I(W)})}var te=i(V,2);{var se=I=>{var $=rt(),A=n($,!0);v($),Z(()=>ee(A,e(b))),l(I,$)};R(te,I=>{e(b)&&I(se)})}v(M),l(K,M),ge()}var vt=x('<div class="err svelte-1jljqe9"> </div>'),nt=x('<div class="container svelte-1jljqe9"><div class="label svelte-1jljqe9">Are you sure, you want to delete this user?</div> <!> <!></div>');function ot(K,P){he(P,!0);let s=$e(P,"user",27,()=>r({})),_=p(!1),f=p("");async function b(){t(f,""),t(_,!0);let y=await wa(s().id);if(y.ok)P.onSave();else{let g=await y.json();t(f,r(g.message))}t(_,!1)}var S=nt(),T=i(n(S),2);we(T,{level:1,width:"5rem",get isLoading(){return e(_)},set isLoading(y){t(_,r(y))},$$events:{click:b},children:(y,g)=>{Y();var E=F("DELETE");l(y,E)},$$slots:{default:!0}});var k=i(T,2);{var N=y=>{var g=vt(),E=n(g,!0);v(g),Z(()=>ee(E,e(f))),l(y,g)};R(k,y=>{e(f)&&y(N)})}v(S),l(K,S),ge()}var ut=x('<div class="err svelte-1ofwsjt"> </div>'),dt=x('<div class="success svelte-1ofwsjt">Success</div>'),ct=x('<div class="container svelte-1ofwsjt"><div class="label svelte-1ofwsjt">Invalidate all existing sessions and refresh tokens for this user?</div> <!> <!></div>');function mt(K,P){he(P,!0);let s=$e(P,"user",27,()=>r({})),_=p(!1),f=p(""),b=p(!1);async function S(){t(f,""),t(_,!0);let E=await $a(s().id);if(E.ok)t(b,!0);else{let u=await E.json();t(f,r(u.message))}t(_,!1)}var T=ct(),k=i(n(T),2);we(k,{level:1,get isLoading(){return e(_)},set isLoading(E){t(_,r(E))},$$events:{click:S},children:(E,u)=>{Y();var w=F("LOGOUT");l(E,w)},$$slots:{default:!0}});var N=i(k,2);{var y=E=>{var u=ut(),w=n(u,!0);v(u),Z(()=>ee(w,e(f))),l(E,u)},g=E=>{var u=ye(),w=le(u);{var m=z=>{var c=dt();l(z,c)};R(w,z=>{e(b)&&z(m)},!0)}l(E,u)};R(N,E=>{e(f)?E(y):E(g,!1)})}v(T),l(K,T),ge()}var pt=x('<div class="success svelte-iv4fzr">Success</div>'),ft=x('<div class="err svelte-iv4fzr"> </div>'),ht=x('<div class="container svelte-iv4fzr"><div class="desc svelte-iv4fzr">Set custom user attributes.<br> All Key / Value pairs will be handled as String / String.</div> <!> <!> <!> <!></div>');function gt(K,P){he(P,!0);let s=p(""),_=p(r([])),f=p(!1),b=p(!1);Pe(()=>{k()});async function S(){let c=await ba();if(!c.ok)t(s,"Error fetching attr: "+c.body.message);else return await c.json()}async function T(){let c=await _a(P.user.id);if(!c.ok)t(s,"Error fetching user attr: "+c.body.message);else return await c.json()}async function k(){let c=await S(),L=c.values;if(c){let M=await T();if(M){let j=new Map;for(let D of M.values)j.set(D.key,D.value||"");for(let D of L){let X=j.get(D.name);X?D.value=X:D.value=""}t(_,r([...L]))}}}async function N(){t(s,""),t(b,!0);let c=[];for(let D of e(_)){let X={key:D.name,value:D.value};c.push(X)}let L={values:c},M=await Ea(P.user.id,L),j=await M.json();M.ok?t(f,!0):t(s,r(j.message)),P.onSave(),t(b,!1)}var y=ht(),g=i(n(y),2);Te(g,17,()=>e(_),ga,(c,L,M)=>{var j=Me(()=>e(L).desc||"JSON Value");ie(c,{style:"width: 350px",autocomplete:"off",get placeholder(){return e(j)},get value(){return e(L).value},set value(D){e(L).value=D},children:(D,X)=>{Y();var H=F();Z(()=>ee(H,e(L).name)),l(D,H)},$$slots:{default:!0}})});var E=i(g,2);we(E,{get isLoading(){return e(b)},level:1,width:"4rem",$$events:{click:N},children:(c,L)=>{Y();var M=F("SAVE");l(c,M)},$$slots:{default:!0}});var u=i(E,2);{var w=c=>{var L=pt();l(c,L)};R(u,c=>{e(f)&&c(w)})}var m=i(u,2);{var z=c=>{var L=ft(),M=n(L,!0);v(L),Z(()=>ee(M,e(s))),l(c,L)};R(m,c=>{e(s)&&c(z)})}v(y),l(K,y),ge()}var yt=x('<div class="desc svelte-1a9qw6n">This user does not have any active MFA keys.</div>'),wt=x('<div class="keyContainer svelte-1a9qw6n"><div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Passkey Name:</div> <b> </b></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Key Registered:</div> <span class="font-mono"> </span></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Last Usage:</div> <span class="font-mono"> </span></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n"></div> <div class="deleteBtn svelte-1a9qw6n"><!></div></div></div>'),$t=x('<div class="desc svelte-1a9qw6n">You can delete the users MFA / Security Keys.<br> Be careful though, since this <b>cannot be reverted</b> without user interaction.<br> This is useful, if a user lost his keys and he is not able to log in any more.</div> <div class="keysContainer svelte-1a9qw6n"></div>',1),bt=x('<div class="err svelte-1a9qw6n"> </div>'),_t=x('<div class="container svelte-1a9qw6n"><!> <!></div>');function Et(K,P){he(P,!0);let s=$e(P,"user",27,()=>r({})),_=p(""),f=p(r([]));Pe(async()=>{await b()});async function b(){let u=await Ga(s().id),w=await u.json();u.ok?t(f,r(w)):console.error("error fetching passkeys: "+w.message)}async function S(u){let w=e(f).length===1,m=await Ya(s().id,u);if(m.status===200)return await b(),w&&P.onSave(),!0;{let z=await m.json();return t(_,r(z.message)),!1}}var T=_t(),k=n(T);{var N=u=>{var w=yt();l(u,w)},y=u=>{var w=$t(),m=i(le(w),2);Te(m,21,()=>e(f),z=>z.name,(z,c)=>{var L=wt(),M=n(L),j=i(n(M),2),D=n(j,!0);v(j),v(M);var X=i(M,2),H=i(n(X),2),oe=n(H,!0);Z(()=>ee(oe,Se(e(c).registered))),v(H),v(X);var V=i(X,2),W=i(n(V),2),te=n(W,!0);Z(()=>ee(te,Se(e(c).last_used))),v(W),v(V);var se=i(V,2),I=i(n(se),2),$=n(I);we($,{level:4,$$events:{click:()=>S(e(c).name)},children:(A,Q)=>{Y();var o=F("DELETE");l(A,o)},$$slots:{default:!0}}),v(I),v(se),v(L),Z(()=>ee(D,e(c).name)),l(z,L)}),v(m),l(u,w)};R(k,u=>{e(f).length<1?u(N):u(y,!1)})}var g=i(k,2);{var E=u=>{var w=bt(),m=n(w,!0);v(w),Z(()=>ee(m,e(_))),l(u,w)};R(g,u=>{e(_)&&u(E)})}v(T),l(K,T),ge()}var xt=x('<div class="container svelte-nw2ucx"><!></div>');function kt(K,P){he(P,!0);var s=xt(),_=n(s);Xa(_,{get userId(){return P.user.id}}),v(s),l(K,s),ge()}var It=x('<div class="data font-mono svelte-115hohv"> </div>'),St=x('<div class="data svelte-115hohv"> </div>'),Lt=x('<div class="header svelte-115hohv"><!> <!></div>'),qt=x("<div><!></div>"),Pt=x("<div><!></div>"),Mt=x("<div><!></div>"),Tt=x("<div><!></div>"),Nt=x("<div><!></div>"),jt=x("<div><!></div>"),Ot=x("<div><!></div>"),zt=x("<!> <!>",1),Ct=x("<div><!></div>");function ia(K,P){he(P,!0);let s=$e(P,"userEmail",3,""),_=$e(P,"userId",3,""),f=$e(P,"onSave",15),b=p(void 0),S=p(!0),T=p(void 0);const k=["Info","Attributes","Password","MFA","Devices","Logout","Delete"];let N=p(r(k[0]));const y=200,g=y/2;async function E(){const w=await Ba(_());if(w.ok)t(b,r(await w.json()));else{let m=await w.json();console.error(m)}t(S,!1)}function u(){t(T,!1),f()()}Ue(()=>{e(T)&&E()}),Ze(K,{get show(){return e(T)},set show(w){t(T,r(w))},header:w=>{var m=Lt(),z=n(m);aa(z,{text:"User ID",children:(L,M)=>{var j=It(),D=n(j,!0);v(j),Z(()=>ee(D,_())),l(L,j)},$$slots:{default:!0}});var c=i(z,2);aa(c,{text:"E-Mail",children:(L,M)=>{var j=St(),D=n(j,!0);v(j),Z(()=>ee(D,s())),l(L,j)},$$slots:{default:!0}}),v(m),l(w,m)},body:w=>{var m=Ct(),z=n(m);{var c=M=>{Va(M,{})},L=M=>{var j=zt(),D=le(j);Ua(D,{labels:k,get selected(){return e(N)},set selected(V){t(N,r(V))}});var X=i(D,2);{var H=V=>{var W=qt(),te=n(W);Qa(te,{get user(){return e(b)},set user(se){t(b,r(se))},get onSave(){return f()},set onSave(se){f(se)}}),v(W),ve(5,W,()=>ne,()=>({delay:g,duration:y})),ve(6,W,()=>ne,()=>({duration:y})),l(V,W)},oe=V=>{var W=ye(),te=le(W);{var se=$=>{var A=Pt(),Q=n(A);gt(Q,{get user(){return e(b)},set user(o){t(b,r(o))},get onSave(){return f()},set onSave(o){f(o)}}),v(A),ve(5,A,()=>ne,()=>({delay:g,duration:y})),ve(6,A,()=>ne,()=>({duration:y})),l($,A)},I=$=>{var A=ye(),Q=le(A);{var o=G=>{var d=Mt(),q=n(d);it(q,{get user(){return e(b)},set user(C){t(b,r(C))},get onSave(){return f()},set onSave(C){f(C)}}),v(d),ve(5,d,()=>ne,()=>({delay:g,duration:y})),ve(6,d,()=>ne,()=>({duration:y})),l(G,d)},h=G=>{var d=ye(),q=le(d);{var C=de=>{var re=Tt(),be=n(re);Et(be,{get user(){return e(b)},set user(ce){t(b,r(ce))},get onSave(){return f()},set onSave(ce){f(ce)}}),v(re),ve(5,re,()=>ne,()=>({delay:g,duration:y})),ve(6,re,()=>ne,()=>({duration:y})),l(de,re)},ue=de=>{var re=ye(),be=le(re);{var ce=ae=>{var J=Nt(),Le=n(J);kt(Le,{get user(){return e(b)},set user(ke){t(b,r(ke))}}),v(J),ve(5,J,()=>ne,()=>({delay:g,duration:y})),ve(6,J,()=>ne,()=>({duration:y})),l(ae,J)},B=ae=>{var J=ye(),Le=le(J);{var ke=me=>{var pe=jt(),qe=n(pe);mt(qe,{get user(){return e(b)},set user(_e){t(b,r(_e))}}),v(pe),ve(5,pe,()=>ne,()=>({delay:g,duration:y})),ve(6,pe,()=>ne,()=>({duration:y})),l(me,pe)},Oe=me=>{var pe=ye(),qe=le(pe);{var _e=Ie=>{var Ee=Ot(),ze=n(Ee);ot(ze,{onSave:u,get user(){return e(b)},set user(Ce){t(b,r(Ce))}}),v(Ee),ve(5,Ee,()=>ne,()=>({delay:g,duration:y})),ve(6,Ee,()=>ne,()=>({duration:y})),l(Ie,Ee)};R(qe,Ie=>{e(N)==="Delete"&&Ie(_e)},!0)}l(me,pe)};R(Le,me=>{e(N)==="Logout"?me(ke):me(Oe,!1)},!0)}l(ae,J)};R(be,ae=>{e(N)==="Devices"?ae(ce):ae(B,!1)},!0)}l(de,re)};R(q,de=>{e(N)==="MFA"?de(C):de(ue,!1)},!0)}l(G,d)};R(Q,G=>{e(N)==="Password"?G(o):G(h,!1)},!0)}l($,A)};R(te,$=>{e(N)==="Attributes"?$(se):$(I,!1)},!0)}l(V,W)};R(X,V=>{e(N)==="Info"?V(H):V(oe,!1)})}l(M,j)};R(z,M=>{e(S)?M(c):M(L,!1)})}v(m),l(w,m)},$$slots:{header:!0,body:!0}}),ge()}var Dt=x('<div class="header font-label svelte-1y7ceqm">ADD NEW USER</div>'),Ft=x('<div class="err svelte-1y7ceqm"> </div>'),Ut=x('<div class="container svelte-1y7ceqm"><!> <!> <!> <div class="language svelte-1y7ceqm"><div class="label svelte-1y7ceqm">LANGUAGE</div> <div style="margin-top: .4rem"><!></div></div> <div class="tiles svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">ROLES</div> <!></div> <div class="tiles svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">GROUPS</div> <!></div> <div class="unit svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">LIMIT LIFETIME</div> <div class="value"><!></div></div> <!> <div class="btn svelte-1y7ceqm"><!> <!></div></div>');function Rt(K,P){he(P,!0);let s=$e(P,"idx",31,()=>-1),_=p(""),f=p(void 0),b=p("EN"),S=p(!1),T=p(void 0),k=p(r({email:"",family_name:"",given_name:"",roles:[],groups:[]})),N=p(r({}));const y=Re().shape({email:fe().required("E-Mail is required").email("Bad E-Mail format"),given_name:fe().trim().required("Given Name is required").matches(Ae,"Invalid characters"),family_name:fe().trim().required("Family Name is required").matches(Ae,"Invalid characters")});let g=p(void 0);Ye.subscribe(m=>{t(g,r(m))});let E=p(void 0);Be.subscribe(m=>{t(E,r(m))});async function u(){if(!await w())return;t(_,"");let m=e(k);if(m.language=e(b).toLowerCase(),e(S)){let c=ra(e(T));if(!c){t(_,"Invalid Date Input: User Expires");return}m.user_expires=c}let z=await xa(e(k));if(z.ok)t(k,r({})),t(f,!1),t(k,r({email:"",family_name:"",given_name:"",roles:[],groups:[]})),P.onSave();else{let c=await z.json();t(_,r(c.message))}}async function w(){try{return await y.validate(e(k),{abortEarly:!1}),t(N,r({})),!0}catch(m){return t(N,r(Ge(m))),!1}}Ze(K,{get idx(){return s()},set idx(m){s(m)},get show(){return e(f)},set show(m){t(f,r(m))},header:m=>{var z=Dt();l(m,z)},body:m=>{var z=Ut(),c=n(z);ie(c,{type:"email",autocomplete:"off",placeholder:"E-Mail",get value(){return e(k).email},set value(d){e(k).email=d},get error(){return e(N).email},set error(d){e(N).email=d},$$events:{input:w},children:(d,q)=>{Y();var C=F("E-MAIL");l(d,C)},$$slots:{default:!0}});var L=i(c,2);ie(L,{autocomplete:"off",placeholder:"Given Name",get value(){return e(k).given_name},set value(d){e(k).given_name=d},get error(){return e(N).given_name},set error(d){e(N).given_name=d},$$events:{input:w},children:(d,q)=>{Y();var C=F("GIVEN NAME");l(d,C)},$$slots:{default:!0}});var M=i(L,2);ie(M,{autocomplete:"off",placeholder:"Family Name",get value(){return e(k).family_name},set value(d){e(k).family_name=d},get error(){return e(N).family_name},set error(d){e(N).family_name=d},$$events:{input:w},children:(d,q)=>{Y();var C=F("FAMILY NAME");l(d,C)},$$slots:{default:!0}});var j=i(M,2),D=i(n(j),2),X=n(D);ea(X,{options:sa,get value(){return e(b)},set value(d){t(b,r(d))}}),v(D),v(j);var H=i(j,2),oe=i(n(H),2);je(oe,{get options(){return e(g)},searchThreshold:4,get items(){return e(k).roles},set items(d){e(k).roles=d}}),v(H);var V=i(H,2),W=i(n(V),2);je(W,{get options(){return e(E)},searchThreshold:4,get items(){return e(k).groups},set items(d){e(k).groups=d}}),v(V);var te=i(V,2);xe(te,"margin-top","12px");var se=i(n(te),2),I=n(se);Ne(I,{get selected(){return e(S)},set selected(d){t(S,r(d))}}),v(se),v(te);var $=i(te,2);{var A=d=>{ie(d,{type:"datetime-local",step:"60",width:"18rem",get min(){return new Date().toISOString().split(".")[0]},max:"2099-01-01T00:00",get value(){return e(T)},set value(q){t(T,r(q))},$$events:{input:w},children:(q,C)=>{Y();var ue=F("USER EXPIRES");l(q,ue)},$$slots:{default:!0}})};R($,d=>{e(S)&&d(A)})}var Q=i($,2),o=n(Q);we(o,{level:1,$$events:{click:u},children:(d,q)=>{Y();var C=F("SAVE");l(d,C)},$$slots:{default:!0}});var h=i(o,2);{var G=d=>{var q=Ft(),C=n(q,!0);v(q),Z(()=>ee(C,e(_))),l(d,q)};R(h,d=>{e(_)&&d(G)})}v(Q),v(z),l(m,z)},$$slots:{header:!0,body:!0}}),ge()}var At=x('<div class="svelte-1n3c0ep"><!></div>'),Gt=x('<div class="svelte-1n3c0ep"><!></div>'),Yt=x(' <div class="content"><!> <!> <div id="users" class="svelte-1n3c0ep"><!></div> <!></div>',1);function Bt(K,P){he(P,!0);let s=p(""),_=p(r([])),f=p(r([])),b=p(r([])),S=p(""),T=p(!1),k=p(""),N=p(0),y=p(15),g=p(""),E=p(1),u=p(r([{label:"E-Mail",callback:(o,h)=>o.email.toLowerCase().includes(h.toLowerCase())},{label:"ID",callback:(o,h)=>o.id.toLowerCase().includes(h.toLowerCase())}])),w=p(r([{label:"E-Mail",callback:(o,h)=>o.email.localeCompare(h.email)},{label:"ID",callback:(o,h)=>o.id.localeCompare(h.id)},{label:"Created",callback:(o,h)=>o.created_at<h.created_at},{label:"Last Login",callback:(o,h)=>{let G=o.last_login||9999999999,d=h.last_login||9999999999;return G<d}}]));Pe(async()=>{m(),L(),M()});async function m(o,h,G,d){let q;if(o===!0?G&&e(E)===2?q=await Qe(d||e(y),h,void 0,!1):q=await Qe(d||e(y),h,e(g),G):q=await ka(),!q.ok)t(s,"Error fetching users: "+q.body.message);else{q.status===206?(t(y,r(Number.parseInt(q.headers.get("x-page-size"),10))),t(S,"user"),q.headers.get("x-continuation-token"),t(g,r(q.headers.get("x-continuation-token")))):t(S,""),t(N,r(q.headers.get("x-user-count")));let C=await q.json();t(_,r([...C])),t(f,r([...C]))}}async function z(o,h){await m(!0,o,h),h?t(E,e(E)-1):t(E,e(E)+1)}async function c(o){t(g,""),await m(!0,0,!1,o),t(E,1)}async function L(){let o=await Ia();if(!o.ok)t(s,"Error fetching roles: "+o.body.message);else{let h=await o.json();Ca.set(h),Ye.set(h.map(G=>G.name))}}async function M(){let o=await Sa();if(!o.ok)t(s,"Error fetching groups: "+o.body.message);else{let h=await o.json();Da.set(h),Be.set(h.map(G=>G.name))}}function j(){m(),L(),M(),t(k,"")}Y();var D=Yt(),X=le(D),H=i(X),oe=n(H);La(oe,{get items(){return e(_)},get resItems(){return e(f)},set resItems(o){t(f,r(o))},get searchOptions(){return e(u)},set searchOptions(o){t(u,r(o))},get orderOptions(){return e(w)},set orderOptions(o){t(w,r(o))},get useServerSideIdx(){return e(S)},set useServerSideIdx(o){t(S,r(o))},get isSearchFiltered(){return e(T)},set isSearchFiltered(o){t(T,r(o))},get search(){return e(k)},set search(o){t(k,r(o))}});var V=i(oe,2);Rt(V,{onSave:j});var W=i(V,2),te=n(W);{var se=o=>{var h=ye(),G=le(h);Te(G,17,()=>e(f),d=>d.id,(d,q)=>{var C=At(),ue=n(C);ia(ue,{get userId(){return e(q).id},get userEmail(){return e(q).email},onSave:j}),v(C),l(d,C)}),l(o,h)},I=o=>{var h=ye(),G=le(h);Te(G,17,()=>e(b),d=>d.id,(d,q)=>{var C=Gt(),ue=n(C);ia(ue,{get userId(){return e(q).id},get userEmail(){return e(q).email},onSave:j}),v(C),l(d,C)}),l(o,h)};R(te,o=>{e(S)&&!e(T)?o(se):o(I,!1)})}v(W);var $=i(W,2);{var A=o=>{Wa(o,{get itemsTotal(){return e(N)},fetchPageCallback:z,sspPageSizeChange:c,get sspPage(){return e(E)},set sspPage(h){t(E,r(h))},get sspPageSize(){return e(y)},set sspPageSize(h){t(y,r(h))},get sspContinuationToken(){return e(g)},set sspContinuationToken(h){t(g,r(h))}})},Q=o=>{qa(o,{get items(){return e(f)},set items(h){t(f,r(h))},get resItems(){return e(b)},set resItems(h){t(b,r(h))}})};R($,o=>{e(S)&&!e(T)?o(A):o(Q,!1)})}v(H),Z(()=>ee(X,`${e(s)??""} `)),l(K,D),ge()}export{Bt as U};
