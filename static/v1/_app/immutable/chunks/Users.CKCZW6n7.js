import"./disclose-version.BDr9Qe-U.js";import{p as he,i as p,_ as ha,g as e,h as t,ao as Te,c as n,s as i,r as v,aq as z,t as J,a as ge,a9 as Ne,f as le}from"./index-client.ijM6xFk7.js";import{s as ee}from"./render.BjVgqyVR.js";import{i as A}from"./if.BunKWniS.js";import{e as De,i as ga}from"./each.K_FVK-xy.js";import{d as F,a as l,t as I,e as ye}from"./template.DOyJZ41v.js";import{p as r}from"./proxy.DmesnD8z.js";import{v as Ke,w as ya,x as wa,y as $a,f as ba,z as _a,A as Ea,B as Ia,C as xa,o as ka,k as Sa,D as Qe}from"./dataFetchingAdmin.1Vn3g5PB.js";import{s as Ie,t as ve,a as ne}from"./index.R935SZZb.js";import{p as $e}from"./props.YiozBtSG.js";import{r as Re}from"./legacy-client.YTFnMCQ3.js";import{O as Je,E as ea,T as aa,a as La,P as qa}from"./Pagination.8F_y-ekl.js";import{c as Ae,a as fe,b as Ta,I as ie}from"./Input.QQtpeOHH.js";import{k as Se,a0 as Ve,a1 as Na,a2 as Da,a3 as ja,a4 as Pa,a5 as ta,N as sa,A as ra,q as Ge,a6 as Ma,z as Oa}from"./helpers.DMpx17S8.js";import{S as je}from"./Switch.CaAeENSD.js";import{g as ze,a as Ye,b as Ca,c as Ua}from"./admin.CNBIjhfM.js";import{B as we}from"./Button.BgUaD8Uz.js";import{C as Fa}from"./CheckIcon.BRA846gp.js";import{I as Pe}from"./ItemTiles.84cWCQoV.js";import{T as Ra}from"./TabBar.DtAcwHiX.js";import{P as la}from"./PasswordInput.CKntP0Zc.js";import{P as Aa}from"./PasswordPolicy.BevixuvF.js";import{f as Va,h as Ga,w as za,i as Ya}from"./dataFetching.B_dCHvwF.js";import{L as Ba}from"./Loading.B7S3LDCT.js";import{D as Xa}from"./Devices.BTzgPIaD.js";import{P as Ha}from"./PaginationServer.CAboxPNU.js";var Wa=I('<div class="success svelte-tl4x7h">Success</div>'),Za=I('<div class="err svelte-tl4x7h"> </div>'),Ka=I('<div class="container svelte-tl4x7h"><div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">USER ID</div> <div class="value font-mono svelte-tl4x7h"> </div></div> <div class="row svelte-tl4x7h"><div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">ENABLED</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">E-MAIL VERIFIED</div> <div class="value svelte-tl4x7h"><!></div></div></div> <!> <!> <!> <div class="unit language svelte-tl4x7h"><div class="label svelte-tl4x7h">LANGUAGE</div> <div style="margin-top: .085rem"><!></div></div> <!> <!> <!> <!> <!> <!> <div class="unit svelte-tl4x7h"><div class="label svelte-tl4x7h">ROLES</div> <!></div> <div class="unit svelte-tl4x7h"><div class="label svelte-tl4x7h">GROUPS</div> <!></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">LIMIT LIFETIME</div> <div class="value svelte-tl4x7h"><!></div></div> <!> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">CREATED</div> <div class="value svelte-tl4x7h"> </div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">LAST LOGIN</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">PASSWORD EXPIRES</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">MFA ACTIVE</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><!> <!> <!></div></div>');function Qa(K,T){he(T,!0);let s=$e(T,"user",31,()=>r({}));s().roles===void 0&&s(s().roles=[],!0),s().groups===void 0&&s(s().groups=[],!0);let _=p(""),f=p(!1),b=p(void 0),S=p(r(s().language.toUpperCase())),D=p(!!s().user_expires),x=p(r(ha(()=>e(D))?Se(s().user_expires,!0):void 0)),j=p(r([]));ze.subscribe(a=>{t(j,r(a))});let y=p(r([]));Ye.subscribe(a=>{t(y,r(a))}),Re(()=>{e(f)&&t(b,r(setTimeout(()=>{t(f,!1),T.onSave()},3e3)))});let g=p(r({}));const E=Ae().shape({email:fe().required("E-Mail is required").email("Bad E-Mail format"),given_name:fe().trim().required("Given Name is required").matches(Ve,"Invalid characters"),family_name:fe().nullable().trim().matches(Na,"Invalid characters")});let u=p(r({}));const w=Ae().shape({birthdate:fe().nullable().trim().matches(Da,"Invalid characters"),phone:fe().nullable().trim().matches(ja,"Format: +..."),street:fe().nullable().trim().matches(Pa,"Invalid characters"),zip:Ta().nullable().min(1e3).max(999999),city:fe().nullable().trim().matches(ta,"Invalid characters"),country:fe().nullable().trim().matches(ta,"Invalid characters")});Te(()=>()=>clearTimeout(e(b)));function m(a){a.code==="Enter"&&O()}async function O(){if(!await c())return;t(_,""),console.log(s().user_values);const a={email:s().email,given_name:s().given_name,family_name:s().family_name||null,language:e(S).toLowerCase(),roles:s().roles,groups:s().groups,enabled:s().enabled,email_verified:s().email_verified,user_expires:null,user_values:s().user_values};if(a.user_values.phone&&(a.user_values.phone=a.user_values.phone.replaceAll(" ","")),a.user_values.zip&&(a.user_values.zip=Number.parseInt(a.user_values.zip)),e(D)){let R=ra(e(x));if(!R){t(_,"Invalid Date Input: User Expires");return}a.user_expires=R}let M=await Ke(s().id,a);if(M.ok)t(f,!0);else{let R=await M.json();t(_,r(R.message))}}async function c(){let a=!0;try{await E.validate(s(),{abortEarly:!1}),t(g,r({}))}catch(M){t(g,r(Ge(M))),a=!1}try{await w.validate(s().user_values,{abortEarly:!1}),t(u,r({}))}catch(M){t(u,r(Ge(M))),a=!1}return a}var L=Ka(),N=n(L),P=i(n(N),2),U=n(P,!0);v(P),v(N);var X=i(N,2);Ie(X,"margin-top","-5px");var W=n(X);Ie(W,"width","107px");var oe=i(n(W),2),B=n(oe);je(B,{get selected(){return s().enabled},set selected(a){s(s().enabled=a,!0)}}),v(oe),v(W);var H=i(W,2);Ie(H,"width","135px");var te=i(n(H),2),se=n(te);je(se,{get selected(){return s().email_verified},set selected(a){s(s().email_verified=a,!0)}}),v(te),v(H),v(X);var k=i(X,2);ie(k,{type:"email",autocomplete:"off",placeholder:"E-Mail",get value(){return s().email},set value(a){s(s().email=a,!0)},get error(){return e(g).email},set error(a){e(g).email=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("E-MAIL");l(a,R)},$$slots:{default:!0}});var $=i(k,2);ie($,{autocomplete:"off",placeholder:"Given Name",get value(){return s().given_name},set value(a){s(s().given_name=a,!0)},get error(){return e(g).given_name},set error(a){e(g).given_name=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("GIVEN NAME");l(a,R)},$$slots:{default:!0}});var V=i($,2);ie(V,{autocomplete:"off",placeholder:"Family Name",get value(){return s().family_name},set value(a){s(s().family_name=a,!0)},get error(){return e(g).family_name},set error(a){e(g).family_name=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("FAMILY NAME");l(a,R)},$$slots:{default:!0}});var Q=i(V,2),o=i(n(Q),2),h=n(o);Je(h,{options:sa,get value(){return e(S)},set value(a){t(S,r(a))}}),v(o),v(Q);var G=i(Q,2);ie(G,{autocomplete:"off",placeholder:"Street",get value(){return s().user_values.street},set value(a){s(s().user_values.street=a,!0)},get error(){return e(u).street},set error(a){e(u).street=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("STREET");l(a,R)},$$slots:{default:!0}});var d=i(G,2);ie(d,{type:"number",autocomplete:"off",placeholder:"ZIP",min:1e3,max:999999,get value(){return s().user_values.zip},set value(a){s(s().user_values.zip=a,!0)},get error(){return e(u).zip},set error(a){e(u).zip=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("ZIP");l(a,R)},$$slots:{default:!0}});var q=i(d,2);ie(q,{autocomplete:"off",placeholder:"City",get value(){return s().user_values.city},set value(a){s(s().user_values.city=a,!0)},get error(){return e(u).city},set error(a){e(u).city=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("CITY");l(a,R)},$$slots:{default:!0}});var C=i(q,2);ie(C,{autocomplete:"off",placeholder:"Country",get value(){return s().user_values.country},set value(a){s(s().user_values.country=a,!0)},get error(){return e(u).country},set error(a){e(u).country=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("COUNTRY");l(a,R)},$$slots:{default:!0}});var ue=i(C,2);ie(ue,{autocomplete:"off",placeholder:"Phone",get value(){return s().user_values.phone},set value(a){s(s().user_values.phone=a,!0)},get error(){return e(u).phone},set error(a){e(u).phone=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("PHONE");l(a,R)},$$slots:{default:!0}});var de=i(ue,2);ie(de,{type:"date",autocomplete:"off",placeholder:"Birthdate",get value(){return s().user_values.birthdate},set value(a){s(s().user_values.birthdate=a,!0)},get error(){return e(u).birthdate},set error(a){e(u).birthdate=a},$$events:{keypress:m,input:c},children:(a,M)=>{z();var R=F("BIRTHDATE");l(a,R)},$$slots:{default:!0}});var re=i(de,2);Ie(re,"margin-top","-3px");var be=i(n(re),2);Pe(be,{get options(){return e(j)},searchThreshold:4,get items(){return s().roles},set items(a){s(s().roles=a,!0)}}),v(re);var ce=i(re,2),Y=i(n(ce),2);Pe(Y,{get options(){return e(y)},searchThreshold:4,get items(){return s().groups},set items(a){s(s().groups=a,!0)}}),v(ce);var ae=i(ce,2);Ie(ae,"margin-top","12px");var Z=i(n(ae),2),Le=n(Z);je(Le,{get selected(){return e(D)},set selected(a){t(D,r(a))}}),v(Z),v(ae);var xe=i(ae,2);{var Me=a=>{var M=Ne(()=>Ma(new Date));ie(a,{type:"datetime-local",step:"60",width:"16rem",get min(){return e(M)},max:"2099-01-01T00:00",get value(){return e(x)},set value(R){t(x,r(R))},$$events:{input:c},children:(R,Bt)=>{z();var fa=F("USER EXPIRES");l(R,fa)},$$slots:{default:!0}})};A(xe,a=>{e(D)&&a(Me)})}var me=i(xe,2);Ie(me,"margin-top","12px");var pe=i(n(me),2),qe=n(pe,!0);J(()=>ee(qe,Se(s().created_at))),v(pe),v(me);var _e=i(me,2),ke=i(n(_e),2),Ee=n(ke);{var Oe=a=>{var M=F();J(()=>ee(M,Se(s().last_login))),l(a,M)},Ce=a=>{var M=F("Never");l(a,M)};A(Ee,a=>{s().last_login?a(Oe):a(Ce,!1)})}v(ke),v(_e);var Ue=i(_e,2),Be=i(n(Ue),2),va=n(Be);{var na=a=>{var M=F();J(()=>ee(M,Se(s().password_expires))),l(a,M)},oa=a=>{var M=F("Never");l(a,M)};A(va,a=>{s().password_expires?a(na):a(oa,!1)})}v(Be),v(Ue);var Fe=i(Ue,2),Xe=i(n(Fe),2),ua=n(Xe),da=Ne(()=>!!s().webauthn_user_id);Fa(ua,{get check(){return e(da)}}),v(Xe),v(Fe);var He=i(Fe,2),We=n(He);we(We,{level:1,width:"4rem",$$events:{click:O},children:(a,M)=>{z();var R=F("SAVE");l(a,R)},$$slots:{default:!0}});var Ze=i(We,2);{var ca=a=>{var M=Wa();l(a,M)};A(Ze,a=>{e(f)&&a(ca)})}var ma=i(Ze,2);{var pa=a=>{var M=Za(),R=n(M,!0);v(M),J(()=>ee(R,e(_))),l(a,M)};A(ma,a=>{e(_)&&a(pa)})}v(He),v(L),J(()=>ee(U,s().id)),l(K,L),ge()}var Ja=I('<div class="desc svelte-8ppjyk"><p><b>The user has not initialized this account yet.</b></p> <p>You may send out a new Reset E-Mail, if the user has not received one.</p></div> <!>',1),et=I(`<div class="desc svelte-8ppjyk"><p><b>This is a passkey only account type.</b></p> <p>This means, that this user is using the passwordless login flow only and does not have any password.</p> <p>If the user has lost all his keys and you have verified everything, you may reset his account type and
                send out a new reset E-Mail, so the user can get access again.</p> <p>To reset the account, navigate to 'MFA' and delete all registered keys for this user.</p></div>`),at=I(`<!> <!> <!> <!> <div class="desc svelte-8ppjyk">You can either set and reset a user's password<br> or send out a new reset E-Mail for self-service.</div> <!> <!>`,1),tt=I('<div class="success svelte-8ppjyk">Success</div>'),st=I('<div class="err svelte-8ppjyk"> </div>'),rt=I('<div class="err svelte-8ppjyk"> </div>'),lt=I('<div class="container svelte-8ppjyk"><!> <!> <!> <!></div>');function it(K,T){he(T,!0);let s=$e(T,"user",27,()=>r({}));const _="inherit";let f=p(!1),b=p(""),S=p(""),D=p(!1),x=p(!1),j=p(void 0),y="330px",g=p(void 0),E=p(!1),u=r({new:"",verify:""});Re(()=>{e(x)&&t(j,r(setTimeout(()=>{t(x,!1),T.onSave()},3e3)))}),Te(async()=>{if(!e(g)){let k=await Va(),$=await k.json();k.ok?t(g,r($)):t(S,r($.message))}});async function w(){return t(S,""),await m()?e(E)?!0:(t(S,"You must follow the password policy"),!1):!1}async function m(){return t(S,""),u.new.length>256?(t(S,"max 256 characters"),!1):u.new!==u.verify?(t(S,"New passwords do not match"),!1):!0}async function O(){let k={email:s().email};t(b,""),t(f,!0);let $=await ya(k);if($.ok)t(D,!0);else{let V=await $.json();t(b,r(V.message))}t(f,!1)}async function c(){let k={email:s().email,given_name:s().given_name,family_name:s().family_name,roles:s().roles,groups:s().groups,enabled:s().enabled,email_verified:s().email_verified};if(u.new.length>0){if(!(await m()&&await w()))return;k.password=u.new}t(S,""),t(f,!0);let $=await Ke(s().id,k);if($.ok)t(x,!0);else{let V=await $.json();t(S,r(V.message))}t(f,!1)}function L(){const k=e(g).length_min>24?e(g).length_min:24;let $=Oa(k,e(g).include_lower_case,e(g).include_upper_case,e(g).include_digits,e(g).include_special);u.new=$,u.verify=$}var N=lt(),P=n(N);{var U=k=>{var $=Ja(),V=i(le($),2);we(V,{width:_,level:2,get isLoading(){return e(f)},set isLoading(Q){t(f,r(Q))},$$events:{click:O},children:(Q,o)=>{z();var h=F("SEND RESET E-MAIL");l(Q,h)},$$slots:{default:!0}}),l(k,$)},X=k=>{var $=ye(),V=le($);{var Q=h=>{var G=et();l(h,G)},o=h=>{var G=at(),d=le(G);{var q=Y=>{Aa(Y,{get password(){return u.new},get policy(){return e(g)},get accepted(){return e(E)},set accepted(ae){t(E,r(ae))}})};A(d,Y=>{e(g)&&Y(q)})}var C=i(d,2),ue=Ne(()=>u.new.length>0&&u.new===u.verify);la(C,{type:"password",get width(){return y},autocomplete:"off",get showCopy(){return e(ue)},get value(){return u.new},set value(Y){u.new=Y},$$events:{blur:m},children:(Y,ae)=>{z();var Z=F("New Password");l(Y,Z)},$$slots:{default:!0}});var de=i(C,2);la(de,{type:"password",get width(){return y},autocomplete:"off",get value(){return u.verify},set value(Y){u.verify=Y},$$events:{blur:m},children:(Y,ae)=>{z();var Z=F("New Password");l(Y,Z)},$$slots:{default:!0}});var re=i(de,2);we(re,{width:_,level:3,$$events:{click:L},children:(Y,ae)=>{z();var Z=F("GENERATE RANDOM");l(Y,Z)},$$slots:{default:!0}});var be=i(re,4);we(be,{width:_,level:1,get isLoading(){return e(f)},set isLoading(Y){t(f,r(Y))},$$events:{click:O},children:(Y,ae)=>{z();var Z=F("SEND RESET E-MAIL");l(Y,Z)},$$slots:{default:!0}});var ce=i(be,2);we(ce,{width:_,get isLoading(){return e(f)},set isLoading(Y){t(f,r(Y))},$$events:{click:c},children:(Y,ae)=>{z();var Z=F("SAVE PASSWORD");l(Y,Z)},$$slots:{default:!0}}),l(h,G)};A(V,h=>{s().account_type==="passkey"?h(Q):h(o,!1)},!0)}l(k,$)};A(P,k=>{s().account_type==="new"?k(U):k(X,!1)})}var W=i(P,2);{var oe=k=>{var $=tt();l(k,$)};A(W,k=>{(e(x)||e(D))&&k(oe)})}var B=i(W,2);{var H=k=>{var $=st(),V=n($,!0);v($),J(()=>ee(V,e(S))),l(k,$)};A(B,k=>{e(S)&&k(H)})}var te=i(B,2);{var se=k=>{var $=rt(),V=n($,!0);v($),J(()=>ee(V,e(b))),l(k,$)};A(te,k=>{e(b)&&k(se)})}v(N),l(K,N),ge()}var vt=I('<div class="err svelte-1jljqe9"> </div>'),nt=I('<div class="container svelte-1jljqe9"><div class="label svelte-1jljqe9">Are you sure, you want to delete this user?</div> <!> <!></div>');function ot(K,T){he(T,!0);let s=$e(T,"user",27,()=>r({})),_=p(!1),f=p("");async function b(){t(f,""),t(_,!0);let y=await wa(s().id);if(y.ok)T.onSave();else{let g=await y.json();t(f,r(g.message))}t(_,!1)}var S=nt(),D=i(n(S),2);we(D,{level:1,width:"5rem",get isLoading(){return e(_)},set isLoading(y){t(_,r(y))},$$events:{click:b},children:(y,g)=>{z();var E=F("DELETE");l(y,E)},$$slots:{default:!0}});var x=i(D,2);{var j=y=>{var g=vt(),E=n(g,!0);v(g),J(()=>ee(E,e(f))),l(y,g)};A(x,y=>{e(f)&&y(j)})}v(S),l(K,S),ge()}var ut=I('<div class="err svelte-1ofwsjt"> </div>'),dt=I('<div class="success svelte-1ofwsjt">Success</div>'),ct=I('<div class="container svelte-1ofwsjt"><div class="label svelte-1ofwsjt">Invalidate all existing sessions and refresh tokens for this user?</div> <!> <!></div>');function mt(K,T){he(T,!0);let s=$e(T,"user",27,()=>r({})),_=p(!1),f=p(""),b=p(!1);async function S(){t(f,""),t(_,!0);let E=await $a(s().id);if(E.ok)t(b,!0);else{let u=await E.json();t(f,r(u.message))}t(_,!1)}var D=ct(),x=i(n(D),2);we(x,{level:1,get isLoading(){return e(_)},set isLoading(E){t(_,r(E))},$$events:{click:S},children:(E,u)=>{z();var w=F("LOGOUT");l(E,w)},$$slots:{default:!0}});var j=i(x,2);{var y=E=>{var u=ut(),w=n(u,!0);v(u),J(()=>ee(w,e(f))),l(E,u)},g=E=>{var u=ye(),w=le(u);{var m=O=>{var c=dt();l(O,c)};A(w,O=>{e(b)&&O(m)},!0)}l(E,u)};A(j,E=>{e(f)?E(y):E(g,!1)})}v(D),l(K,D),ge()}var pt=I('<div class="success svelte-iv4fzr">Success</div>'),ft=I('<div class="err svelte-iv4fzr"> </div>'),ht=I('<div class="container svelte-iv4fzr"><div class="desc svelte-iv4fzr">Set custom user attributes.<br> All Key / Value pairs will be handled as String / String.</div> <!> <!> <!> <!></div>');function gt(K,T){he(T,!0);let s=p(""),_=p(r([])),f=p(!1),b=p(!1);Te(()=>{x()});async function S(){let c=await ba();if(!c.ok)t(s,"Error fetching attr: "+c.body.message);else return await c.json()}async function D(){let c=await _a(T.user.id);if(!c.ok)t(s,"Error fetching user attr: "+c.body.message);else return await c.json()}async function x(){let c=await S(),L=c.values;if(c){let N=await D();if(N){let P=new Map;for(let U of N.values)P.set(U.key,U.value||"");for(let U of L){let X=P.get(U.name);X?U.value=X:U.value=""}t(_,r([...L]))}}}async function j(){t(s,""),t(b,!0);let c=[];for(let U of e(_)){let X={key:U.name,value:U.value};c.push(X)}let L={values:c},N=await Ea(T.user.id,L),P=await N.json();N.ok?t(f,!0):t(s,r(P.message)),T.onSave(),t(b,!1)}var y=ht(),g=i(n(y),2);De(g,17,()=>e(_),ga,(c,L,N)=>{var P=Ne(()=>e(L).desc||"JSON Value");ie(c,{style:"width: 350px",autocomplete:"off",get placeholder(){return e(P)},get value(){return e(L).value},set value(U){e(L).value=U},children:(U,X)=>{z();var W=F();J(()=>ee(W,e(L).name)),l(U,W)},$$slots:{default:!0}})});var E=i(g,2);we(E,{get isLoading(){return e(b)},level:1,width:"4rem",$$events:{click:j},children:(c,L)=>{z();var N=F("SAVE");l(c,N)},$$slots:{default:!0}});var u=i(E,2);{var w=c=>{var L=pt();l(c,L)};A(u,c=>{e(f)&&c(w)})}var m=i(u,2);{var O=c=>{var L=ft(),N=n(L,!0);v(L),J(()=>ee(N,e(s))),l(c,L)};A(m,c=>{e(s)&&c(O)})}v(y),l(K,y),ge()}var yt=I('<div class="desc svelte-1a9qw6n">This user does not have any active MFA keys.</div>'),wt=I('<div class="keyContainer svelte-1a9qw6n"><div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Passkey Name:</div> <b> </b></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Key Registered:</div> <span class="font-mono"> </span></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Last Usage:</div> <span class="font-mono"> </span></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n"></div> <div class="deleteBtn svelte-1a9qw6n"><!></div></div></div>'),$t=I('<div class="desc svelte-1a9qw6n">You can delete the users MFA / Security Keys.<br> Be careful though, since this <b>cannot be reverted</b> without user interaction.<br> This is useful, if a user lost his keys and he is not able to log in any more.</div> <div class="keysContainer svelte-1a9qw6n"></div>',1),bt=I('<div class="err svelte-1a9qw6n"> </div>'),_t=I('<div class="container svelte-1a9qw6n"><!> <!></div>');function Et(K,T){he(T,!0);let s=$e(T,"user",27,()=>r({})),_=p(""),f=p(r([]));Te(async()=>{await b()});async function b(){let u=await Ga(s().id),w=await u.json();u.ok?t(f,r(w)):console.error("error fetching passkeys: "+w.message)}async function S(u){let w=e(f).length===1,m=await za(s().id,u);if(m.status===200)return await b(),w&&T.onSave(),!0;{let O=await m.json();return t(_,r(O.message)),!1}}var D=_t(),x=n(D);{var j=u=>{var w=yt();l(u,w)},y=u=>{var w=$t(),m=i(le(w),2);De(m,21,()=>e(f),O=>O.name,(O,c)=>{var L=wt(),N=n(L),P=i(n(N),2),U=n(P,!0);v(P),v(N);var X=i(N,2),W=i(n(X),2),oe=n(W,!0);J(()=>ee(oe,Se(e(c).registered))),v(W),v(X);var B=i(X,2),H=i(n(B),2),te=n(H,!0);J(()=>ee(te,Se(e(c).last_used))),v(H),v(B);var se=i(B,2),k=i(n(se),2),$=n(k);we($,{level:4,$$events:{click:()=>S(e(c).name)},children:(V,Q)=>{z();var o=F("DELETE");l(V,o)},$$slots:{default:!0}}),v(k),v(se),v(L),J(()=>ee(U,e(c).name)),l(O,L)}),v(m),l(u,w)};A(x,u=>{e(f).length<1?u(j):u(y,!1)})}var g=i(x,2);{var E=u=>{var w=bt(),m=n(w,!0);v(w),J(()=>ee(m,e(_))),l(u,w)};A(g,u=>{e(_)&&u(E)})}v(D),l(K,D),ge()}var It=I('<div class="container svelte-nw2ucx"><!></div>');function xt(K,T){he(T,!0);var s=It(),_=n(s);Xa(_,{get userId(){return T.user.id}}),v(s),l(K,s),ge()}var kt=I('<div class="data font-mono svelte-115hohv"> </div>'),St=I('<div class="data svelte-115hohv"> </div>'),Lt=I('<div class="header svelte-115hohv"><!> <!></div>'),qt=I("<div><!></div>"),Tt=I("<div><!></div>"),Nt=I("<div><!></div>"),Dt=I("<div><!></div>"),jt=I("<div><!></div>"),Pt=I("<div><!></div>"),Mt=I("<div><!></div>"),Ot=I("<!> <!>",1),Ct=I("<div><!></div>");function ia(K,T){he(T,!0);let s=$e(T,"userEmail",3,""),_=$e(T,"userId",3,""),f=$e(T,"onSave",15),b=p(void 0),S=p(!0),D=p(void 0);const x=["Info","Attributes","Password","MFA","Devices","Logout","Delete"];let j=p(r(x[0]));const y=200,g=y/2;async function E(){const w=await Ya(_());if(w.ok)t(b,r(await w.json()));else{let m=await w.json();console.error(m)}t(S,!1)}function u(){t(D,!1),f()()}Re(()=>{e(D)&&E()}),ea(K,{get show(){return e(D)},set show(w){t(D,r(w))},header:w=>{var m=Lt(),O=n(m);aa(O,{text:"User ID",children:(L,N)=>{var P=kt(),U=n(P,!0);v(P),J(()=>ee(U,_())),l(L,P)},$$slots:{default:!0}});var c=i(O,2);aa(c,{text:"E-Mail",children:(L,N)=>{var P=St(),U=n(P,!0);v(P),J(()=>ee(U,s())),l(L,P)},$$slots:{default:!0}}),v(m),l(w,m)},body:w=>{var m=Ct(),O=n(m);{var c=N=>{Ba(N,{})},L=N=>{var P=Ot(),U=le(P);Ra(U,{labels:x,get selected(){return e(j)},set selected(B){t(j,r(B))}});var X=i(U,2);{var W=B=>{var H=qt(),te=n(H);Qa(te,{get user(){return e(b)},set user(se){t(b,r(se))},get onSave(){return f()},set onSave(se){f(se)}}),v(H),ve(5,H,()=>ne,()=>({delay:g,duration:y})),ve(6,H,()=>ne,()=>({duration:y})),l(B,H)},oe=B=>{var H=ye(),te=le(H);{var se=$=>{var V=Tt(),Q=n(V);gt(Q,{get user(){return e(b)},set user(o){t(b,r(o))},get onSave(){return f()},set onSave(o){f(o)}}),v(V),ve(5,V,()=>ne,()=>({delay:g,duration:y})),ve(6,V,()=>ne,()=>({duration:y})),l($,V)},k=$=>{var V=ye(),Q=le(V);{var o=G=>{var d=Nt(),q=n(d);it(q,{get user(){return e(b)},set user(C){t(b,r(C))},get onSave(){return f()},set onSave(C){f(C)}}),v(d),ve(5,d,()=>ne,()=>({delay:g,duration:y})),ve(6,d,()=>ne,()=>({duration:y})),l(G,d)},h=G=>{var d=ye(),q=le(d);{var C=de=>{var re=Dt(),be=n(re);Et(be,{get user(){return e(b)},set user(ce){t(b,r(ce))},get onSave(){return f()},set onSave(ce){f(ce)}}),v(re),ve(5,re,()=>ne,()=>({delay:g,duration:y})),ve(6,re,()=>ne,()=>({duration:y})),l(de,re)},ue=de=>{var re=ye(),be=le(re);{var ce=ae=>{var Z=jt(),Le=n(Z);xt(Le,{get user(){return e(b)},set user(xe){t(b,r(xe))}}),v(Z),ve(5,Z,()=>ne,()=>({delay:g,duration:y})),ve(6,Z,()=>ne,()=>({duration:y})),l(ae,Z)},Y=ae=>{var Z=ye(),Le=le(Z);{var xe=me=>{var pe=Pt(),qe=n(pe);mt(qe,{get user(){return e(b)},set user(_e){t(b,r(_e))}}),v(pe),ve(5,pe,()=>ne,()=>({delay:g,duration:y})),ve(6,pe,()=>ne,()=>({duration:y})),l(me,pe)},Me=me=>{var pe=ye(),qe=le(pe);{var _e=ke=>{var Ee=Mt(),Oe=n(Ee);ot(Oe,{onSave:u,get user(){return e(b)},set user(Ce){t(b,r(Ce))}}),v(Ee),ve(5,Ee,()=>ne,()=>({delay:g,duration:y})),ve(6,Ee,()=>ne,()=>({duration:y})),l(ke,Ee)};A(qe,ke=>{e(j)==="Delete"&&ke(_e)},!0)}l(me,pe)};A(Le,me=>{e(j)==="Logout"?me(xe):me(Me,!1)},!0)}l(ae,Z)};A(be,ae=>{e(j)==="Devices"?ae(ce):ae(Y,!1)},!0)}l(de,re)};A(q,de=>{e(j)==="MFA"?de(C):de(ue,!1)},!0)}l(G,d)};A(Q,G=>{e(j)==="Password"?G(o):G(h,!1)},!0)}l($,V)};A(te,$=>{e(j)==="Attributes"?$(se):$(k,!1)},!0)}l(B,H)};A(X,B=>{e(j)==="Info"?B(W):B(oe,!1)})}l(N,P)};A(O,N=>{e(S)?N(c):N(L,!1)})}v(m),l(w,m)},$$slots:{header:!0,body:!0}}),ge()}var Ut=I('<div class="header font-label svelte-1y7ceqm">ADD NEW USER</div>'),Ft=I('<div class="err svelte-1y7ceqm"> </div>'),Rt=I('<div class="container svelte-1y7ceqm"><!> <!> <!> <div class="language svelte-1y7ceqm"><div class="label svelte-1y7ceqm">LANGUAGE</div> <div style="margin-top: .4rem"><!></div></div> <div class="tiles svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">ROLES</div> <!></div> <div class="tiles svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">GROUPS</div> <!></div> <div class="unit svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">LIMIT LIFETIME</div> <div class="value"><!></div></div> <!> <div class="btn svelte-1y7ceqm"><!> <!></div></div>');function At(K,T){he(T,!0);let s=$e(T,"idx",31,()=>-1),_=p(""),f=p(void 0),b=p("EN"),S=p(!1),D=p(void 0),x=p(r({email:"",family_name:"",given_name:"",roles:[],groups:[]})),j=p(r({}));const y=Ae().shape({email:fe().required("E-Mail is required").email("Bad E-Mail format"),given_name:fe().trim().required("Given Name is required").matches(Ve,"Invalid characters"),family_name:fe().trim().required("Family Name is required").matches(Ve,"Invalid characters")});let g=p(void 0);ze.subscribe(m=>{t(g,r(m))});let E=p(void 0);Ye.subscribe(m=>{t(E,r(m))});async function u(){if(!await w())return;t(_,"");let m=e(x);if(m.language=e(b).toLowerCase(),e(S)){let c=ra(e(D));if(!c){t(_,"Invalid Date Input: User Expires");return}m.user_expires=c}let O=await Ia(e(x));if(O.ok)t(x,r({})),t(f,!1),t(x,r({email:"",family_name:"",given_name:"",roles:[],groups:[]})),T.onSave();else{let c=await O.json();t(_,r(c.message))}}async function w(){try{return await y.validate(e(x),{abortEarly:!1}),t(j,r({})),!0}catch(m){return t(j,r(Ge(m))),!1}}ea(K,{get idx(){return s()},set idx(m){s(m)},get show(){return e(f)},set show(m){t(f,r(m))},header:m=>{var O=Ut();l(m,O)},body:m=>{var O=Rt(),c=n(O);ie(c,{type:"email",autocomplete:"off",placeholder:"E-Mail",get value(){return e(x).email},set value(d){e(x).email=d},get error(){return e(j).email},set error(d){e(j).email=d},$$events:{input:w},children:(d,q)=>{z();var C=F("E-MAIL");l(d,C)},$$slots:{default:!0}});var L=i(c,2);ie(L,{autocomplete:"off",placeholder:"Given Name",get value(){return e(x).given_name},set value(d){e(x).given_name=d},get error(){return e(j).given_name},set error(d){e(j).given_name=d},$$events:{input:w},children:(d,q)=>{z();var C=F("GIVEN NAME");l(d,C)},$$slots:{default:!0}});var N=i(L,2);ie(N,{autocomplete:"off",placeholder:"Family Name",get value(){return e(x).family_name},set value(d){e(x).family_name=d},get error(){return e(j).family_name},set error(d){e(j).family_name=d},$$events:{input:w},children:(d,q)=>{z();var C=F("FAMILY NAME");l(d,C)},$$slots:{default:!0}});var P=i(N,2),U=i(n(P),2),X=n(U);Je(X,{options:sa,get value(){return e(b)},set value(d){t(b,r(d))}}),v(U),v(P);var W=i(P,2),oe=i(n(W),2);Pe(oe,{get options(){return e(g)},searchThreshold:4,get items(){return e(x).roles},set items(d){e(x).roles=d}}),v(W);var B=i(W,2),H=i(n(B),2);Pe(H,{get options(){return e(E)},searchThreshold:4,get items(){return e(x).groups},set items(d){e(x).groups=d}}),v(B);var te=i(B,2);Ie(te,"margin-top","12px");var se=i(n(te),2),k=n(se);je(k,{get selected(){return e(S)},set selected(d){t(S,r(d))}}),v(se),v(te);var $=i(te,2);{var V=d=>{ie(d,{type:"datetime-local",step:"60",width:"18rem",get min(){return new Date().toISOString().split(".")[0]},max:"2099-01-01T00:00",get value(){return e(D)},set value(q){t(D,r(q))},$$events:{input:w},children:(q,C)=>{z();var ue=F("USER EXPIRES");l(q,ue)},$$slots:{default:!0}})};A($,d=>{e(S)&&d(V)})}var Q=i($,2),o=n(Q);we(o,{level:1,$$events:{click:u},children:(d,q)=>{z();var C=F("SAVE");l(d,C)},$$slots:{default:!0}});var h=i(o,2);{var G=d=>{var q=Ft(),C=n(q,!0);v(q),J(()=>ee(C,e(_))),l(d,q)};A(h,d=>{e(_)&&d(G)})}v(Q),v(O),l(m,O)},$$slots:{header:!0,body:!0}}),ge()}var Vt=I('<div class="svelte-1n3c0ep"><!></div>'),Gt=I('<div class="svelte-1n3c0ep"><!></div>'),zt=I(' <div class="content"><!> <!> <div id="users" class="svelte-1n3c0ep"><!></div> <!></div>',1);function Yt(K,T){he(T,!0);let s=p(""),_=p(r([])),f=p(r([])),b=p(r([])),S=p(""),D=p(!1),x=p(""),j=p(0),y=p(15),g=p(""),E=p(1),u=p(r([{label:"E-Mail",callback:(o,h)=>o.email.toLowerCase().includes(h.toLowerCase())},{label:"ID",callback:(o,h)=>o.id.toLowerCase().includes(h.toLowerCase())}])),w=p(r([{label:"E-Mail",callback:(o,h)=>o.email.localeCompare(h.email)},{label:"ID",callback:(o,h)=>o.id.localeCompare(h.id)},{label:"Created",callback:(o,h)=>o.created_at<h.created_at},{label:"Last Login",callback:(o,h)=>{let G=o.last_login||9999999999,d=h.last_login||9999999999;return G<d}}]));Te(async()=>{m(),L(),N()});async function m(o,h,G,d){let q;if(o===!0?G&&e(E)===2?q=await Qe(d||e(y),h,void 0,!1):q=await Qe(d||e(y),h,e(g),G):q=await xa(),!q.ok)t(s,"Error fetching users: "+q.body.message);else{q.status===206?(t(y,r(Number.parseInt(q.headers.get("x-page-size"),10))),t(S,"user"),q.headers.get("x-continuation-token"),t(g,r(q.headers.get("x-continuation-token")))):t(S,""),t(j,r(q.headers.get("x-user-count")));let C=await q.json();t(_,r([...C])),t(f,r([...C]))}}async function O(o,h){await m(!0,o,h),h?t(E,e(E)-1):t(E,e(E)+1)}async function c(o){t(g,""),await m(!0,0,!1,o),t(E,1)}async function L(){let o=await ka();if(!o.ok)t(s,"Error fetching roles: "+o.body.message);else{let h=await o.json();Ca.set(h),ze.set(h.map(G=>G.name))}}async function N(){let o=await Sa();if(!o.ok)t(s,"Error fetching groups: "+o.body.message);else{let h=await o.json();Ua.set(h),Ye.set(h.map(G=>G.name))}}function P(){m(),L(),N(),t(x,"")}z();var U=zt(),X=le(U),W=i(X),oe=n(W);La(oe,{get items(){return e(_)},get resItems(){return e(f)},set resItems(o){t(f,r(o))},get searchOptions(){return e(u)},set searchOptions(o){t(u,r(o))},get orderOptions(){return e(w)},set orderOptions(o){t(w,r(o))},get useServerSideIdx(){return e(S)},set useServerSideIdx(o){t(S,r(o))},get isSearchFiltered(){return e(D)},set isSearchFiltered(o){t(D,r(o))},get search(){return e(x)},set search(o){t(x,r(o))}});var B=i(oe,2);At(B,{onSave:P});var H=i(B,2),te=n(H);{var se=o=>{var h=ye(),G=le(h);De(G,17,()=>e(f),d=>d.id,(d,q)=>{var C=Vt(),ue=n(C);ia(ue,{get userId(){return e(q).id},get userEmail(){return e(q).email},onSave:P}),v(C),l(d,C)}),l(o,h)},k=o=>{var h=ye(),G=le(h);De(G,17,()=>e(b),d=>d.id,(d,q)=>{var C=Gt(),ue=n(C);ia(ue,{get userId(){return e(q).id},get userEmail(){return e(q).email},onSave:P}),v(C),l(d,C)}),l(o,h)};A(te,o=>{e(S)&&!e(D)?o(se):o(k,!1)})}v(H);var $=i(H,2);{var V=o=>{Ha(o,{get itemsTotal(){return e(j)},fetchPageCallback:O,sspPageSizeChange:c,get sspPage(){return e(E)},set sspPage(h){t(E,r(h))},get sspPageSize(){return e(y)},set sspPageSize(h){t(y,r(h))},get sspContinuationToken(){return e(g)},set sspContinuationToken(h){t(g,r(h))}})},Q=o=>{qa(o,{get items(){return e(f)},set items(h){t(f,r(h))},get resItems(){return e(b)},set resItems(h){t(b,r(h))}})};A($,o=>{e(S)&&!e(D)?o(V):o(Q,!1)})}v(W),J(()=>ee(X,`${e(s)??""} `)),l(K,U),ge()}export{Yt as U};
