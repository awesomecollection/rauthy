import{a as m,b as z,c as Q}from"./disclose-version.C0dpEWi_.js";import{p as V,o as N,j as D,g,a2 as a,a4 as t,a0 as I,a1 as k,a as ee,Z as L,_ as se}from"./index-client.LkyNpeLM.js";import{s as f}from"./render.D21ACvZ4.js";import{i as P}from"./if.BQqAvi9S.js";import{d as re,s as ae,L as te}from"./Loading.CZYfBo5y.js";import{p as Z}from"./proxy.bVSoDcUp.js";import{s as ie,p as y,a as oe}from"./props.BDzDHVdA.js";import{t as de}from"./tweened._kLXMt8j.js";import{z as ne,D as _,E as w,Z as ce,$ as le}from"./dataFetching.C4rEqQY1.js";import{u as ve}from"./i18n.svelte.DPkpATkG.js";async function pe(u,d,h){let o=await ne(u,d);if(o.status===200){let r=await o.json(),n=r.rcr;n.publicKey.challenge=_(n.publicKey.challenge);for(let c of n.publicKey.allowCredentials)c.id=_(c.id);let i;try{i=await navigator.credentials.get(n)}catch(c){return console.error(c),{err:!0,msg:h||"Invalid Key"}}let j={code:r.code,data:{id:i.id,rawId:w(i.rawId),response:{authenticatorData:w(i.response.authenticatorData),clientDataJSON:w(i.response.clientDataJSON),signature:w(i.response.signature)},type:i.type}};return o=await ce(u,j),o.status===202?{err:!1,msg:"Authentication successful",body:await o.json()}:(console.error(o),{err:!0,msg:"Authentication Error"})}else return console.error(o),{err:!0,msg:"Error starting the Authentication"}}var ue=z('<div class="good svelte-jsdqii"> </div>'),me=z('<div class="err svelte-jsdqii"> </div>'),ge=z('<div class="wrapperOuter svelte-jsdqii"><div class="wrapperInner svelte-jsdqii"><div class="content svelte-jsdqii"><div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div></div> <div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div> <div><progress class="svelte-jsdqii"></progress></div></div> <div class="contentRow svelte-jsdqii"><!></div></div></div></div>');function fe(u,d){V(d,!0);const h=ie(),o=()=>oe(T,"$progress",h);let r=y(d,"data",15),n=y(d,"purpose",3,"Login"),i=y(d,"onError",3,e=>{}),j=y(d,"onSuccess",3,e=>{}),c=L(!1),R=L(""),q=L(!1),l=ve(),T=de(r().exp,{duration:r().exp*1e3});N(()=>{let e=setTimeout(()=>{r(void 0)},r().exp*1e3);return T.set(0),()=>clearTimeout(e)}),N(async()=>{let e;n()==="Login"?e={purpose:{Login:r().code}}:e={purpose:n()};let s={};try{s=await le(pe(r().user_id,e,(l==null?void 0:l.authorize.invalidKeyUsed)||"Invalid Key"),r().exp*1e3-1e3)}catch(p){console.error(p),s.err=!0,s.msg="Timeout",i()("Passkey Error")}D(c,Z(s.err)),D(q,!s.err),D(R,Z(s.msg)),g(q)?j()(s.body):setTimeout(()=>{i()()},3e3)});var x=ge(),O=a(x),S=a(O),b=a(S),$=a(b),F=a($,!0);t($),t(b);var E=I(b,2),A=a(E),U=a(A);t(A);var H=I(A,2),J=a(H);t(H),t(E);var M=I(E,2),W=a(M);{var B=e=>{var s=ue(),p=a(s,!0);t(s),k(()=>f(p,l.authorize.mfaAck||"Acknowledged")),m(e,s)},C=e=>{var s=Q(),p=se(s);{var X=v=>{var K=me(),G=a(K,!0);t(K),k(()=>f(G,g(R))),m(v,K)},Y=v=>{te(v,{background:!1})};P(p,v=>{g(c)?v(X):v(Y,!1)},!0)}m(e,s)};P(W,e=>{g(q)?e(B):e(C,!1)})}t(M),t(S),t(O),t(x),k(()=>{f(F,l.authorize.provideMfa||"Please login with your MFA device"),f(U,`${l.authorize.requestExpires||"Request expires"}
                    :`),re(J,o()),ae(J,"max",r().exp)}),m(u,x),ee()}export{fe as W};
