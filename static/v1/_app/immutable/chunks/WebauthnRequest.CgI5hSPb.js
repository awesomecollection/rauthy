import"./disclose-version.BDr9Qe-U.js";import{p as G,o as J,j as T,g as m,U as a,W as t,R as I,T as R,a as V,P as k,Q as ee}from"./index-client.CzqVbBUo.js";import{s as g}from"./render.DOFZNw8l.js";import{p as M,i as N}from"./if.BnegfJmL.js";import{a as f,b as z,c as se}from"./template.C3U8HW1x.js";import{c as re,s as ae,L as te}from"./Button.65naIT6w.js";import{s as ie,p as y,a as oe}from"./props.C_MHtC74.js";import{t as de}from"./tweened.B25itCeH.js";import{A as ce,E as U,F as w,Z as ne,$ as le}from"./dataFetching.BAMt2mQp.js";import{u as ve}from"./i18n.svelte.C_qSL0ZA.js";async function pe(u,d,h){let o=await ce(u,d);if(o.status===200){let r=await o.json(),c=r.rcr;c.publicKey.challenge=U(c.publicKey.challenge);for(let n of c.publicKey.allowCredentials)n.id=U(n.id);let i;try{i=await navigator.credentials.get(c)}catch(n){return console.error(n),{err:!0,msg:h||"Invalid Key"}}let j={code:r.code,data:{id:i.id,rawId:w(i.rawId),response:{authenticatorData:w(i.response.authenticatorData),clientDataJSON:w(i.response.clientDataJSON),signature:w(i.response.signature)},type:i.type}};return o=await ne(u,j),o.status===202?{err:!1,msg:"Authentication successful",body:await o.json()}:(console.error(o),{err:!0,msg:"Authentication Error"})}else return console.error(o),{err:!0,msg:"Error starting the Authentication"}}var ue=z('<div class="good svelte-jsdqii"> </div>'),me=z('<div class="err svelte-jsdqii"> </div>'),ge=z('<div class="wrapperOuter svelte-jsdqii"><div class="wrapperInner svelte-jsdqii"><div class="content svelte-jsdqii"><div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div></div> <div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div> <div><progress class="svelte-jsdqii"></progress></div></div> <div class="contentRow svelte-jsdqii"><!></div></div></div></div>');function fe(u,d){G(d,!0);const h=ie(),o=()=>oe(L,"$progress",h);let r=y(d,"data",15),c=y(d,"purpose",3,"Login"),i=y(d,"onError",3,e=>{}),j=y(d,"onSuccess",3,e=>{}),n=k(!1),D=k(""),q=k(!1),l=ve(),L=de(r().exp,{duration:r().exp*1e3});J(()=>{let e=setTimeout(()=>{r(void 0)},r().exp*1e3);return L.set(0),()=>clearTimeout(e)}),J(async()=>{let e;c()==="Login"?e={purpose:{Login:r().code}}:e={purpose:c()};let s={};try{s=await le(pe(r().user_id,e,(l==null?void 0:l.authorize.invalidKeyUsed)||"Invalid Key"),r().exp*1e3-1e3)}catch(p){console.error(p),s.err=!0,s.msg="Timeout",i()("Passkey Error")}T(n,M(s.err)),T(q,!s.err),T(D,M(s.msg)),m(q)?j()(s.body):setTimeout(()=>{i()()},3e3)});var x=ge(),O=a(x),P=a(O),b=a(P),S=a(b),W=a(S,!0);t(S),t(b);var A=I(b,2),E=a(A),C=a(E);t(E);var $=I(E,2),F=a($);t($),t(A);var H=I(A,2),_=a(H);{var B=e=>{var s=ue(),p=a(s,!0);t(s),R(()=>g(p,l.authorize.mfaAck||"Acknowledged")),f(e,s)},Q=e=>{var s=se(),p=ee(s);{var X=v=>{var K=me(),Z=a(K,!0);t(K),R(()=>g(Z,m(D))),f(v,K)},Y=v=>{te(v,{background:!1})};N(p,v=>{m(n)?v(X):v(Y,!1)},!0)}f(e,s)};N(_,e=>{m(q)?e(B):e(Q,!1)})}t(H),t(P),t(O),t(x),R(()=>{g(W,l.authorize.provideMfa||"Please login with your MFA device"),g(C,`${l.authorize.requestExpires||"Request expires"}
                    :`),re(F,o()),ae(F,"max",r().exp)}),f(u,x),V()}export{fe as W};
