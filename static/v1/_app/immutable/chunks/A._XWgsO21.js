import{a as w}from"./ThemeSwitch.roIqycWj.js";import{b as f,a as m}from"./WebauthnRequest.DdM1Tehs.js";import{E as v}from"./helpers.DwhnXD2f.js";import"./disclose-version.BDr9Qe-U.js";import{p as x,c as D,r as O,t as C,a as E,g as S,y as $}from"./index-client.BTDbhFDr.js";import{a as k,t as T}from"./template.WjkCsOA4.js";import{s as U}from"./snippet.DrOrOIgy.js";import{s as c,b as W}from"./index.C-OHSz9E.js";import{p as o}from"./props.C0sO4y_5.js";import{p as n}from"./index.Bm2cNtlW.js";async function _(l,e,u,d){var y,b;let h={passkey_name:e},s=await w(`/auth/v1/users/${l}/webauthn/register/start`,h);if(!s.body)return{error:((y=s.error)==null?void 0:y.message)||"did not receive any registration data"};let t=s.body;if(!t.publicKey){let i="no publicKey in options from the backend";return console.error(i),{error:i}}if(t.publicKey.challenge=f(t.publicKey.challenge),t.publicKey.user.id=f(t.publicKey.user.id),t.publicKey.excludeCredentials)for(let i of t.publicKey.excludeCredentials)i.id=f(i.id);let p=(t.publicKey.timeout||6e4)-1e3;const r=new Date().getTime()+p;let a;try{const i=await v(navigator.credentials.create(t),p);if(i)a=i;else return{error:u}}catch{return{error:new Date().getTime()>=r?d:u}}let K={passkey_name:e,data:{id:a.id,rawId:m(a.rawId),response:{attestationObject:m(a.response.attestationObject),clientDataJSON:m(a.response.clientDataJSON)},extensions:a.getClientExtensionResults(),type:a.type}},g=await w(`/auth/v1/users/${l}/webauthn/register/finish`,K);return g.status===201?{}:{error:((b=g.error)==null?void 0:b.message)||"Registration failed"}}var j=T('<a class="font-label svelte-1cyodh8"><!></a>');function I(l,e){x(e,!0);let u=o(e,"selectedStep",3,!1),d=o(e,"hideUnderline",3,!1),h=o(e,"highlight",3,!1),s=o(e,"highlightExact",3,!0),t=o(e,"highlightWithParams",3,!1),p=$(()=>{if(u())return"step";if(t()){if(`${n.route.id}${n.url.search}`.startsWith(e.href))return"page"}else if(s()){if(n.route.id===e.href.split("?")[0])return"page"}else if(n.route.id&&n.route.id.startsWith(e.href.split("?")[0]))return"page"});var r=j(),a=D(r);U(a,()=>e.children),O(r),C(()=>{c(r,"href",e.href),c(r,"target",e.target),c(r,"aria-current",S(p)),c(r,"data-highlight",h()),W(r,"hideUnderline",d())}),k(l,r),E()}export{I as A,_ as w};
