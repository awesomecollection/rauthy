import{b}from"./fetch.BnpwKXAn.js";import{b as i,a as s}from"./WebauthnRequest.D7AXCzJU.js";import{p as w}from"./helpers.BweJi6s8.js";async function h(n,o,l,y){var p,d;let m={passkey_name:o},a=await b(`/auth/v1/users/${n}/webauthn/register/start`,m);if(!a.body)return{error:((p=a.error)==null?void 0:p.message)||"did not receive any registration data"};let e=a.body;if(!e.publicKey){let t="no publicKey in options from the backend";return console.error(t),{error:t}}if(e.publicKey.challenge=i(e.publicKey.challenge),e.publicKey.user.id=i(e.publicKey.user.id),e.publicKey.excludeCredentials)for(let t of e.publicKey.excludeCredentials)t.id=i(t.id);let c=(e.publicKey.timeout||6e4)-1e3;const f=new Date().getTime()+c;let r;try{const t=await w(navigator.credentials.create(e),c);if(t)r=t;else return{error:l}}catch{return{error:new Date().getTime()>=f?y:l}}let g={passkey_name:o,data:{id:r.id,rawId:s(r.rawId),response:{attestationObject:s(r.response.attestationObject),clientDataJSON:s(r.response.clientDataJSON)},extensions:r.getClientExtensionResults(),type:r.type}},u=await b(`/auth/v1/users/${n}/webauthn/register/finish`,g);return u.status===201?{}:{error:((d=u.error)==null?void 0:d.message)||"Registration failed"}}export{h as w};
