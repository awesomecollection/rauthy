import"./disclose-version.BDr9Qe-U.js";import{p as fe,A as p,a0 as fa,y as e,z as t,ap as Me,c as n,s as i,r as v,ar as z,t as J,a as ge,ab as Te,f as le}from"./index-client.CVQra9Cu.js";import{s as ee}from"./render.CkKFmY3E.js";import{i as R}from"./if._4yhN2kP.js";import{e as Ne,i as ga}from"./each.D7w_Y1pv.js";import{d as F,a as l,t as I,e as ye}from"./template.4ZWi6dE6.js";import{p as r}from"./proxy.Dc6q2r8X.js";import{j as Ke,k as ya,l as wa,m as $a,g as ba,n as _a,u as Ea,o as Ia,q as xa,h as ka,r as Sa,s as Qe}from"./dataFetchingAdmin.DA15Jmej.js";import{a as Ie,t as ve,s as ne}from"./index.CkVfMYgG.js";import{p as $e}from"./props.BVYR8gU-.js";import{r as Ae}from"./legacy-client.nffOF2oE.js";import{E as Je,T as ea,a as La,O as qa,P as Ma}from"./Pagination.AI5NcTku.js";import{c as Re,a as he,b as Ta,I as ie,B as we}from"./Input.BLzcZ_Un.js";import{l as Se,a0 as Ve,a1 as Na,a2 as ja,a3 as Pa,a4 as Oa,a5 as aa,N as ta,A as sa,q as Ge,a6 as Ca,z as Da}from"./helpers.BweJi6s8.js";import{S as je}from"./Switch.BxcKRi58.js";import{g as ze,a as Ye,I as Pe,b as Ua,c as Fa}from"./ItemTiles.OhU5JS-h.js";import{C as Aa}from"./CheckIcon.BEZpWWv8.js";import{O as ra}from"./OptionSelect.BFtPftoi.js";import{P as la}from"./PasswordInput.DBSvQw8Y.js";import{P as Ra}from"./PasswordPolicy.C-eS1uVN.js";import{f as Va,h as Ga,w as za,i as Ya}from"./dataFetching.DHlo1LT-.js";import{L as Ba}from"./Loading.BhsEZHIf.js";import{D as Xa}from"./Devices.CLxhARB9.js";import{P as Ha}from"./PaginationServer.CLdcNeWV.js";var Wa=I('<div class="success svelte-tl4x7h">Success</div>'),Za=I('<div class="err svelte-tl4x7h"> </div>'),Ka=I('<div class="container svelte-tl4x7h"><div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">USER ID</div> <div class="value font-mono svelte-tl4x7h"> </div></div> <div class="row svelte-tl4x7h"><div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">ENABLED</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">E-MAIL VERIFIED</div> <div class="value svelte-tl4x7h"><!></div></div></div> <!> <!> <!> <div class="unit language svelte-tl4x7h"><div class="label svelte-tl4x7h">LANGUAGE</div> <div style="margin-top: .085rem"><!></div></div> <!> <!> <!> <!> <!> <!> <div class="unit svelte-tl4x7h"><div class="label svelte-tl4x7h">ROLES</div> <!></div> <div class="unit svelte-tl4x7h"><div class="label svelte-tl4x7h">GROUPS</div> <!></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">LIMIT LIFETIME</div> <div class="value svelte-tl4x7h"><!></div></div> <!> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">CREATED</div> <div class="value svelte-tl4x7h"> </div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">LAST LOGIN</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">PASSWORD EXPIRES</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">MFA ACTIVE</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><!> <!> <!></div></div>');function Qa(K,M){fe(M,!0);let s=$e(M,"user",31,()=>r({}));s().roles===void 0&&s(s().roles=[],!0),s().groups===void 0&&s(s().groups=[],!0);let _=p(""),h=p(!1),b=p(void 0),S=p(r(s().language.toUpperCase())),N=p(!!s().user_expires),x=p(r(fa(()=>e(N))?Se(s().user_expires,!0):void 0)),j=p(r([]));ze.subscribe(a=>{t(j,r(a))});let y=p(r([]));Ye.subscribe(a=>{t(y,r(a))}),Ae(()=>{e(h)&&t(b,r(setTimeout(()=>{t(h,!1),M.onSave()},3e3)))});let g=p(r({}));const E=Re().shape({email:he().required("E-Mail is required").email("Bad E-Mail format"),given_name:he().trim().required("Given Name is required").matches(Ve,"Invalid characters"),family_name:he().nullable().trim().matches(Na,"Invalid characters")});let u=p(r({}));const w=Re().shape({birthdate:he().nullable().trim().matches(ja,"Invalid characters"),phone:he().nullable().trim().matches(Pa,"Format: +..."),street:he().nullable().trim().matches(Oa,"Invalid characters"),zip:Ta().nullable().min(1e3).max(999999),city:he().nullable().trim().matches(aa,"Invalid characters"),country:he().nullable().trim().matches(aa,"Invalid characters")});Me(()=>()=>clearTimeout(e(b)));function m(a){a.code==="Enter"&&C()}async function C(){if(!await c())return;t(_,""),console.log(s().user_values);const a={email:s().email,given_name:s().given_name,family_name:s().family_name||null,language:e(S).toLowerCase(),roles:s().roles,groups:s().groups,enabled:s().enabled,email_verified:s().email_verified,user_expires:null,user_values:s().user_values};if(a.user_values.phone&&(a.user_values.phone=a.user_values.phone.replaceAll(" ","")),a.user_values.zip&&(a.user_values.zip=Number.parseInt(a.user_values.zip)),e(N)){let A=sa(e(x));if(!A){t(_,"Invalid Date Input: User Expires");return}a.user_expires=A}let O=await Ke(s().id,a);if(O.ok)t(h,!0);else{let A=await O.json();t(_,r(A.message))}}async function c(){let a=!0;try{await E.validate(s(),{abortEarly:!1}),t(g,r({}))}catch(O){t(g,r(Ge(O))),a=!1}try{await w.validate(s().user_values,{abortEarly:!1}),t(u,r({}))}catch(O){t(u,r(Ge(O))),a=!1}return a}var L=Ka(),T=n(L),P=i(n(T),2),U=n(P,!0);v(P),v(T);var X=i(T,2);Ie(X,"margin-top","-5px");var W=n(X);Ie(W,"width","107px");var oe=i(n(W),2),B=n(oe);je(B,{get selected(){return s().enabled},set selected(a){s(s().enabled=a,!0)}}),v(oe),v(W);var H=i(W,2);Ie(H,"width","135px");var te=i(n(H),2),se=n(te);je(se,{get selected(){return s().email_verified},set selected(a){s(s().email_verified=a,!0)}}),v(te),v(H),v(X);var k=i(X,2);ie(k,{type:"email",autocomplete:"off",placeholder:"E-Mail",get value(){return s().email},set value(a){s(s().email=a,!0)},get error(){return e(g).email},set error(a){e(g).email=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("E-MAIL");l(a,A)},$$slots:{default:!0}});var $=i(k,2);ie($,{autocomplete:"off",placeholder:"Given Name",get value(){return s().given_name},set value(a){s(s().given_name=a,!0)},get error(){return e(g).given_name},set error(a){e(g).given_name=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("GIVEN NAME");l(a,A)},$$slots:{default:!0}});var V=i($,2);ie(V,{autocomplete:"off",placeholder:"Family Name",get value(){return s().family_name},set value(a){s(s().family_name=a,!0)},get error(){return e(g).family_name},set error(a){e(g).family_name=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("FAMILY NAME");l(a,A)},$$slots:{default:!0}});var Q=i(V,2),o=i(n(Q),2),f=n(o);ra(f,{options:ta,get value(){return e(S)},set value(a){t(S,r(a))}}),v(o),v(Q);var G=i(Q,2);ie(G,{autocomplete:"off",placeholder:"Street",get value(){return s().user_values.street},set value(a){s(s().user_values.street=a,!0)},get error(){return e(u).street},set error(a){e(u).street=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("STREET");l(a,A)},$$slots:{default:!0}});var d=i(G,2);ie(d,{type:"number",autocomplete:"off",placeholder:"ZIP",min:1e3,max:999999,get value(){return s().user_values.zip},set value(a){s(s().user_values.zip=a,!0)},get error(){return e(u).zip},set error(a){e(u).zip=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("ZIP");l(a,A)},$$slots:{default:!0}});var q=i(d,2);ie(q,{autocomplete:"off",placeholder:"City",get value(){return s().user_values.city},set value(a){s(s().user_values.city=a,!0)},get error(){return e(u).city},set error(a){e(u).city=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("CITY");l(a,A)},$$slots:{default:!0}});var D=i(q,2);ie(D,{autocomplete:"off",placeholder:"Country",get value(){return s().user_values.country},set value(a){s(s().user_values.country=a,!0)},get error(){return e(u).country},set error(a){e(u).country=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("COUNTRY");l(a,A)},$$slots:{default:!0}});var ue=i(D,2);ie(ue,{autocomplete:"off",placeholder:"Phone",get value(){return s().user_values.phone},set value(a){s(s().user_values.phone=a,!0)},get error(){return e(u).phone},set error(a){e(u).phone=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("PHONE");l(a,A)},$$slots:{default:!0}});var de=i(ue,2);ie(de,{type:"date",autocomplete:"off",placeholder:"Birthdate",get value(){return s().user_values.birthdate},set value(a){s(s().user_values.birthdate=a,!0)},get error(){return e(u).birthdate},set error(a){e(u).birthdate=a},$$events:{keypress:m,input:c},children:(a,O)=>{z();var A=F("BIRTHDATE");l(a,A)},$$slots:{default:!0}});var re=i(de,2);Ie(re,"margin-top","-3px");var be=i(n(re),2);Pe(be,{get options(){return e(j)},searchThreshold:4,get items(){return s().roles},set items(a){s(s().roles=a,!0)}}),v(re);var ce=i(re,2),Y=i(n(ce),2);Pe(Y,{get options(){return e(y)},searchThreshold:4,get items(){return s().groups},set items(a){s(s().groups=a,!0)}}),v(ce);var ae=i(ce,2);Ie(ae,"margin-top","12px");var Z=i(n(ae),2),Le=n(Z);je(Le,{get selected(){return e(N)},set selected(a){t(N,r(a))}}),v(Z),v(ae);var xe=i(ae,2);{var Oe=a=>{var O=Te(()=>Ca(new Date));ie(a,{type:"datetime-local",step:"60",width:"16rem",get min(){return e(O)},max:"2099-01-01T00:00",get value(){return e(x)},set value(A){t(x,r(A))},$$events:{input:c},children:(A,Bt)=>{z();var ha=F("USER EXPIRES");l(A,ha)},$$slots:{default:!0}})};R(xe,a=>{e(N)&&a(Oe)})}var me=i(xe,2);Ie(me,"margin-top","12px");var pe=i(n(me),2),qe=n(pe,!0);J(()=>ee(qe,Se(s().created_at))),v(pe),v(me);var _e=i(me,2),ke=i(n(_e),2),Ee=n(ke);{var Ce=a=>{var O=F();J(()=>ee(O,Se(s().last_login))),l(a,O)},De=a=>{var O=F("Never");l(a,O)};R(Ee,a=>{s().last_login?a(Ce):a(De,!1)})}v(ke),v(_e);var Ue=i(_e,2),Be=i(n(Ue),2),va=n(Be);{var na=a=>{var O=F();J(()=>ee(O,Se(s().password_expires))),l(a,O)},oa=a=>{var O=F("Never");l(a,O)};R(va,a=>{s().password_expires?a(na):a(oa,!1)})}v(Be),v(Ue);var Fe=i(Ue,2),Xe=i(n(Fe),2),ua=n(Xe),da=Te(()=>!!s().webauthn_user_id);Aa(ua,{get check(){return e(da)}}),v(Xe),v(Fe);var He=i(Fe,2),We=n(He);we(We,{level:1,width:"4rem",$$events:{click:C},children:(a,O)=>{z();var A=F("SAVE");l(a,A)},$$slots:{default:!0}});var Ze=i(We,2);{var ca=a=>{var O=Wa();l(a,O)};R(Ze,a=>{e(h)&&a(ca)})}var ma=i(Ze,2);{var pa=a=>{var O=Za(),A=n(O,!0);v(O),J(()=>ee(A,e(_))),l(a,O)};R(ma,a=>{e(_)&&a(pa)})}v(He),v(L),J(()=>ee(U,s().id)),l(K,L),ge()}var Ja=I('<div class="desc svelte-8ppjyk"><p><b>The user has not initialized this account yet.</b></p> <p>You may send out a new Reset E-Mail, if the user has not received one.</p></div> <!>',1),et=I(`<div class="desc svelte-8ppjyk"><p><b>This is a passkey only account type.</b></p> <p>This means, that this user is using the passwordless login flow only and does not have any password.</p> <p>If the user has lost all his keys and you have verified everything, you may reset his account type and
                send out a new reset E-Mail, so the user can get access again.</p> <p>To reset the account, navigate to 'MFA' and delete all registered keys for this user.</p></div>`),at=I(`<!> <!> <!> <!> <div class="desc svelte-8ppjyk">You can either set and reset a user's password<br> or send out a new reset E-Mail for self-service.</div> <!> <!>`,1),tt=I('<div class="success svelte-8ppjyk">Success</div>'),st=I('<div class="err svelte-8ppjyk"> </div>'),rt=I('<div class="err svelte-8ppjyk"> </div>'),lt=I('<div class="container svelte-8ppjyk"><!> <!> <!> <!></div>');function it(K,M){fe(M,!0);let s=$e(M,"user",27,()=>r({}));const _="inherit";let h=p(!1),b=p(""),S=p(""),N=p(!1),x=p(!1),j=p(void 0),y="330px",g=p(void 0),E=p(!1),u=r({new:"",verify:""});Ae(()=>{e(x)&&t(j,r(setTimeout(()=>{t(x,!1),M.onSave()},3e3)))}),Me(async()=>{if(!e(g)){let k=await Va(),$=await k.json();k.ok?t(g,r($)):t(S,r($.message))}});async function w(){return t(S,""),await m()?e(E)?!0:(t(S,"You must follow the password policy"),!1):!1}async function m(){return t(S,""),u.new.length>256?(t(S,"max 256 characters"),!1):u.new!==u.verify?(t(S,"New passwords do not match"),!1):!0}async function C(){let k={email:s().email};t(b,""),t(h,!0);let $=await ya(k);if($.ok)t(N,!0);else{let V=await $.json();t(b,r(V.message))}t(h,!1)}async function c(){let k={email:s().email,given_name:s().given_name,family_name:s().family_name,roles:s().roles,groups:s().groups,enabled:s().enabled,email_verified:s().email_verified};if(u.new.length>0){if(!(await m()&&await w()))return;k.password=u.new}t(S,""),t(h,!0);let $=await Ke(s().id,k);if($.ok)t(x,!0);else{let V=await $.json();t(S,r(V.message))}t(h,!1)}function L(){const k=e(g).length_min>24?e(g).length_min:24;let $=Da(k,e(g).include_lower_case,e(g).include_upper_case,e(g).include_digits,e(g).include_special);u.new=$,u.verify=$}var T=lt(),P=n(T);{var U=k=>{var $=Ja(),V=i(le($),2);we(V,{width:_,level:2,get isLoading(){return e(h)},set isLoading(Q){t(h,r(Q))},$$events:{click:C},children:(Q,o)=>{z();var f=F("SEND RESET E-MAIL");l(Q,f)},$$slots:{default:!0}}),l(k,$)},X=k=>{var $=ye(),V=le($);{var Q=f=>{var G=et();l(f,G)},o=f=>{var G=at(),d=le(G);{var q=Y=>{Ra(Y,{get password(){return u.new},get policy(){return e(g)},get accepted(){return e(E)},set accepted(ae){t(E,r(ae))}})};R(d,Y=>{e(g)&&Y(q)})}var D=i(d,2),ue=Te(()=>u.new.length>0&&u.new===u.verify);la(D,{type:"password",get width(){return y},autocomplete:"off",get showCopy(){return e(ue)},get value(){return u.new},set value(Y){u.new=Y},$$events:{blur:m},children:(Y,ae)=>{z();var Z=F("New Password");l(Y,Z)},$$slots:{default:!0}});var de=i(D,2);la(de,{type:"password",get width(){return y},autocomplete:"off",get value(){return u.verify},set value(Y){u.verify=Y},$$events:{blur:m},children:(Y,ae)=>{z();var Z=F("New Password");l(Y,Z)},$$slots:{default:!0}});var re=i(de,2);we(re,{width:_,level:3,$$events:{click:L},children:(Y,ae)=>{z();var Z=F("GENERATE RANDOM");l(Y,Z)},$$slots:{default:!0}});var be=i(re,4);we(be,{width:_,level:1,get isLoading(){return e(h)},set isLoading(Y){t(h,r(Y))},$$events:{click:C},children:(Y,ae)=>{z();var Z=F("SEND RESET E-MAIL");l(Y,Z)},$$slots:{default:!0}});var ce=i(be,2);we(ce,{width:_,get isLoading(){return e(h)},set isLoading(Y){t(h,r(Y))},$$events:{click:c},children:(Y,ae)=>{z();var Z=F("SAVE PASSWORD");l(Y,Z)},$$slots:{default:!0}}),l(f,G)};R(V,f=>{s().account_type==="passkey"?f(Q):f(o,!1)},!0)}l(k,$)};R(P,k=>{s().account_type==="new"?k(U):k(X,!1)})}var W=i(P,2);{var oe=k=>{var $=tt();l(k,$)};R(W,k=>{(e(x)||e(N))&&k(oe)})}var B=i(W,2);{var H=k=>{var $=st(),V=n($,!0);v($),J(()=>ee(V,e(S))),l(k,$)};R(B,k=>{e(S)&&k(H)})}var te=i(B,2);{var se=k=>{var $=rt(),V=n($,!0);v($),J(()=>ee(V,e(b))),l(k,$)};R(te,k=>{e(b)&&k(se)})}v(T),l(K,T),ge()}var vt=I('<div class="err svelte-1jljqe9"> </div>'),nt=I('<div class="container svelte-1jljqe9"><div class="label svelte-1jljqe9">Are you sure, you want to delete this user?</div> <!> <!></div>');function ot(K,M){fe(M,!0);let s=$e(M,"user",27,()=>r({})),_=p(!1),h=p("");async function b(){t(h,""),t(_,!0);let y=await wa(s().id);if(y.ok)M.onSave();else{let g=await y.json();t(h,r(g.message))}t(_,!1)}var S=nt(),N=i(n(S),2);we(N,{level:1,width:"5rem",get isLoading(){return e(_)},set isLoading(y){t(_,r(y))},$$events:{click:b},children:(y,g)=>{z();var E=F("DELETE");l(y,E)},$$slots:{default:!0}});var x=i(N,2);{var j=y=>{var g=vt(),E=n(g,!0);v(g),J(()=>ee(E,e(h))),l(y,g)};R(x,y=>{e(h)&&y(j)})}v(S),l(K,S),ge()}var ut=I('<div class="err svelte-1ofwsjt"> </div>'),dt=I('<div class="success svelte-1ofwsjt">Success</div>'),ct=I('<div class="container svelte-1ofwsjt"><div class="label svelte-1ofwsjt">Invalidate all existing sessions and refresh tokens for this user?</div> <!> <!></div>');function mt(K,M){fe(M,!0);let s=$e(M,"user",27,()=>r({})),_=p(!1),h=p(""),b=p(!1);async function S(){t(h,""),t(_,!0);let E=await $a(s().id);if(E.ok)t(b,!0);else{let u=await E.json();t(h,r(u.message))}t(_,!1)}var N=ct(),x=i(n(N),2);we(x,{level:1,get isLoading(){return e(_)},set isLoading(E){t(_,r(E))},$$events:{click:S},children:(E,u)=>{z();var w=F("LOGOUT");l(E,w)},$$slots:{default:!0}});var j=i(x,2);{var y=E=>{var u=ut(),w=n(u,!0);v(u),J(()=>ee(w,e(h))),l(E,u)},g=E=>{var u=ye(),w=le(u);{var m=C=>{var c=dt();l(C,c)};R(w,C=>{e(b)&&C(m)},!0)}l(E,u)};R(j,E=>{e(h)?E(y):E(g,!1)})}v(N),l(K,N),ge()}var pt=I('<div class="success svelte-iv4fzr">Success</div>'),ht=I('<div class="err svelte-iv4fzr"> </div>'),ft=I('<div class="container svelte-iv4fzr"><div class="desc svelte-iv4fzr">Set custom user attributes.<br> All Key / Value pairs will be handled as String / String.</div> <!> <!> <!> <!></div>');function gt(K,M){fe(M,!0);let s=p(""),_=p(r([])),h=p(!1),b=p(!1);Me(()=>{x()});async function S(){let c=await ba();if(!c.ok)t(s,"Error fetching attr: "+c.body.message);else return await c.json()}async function N(){let c=await _a(M.user.id);if(!c.ok)t(s,"Error fetching user attr: "+c.body.message);else return await c.json()}async function x(){let c=await S(),L=c.values;if(c){let T=await N();if(T){let P=new Map;for(let U of T.values)P.set(U.key,U.value||"");for(let U of L){let X=P.get(U.name);X?U.value=X:U.value=""}t(_,r([...L]))}}}async function j(){t(s,""),t(b,!0);let c=[];for(let U of e(_)){let X={key:U.name,value:U.value};c.push(X)}let L={values:c},T=await Ea(M.user.id,L),P=await T.json();T.ok?t(h,!0):t(s,r(P.message)),M.onSave(),t(b,!1)}var y=ft(),g=i(n(y),2);Ne(g,17,()=>e(_),ga,(c,L,T)=>{var P=Te(()=>e(L).desc||"JSON Value");ie(c,{style:"width: 350px",autocomplete:"off",get placeholder(){return e(P)},get value(){return e(L).value},set value(U){e(L).value=U},children:(U,X)=>{z();var W=F();J(()=>ee(W,e(L).name)),l(U,W)},$$slots:{default:!0}})});var E=i(g,2);we(E,{get isLoading(){return e(b)},level:1,width:"4rem",$$events:{click:j},children:(c,L)=>{z();var T=F("SAVE");l(c,T)},$$slots:{default:!0}});var u=i(E,2);{var w=c=>{var L=pt();l(c,L)};R(u,c=>{e(h)&&c(w)})}var m=i(u,2);{var C=c=>{var L=ht(),T=n(L,!0);v(L),J(()=>ee(T,e(s))),l(c,L)};R(m,c=>{e(s)&&c(C)})}v(y),l(K,y),ge()}var yt=I('<div class="desc svelte-1a9qw6n">This user does not have any active MFA keys.</div>'),wt=I('<div class="keyContainer svelte-1a9qw6n"><div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Passkey Name:</div> <b> </b></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Key Registered:</div> <span class="font-mono"> </span></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Last Usage:</div> <span class="font-mono"> </span></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n"></div> <div class="deleteBtn svelte-1a9qw6n"><!></div></div></div>'),$t=I('<div class="desc svelte-1a9qw6n">You can delete the users MFA / Security Keys.<br> Be careful though, since this <b>cannot be reverted</b> without user interaction.<br> This is useful, if a user lost his keys and he is not able to log in any more.</div> <div class="keysContainer svelte-1a9qw6n"></div>',1),bt=I('<div class="err svelte-1a9qw6n"> </div>'),_t=I('<div class="container svelte-1a9qw6n"><!> <!></div>');function Et(K,M){fe(M,!0);let s=$e(M,"user",27,()=>r({})),_=p(""),h=p(r([]));Me(async()=>{await b()});async function b(){let u=await Ga(s().id),w=await u.json();u.ok?t(h,r(w)):console.error("error fetching passkeys: "+w.message)}async function S(u){let w=e(h).length===1,m=await za(s().id,u);if(m.status===200)return await b(),w&&M.onSave(),!0;{let C=await m.json();return t(_,r(C.message)),!1}}var N=_t(),x=n(N);{var j=u=>{var w=yt();l(u,w)},y=u=>{var w=$t(),m=i(le(w),2);Ne(m,21,()=>e(h),C=>C.name,(C,c)=>{var L=wt(),T=n(L),P=i(n(T),2),U=n(P,!0);v(P),v(T);var X=i(T,2),W=i(n(X),2),oe=n(W,!0);J(()=>ee(oe,Se(e(c).registered))),v(W),v(X);var B=i(X,2),H=i(n(B),2),te=n(H,!0);J(()=>ee(te,Se(e(c).last_used))),v(H),v(B);var se=i(B,2),k=i(n(se),2),$=n(k);we($,{level:4,$$events:{click:()=>S(e(c).name)},children:(V,Q)=>{z();var o=F("DELETE");l(V,o)},$$slots:{default:!0}}),v(k),v(se),v(L),J(()=>ee(U,e(c).name)),l(C,L)}),v(m),l(u,w)};R(x,u=>{e(h).length<1?u(j):u(y,!1)})}var g=i(x,2);{var E=u=>{var w=bt(),m=n(w,!0);v(w),J(()=>ee(m,e(_))),l(u,w)};R(g,u=>{e(_)&&u(E)})}v(N),l(K,N),ge()}var It=I('<div class="container svelte-nw2ucx"><!></div>');function xt(K,M){fe(M,!0);var s=It(),_=n(s);Xa(_,{get userId(){return M.user.id}}),v(s),l(K,s),ge()}var kt=I('<div class="data font-mono svelte-115hohv"> </div>'),St=I('<div class="data svelte-115hohv"> </div>'),Lt=I('<div class="header svelte-115hohv"><!> <!></div>'),qt=I("<div><!></div>"),Mt=I("<div><!></div>"),Tt=I("<div><!></div>"),Nt=I("<div><!></div>"),jt=I("<div><!></div>"),Pt=I("<div><!></div>"),Ot=I("<div><!></div>"),Ct=I("<!> <!>",1),Dt=I("<div><!></div>");function ia(K,M){fe(M,!0);let s=$e(M,"userEmail",3,""),_=$e(M,"userId",3,""),h=$e(M,"onSave",15),b=p(void 0),S=p(!0),N=p(void 0);const x=["Info","Attributes","Password","MFA","Devices","Logout","Delete"];let j=p(r(x[0]));const y=200,g=y/2;async function E(){const w=await Ya(_());if(w.ok)t(b,r(await w.json()));else{let m=await w.json();console.error(m)}t(S,!1)}function u(){t(N,!1),h()()}Ae(()=>{e(N)&&E()}),Je(K,{get show(){return e(N)},set show(w){t(N,r(w))},header:w=>{var m=Lt(),C=n(m);ea(C,{text:"User ID",children:(L,T)=>{var P=kt(),U=n(P,!0);v(P),J(()=>ee(U,_())),l(L,P)},$$slots:{default:!0}});var c=i(C,2);ea(c,{text:"E-Mail",children:(L,T)=>{var P=St(),U=n(P,!0);v(P),J(()=>ee(U,s())),l(L,P)},$$slots:{default:!0}}),v(m),l(w,m)},body:w=>{var m=Dt(),C=n(m);{var c=T=>{Ba(T,{})},L=T=>{var P=Ct(),U=le(P);La(U,{labels:x,get selected(){return e(j)},set selected(B){t(j,r(B))}});var X=i(U,2);{var W=B=>{var H=qt(),te=n(H);Qa(te,{get user(){return e(b)},set user(se){t(b,r(se))},get onSave(){return h()},set onSave(se){h(se)}}),v(H),ve(5,H,()=>ne,()=>({delay:g,duration:y})),ve(6,H,()=>ne,()=>({duration:y})),l(B,H)},oe=B=>{var H=ye(),te=le(H);{var se=$=>{var V=Mt(),Q=n(V);gt(Q,{get user(){return e(b)},set user(o){t(b,r(o))},get onSave(){return h()},set onSave(o){h(o)}}),v(V),ve(5,V,()=>ne,()=>({delay:g,duration:y})),ve(6,V,()=>ne,()=>({duration:y})),l($,V)},k=$=>{var V=ye(),Q=le(V);{var o=G=>{var d=Tt(),q=n(d);it(q,{get user(){return e(b)},set user(D){t(b,r(D))},get onSave(){return h()},set onSave(D){h(D)}}),v(d),ve(5,d,()=>ne,()=>({delay:g,duration:y})),ve(6,d,()=>ne,()=>({duration:y})),l(G,d)},f=G=>{var d=ye(),q=le(d);{var D=de=>{var re=Nt(),be=n(re);Et(be,{get user(){return e(b)},set user(ce){t(b,r(ce))},get onSave(){return h()},set onSave(ce){h(ce)}}),v(re),ve(5,re,()=>ne,()=>({delay:g,duration:y})),ve(6,re,()=>ne,()=>({duration:y})),l(de,re)},ue=de=>{var re=ye(),be=le(re);{var ce=ae=>{var Z=jt(),Le=n(Z);xt(Le,{get user(){return e(b)},set user(xe){t(b,r(xe))}}),v(Z),ve(5,Z,()=>ne,()=>({delay:g,duration:y})),ve(6,Z,()=>ne,()=>({duration:y})),l(ae,Z)},Y=ae=>{var Z=ye(),Le=le(Z);{var xe=me=>{var pe=Pt(),qe=n(pe);mt(qe,{get user(){return e(b)},set user(_e){t(b,r(_e))}}),v(pe),ve(5,pe,()=>ne,()=>({delay:g,duration:y})),ve(6,pe,()=>ne,()=>({duration:y})),l(me,pe)},Oe=me=>{var pe=ye(),qe=le(pe);{var _e=ke=>{var Ee=Ot(),Ce=n(Ee);ot(Ce,{onSave:u,get user(){return e(b)},set user(De){t(b,r(De))}}),v(Ee),ve(5,Ee,()=>ne,()=>({delay:g,duration:y})),ve(6,Ee,()=>ne,()=>({duration:y})),l(ke,Ee)};R(qe,ke=>{e(j)==="Delete"&&ke(_e)},!0)}l(me,pe)};R(Le,me=>{e(j)==="Logout"?me(xe):me(Oe,!1)},!0)}l(ae,Z)};R(be,ae=>{e(j)==="Devices"?ae(ce):ae(Y,!1)},!0)}l(de,re)};R(q,de=>{e(j)==="MFA"?de(D):de(ue,!1)},!0)}l(G,d)};R(Q,G=>{e(j)==="Password"?G(o):G(f,!1)},!0)}l($,V)};R(te,$=>{e(j)==="Attributes"?$(se):$(k,!1)},!0)}l(B,H)};R(X,B=>{e(j)==="Info"?B(W):B(oe,!1)})}l(T,P)};R(C,T=>{e(S)?T(c):T(L,!1)})}v(m),l(w,m)},$$slots:{header:!0,body:!0}}),ge()}var Ut=I('<div class="header font-label svelte-1y7ceqm">ADD NEW USER</div>'),Ft=I('<div class="err svelte-1y7ceqm"> </div>'),At=I('<div class="container svelte-1y7ceqm"><!> <!> <!> <div class="language svelte-1y7ceqm"><div class="label svelte-1y7ceqm">LANGUAGE</div> <div style="margin-top: .4rem"><!></div></div> <div class="tiles svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">ROLES</div> <!></div> <div class="tiles svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">GROUPS</div> <!></div> <div class="unit svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">LIMIT LIFETIME</div> <div class="value"><!></div></div> <!> <div class="btn svelte-1y7ceqm"><!> <!></div></div>');function Rt(K,M){fe(M,!0);let s=$e(M,"idx",31,()=>-1),_=p(""),h=p(void 0),b=p("EN"),S=p(!1),N=p(void 0),x=p(r({email:"",family_name:"",given_name:"",roles:[],groups:[]})),j=p(r({}));const y=Re().shape({email:he().required("E-Mail is required").email("Bad E-Mail format"),given_name:he().trim().required("Given Name is required").matches(Ve,"Invalid characters"),family_name:he().trim().required("Family Name is required").matches(Ve,"Invalid characters")});let g=p(void 0);ze.subscribe(m=>{t(g,r(m))});let E=p(void 0);Ye.subscribe(m=>{t(E,r(m))});async function u(){if(!await w())return;t(_,"");let m=e(x);if(m.language=e(b).toLowerCase(),e(S)){let c=sa(e(N));if(!c){t(_,"Invalid Date Input: User Expires");return}m.user_expires=c}let C=await Ia(e(x));if(C.ok)t(x,r({})),t(h,!1),t(x,r({email:"",family_name:"",given_name:"",roles:[],groups:[]})),M.onSave();else{let c=await C.json();t(_,r(c.message))}}async function w(){try{return await y.validate(e(x),{abortEarly:!1}),t(j,r({})),!0}catch(m){return t(j,r(Ge(m))),!1}}Je(K,{get idx(){return s()},set idx(m){s(m)},get show(){return e(h)},set show(m){t(h,r(m))},header:m=>{var C=Ut();l(m,C)},body:m=>{var C=At(),c=n(C);ie(c,{type:"email",autocomplete:"off",placeholder:"E-Mail",get value(){return e(x).email},set value(d){e(x).email=d},get error(){return e(j).email},set error(d){e(j).email=d},$$events:{input:w},children:(d,q)=>{z();var D=F("E-MAIL");l(d,D)},$$slots:{default:!0}});var L=i(c,2);ie(L,{autocomplete:"off",placeholder:"Given Name",get value(){return e(x).given_name},set value(d){e(x).given_name=d},get error(){return e(j).given_name},set error(d){e(j).given_name=d},$$events:{input:w},children:(d,q)=>{z();var D=F("GIVEN NAME");l(d,D)},$$slots:{default:!0}});var T=i(L,2);ie(T,{autocomplete:"off",placeholder:"Family Name",get value(){return e(x).family_name},set value(d){e(x).family_name=d},get error(){return e(j).family_name},set error(d){e(j).family_name=d},$$events:{input:w},children:(d,q)=>{z();var D=F("FAMILY NAME");l(d,D)},$$slots:{default:!0}});var P=i(T,2),U=i(n(P),2),X=n(U);ra(X,{options:ta,get value(){return e(b)},set value(d){t(b,r(d))}}),v(U),v(P);var W=i(P,2),oe=i(n(W),2);Pe(oe,{get options(){return e(g)},searchThreshold:4,get items(){return e(x).roles},set items(d){e(x).roles=d}}),v(W);var B=i(W,2),H=i(n(B),2);Pe(H,{get options(){return e(E)},searchThreshold:4,get items(){return e(x).groups},set items(d){e(x).groups=d}}),v(B);var te=i(B,2);Ie(te,"margin-top","12px");var se=i(n(te),2),k=n(se);je(k,{get selected(){return e(S)},set selected(d){t(S,r(d))}}),v(se),v(te);var $=i(te,2);{var V=d=>{ie(d,{type:"datetime-local",step:"60",width:"18rem",get min(){return new Date().toISOString().split(".")[0]},max:"2099-01-01T00:00",get value(){return e(N)},set value(q){t(N,r(q))},$$events:{input:w},children:(q,D)=>{z();var ue=F("USER EXPIRES");l(q,ue)},$$slots:{default:!0}})};R($,d=>{e(S)&&d(V)})}var Q=i($,2),o=n(Q);we(o,{level:1,$$events:{click:u},children:(d,q)=>{z();var D=F("SAVE");l(d,D)},$$slots:{default:!0}});var f=i(o,2);{var G=d=>{var q=Ft(),D=n(q,!0);v(q),J(()=>ee(D,e(_))),l(d,q)};R(f,d=>{e(_)&&d(G)})}v(Q),v(C),l(m,C)},$$slots:{header:!0,body:!0}}),ge()}var Vt=I('<div class="svelte-1n3c0ep"><!></div>'),Gt=I('<div class="svelte-1n3c0ep"><!></div>'),zt=I(' <div class="content"><!> <!> <div id="users" class="svelte-1n3c0ep"><!></div> <!></div>',1);function Yt(K,M){fe(M,!0);let s=p(""),_=p(r([])),h=p(r([])),b=p(r([])),S=p(""),N=p(!1),x=p(""),j=p(0),y=p(15),g=p(""),E=p(1),u=p(r([{label:"E-Mail",callback:(o,f)=>o.email.toLowerCase().includes(f.toLowerCase())},{label:"ID",callback:(o,f)=>o.id.toLowerCase().includes(f.toLowerCase())}])),w=p(r([{label:"E-Mail",callback:(o,f)=>o.email.localeCompare(f.email)},{label:"ID",callback:(o,f)=>o.id.localeCompare(f.id)},{label:"Created",callback:(o,f)=>o.created_at<f.created_at},{label:"Last Login",callback:(o,f)=>{let G=o.last_login||9999999999,d=f.last_login||9999999999;return G<d}}]));Me(async()=>{m(),L(),T()});async function m(o,f,G,d){let q;if(o===!0?G&&e(E)===2?q=await Qe(d||e(y),f,void 0,!1):q=await Qe(d||e(y),f,e(g),G):q=await xa(),!q.ok)t(s,"Error fetching users: "+q.body.message);else{q.status===206?(t(y,r(Number.parseInt(q.headers.get("x-page-size"),10))),t(S,"user"),q.headers.get("x-continuation-token"),t(g,r(q.headers.get("x-continuation-token")))):t(S,""),t(j,r(q.headers.get("x-user-count")));let D=await q.json();t(_,r([...D])),t(h,r([...D]))}}async function C(o,f){await m(!0,o,f),f?t(E,e(E)-1):t(E,e(E)+1)}async function c(o){t(g,""),await m(!0,0,!1,o),t(E,1)}async function L(){let o=await ka();if(!o.ok)t(s,"Error fetching roles: "+o.body.message);else{let f=await o.json();Ua.set(f),ze.set(f.map(G=>G.name))}}async function T(){let o=await Sa();if(!o.ok)t(s,"Error fetching groups: "+o.body.message);else{let f=await o.json();Fa.set(f),Ye.set(f.map(G=>G.name))}}function P(){m(),L(),T(),t(x,"")}z();var U=zt(),X=le(U),W=i(X),oe=n(W);qa(oe,{get items(){return e(_)},get resItems(){return e(h)},set resItems(o){t(h,r(o))},get searchOptions(){return e(u)},set searchOptions(o){t(u,r(o))},get orderOptions(){return e(w)},set orderOptions(o){t(w,r(o))},get useServerSideIdx(){return e(S)},set useServerSideIdx(o){t(S,r(o))},get isSearchFiltered(){return e(N)},set isSearchFiltered(o){t(N,r(o))},get search(){return e(x)},set search(o){t(x,r(o))}});var B=i(oe,2);Rt(B,{onSave:P});var H=i(B,2),te=n(H);{var se=o=>{var f=ye(),G=le(f);Ne(G,17,()=>e(h),d=>d.id,(d,q)=>{var D=Vt(),ue=n(D);ia(ue,{get userId(){return e(q).id},get userEmail(){return e(q).email},onSave:P}),v(D),l(d,D)}),l(o,f)},k=o=>{var f=ye(),G=le(f);Ne(G,17,()=>e(b),d=>d.id,(d,q)=>{var D=Gt(),ue=n(D);ia(ue,{get userId(){return e(q).id},get userEmail(){return e(q).email},onSave:P}),v(D),l(d,D)}),l(o,f)};R(te,o=>{e(S)&&!e(N)?o(se):o(k,!1)})}v(H);var $=i(H,2);{var V=o=>{Ha(o,{get itemsTotal(){return e(j)},fetchPageCallback:C,sspPageSizeChange:c,get sspPage(){return e(E)},set sspPage(f){t(E,r(f))},get sspPageSize(){return e(y)},set sspPageSize(f){t(y,r(f))},get sspContinuationToken(){return e(g)},set sspContinuationToken(f){t(g,r(f))}})},Q=o=>{Ma(o,{get items(){return e(h)},set items(f){t(h,r(f))},get resItems(){return e(b)},set resItems(f){t(b,r(f))}})};R($,o=>{e(S)&&!e(N)?o(V):o(Q,!1)})}v(W),J(()=>ee(X,`${e(s)??""} `)),l(K,U),ge()}export{Yt as U};
