import"./disclose-version.BDr9Qe-U.js";import{p as he,i as p,_ as ha,g as e,h as t,ao as Me,c as n,s as i,r as v,aq as Y,t as J,a as ge,a9 as Te,f as le}from"./index-client.DAoU_hDn.js";import{s as ee}from"./render.mNhspeV3.js";import{i as R}from"./if.BANCODOf.js";import{e as Ne,i as ga}from"./each.DTG73tix.js";import{d as D,a as l,t as I,e as ye}from"./template.DcxtE4ym.js";import{p as r}from"./proxy.D3ASEzk3.js";import{K as We,L as ya,M as wa,N as $a,k as ba,O as _a,P as Ea,Q as Ia,R as xa,t as ka,o as Sa,S as Ze}from"./dataFetchingAdmin.D7RWqeRL.js";import{s as Ie,t as ve,a as ne}from"./index.DER1jHiU.js";import{p as $e}from"./props.VJ8UyA45.js";import{r as Ue}from"./legacy-client.rYJ80fHr.js";import{E as Je}from"./ExpandContainer.mM6ZiTQe.js";import{O as ea,T as aa}from"./OptionSelect.CBlj_bre.js";import{c as Re,a as fe,b as La,I as ie}from"./Input.C04-Kl2S.js";import{k as Se,a3 as Ae,a4 as qa,a5 as Ma,a6 as Ta,a7 as Na,a8 as ta,M as sa,B as ra,o as Ge,a9 as Pa,z as ja}from"./helpers.BV-akmwW.js";import{S as Pe,P as la}from"./PasswordInput.JBBIMWuW.js";import{g as Ye,a as Be,b as za,c as Ca}from"./admin.D1fpipkw.js";import{B as we,L as Fa}from"./Button.CKHLXer8.js";import{C as Oa}from"./CheckIcon.CrU43zqd.js";import{I as je}from"./ItemTiles.DxajBUfv.js";import{T as Da}from"./TabBar.BqcS880p.js";import{P as Ua}from"./PasswordPolicy.DAaeophg.js";import{d as Ra,e as Aa,w as Ga,f as Ya}from"./dataFetching.dLYaql-r.js";import{D as Ba}from"./Devices.xP6jbLAC.js";import{O as Va,P as Xa}from"./Pagination.DF9sn7Vj.js";import{P as Ha}from"./PaginationServer.CSS8vRPq.js";var Ka=I('<div class="success svelte-tl4x7h">Success</div>'),Qa=I('<div class="err svelte-tl4x7h"> </div>'),Wa=I('<div class="container svelte-tl4x7h"><div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">USER ID</div> <div class="value font-mono svelte-tl4x7h"> </div></div> <div class="row svelte-tl4x7h"><div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">ENABLED</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">E-MAIL VERIFIED</div> <div class="value svelte-tl4x7h"><!></div></div></div> <!> <!> <!> <div class="unit language svelte-tl4x7h"><div class="label svelte-tl4x7h">LANGUAGE</div> <div style="margin-top: .085rem"><!></div></div> <!> <!> <!> <!> <!> <!> <div class="unit svelte-tl4x7h"><div class="label svelte-tl4x7h">ROLES</div> <!></div> <div class="unit svelte-tl4x7h"><div class="label svelte-tl4x7h">GROUPS</div> <!></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">LIMIT LIFETIME</div> <div class="value svelte-tl4x7h"><!></div></div> <!> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">CREATED</div> <div class="value svelte-tl4x7h"> </div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">LAST LOGIN</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">PASSWORD EXPIRES</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><div class="label font-label svelte-tl4x7h">MFA ACTIVE</div> <div class="value svelte-tl4x7h"><!></div></div> <div class="unit svelte-tl4x7h"><!> <!> <!></div></div>');function Za(W,M){he(M,!0);let s=$e(M,"user",31,()=>r({}));s().roles===void 0&&s(s().roles=[],!0),s().groups===void 0&&s(s().groups=[],!0);let _=p(""),f=p(!1),b=p(void 0),S=p(r(s().language.toUpperCase())),N=p(!!s().user_expires),x=p(r(ha(()=>e(N))?Se(s().user_expires,!0):void 0)),P=p(r([]));Ye.subscribe(a=>{t(P,r(a))});let y=p(r([]));Be.subscribe(a=>{t(y,r(a))}),Ue(()=>{e(f)&&t(b,r(setTimeout(()=>{t(f,!1),M.onSave()},3e3)))});let g=p(r({}));const E=Re().shape({email:fe().required("E-Mail is required").email("Bad E-Mail format"),given_name:fe().trim().required("Given Name is required").matches(Ae,"Invalid characters"),family_name:fe().nullable().trim().matches(qa,"Invalid characters")});let d=p(r({}));const w=Re().shape({birthdate:fe().nullable().trim().matches(Ma,"Invalid characters"),phone:fe().nullable().trim().matches(Ta,"Format: +..."),street:fe().nullable().trim().matches(Na,"Invalid characters"),zip:La().nullable().min(1e3).max(999999),city:fe().nullable().trim().matches(ta,"Invalid characters"),country:fe().nullable().trim().matches(ta,"Invalid characters")});Me(()=>()=>clearTimeout(e(b)));function m(a){a.code==="Enter"&&C()}async function C(){if(!await c())return;t(_,""),console.log(s().user_values);const a={email:s().email,given_name:s().given_name,family_name:s().family_name||null,language:e(S).toLowerCase(),roles:s().roles,groups:s().groups,enabled:s().enabled,email_verified:s().email_verified,user_expires:null,user_values:s().user_values};if(a.user_values.phone&&(a.user_values.phone=a.user_values.phone.replaceAll(" ","")),a.user_values.zip&&(a.user_values.zip=Number.parseInt(a.user_values.zip)),e(N)){let U=ra(e(x));if(!U){t(_,"Invalid Date Input: User Expires");return}a.user_expires=U}let z=await We(s().id,a);if(z.ok)t(f,!0);else{let U=await z.json();t(_,r(U.message))}}async function c(){let a=!0;try{await E.validate(s(),{abortEarly:!1}),t(g,r({}))}catch(z){t(g,r(Ge(z))),a=!1}try{await w.validate(s().user_values,{abortEarly:!1}),t(d,r({}))}catch(z){t(d,r(Ge(z))),a=!1}return a}var L=Wa(),T=n(L),j=i(n(T),2),O=n(j,!0);v(j),v(T);var X=i(T,2);Ie(X,"margin-top","-5px");var K=n(X);Ie(K,"width","107px");var oe=i(n(K),2),V=n(oe);Pe(V,{get selected(){return s().enabled},set selected(a){s(s().enabled=a,!0)}}),v(oe),v(K);var H=i(K,2);Ie(H,"width","135px");var te=i(n(H),2),se=n(te);Pe(se,{get selected(){return s().email_verified},set selected(a){s(s().email_verified=a,!0)}}),v(te),v(H),v(X);var k=i(X,2);ie(k,{type:"email",autocomplete:"off",placeholder:"E-Mail",get value(){return s().email},set value(a){s(s().email=a,!0)},get error(){return e(g).email},set error(a){e(g).email=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("E-MAIL");l(a,U)},$$slots:{default:!0}});var $=i(k,2);ie($,{autocomplete:"off",placeholder:"Given Name",get value(){return s().given_name},set value(a){s(s().given_name=a,!0)},get error(){return e(g).given_name},set error(a){e(g).given_name=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("GIVEN NAME");l(a,U)},$$slots:{default:!0}});var A=i($,2);ie(A,{autocomplete:"off",placeholder:"Family Name",get value(){return s().family_name},set value(a){s(s().family_name=a,!0)},get error(){return e(g).family_name},set error(a){e(g).family_name=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("FAMILY NAME");l(a,U)},$$slots:{default:!0}});var Z=i(A,2),o=i(n(Z),2),h=n(o);ea(h,{options:sa,get value(){return e(S)},set value(a){t(S,r(a))}}),v(o),v(Z);var G=i(Z,2);ie(G,{autocomplete:"off",placeholder:"Street",get value(){return s().user_values.street},set value(a){s(s().user_values.street=a,!0)},get error(){return e(d).street},set error(a){e(d).street=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("STREET");l(a,U)},$$slots:{default:!0}});var u=i(G,2);ie(u,{type:"number",autocomplete:"off",placeholder:"ZIP",min:1e3,max:999999,get value(){return s().user_values.zip},set value(a){s(s().user_values.zip=a,!0)},get error(){return e(d).zip},set error(a){e(d).zip=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("ZIP");l(a,U)},$$slots:{default:!0}});var q=i(u,2);ie(q,{autocomplete:"off",placeholder:"City",get value(){return s().user_values.city},set value(a){s(s().user_values.city=a,!0)},get error(){return e(d).city},set error(a){e(d).city=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("CITY");l(a,U)},$$slots:{default:!0}});var F=i(q,2);ie(F,{autocomplete:"off",placeholder:"Country",get value(){return s().user_values.country},set value(a){s(s().user_values.country=a,!0)},get error(){return e(d).country},set error(a){e(d).country=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("COUNTRY");l(a,U)},$$slots:{default:!0}});var de=i(F,2);ie(de,{autocomplete:"off",placeholder:"Phone",get value(){return s().user_values.phone},set value(a){s(s().user_values.phone=a,!0)},get error(){return e(d).phone},set error(a){e(d).phone=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("PHONE");l(a,U)},$$slots:{default:!0}});var ue=i(de,2);ie(ue,{type:"date",autocomplete:"off",placeholder:"Birthdate",get value(){return s().user_values.birthdate},set value(a){s(s().user_values.birthdate=a,!0)},get error(){return e(d).birthdate},set error(a){e(d).birthdate=a},$$events:{keypress:m,input:c},children:(a,z)=>{Y();var U=D("BIRTHDATE");l(a,U)},$$slots:{default:!0}});var re=i(ue,2);Ie(re,"margin-top","-3px");var be=i(n(re),2);je(be,{get options(){return e(P)},searchThreshold:4,get items(){return s().roles},set items(a){s(s().roles=a,!0)}}),v(re);var ce=i(re,2),B=i(n(ce),2);je(B,{get options(){return e(y)},searchThreshold:4,get items(){return s().groups},set items(a){s(s().groups=a,!0)}}),v(ce);var ae=i(ce,2);Ie(ae,"margin-top","12px");var Q=i(n(ae),2),Le=n(Q);Pe(Le,{get selected(){return e(N)},set selected(a){t(N,r(a))}}),v(Q),v(ae);var xe=i(ae,2);{var ze=a=>{var z=Te(()=>Pa(new Date));ie(a,{type:"datetime-local",step:"60",width:"16rem",get min(){return e(z)},max:"2099-01-01T00:00",get value(){return e(x)},set value(U){t(x,r(U))},$$events:{input:c},children:(U,Vt)=>{Y();var fa=D("USER EXPIRES");l(U,fa)},$$slots:{default:!0}})};R(xe,a=>{e(N)&&a(ze)})}var me=i(xe,2);Ie(me,"margin-top","12px");var pe=i(n(me),2),qe=n(pe,!0);J(()=>ee(qe,Se(s().created_at))),v(pe),v(me);var _e=i(me,2),ke=i(n(_e),2),Ee=n(ke);{var Ce=a=>{var z=D();J(()=>ee(z,Se(s().last_login))),l(a,z)},Fe=a=>{var z=D("Never");l(a,z)};R(Ee,a=>{s().last_login?a(Ce):a(Fe,!1)})}v(ke),v(_e);var Oe=i(_e,2),Ve=i(n(Oe),2),va=n(Ve);{var na=a=>{var z=D();J(()=>ee(z,Se(s().password_expires))),l(a,z)},oa=a=>{var z=D("Never");l(a,z)};R(va,a=>{s().password_expires?a(na):a(oa,!1)})}v(Ve),v(Oe);var De=i(Oe,2),Xe=i(n(De),2),da=n(Xe),ua=Te(()=>!!s().webauthn_user_id);Oa(da,{get check(){return e(ua)}}),v(Xe),v(De);var He=i(De,2),Ke=n(He);we(Ke,{level:1,width:"4rem",$$events:{click:C},children:(a,z)=>{Y();var U=D("SAVE");l(a,U)},$$slots:{default:!0}});var Qe=i(Ke,2);{var ca=a=>{var z=Ka();l(a,z)};R(Qe,a=>{e(f)&&a(ca)})}var ma=i(Qe,2);{var pa=a=>{var z=Qa(),U=n(z,!0);v(z),J(()=>ee(U,e(_))),l(a,z)};R(ma,a=>{e(_)&&a(pa)})}v(He),v(L),J(()=>ee(O,s().id)),l(W,L),ge()}var Ja=I('<div class="desc svelte-8ppjyk"><p><b>The user has not initialized this account yet.</b></p> <p>You may send out a new Reset E-Mail, if the user has not received one.</p></div> <!>',1),et=I(`<div class="desc svelte-8ppjyk"><p><b>This is a passkey only account type.</b></p> <p>This means, that this user is using the passwordless login flow only and does not have any password.</p> <p>If the user has lost all his keys and you have verified everything, you may reset his account type and
                send out a new reset E-Mail, so the user can get access again.</p> <p>To reset the account, navigate to 'MFA' and delete all registered keys for this user.</p></div>`),at=I(`<!> <!> <!> <!> <div class="desc svelte-8ppjyk">You can either set and reset a user's password<br> or send out a new reset E-Mail for self-service.</div> <!> <!>`,1),tt=I('<div class="success svelte-8ppjyk">Success</div>'),st=I('<div class="err svelte-8ppjyk"> </div>'),rt=I('<div class="err svelte-8ppjyk"> </div>'),lt=I('<div class="container svelte-8ppjyk"><!> <!> <!> <!></div>');function it(W,M){he(M,!0);let s=$e(M,"user",27,()=>r({}));const _="inherit";let f=p(!1),b=p(""),S=p(""),N=p(!1),x=p(!1),P=p(void 0),y="330px",g=p(void 0),E=p(!1),d=r({new:"",verify:""});Ue(()=>{e(x)&&t(P,r(setTimeout(()=>{t(x,!1),M.onSave()},3e3)))}),Me(async()=>{if(!e(g)){let k=await Ra(),$=await k.json();k.ok?t(g,r($)):t(S,r($.message))}});async function w(){return t(S,""),await m()?e(E)?!0:(t(S,"You must follow the password policy"),!1):!1}async function m(){return t(S,""),d.new.length>256?(t(S,"max 256 characters"),!1):d.new!==d.verify?(t(S,"New passwords do not match"),!1):!0}async function C(){let k={email:s().email};t(b,""),t(f,!0);let $=await ya(k);if($.ok)t(N,!0);else{let A=await $.json();t(b,r(A.message))}t(f,!1)}async function c(){let k={email:s().email,given_name:s().given_name,family_name:s().family_name,roles:s().roles,groups:s().groups,enabled:s().enabled,email_verified:s().email_verified};if(d.new.length>0){if(!(await m()&&await w()))return;k.password=d.new}t(S,""),t(f,!0);let $=await We(s().id,k);if($.ok)t(x,!0);else{let A=await $.json();t(S,r(A.message))}t(f,!1)}function L(){const k=e(g).length_min>24?e(g).length_min:24;let $=ja(k,e(g).include_lower_case,e(g).include_upper_case,e(g).include_digits,e(g).include_special);d.new=$,d.verify=$}var T=lt(),j=n(T);{var O=k=>{var $=Ja(),A=i(le($),2);we(A,{width:_,level:2,get isLoading(){return e(f)},set isLoading(Z){t(f,r(Z))},$$events:{click:C},children:(Z,o)=>{Y();var h=D("SEND RESET E-MAIL");l(Z,h)},$$slots:{default:!0}}),l(k,$)},X=k=>{var $=ye(),A=le($);{var Z=h=>{var G=et();l(h,G)},o=h=>{var G=at(),u=le(G);{var q=B=>{Ua(B,{get password(){return d.new},get policy(){return e(g)},get accepted(){return e(E)},set accepted(ae){t(E,r(ae))}})};R(u,B=>{e(g)&&B(q)})}var F=i(u,2),de=Te(()=>d.new.length>0&&d.new===d.verify);la(F,{type:"password",get width(){return y},autocomplete:"off",get showCopy(){return e(de)},get value(){return d.new},set value(B){d.new=B},$$events:{blur:m},children:(B,ae)=>{Y();var Q=D("New Password");l(B,Q)},$$slots:{default:!0}});var ue=i(F,2);la(ue,{type:"password",get width(){return y},autocomplete:"off",get value(){return d.verify},set value(B){d.verify=B},$$events:{blur:m},children:(B,ae)=>{Y();var Q=D("New Password");l(B,Q)},$$slots:{default:!0}});var re=i(ue,2);we(re,{width:_,level:3,$$events:{click:L},children:(B,ae)=>{Y();var Q=D("GENERATE RANDOM");l(B,Q)},$$slots:{default:!0}});var be=i(re,4);we(be,{width:_,level:1,get isLoading(){return e(f)},set isLoading(B){t(f,r(B))},$$events:{click:C},children:(B,ae)=>{Y();var Q=D("SEND RESET E-MAIL");l(B,Q)},$$slots:{default:!0}});var ce=i(be,2);we(ce,{width:_,get isLoading(){return e(f)},set isLoading(B){t(f,r(B))},$$events:{click:c},children:(B,ae)=>{Y();var Q=D("SAVE PASSWORD");l(B,Q)},$$slots:{default:!0}}),l(h,G)};R(A,h=>{s().account_type==="passkey"?h(Z):h(o,!1)},!0)}l(k,$)};R(j,k=>{s().account_type==="new"?k(O):k(X,!1)})}var K=i(j,2);{var oe=k=>{var $=tt();l(k,$)};R(K,k=>{(e(x)||e(N))&&k(oe)})}var V=i(K,2);{var H=k=>{var $=st(),A=n($,!0);v($),J(()=>ee(A,e(S))),l(k,$)};R(V,k=>{e(S)&&k(H)})}var te=i(V,2);{var se=k=>{var $=rt(),A=n($,!0);v($),J(()=>ee(A,e(b))),l(k,$)};R(te,k=>{e(b)&&k(se)})}v(T),l(W,T),ge()}var vt=I('<div class="err svelte-1jljqe9"> </div>'),nt=I('<div class="container svelte-1jljqe9"><div class="label svelte-1jljqe9">Are you sure, you want to delete this user?</div> <!> <!></div>');function ot(W,M){he(M,!0);let s=$e(M,"user",27,()=>r({})),_=p(!1),f=p("");async function b(){t(f,""),t(_,!0);let y=await wa(s().id);if(y.ok)M.onSave();else{let g=await y.json();t(f,r(g.message))}t(_,!1)}var S=nt(),N=i(n(S),2);we(N,{level:1,width:"5rem",get isLoading(){return e(_)},set isLoading(y){t(_,r(y))},$$events:{click:b},children:(y,g)=>{Y();var E=D("DELETE");l(y,E)},$$slots:{default:!0}});var x=i(N,2);{var P=y=>{var g=vt(),E=n(g,!0);v(g),J(()=>ee(E,e(f))),l(y,g)};R(x,y=>{e(f)&&y(P)})}v(S),l(W,S),ge()}var dt=I('<div class="err svelte-1ofwsjt"> </div>'),ut=I('<div class="success svelte-1ofwsjt">Success</div>'),ct=I('<div class="container svelte-1ofwsjt"><div class="label svelte-1ofwsjt">Invalidate all existing sessions and refresh tokens for this user?</div> <!> <!></div>');function mt(W,M){he(M,!0);let s=$e(M,"user",27,()=>r({})),_=p(!1),f=p(""),b=p(!1);async function S(){t(f,""),t(_,!0);let E=await $a(s().id);if(E.ok)t(b,!0);else{let d=await E.json();t(f,r(d.message))}t(_,!1)}var N=ct(),x=i(n(N),2);we(x,{level:1,get isLoading(){return e(_)},set isLoading(E){t(_,r(E))},$$events:{click:S},children:(E,d)=>{Y();var w=D("LOGOUT");l(E,w)},$$slots:{default:!0}});var P=i(x,2);{var y=E=>{var d=dt(),w=n(d,!0);v(d),J(()=>ee(w,e(f))),l(E,d)},g=E=>{var d=ye(),w=le(d);{var m=C=>{var c=ut();l(C,c)};R(w,C=>{e(b)&&C(m)},!0)}l(E,d)};R(P,E=>{e(f)?E(y):E(g,!1)})}v(N),l(W,N),ge()}var pt=I('<div class="success svelte-iv4fzr">Success</div>'),ft=I('<div class="err svelte-iv4fzr"> </div>'),ht=I('<div class="container svelte-iv4fzr"><div class="desc svelte-iv4fzr">Set custom user attributes.<br> All Key / Value pairs will be handled as String / String.</div> <!> <!> <!> <!></div>');function gt(W,M){he(M,!0);let s=p(""),_=p(r([])),f=p(!1),b=p(!1);Me(()=>{x()});async function S(){let c=await ba();if(!c.ok)t(s,"Error fetching attr: "+c.body.message);else return await c.json()}async function N(){let c=await _a(M.user.id);if(!c.ok)t(s,"Error fetching user attr: "+c.body.message);else return await c.json()}async function x(){let c=await S(),L=c.values;if(c){let T=await N();if(T){let j=new Map;for(let O of T.values)j.set(O.key,O.value||"");for(let O of L){let X=j.get(O.name);X?O.value=X:O.value=""}t(_,r([...L]))}}}async function P(){t(s,""),t(b,!0);let c=[];for(let O of e(_)){let X={key:O.name,value:O.value};c.push(X)}let L={values:c},T=await Ea(M.user.id,L),j=await T.json();T.ok?t(f,!0):t(s,r(j.message)),M.onSave(),t(b,!1)}var y=ht(),g=i(n(y),2);Ne(g,17,()=>e(_),ga,(c,L,T)=>{var j=Te(()=>e(L).desc||"JSON Value");ie(c,{style:"width: 350px",autocomplete:"off",get placeholder(){return e(j)},get value(){return e(L).value},set value(O){e(L).value=O},children:(O,X)=>{Y();var K=D();J(()=>ee(K,e(L).name)),l(O,K)},$$slots:{default:!0}})});var E=i(g,2);we(E,{get isLoading(){return e(b)},level:1,width:"4rem",$$events:{click:P},children:(c,L)=>{Y();var T=D("SAVE");l(c,T)},$$slots:{default:!0}});var d=i(E,2);{var w=c=>{var L=pt();l(c,L)};R(d,c=>{e(f)&&c(w)})}var m=i(d,2);{var C=c=>{var L=ft(),T=n(L,!0);v(L),J(()=>ee(T,e(s))),l(c,L)};R(m,c=>{e(s)&&c(C)})}v(y),l(W,y),ge()}var yt=I('<div class="desc svelte-1a9qw6n">This user does not have any active MFA keys.</div>'),wt=I('<div class="keyContainer svelte-1a9qw6n"><div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Passkey Name:</div> <b> </b></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Key Registered:</div> <span class="font-mono"> </span></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n">Last Usage:</div> <span class="font-mono"> </span></div> <div class="row svelte-1a9qw6n"><div class="label svelte-1a9qw6n"></div> <div class="deleteBtn svelte-1a9qw6n"><!></div></div></div>'),$t=I('<div class="desc svelte-1a9qw6n">You can delete the users MFA / Security Keys.<br> Be careful though, since this <b>cannot be reverted</b> without user interaction.<br> This is useful, if a user lost his keys and he is not able to log in any more.</div> <div class="keysContainer svelte-1a9qw6n"></div>',1),bt=I('<div class="err svelte-1a9qw6n"> </div>'),_t=I('<div class="container svelte-1a9qw6n"><!> <!></div>');function Et(W,M){he(M,!0);let s=$e(M,"user",27,()=>r({})),_=p(""),f=p(r([]));Me(async()=>{await b()});async function b(){let d=await Aa(s().id),w=await d.json();d.ok?t(f,r(w)):console.error("error fetching passkeys: "+w.message)}async function S(d){let w=e(f).length===1,m=await Ga(s().id,d);if(m.status===200)return await b(),w&&M.onSave(),!0;{let C=await m.json();return t(_,r(C.message)),!1}}var N=_t(),x=n(N);{var P=d=>{var w=yt();l(d,w)},y=d=>{var w=$t(),m=i(le(w),2);Ne(m,21,()=>e(f),C=>C.name,(C,c)=>{var L=wt(),T=n(L),j=i(n(T),2),O=n(j,!0);v(j),v(T);var X=i(T,2),K=i(n(X),2),oe=n(K,!0);J(()=>ee(oe,Se(e(c).registered))),v(K),v(X);var V=i(X,2),H=i(n(V),2),te=n(H,!0);J(()=>ee(te,Se(e(c).last_used))),v(H),v(V);var se=i(V,2),k=i(n(se),2),$=n(k);we($,{level:4,$$events:{click:()=>S(e(c).name)},children:(A,Z)=>{Y();var o=D("DELETE");l(A,o)},$$slots:{default:!0}}),v(k),v(se),v(L),J(()=>ee(O,e(c).name)),l(C,L)}),v(m),l(d,w)};R(x,d=>{e(f).length<1?d(P):d(y,!1)})}var g=i(x,2);{var E=d=>{var w=bt(),m=n(w,!0);v(w),J(()=>ee(m,e(_))),l(d,w)};R(g,d=>{e(_)&&d(E)})}v(N),l(W,N),ge()}var It=I('<div class="container svelte-nw2ucx"><!></div>');function xt(W,M){he(M,!0);var s=It(),_=n(s);Ba(_,{get userId(){return M.user.id}}),v(s),l(W,s),ge()}var kt=I('<div class="data font-mono svelte-115hohv"> </div>'),St=I('<div class="data svelte-115hohv"> </div>'),Lt=I('<div class="header svelte-115hohv"><!> <!></div>'),qt=I("<div><!></div>"),Mt=I("<div><!></div>"),Tt=I("<div><!></div>"),Nt=I("<div><!></div>"),Pt=I("<div><!></div>"),jt=I("<div><!></div>"),zt=I("<div><!></div>"),Ct=I("<!> <!>",1),Ft=I("<div><!></div>");function ia(W,M){he(M,!0);let s=$e(M,"userEmail",3,""),_=$e(M,"userId",3,""),f=$e(M,"onSave",15),b=p(void 0),S=p(!0),N=p(void 0);const x=["Info","Attributes","Password","MFA","Devices","Logout","Delete"];let P=p(r(x[0]));const y=200,g=y/2;async function E(){const w=await Ya(_());if(w.ok)t(b,r(await w.json()));else{let m=await w.json();console.error(m)}t(S,!1)}function d(){t(N,!1),f()()}Ue(()=>{e(N)&&E()}),Je(W,{get show(){return e(N)},set show(w){t(N,r(w))},header:w=>{var m=Lt(),C=n(m);aa(C,{text:"User ID",children:(L,T)=>{var j=kt(),O=n(j,!0);v(j),J(()=>ee(O,_())),l(L,j)},$$slots:{default:!0}});var c=i(C,2);aa(c,{text:"E-Mail",children:(L,T)=>{var j=St(),O=n(j,!0);v(j),J(()=>ee(O,s())),l(L,j)},$$slots:{default:!0}}),v(m),l(w,m)},body:w=>{var m=Ft(),C=n(m);{var c=T=>{Fa(T,{})},L=T=>{var j=Ct(),O=le(j);Da(O,{labels:x,get selected(){return e(P)},set selected(V){t(P,r(V))}});var X=i(O,2);{var K=V=>{var H=qt(),te=n(H);Za(te,{get user(){return e(b)},set user(se){t(b,r(se))},get onSave(){return f()},set onSave(se){f(se)}}),v(H),ve(5,H,()=>ne,()=>({delay:g,duration:y})),ve(6,H,()=>ne,()=>({duration:y})),l(V,H)},oe=V=>{var H=ye(),te=le(H);{var se=$=>{var A=Mt(),Z=n(A);gt(Z,{get user(){return e(b)},set user(o){t(b,r(o))},get onSave(){return f()},set onSave(o){f(o)}}),v(A),ve(5,A,()=>ne,()=>({delay:g,duration:y})),ve(6,A,()=>ne,()=>({duration:y})),l($,A)},k=$=>{var A=ye(),Z=le(A);{var o=G=>{var u=Tt(),q=n(u);it(q,{get user(){return e(b)},set user(F){t(b,r(F))},get onSave(){return f()},set onSave(F){f(F)}}),v(u),ve(5,u,()=>ne,()=>({delay:g,duration:y})),ve(6,u,()=>ne,()=>({duration:y})),l(G,u)},h=G=>{var u=ye(),q=le(u);{var F=ue=>{var re=Nt(),be=n(re);Et(be,{get user(){return e(b)},set user(ce){t(b,r(ce))},get onSave(){return f()},set onSave(ce){f(ce)}}),v(re),ve(5,re,()=>ne,()=>({delay:g,duration:y})),ve(6,re,()=>ne,()=>({duration:y})),l(ue,re)},de=ue=>{var re=ye(),be=le(re);{var ce=ae=>{var Q=Pt(),Le=n(Q);xt(Le,{get user(){return e(b)},set user(xe){t(b,r(xe))}}),v(Q),ve(5,Q,()=>ne,()=>({delay:g,duration:y})),ve(6,Q,()=>ne,()=>({duration:y})),l(ae,Q)},B=ae=>{var Q=ye(),Le=le(Q);{var xe=me=>{var pe=jt(),qe=n(pe);mt(qe,{get user(){return e(b)},set user(_e){t(b,r(_e))}}),v(pe),ve(5,pe,()=>ne,()=>({delay:g,duration:y})),ve(6,pe,()=>ne,()=>({duration:y})),l(me,pe)},ze=me=>{var pe=ye(),qe=le(pe);{var _e=ke=>{var Ee=zt(),Ce=n(Ee);ot(Ce,{onSave:d,get user(){return e(b)},set user(Fe){t(b,r(Fe))}}),v(Ee),ve(5,Ee,()=>ne,()=>({delay:g,duration:y})),ve(6,Ee,()=>ne,()=>({duration:y})),l(ke,Ee)};R(qe,ke=>{e(P)==="Delete"&&ke(_e)},!0)}l(me,pe)};R(Le,me=>{e(P)==="Logout"?me(xe):me(ze,!1)},!0)}l(ae,Q)};R(be,ae=>{e(P)==="Devices"?ae(ce):ae(B,!1)},!0)}l(ue,re)};R(q,ue=>{e(P)==="MFA"?ue(F):ue(de,!1)},!0)}l(G,u)};R(Z,G=>{e(P)==="Password"?G(o):G(h,!1)},!0)}l($,A)};R(te,$=>{e(P)==="Attributes"?$(se):$(k,!1)},!0)}l(V,H)};R(X,V=>{e(P)==="Info"?V(K):V(oe,!1)})}l(T,j)};R(C,T=>{e(S)?T(c):T(L,!1)})}v(m),l(w,m)},$$slots:{header:!0,body:!0}}),ge()}var Ot=I('<div class="header font-label svelte-1y7ceqm">ADD NEW USER</div>'),Dt=I('<div class="err svelte-1y7ceqm"> </div>'),Ut=I('<div class="container svelte-1y7ceqm"><!> <!> <!> <div class="language svelte-1y7ceqm"><div class="label svelte-1y7ceqm">LANGUAGE</div> <div style="margin-top: .4rem"><!></div></div> <div class="tiles svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">ROLES</div> <!></div> <div class="tiles svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">GROUPS</div> <!></div> <div class="unit svelte-1y7ceqm"><div class="label font-label svelte-1y7ceqm">LIMIT LIFETIME</div> <div class="value"><!></div></div> <!> <div class="btn svelte-1y7ceqm"><!> <!></div></div>');function Rt(W,M){he(M,!0);let s=$e(M,"idx",31,()=>-1),_=p(""),f=p(void 0),b=p("EN"),S=p(!1),N=p(void 0),x=p(r({email:"",family_name:"",given_name:"",roles:[],groups:[]})),P=p(r({}));const y=Re().shape({email:fe().required("E-Mail is required").email("Bad E-Mail format"),given_name:fe().trim().required("Given Name is required").matches(Ae,"Invalid characters"),family_name:fe().trim().required("Family Name is required").matches(Ae,"Invalid characters")});let g=p(void 0);Ye.subscribe(m=>{t(g,r(m))});let E=p(void 0);Be.subscribe(m=>{t(E,r(m))});async function d(){if(!await w())return;t(_,"");let m=e(x);if(m.language=e(b).toLowerCase(),e(S)){let c=ra(e(N));if(!c){t(_,"Invalid Date Input: User Expires");return}m.user_expires=c}let C=await Ia(e(x));if(C.ok)t(x,r({})),t(f,!1),t(x,r({email:"",family_name:"",given_name:"",roles:[],groups:[]})),M.onSave();else{let c=await C.json();t(_,r(c.message))}}async function w(){try{return await y.validate(e(x),{abortEarly:!1}),t(P,r({})),!0}catch(m){return t(P,r(Ge(m))),!1}}Je(W,{get idx(){return s()},set idx(m){s(m)},get show(){return e(f)},set show(m){t(f,r(m))},header:m=>{var C=Ot();l(m,C)},body:m=>{var C=Ut(),c=n(C);ie(c,{type:"email",autocomplete:"off",placeholder:"E-Mail",get value(){return e(x).email},set value(u){e(x).email=u},get error(){return e(P).email},set error(u){e(P).email=u},$$events:{input:w},children:(u,q)=>{Y();var F=D("E-MAIL");l(u,F)},$$slots:{default:!0}});var L=i(c,2);ie(L,{autocomplete:"off",placeholder:"Given Name",get value(){return e(x).given_name},set value(u){e(x).given_name=u},get error(){return e(P).given_name},set error(u){e(P).given_name=u},$$events:{input:w},children:(u,q)=>{Y();var F=D("GIVEN NAME");l(u,F)},$$slots:{default:!0}});var T=i(L,2);ie(T,{autocomplete:"off",placeholder:"Family Name",get value(){return e(x).family_name},set value(u){e(x).family_name=u},get error(){return e(P).family_name},set error(u){e(P).family_name=u},$$events:{input:w},children:(u,q)=>{Y();var F=D("FAMILY NAME");l(u,F)},$$slots:{default:!0}});var j=i(T,2),O=i(n(j),2),X=n(O);ea(X,{options:sa,get value(){return e(b)},set value(u){t(b,r(u))}}),v(O),v(j);var K=i(j,2),oe=i(n(K),2);je(oe,{get options(){return e(g)},searchThreshold:4,get items(){return e(x).roles},set items(u){e(x).roles=u}}),v(K);var V=i(K,2),H=i(n(V),2);je(H,{get options(){return e(E)},searchThreshold:4,get items(){return e(x).groups},set items(u){e(x).groups=u}}),v(V);var te=i(V,2);Ie(te,"margin-top","12px");var se=i(n(te),2),k=n(se);Pe(k,{get selected(){return e(S)},set selected(u){t(S,r(u))}}),v(se),v(te);var $=i(te,2);{var A=u=>{ie(u,{type:"datetime-local",step:"60",width:"18rem",get min(){return new Date().toISOString().split(".")[0]},max:"2099-01-01T00:00",get value(){return e(N)},set value(q){t(N,r(q))},$$events:{input:w},children:(q,F)=>{Y();var de=D("USER EXPIRES");l(q,de)},$$slots:{default:!0}})};R($,u=>{e(S)&&u(A)})}var Z=i($,2),o=n(Z);we(o,{level:1,$$events:{click:d},children:(u,q)=>{Y();var F=D("SAVE");l(u,F)},$$slots:{default:!0}});var h=i(o,2);{var G=u=>{var q=Dt(),F=n(q,!0);v(q),J(()=>ee(F,e(_))),l(u,q)};R(h,u=>{e(_)&&u(G)})}v(Z),v(C),l(m,C)},$$slots:{header:!0,body:!0}}),ge()}var At=I('<div class="svelte-1n3c0ep"><!></div>'),Gt=I('<div class="svelte-1n3c0ep"><!></div>'),Yt=I(' <div class="content"><!> <!> <div id="users" class="svelte-1n3c0ep"><!></div> <!></div>',1);function Bt(W,M){he(M,!0);let s=p(""),_=p(r([])),f=p(r([])),b=p(r([])),S=p(""),N=p(!1),x=p(""),P=p(0),y=p(15),g=p(""),E=p(1),d=p(r([{label:"E-Mail",callback:(o,h)=>o.email.toLowerCase().includes(h.toLowerCase())},{label:"ID",callback:(o,h)=>o.id.toLowerCase().includes(h.toLowerCase())}])),w=p(r([{label:"E-Mail",callback:(o,h)=>o.email.localeCompare(h.email)},{label:"ID",callback:(o,h)=>o.id.localeCompare(h.id)},{label:"Created",callback:(o,h)=>o.created_at<h.created_at},{label:"Last Login",callback:(o,h)=>{let G=o.last_login||9999999999,u=h.last_login||9999999999;return G<u}}]));Me(async()=>{m(),L(),T()});async function m(o,h,G,u){let q;if(o===!0?G&&e(E)===2?q=await Ze(u||e(y),h,void 0,!1):q=await Ze(u||e(y),h,e(g),G):q=await xa(),!q.ok)t(s,"Error fetching users: "+q.body.message);else{q.status===206?(t(y,r(Number.parseInt(q.headers.get("x-page-size"),10))),t(S,"user"),q.headers.get("x-continuation-token"),t(g,r(q.headers.get("x-continuation-token")))):t(S,""),t(P,r(q.headers.get("x-user-count")));let F=await q.json();t(_,r([...F])),t(f,r([...F]))}}async function C(o,h){await m(!0,o,h),h?t(E,e(E)-1):t(E,e(E)+1)}async function c(o){t(g,""),await m(!0,0,!1,o),t(E,1)}async function L(){let o=await ka();if(!o.ok)t(s,"Error fetching roles: "+o.body.message);else{let h=await o.json();za.set(h),Ye.set(h.map(G=>G.name))}}async function T(){let o=await Sa();if(!o.ok)t(s,"Error fetching groups: "+o.body.message);else{let h=await o.json();Ca.set(h),Be.set(h.map(G=>G.name))}}function j(){m(),L(),T(),t(x,"")}Y();var O=Yt(),X=le(O),K=i(X),oe=n(K);Va(oe,{get items(){return e(_)},get resItems(){return e(f)},set resItems(o){t(f,r(o))},get searchOptions(){return e(d)},set searchOptions(o){t(d,r(o))},get orderOptions(){return e(w)},set orderOptions(o){t(w,r(o))},get useServerSideIdx(){return e(S)},set useServerSideIdx(o){t(S,r(o))},get isSearchFiltered(){return e(N)},set isSearchFiltered(o){t(N,r(o))},get search(){return e(x)},set search(o){t(x,r(o))}});var V=i(oe,2);Rt(V,{onSave:j});var H=i(V,2),te=n(H);{var se=o=>{var h=ye(),G=le(h);Ne(G,17,()=>e(f),u=>u.id,(u,q)=>{var F=At(),de=n(F);ia(de,{get userId(){return e(q).id},get userEmail(){return e(q).email},onSave:j}),v(F),l(u,F)}),l(o,h)},k=o=>{var h=ye(),G=le(h);Ne(G,17,()=>e(b),u=>u.id,(u,q)=>{var F=Gt(),de=n(F);ia(de,{get userId(){return e(q).id},get userEmail(){return e(q).email},onSave:j}),v(F),l(u,F)}),l(o,h)};R(te,o=>{e(S)&&!e(N)?o(se):o(k,!1)})}v(H);var $=i(H,2);{var A=o=>{Ha(o,{get itemsTotal(){return e(P)},fetchPageCallback:C,sspPageSizeChange:c,get sspPage(){return e(E)},set sspPage(h){t(E,r(h))},get sspPageSize(){return e(y)},set sspPageSize(h){t(y,r(h))},get sspContinuationToken(){return e(g)},set sspContinuationToken(h){t(g,r(h))}})},Z=o=>{Xa(o,{get items(){return e(f)},set items(h){t(f,r(h))},get resItems(){return e(b)},set resItems(h){t(b,r(h))}})};R($,o=>{e(S)&&!e(N)?o(A):o(Z,!1)})}v(K),J(()=>ee(X,`${e(s)??""} `)),l(W,O),ge()}export{Bt as U};
