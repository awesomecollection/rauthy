import"./disclose-version.BDr9Qe-U.js";import{p as Q,o as M,j as E,g as m,a7 as a,a9 as t,a5 as I,a6 as z,a as V,a3 as D,a4 as ee}from"./index-client.Cqn5bTAA.js";import{s as g}from"./render.BxZ_8nPF.js";import{i as N}from"./if.CfO-_epY.js";import{a as f,t as L,c as se}from"./template.A7ni-K4i.js";import{f as re,s as ae}from"./helpers.CZ9R9OcM.js";import{p as P}from"./proxy.Ce5Ub1RB.js";import{s as te,p as y,a as ie}from"./props.YICxVAwD.js";import{t as oe}from"./tweened.D7sgWmKu.js";import{L as de}from"./Button.Ch35LVs2.js";import{B as ne,F as B,G as w,Z as ce,$ as le}from"./dataFetching.BTF7Y2Cd.js";import{u as ve}from"./i18n.svelte.CZcZQkVy.js";async function pe(u,d,h){let o=await ne(u,d);if(o.status===200){let r=await o.json(),n=r.rcr;n.publicKey.challenge=B(n.publicKey.challenge);for(let c of n.publicKey.allowCredentials)c.id=B(c.id);let i;try{i=await navigator.credentials.get(n)}catch(c){return console.error(c),{err:!0,msg:h||"Invalid Key"}}let j={code:r.code,data:{id:i.id,rawId:w(i.rawId),response:{authenticatorData:w(i.response.authenticatorData),clientDataJSON:w(i.response.clientDataJSON),signature:w(i.response.signature)},type:i.type}};return o=await ce(u,j),o.status===202?{err:!1,msg:"Authentication successful",body:await o.json()}:(console.error(o),{err:!0,msg:"Authentication Error"})}else return console.error(o),{err:!0,msg:"Error starting the Authentication"}}var ue=L('<div class="good svelte-jsdqii"> </div>'),me=L('<div class="err svelte-jsdqii"> </div>'),ge=L('<div class="wrapperOuter svelte-jsdqii"><div class="wrapperInner svelte-jsdqii"><div class="content svelte-jsdqii"><div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div></div> <div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div> <div><progress class="svelte-jsdqii"></progress></div></div> <div class="contentRow svelte-jsdqii"><!></div></div></div></div>');function fe(u,d){Q(d,!0);const h=te(),o=()=>ie(T,"$progress",h);let r=y(d,"data",15),n=y(d,"purpose",3,"Login"),i=y(d,"onError",3,e=>{}),j=y(d,"onSuccess",3,e=>{}),c=D(!1),R=D(""),q=D(!1),l=ve(),T=oe(r().exp,{duration:r().exp*1e3});M(()=>{let e=setTimeout(()=>{r(void 0)},r().exp*1e3);return T.set(0),()=>clearTimeout(e)}),M(async()=>{let e;n()==="Login"?e={purpose:{Login:r().code}}:e={purpose:n()};let s={};try{s=await le(pe(r().user_id,e,(l==null?void 0:l.authorize.invalidKeyUsed)||"Invalid Key"),r().exp*1e3-1e3)}catch(p){console.error(p),s.err=!0,s.msg="Timeout",i()("Passkey Error")}E(c,P(s.err)),E(q,!s.err),E(R,P(s.msg)),m(q)?j()(s.body):setTimeout(()=>{i()()},3e3)});var x=ge(),O=a(x),S=a(O),b=a(S),$=a(b),C=a($,!0);t($),t(b);var A=I(b,2),K=a(A),U=a(K);t(K);var F=I(K,2),H=a(F);t(F),t(A);var J=I(A,2),W=a(J);{var _=e=>{var s=ue(),p=a(s,!0);t(s),z(()=>g(p,l.authorize.mfaAck||"Acknowledged")),f(e,s)},G=e=>{var s=se(),p=ee(s);{var X=v=>{var k=me(),Z=a(k,!0);t(k),z(()=>g(Z,m(R))),f(v,k)},Y=v=>{de(v,{background:!1})};N(p,v=>{m(c)?v(X):v(Y,!1)},!0)}f(e,s)};N(W,e=>{m(q)?e(_):e(G,!1)})}t(J),t(S),t(O),t(x),z(()=>{g(C,l.authorize.provideMfa||"Please login with your MFA device"),g(U,`${l.authorize.requestExpires||"Request expires"}
                    :`),re(H,o()),ae(H,"max",r().exp)}),f(u,x),V()}export{fe as W};
