import"./disclose-version.BDr9Qe-U.js";import{p as W,o as B,j as G,b as L,g as l,a4 as O,a as M,a3 as Q,a7 as n,a9 as c,a5 as S,a6 as D}from"./index-client.Bsb9hq-M.js";import{s as E}from"./render.Cl_nSOQQ.js";import{i as k}from"./if.Mw_hWmq0.js";import{c as T,a as g,t as I}from"./template.D54H5ZkF.js";import{p as V}from"./proxy.DclUEOHG.js";import{a as _,L as X}from"./ThemeSwitch.Zeh_8WtX.js";import{I as Y,J as Z,K as F,x as j}from"./helpers.Cfg4Q1a_.js";import{u as ee}from"./i18n.svelte.B0RF3bDg.js";function re(i){let t=Z(i);const s={"+":"-","/":"_","=":""};return t.replace(/[+/=]/g,e=>s[e])}function z(i){if(typeof i=="string"){const t={"-":"+",_:"/",".":"="},s=i.replace(/[-_.]/g,e=>t[e]);return Y(s)}else return i}async function ae(i,t,s,e){let b={purpose:t},d=await _(`/auth/v1/users/${i}/webauthn/auth/start`,b);if(d.error)return console.error(d.error),{error:d.error.message||"Error starting the Authentication"};if(!d.body){let a="Did not receive a valid webauthn body";return console.error(a),{error:a}}let y=d.body,r=y.rcr;if(!r.publicKey){let a="no publicKey in challenge from the backend";return console.error(a),{error:a}}if(r.publicKey.challenge=z(r.publicKey.challenge),r.publicKey.allowCredentials)for(let a of r.publicKey.allowCredentials)a.id=z(a.id);const f=(y.exp-1)*1e3,w=new Date().getTime()+f;let o;try{const a=await F(navigator.credentials.get(r),f);if(a)o=a;else return{error:s}}catch{return{error:new Date().getTime()>=w?e:s}}let h={code:y.code,data:{id:o.id,rawId:j(o.rawId),response:{authenticatorData:j(o.response.authenticatorData),clientDataJSON:j(o.response.clientDataJSON),signature:j(o.response.signature)},extensions:o.getClientExtensionResults(),type:o.type}},u=await _(`/auth/v1/users/${i}/webauthn/auth/finish`,h);return u.status===202?{data:u.body}:(console.error(u),{error:u.error||"Authentication Error"})}var te=I('<div class="err svelte-jfkcym"> </div>'),se=I('<div class="good svelte-jfkcym"> </div>'),oe=I('<div class="wrapperOuter svelte-jfkcym"><div class="wrapperInner svelte-jfkcym"><div class="content svelte-jfkcym"><div class="contentRow svelte-jfkcym"><div class="contentHeader svelte-jfkcym"> </div></div> <div class="contentRow svelte-jfkcym"><div><!></div></div> <div class="contentRow svelte-jfkcym"><!></div></div></div></div>');function ie(i,t){W(t,!0);let s=ee(),e=Q(void 0);B(async()=>{G(e,V(await ae(t.userId,t.purpose,s.authorize.invalidKeyUsed,s.authorize.requestExpired)))}),L(()=>{l(e)&&(l(e).error?setTimeout(()=>{var r;t.onError(((r=l(e))==null?void 0:r.error)||"Webauthn Error")},3e3):t.onSuccess(l(e).data))});var b=T(),d=O(b);{var y=r=>{var f=oe(),w=n(f),o=n(w),h=n(o),u=n(h),a=n(u,!0);c(u),c(h);var K=S(h,2),R=n(K),J=n(R);{var N=v=>{X(v,{})};k(J,v=>{l(e)||v(N)})}c(R),c(K);var A=S(K,2),$=n(A);{var q=v=>{var C=T(),H=O(C);{var P=m=>{var p=te(),x=n(p,!0);c(p),D(()=>E(x,l(e).error)),g(m,p)},U=m=>{var p=se(),x=n(p,!0);c(p),D(()=>E(x,s.authorize.mfaAck)),g(m,p)};k(H,m=>{l(e).error?m(P):m(U,!1)})}g(v,C)};k($,v=>{l(e)&&v(q)})}c(A),c(o),c(w),c(f),D(()=>E(a,s.authorize.expectingPasskey)),g(r,f)};k(d,r=>{t.purpose&&r(y)})}g(i,b),M()}export{ie as W,re as a,z as b};
