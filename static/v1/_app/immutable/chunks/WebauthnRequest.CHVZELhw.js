import{a as m,b as I,c as Q}from"./disclose-version.DZhRUPAc.js";import{p as X,o as N,j as k,g,a3 as a,a5 as t,a1 as z,a2 as D,a as ee,_ as L,a0 as se}from"./index-client.CGppiJvc.js";import{s as f}from"./render.D4MwAWTL.js";import{i as P}from"./if.DUA6Hpfn.js";import{d as re,s as ae,L as te}from"./Loading.FF_EHyHU.js";import{p as U}from"./proxy.DB4Km9hY.js";import{s as ie,p as y,a as oe}from"./props.Df_pGDSd.js";import{t as de}from"./tweened.CQQvc4Vq.js";import{B as ne,F as _,G as w,U as ce,V as le}from"./dataFetching.Dto1xJW6.js";import{u as ve}from"./i18n.svelte.BTGsPiz_.js";async function pe(u,d,h){let o=await ne(u,d);if(o.status===200){let r=await o.json(),n=r.rcr;n.publicKey.challenge=_(n.publicKey.challenge);for(let c of n.publicKey.allowCredentials)c.id=_(c.id);let i;try{i=await navigator.credentials.get(n)}catch(c){return console.error(c),{err:!0,msg:h||"Invalid Key"}}let j={code:r.code,data:{id:i.id,rawId:w(i.rawId),response:{authenticatorData:w(i.response.authenticatorData),clientDataJSON:w(i.response.clientDataJSON),signature:w(i.response.signature)},type:i.type}};return o=await ce(u,j),o.status===202?{err:!1,msg:"Authentication successful",body:await o.json()}:(console.error(o),{err:!0,msg:"Authentication Error"})}else return console.error(o),{err:!0,msg:"Error starting the Authentication"}}var ue=I('<div class="good svelte-jsdqii"> </div>'),me=I('<div class="err svelte-jsdqii"> </div>'),ge=I('<div class="wrapperOuter svelte-jsdqii"><div class="wrapperInner svelte-jsdqii"><div class="content svelte-jsdqii"><div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div></div> <div class="contentRow svelte-jsdqii"><div class="contentHeader svelte-jsdqii"> </div> <div><progress class="svelte-jsdqii"></progress></div></div> <div class="contentRow svelte-jsdqii"><!></div></div></div></div>');function fe(u,d){X(d,!0);const h=ie(),o=()=>oe(S,"$progress",h);let r=y(d,"data",15),n=y(d,"purpose",3,"Login"),i=y(d,"onError",3,e=>{}),j=y(d,"onSuccess",3,e=>{}),c=L(!1),R=L(""),q=L(!1),l=ve(),S=de(r().exp,{duration:r().exp*1e3});N(()=>{let e=setTimeout(()=>{r(void 0)},r().exp*1e3);return S.set(0),()=>clearTimeout(e)}),N(async()=>{let e;n()==="Login"?e={purpose:{Login:r().code}}:e={purpose:n()};let s={};try{s=await le(pe(r().user_id,e,(l==null?void 0:l.authorize.invalidKeyUsed)||"Invalid Key"),r().exp*1e3-1e3)}catch(p){console.error(p),s.err=!0,s.msg="Timeout",i()("Passkey Error")}k(c,U(s.err)),k(q,!s.err),k(R,U(s.msg)),g(q)?j()(s.body):setTimeout(()=>{i()()},3e3)});var x=ge(),T=a(x),O=a(T),b=a(O),F=a(b),$=a(F,!0);t(F),t(b);var A=z(b,2),K=a(A),B=a(K);t(K);var H=z(K,2),J=a(H);t(H),t(A);var M=z(A,2),C=a(M);{var W=e=>{var s=ue(),p=a(s,!0);t(s),D(()=>f(p,l.authorize.mfaAck||"Acknowledged")),m(e,s)},G=e=>{var s=Q(),p=se(s);{var V=v=>{var E=me(),Z=a(E,!0);t(E),D(()=>f(Z,g(R))),m(v,E)},Y=v=>{te(v,{background:!1})};P(p,v=>{g(c)?v(V):v(Y,!1)},!0)}m(e,s)};P(C,e=>{g(q)?e(W):e(G,!1)})}t(M),t(O),t(T),t(x),D(()=>{f($,l.authorize.provideMfa||"Please login with your MFA device"),f(B,`${l.authorize.requestExpires||"Request expires"}
                    :`),re(J,o()),ae(J,"max",r().exp)}),m(u,x),ee()}export{fe as W};
