import"../chunks/disclose-version.BDr9Qe-U.js";import{p as Me,c as d,r as c,t as w,a as Fe,g as e,y as re,k as we,f as g,$ as Te,b as t,s as o,d as $,a9 as P}from"../chunks/index-client.B6iEebqi.js";import{s as p}from"../chunks/render.Bsso_k3p.js";import{i as f}from"../chunks/if.1XSPtMho.js";import{a,t as m,c as Z,b as q}from"../chunks/template.BMDtqFuO.js";import{h as fr}from"../chunks/svelte-head.BZpVhBz3.js";import{s as ge,b as mr,t as Oe,d as He}from"../chunks/index.CmB1UnQy.js";import{p as h}from"../chunks/proxy.CjI65D-A.js";import{G as hr,H as wr}from"../chunks/helpers.Cbcu7vP_.js";import{T as gr,B}from"../chunks/ThemeSwitch.CRSTiBZD.js";import{P as $r}from"../chunks/PasswordPolicy.D0S-eDD0.js";import{I as yr}from"../chunks/Input.Bd9f6bUF.js";import{W as br}from"../chunks/WebauthnRequest.B12HRIW8.js";import{u as _r,L as Rr}from"../chunks/LangSelector.BbriGzIU.js";import{u as kr}from"../chunks/i18n.svelte.CSnrsaW1.js";import{M as Lr,C as xr}from"../chunks/ContentCenter.CrmYuxhV.js";import{T as Sr}from"../chunks/Template.C8mYZqXV.js";import{u as jr}from"../chunks/param.svelte.BdhMoRpL.js";import{I as Je}from"../chunks/InputPassword.DGTcf7PR.js";import{s as Cr}from"../chunks/snippet.CTHg_e8y.js";import{p as ce}from"../chunks/props.C6aLk1Bq.js";import{p as pe}from"../chunks/index.yy28iGGd.js";import{w as Tr}from"../chunks/registration.76Y1Y4TV.js";import{F as Ke}from"../chunks/Form.2JZBppzc.js";import{a as Nr}from"../chunks/patterns.BdncpE46.js";var Pr=m('<a class="font-label svelte-1cyodh8"><!></a>');function Ze($e,u){Me(u,!0);let ue=ce(u,"selectedStep",3,!1),se=ce(u,"hideUnderline",3,!1),s=ce(u,"highlight",3,!1),ye=ce(u,"highlightExact",3,!0),i=ce(u,"highlightWithParams",3,!1),te=re(()=>{if(ue())return"step";if(i()){if(`${pe.route.id}${pe.url.search}`.startsWith(u.href))return"page"}else if(ye()){if(pe.route.id===u.href.split("?")[0])return"page"}else if(pe.route.id&&pe.route.id.startsWith(u.href.split("?")[0]))return"page"});var y=Pr(),E=d(y);Cr(E,()=>u.children),c(y),w(()=>{ge(y,"href",u.href),ge(y,"target",u.target),ge(y,"aria-current",e(te)),ge(y,"data-highlight",s()),mr(y,"hideUnderline",se())}),a($e,y),Fe()}var qr=m('<!> <!> <!> <div class="generate svelte-1w50bpj"><!></div> <!>',1),Ar=m('<div class="dev svelte-1w50bpj"><p>This window shows up during local dev,<br> only to be able to switch modes easily.<br></p> <!> <!></div>'),Ur=m("<p> <br> <br> <br> <!></p>"),Wr=m("<div><!></div>"),Dr=m("<!> <!>",1),Ir=m('<div class="success"><p> </p> <p> </p> <!></div>'),zr=m("<div><!> <!></div>"),Br=m('<h1> </h1> <p> </p> <p> <!></p> <div class="typeChoice svelte-1w50bpj"><!> <!></div> <!>',1),Er=m("<h1>Password Reset</h1> <!>",1),Gr=m('<div class="err svelte-1w50bpj"> </div>'),Mr=m('<div class="container"><!> <!></div>'),Fr=m("<!> <!> <!>",1),Or=m("<!> <!> <!> <!>",1);function Hr($e,u){Me(u,!0);const ue=r=>{var b=Z(),_=g(b);{var U=v=>{Ke(v,{action:"",onSubmit:Xe,children:(R,W)=>{var M=qr(),X=g(M);$r(X,{get policy(){return e(i).password_policy},get password(){return e(A)},get accepted(){return e(be)},set accepted(l){t(be,h(l))}});var Y=o(X,2),D=re(()=>e(A).length>=e(i).password_policy.length_min);Je(Y,{autocomplete:"new-password",get label(){return s.account.passwordNew},get placeholder(){return s.account.passwordNew},get maxLength(){return e(i).password_policy.length_max},required:!0,get showCopy(){return e(D)},width:se,get ref(){return e(y)},set ref(l){t(y,h(l))},get value(){return e(A)},set value(l){t(A,h(l))}});var n=o(Y,2);Je(n,{autocomplete:"new-password",get label(){return s.account.passwordConfirm},get placeholder(){return s.account.passwordConfirm},get maxLength(){return e(i).password_policy.length_max},required:!0,width:se,get value(){return e(ie)},set value(l){t(ie,h(l))}});var k=o(n,2),z=d(k);B(z,{level:2,onclick:Qe,children:(l,F)=>{P();var C=q();w(()=>p(C,s.passwordReset.generate)),a(l,C)},$$slots:{default:!0}}),c(k);var I=o(k,2);B(I,{type:"submit",get isLoading(){return e(E)},children:(l,F)=>{P();var C=q();w(()=>p(C,s.common.save)),a(l,C)},$$slots:{default:!0}}),a(R,M)},$$slots:{default:!0}})};f(_,v=>{e(i)&&v(U)})}a(r,b)},se="20rem";let s=kr(),ye=_r().get(),i=$(void 0),te=$(void 0),y=$(void 0),E=$(!1),S=$(""),Q=jr("type","password_reset"),G=$(""),ve=$(""),V=$(!1),be=$(!1),ae=$(void 0),oe=$(""),A=$(""),ie=$("");we(()=>{e(G)&&_e()}),we(()=>{var r;(r=e(te))==null||r.focus()}),we(()=>{var r;(r=e(y))==null||r.focus()}),we(()=>{e(V)&&setTimeout(()=>{e(ve)?window.location.replace(e(ve)):Ne()},5e3)});function Ne(){window.location.replace("/auth/v1/account")}function Qe(){if(e(i)){let r=wr(e(i).password_policy);t(A,h(r)),t(ie,h(r))}}async function Ve(){if(!e(i)){console.error("template data is undefined");return}if(t(S,""),e(oe).length<1){t(S,h(s.mfa.passkeyNameErr));return}let r=await Tr(e(i).user_id,e(oe),s.authorize.invalidKeyUsed,s.authorize.requestExpired);r.error?t(S,`${s.mfa.errorReg} - ${r.error}`):(_e(),t(V,!0))}async function Xe(){var r;if(t(S,""),!!e(be)){if(e(A)!==e(ie)){t(S,h(s.passwordReset.passwordNoMatch));return}if(e(A).length>256){t(S,"max 256");return}(r=e(i))!=null&&r.needs_mfa?t(ae,"PasswordReset"):await Pe()}}async function Pe(r){var U;if(!e(i))return;t(E,!0);const b={password:e(A),magic_link_id:e(i).magic_link_id,mfa_code:r};let _=await fetch(`/auth/v1/users/${e(i).user_id}/reset`,{method:"PUT",headers:{"content-type":"application/json","pwd-csrf-token":(U=e(i))==null?void 0:U.csrf_token},body:JSON.stringify(b)});if(_.ok)_e(),t(ve,h(_.headers.get("location")||"/auth/v1/account")),t(V,!0);else{const v=await _.json();t(S,h(v.message))}t(E,!1)}function Ye(r){t(S,h(r)),t(ae,void 0)}function er(r){t(ae,void 0),r&&"code"in r?Pe(r.code):console.error("invalid webauthn response",r)}function _e(){t(S,""),t(oe,""),t(A,""),t(ie,"")}var qe=Or();fr(r=>{var b=Z(),_=g(b);{var U=R=>{var W=Z(),M=g(W);{var X=D=>{w(()=>Te.title=s.passwordReset.newAccount)},Y=D=>{var n=Z(),k=g(n);{var z=I=>{w(()=>Te.title=s.passwordReset.passwordReset)};f(k,I=>{Q.get()==="password_reset"&&I(z)},!0)}a(D,n)};f(M,D=>{var n;(n=Q.get())!=null&&n.startsWith("new_user")?D(X):D(Y,!1)})}a(R,W)},v=R=>{Te.title="Password"};f(_,R=>{s?R(U):R(v,!1)})}a(r,b)});var Ae=g(qe);Sr(Ae,{id:hr,get value(){return e(i)},set value(r){t(i,h(r))}});var Ue=o(Ae,2);{var rr=r=>{var b=Ar(),_=o(d(b),2);B(_,{level:2,onclick:()=>Q.set("new_user"),children:(v,R)=>{P();var W=q("new_user");a(v,W)},$$slots:{default:!0}});var U=o(_,2);B(U,{level:2,onclick:()=>Q.set("password_reset"),children:(v,R)=>{P();var W=q("password_reset");a(v,W)},$$slots:{default:!0}}),c(b),a(r,b)};f(Ue,r=>{ye&&r(rr)})}var We=o(Ue,2);Lr(We,{children:(r,b)=>{xr(r,{children:(_,U)=>{var v=Fr(),R=g(v);{var W=n=>{br(n,{get userId(){return e(i).user_id},get purpose(){return e(ae)},onSuccess:er,onError:Ye})};f(R,n=>{e(ae)&&e(i)&&n(W)})}var M=o(R,2);{var X=n=>{var k=Ur(),z=d(k),I=o(z,2),l=o(I,4),F=o(l),C=re(()=>e(ve)||"/auth/v1/account");Ze(F,{get href(){return e(C)},children:(Re,De)=>{P();var ke=q("Account");a(Re,ke)},$$slots:{default:!0}}),c(k),w(()=>{p(z,`${s.passwordReset.success1??""} `),p(I,` ${s.passwordReset.success2??""} `),p(l,` ${s.passwordReset.success3??""} `)}),a(n,k)},Y=n=>{var k=Z(),z=g(k);{var I=l=>{var F=Mr(),C=d(F);{var Re=T=>{var L=Br(),O=g(L),Le=d(O,!0);c(O);var H=o(O,2),J=d(H,!0);c(H);var ne=o(H,2),Ie=d(ne),ar=o(Ie);Ze(ar,{get href(){return s.passwordReset.fidoLink},target:"_blank",children:(x,N)=>{P();var j=q("FIDO Alliance");a(x,j)},$$slots:{default:!0}}),c(ne);var xe=o(ne,2),ze=d(xe),or=re(()=>e(G)?3:1);B(ze,{get level(){return e(or)},onclick:()=>t(G,"passkey"),get isLoading(){return e(E)},children:(x,N)=>{P();var j=q();w(()=>p(j,s.passwordReset.passwordless)),a(x,j)},$$slots:{default:!0}});var ir=o(ze,2),nr=re(()=>e(G)?3:2);B(ir,{get level(){return e(nr)},onclick:()=>t(G,"password"),get isLoading(){return e(E)},children:(x,N)=>{P();var j=q();w(()=>p(j,s.passwordReset.password)),a(x,j)},$$slots:{default:!0}}),c(xe);var lr=o(xe,2);{var dr=x=>{var N=Wr(),j=d(N);ue(j),c(N),Oe(3,N,()=>He),a(x,N)},cr=x=>{var N=Z(),j=g(N);{var pr=Se=>{var fe=zr(),Be=d(fe);Ke(Be,{action:"",onSubmit:Ve,children:(le,me)=>{var ee=Dr(),he=g(ee);yr(he,{autocomplete:"off",get label(){return s.mfa.passkeyName},get placeholder(){return s.mfa.passkeyName},width:se,maxLength:32,pattern:Nr,required:!0,get ref(){return e(te)},set ref(K){t(te,h(K))},get value(){return e(oe)},set value(K){t(oe,h(K))}});var de=o(he,2),je=re(()=>e(V)?2:1);B(de,{type:"submit",get level(){return e(je)},children:(K,Ee)=>{P();var Ce=q();w(()=>p(Ce,s.mfa.register)),a(K,Ce)},$$slots:{default:!0}}),a(le,ee)},$$slots:{default:!0}});var ur=o(Be,2);{var vr=le=>{var me=Ir(),ee=d(me),he=d(ee,!0);c(ee);var de=o(ee,2),je=d(de,!0);c(de);var K=o(de,2);B(K,{onclick:Ne,children:(Ee,Ce)=>{P();var Ge=q();w(()=>p(Ge,s.passwordReset.accountLogin)),a(Ee,Ge)},$$slots:{default:!0}}),c(me),w(()=>{p(he,s.passwordReset.successPasskey1),p(je,s.passwordReset.successPasskey2)}),a(le,me)};f(ur,le=>{e(V)&&le(vr)})}c(fe),Oe(3,fe,()=>He),a(Se,fe)};f(j,Se=>{e(G)==="passkey"&&Se(pr)},!0)}a(x,N)};f(lr,x=>{e(G)==="password"?x(dr):x(cr,!1)})}w(()=>{p(Le,s.passwordReset.newAccount),p(J,s.passwordReset.newAccDesc1),p(Ie,`${s.passwordReset.newAccDesc2??""} `)}),a(T,L)},De=T=>{var L=Z(),O=g(L);{var Le=H=>{var J=Er(),ne=o(g(J),2);ue(ne),a(H,J)};f(O,H=>{var J;(J=Q.get())!=null&&J.startsWith("password_reset")&&H(Le)},!0)}a(T,L)};f(C,T=>{var L;(L=Q.get())!=null&&L.startsWith("new_user")?T(Re):T(De,!1)})}var ke=o(C,2);{var tr=T=>{var L=Gr(),O=d(L,!0);c(L),w(()=>p(O,e(S))),a(T,L)};f(ke,T=>{e(S)&&T(tr)})}c(F),a(l,F)};f(z,l=>{e(i)&&l(I)},!0)}a(n,k)};f(M,n=>{e(V)?n(X):n(Y,!1)})}var D=o(M,2);gr(D,{absolute:!0}),a(_,v)},$$slots:{default:!0}})},$$slots:{default:!0}});var sr=o(We,2);Rr(sr,{absolute:!0}),a($e,qe),Fe()}export{Hr as component};
