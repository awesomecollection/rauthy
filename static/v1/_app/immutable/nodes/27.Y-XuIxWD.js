import"../chunks/disclose-version.BDr9Qe-U.js";import{p as U,o as z,s as F,f as m,a as E,b as r,g as c,d as p,A as J,$ as K,c as I,a9 as N,r as M,t as Q}from"../chunks/index-client.B6iEebqi.js";import{s as V}from"../chunks/render.Bsso_k3p.js";import{i as _}from"../chunks/if.1XSPtMho.js";import{a as i,t as L,c as B,b as X}from"../chunks/template.BMDtqFuO.js";import{h as Z}from"../chunks/svelte-head.BZpVhBz3.js";import{p as f}from"../chunks/proxy.CjI65D-A.js";import{A as D,B as O}from"../chunks/helpers.Cbcu7vP_.js";import{W as ee}from"../chunks/WebauthnRequest.B12HRIW8.js";import{s as ae}from"../chunks/snippet.CTHg_e8y.js";import{u as oe,L as re}from"../chunks/LangSelector.BbriGzIU.js";import{a as te,T as se,B as ie}from"../chunks/ThemeSwitch.CRSTiBZD.js";import{u as ne}from"../chunks/i18n.svelte.CSnrsaW1.js";import{u as H}from"../chunks/param.svelte.BdhMoRpL.js";var ce=L("<div><h2>Cookies disabled</h2> <p>You need to enable Cookies.<br> Without them, a safe login cannot be executed.</p></div>"),le=L("<noscript></noscript> <!>",1);function ue(P,x){U(x,!0);let T=p(!1),h=p(!1);z(()=>{r(h,f(navigator.cookieEnabled)),r(T,!0)});var t=le(),b=F(m(t),2);{var u=g=>{var W=B(),e=m(W);{var k=s=>{var n=B(),a=m(n);ae(a,()=>x.children??J),i(s,n)},l=s=>{var n=ce();i(s,n)};_(e,s=>{c(h)?s(k):s(l,!1)})}i(g,W)};_(b,g=>{c(T)&&g(u)})}i(P,t),E()}var ve=L('<div class="btn flex-col svelte-17xvymb"><!></div>'),de=L('<div class="err"> </div>'),me=L("<!> <!> <!>",1);function pe(P,x){U(x,!0);let T=ne(),h=p(!1),t=p(""),b=p(void 0),u=p(void 0);z(async()=>{var w,y;let e=H("error").get();if(e){let o=H("error_description").get();r(t,`${e}: ${o}`);return}let k=H("state").get();if(!k){r(t,"'state' is missing in URL");return}let l=H("code").get();if(!l){r(t,"'code' is missing in URL");return}let s={state:k,code:l,pkce_verifier:D(),xsrf_token:O()},n="/auth/v1/providers/callback";oe().get()&&(n="/auth/v1/dev/providers_callback");let a=await te(n,s);if(a.status===202)window.location.replace(a.headers.get("location")||"/auth/v1/account");else if(a.status===200){r(t,"");let o=a.body;o&&"user_id"in o&&"code"in o?(r(b,f(o.user_id)),r(u,f({Login:o.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else a.status===204?window.location.replace("/auth/v1/account"):a.status===403?r(t,f(((w=a.error)==null?void 0:w.message)||"HTTP 403 Forbidden")):a.status===406?(r(t,f(T.authorize.clientForceMfa)),r(h,!0)):r(t,`HTTP ${a.status}: ${(y=a.error)==null?void 0:y.message}`)});function g(e){r(t,f(e)),r(u,void 0)}function W(e){console.log("onWebauthnSuccess",e),e&&"loc"in e&&window.location.replace(e.loc)}Z(e=>{K.title="Callback"}),ue(P,{children:(e,k)=>{var l=me(),s=m(l);{var n=o=>{ee(o,{get userId(){return c(b)},get purpose(){return c(u)},onSuccess:W,onError:g})},a=o=>{var S=B(),Y=m(S);{var j=v=>{var d=ve(),R=I(d);ie(R,{onclick:()=>window.location.href="/auth/v1/account",children:(C,A)=>{N();var $=X("Account");i(C,$)},$$slots:{default:!0}}),M(d),i(v,d)},q=v=>{var d=B(),R=m(d);{var C=A=>{var $=de(),G=I($,!0);M($),Q(()=>V(G,c(t))),i(A,$)};_(R,A=>{c(t)&&A(C)},!0)}i(v,d)};_(Y,v=>{c(h)?v(j):v(q,!1)},!0)}i(o,S)};_(s,o=>{c(u)&&c(b)?o(n):o(a,!1)})}var w=F(s,2);se(w,{absolute:!0});var y=F(w,2);re(y,{absolute:!0}),i(e,l)},$$slots:{default:!0}}),E()}export{pe as component};
