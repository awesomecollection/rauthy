import"../chunks/disclose-version.BDr9Qe-U.js";import{p as we,o as Le,f as k,a as ye,b as a,t as l,$ as Se,g as e,s as o,d as f,c as t,r as s,a9 as Q,y as ce}from"../chunks/index-client.B6iEebqi.js";import{s as d}from"../chunks/render.Bsso_k3p.js";import{i as W}from"../chunks/if.1XSPtMho.js";import{f as Te,T as ke,B as X,a as Ae,e as Ce,i as De}from"../chunks/ThemeSwitch.CRSTiBZD.js";import{a as i,t as z,b as Y,c as le}from"../chunks/template.BMDtqFuO.js";import{h as Ee}from"../chunks/svelte-head.BZpVhBz3.js";import{p as n}from"../chunks/proxy.CjI65D-A.js";import{r as ne,i as Pe}from"../chunks/helpers.Cbcu7vP_.js";import{L as Re}from"../chunks/LangSelector.BbriGzIU.js";import{I as je}from"../chunks/Input.Bd9f6bUF.js";import{f as qe}from"../chunks/pow.Btz0dp6P.js";import{M as Be,C as Me}from"../chunks/ContentCenter.CrmYuxhV.js";import{u as Ne}from"../chunks/i18n.svelte.CSnrsaW1.js";import{T as Oe}from"../chunks/Template.C8mYZqXV.js";import{u as We}from"../chunks/param.svelte.BdhMoRpL.js";import{P as _e}from"../chunks/patterns.BdncpE46.js";var Fe=z('<div class="desc svelte-hzde4x"> </div> <!> <div><!></div>',1),Ge=z('<div class="desc svelte-hzde4x"><p> </p> <p> </p></div>'),He=z('<div class="desc svelte-hzde4x"><p class="declined svelte-hzde4x"> </p> <p> </p></div>'),Ie=z('<li class="svelte-hzde4x"> </li>'),Je=z('<div class="desc svelte-hzde4x"> <ul class="svelte-hzde4x"></ul></div> <div class="inline svelte-hzde4x"><!> <!></div>',1),Ke=z('<div class="container svelte-hzde4x"><div class="name svelte-hzde4x"><h2> </h2></div> <!> <div class="err svelte-hzde4x"> </div></div>'),Ue=z("<!> <!> <!>",1),Ve=z("<!> <!>",1);function Qe(ue,pe){we(pe,!0);let r=Ne(),Z=f(void 0),b=f(""),_=f(!1),A=f(!1),w=f(8),F=f(void 0),ee=f(!1),re=f(!1),y=f("");Le(async()=>{let v=We("code").get()||"";a(y,n(v));let S=await Te("/auth/v1/oidc/sessioninfo");S.body?a(Z,n(S.body)):v?ne(`device?code=${v}`):ne("device")});async function G(v){var C,D,B;if(a(b,""),e(_))return;if(e(y).length<e(w)){a(b,n(r.common.errTooShort));return}if(e(y).length>e(w)){a(b,n(r.common.errTooLong));return}a(A,!0);let S=await qe();if(!S){a(b,"PoW error - please contact your administrator");return}let H={user_code:e(y),pow:S,device_accepted:v},h=await Ae("/auth/v1/oidc/device/verify",H);h.status===200?a(F,n(((D=(C=h.body)==null?void 0:C.scopes)==null?void 0:D.split(" "))||["openid"])):h.status===202?(a(ee,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3)):h.status===204?a(re,!0):h.status===404?a(b,n(r.device.wrongOrExpired)):(console.error(h),a(b,n((B=h.error)==null?void 0:B.message))),a(A,!1)}var ae=Ve();Ee(v=>{l(()=>Se.title=(r==null?void 0:r.device.title)||"Device Authorization")});var se=k(ae);Oe(se,{id:Pe,get value(){return e(w)},set value(v){a(w,n(v))}});var me=o(se,2);Be(me,{children:(v,S)=>{Me(v,{children:(H,h)=>{var C=Ue(),D=k(C);{var B=I=>{var J=Ke(),K=t(J),ie=t(K),he=t(ie,!0);s(ie),s(K);var oe=o(K,2);{var ge=T=>{var E=Fe(),P=k(E),U=t(P,!0);l(()=>d(U,r.device.desc.replace("{{count}}",e(w).toString()))),s(P);var M=o(P,2),g=ce(()=>e(w).toString()),x=ce(()=>e(w).toString());je(M,{name:"userCode",autocomplete:"off",get label(){return r.device.userCode},get placeholder(){return r.device.userCode},required:!0,get min(){return e(g)},get max(){return e(x)},pattern:_e,get value(){return e(y)},set value(c){a(y,n(c))},get isError(){return e(_)},set isError(c){a(_,n(c))}});var $=o(M,2),R=t($);X(R,{onclick:()=>G("pending"),get isLoading(){return e(A)},children:(c,u)=>{Q();var p=Y();l(()=>d(p,r.device.submit)),i(c,p)},$$slots:{default:!0}}),s($),i(T,E)},xe=T=>{var E=le(),P=k(E);{var U=g=>{var x=Ge(),$=t(x),R=t($,!0);s($);var c=o($,2),u=t(c,!0);s(c),s(x),l(()=>{d(R,r.device.isAccepted),d(u,r.device.autoRedirectAccount)}),i(g,x)},M=g=>{var x=le(),$=k(x);{var R=u=>{var p=He(),L=t(p),N=t(L,!0);s(L);var j=o(L,2),O=t(j,!0);s(j),s(p),l(()=>{d(N,r.device.isDeclined),d(O,r.device.closeWindow)}),i(u,p)},c=u=>{var p=Je(),L=k(p),N=t(L),j=o(N);Ce(j,21,()=>e(F),De,(q,V)=>{var m=Ie(),be=t(m,!0);s(m),l(()=>d(be,e(V))),i(q,m)}),s(j),s(L);var O=o(L,2),ve=t(O);X(ve,{onclick:()=>G("accept"),get isLoading(){return e(A)},children:(q,V)=>{Q();var m=Y();l(()=>d(m,r.device.accept)),i(q,m)},$$slots:{default:!0}});var ze=o(ve,2);X(ze,{level:-1,onclick:()=>G("decline"),get isLoading(){return e(A)},children:(q,V)=>{Q();var m=Y();l(()=>d(m,r.device.decline)),i(q,m)},$$slots:{default:!0}}),s(O),l(()=>d(N,`${r.device.descScopes??""} `)),i(u,p)};W($,u=>{e(re)?u(R):u(c,!1)},!0)}i(g,x)};W(P,g=>{e(ee)?g(U):g(M,!1)},!0)}i(T,E)};W(oe,T=>{e(F)===void 0?T(ge):T(xe,!1)})}var de=o(oe,2),$e=t(de,!0);s(de),s(J),l(()=>{d(he,r.device.title),d($e,e(b))}),i(I,J)};W(D,I=>{e(Z)&&I(B)})}var te=o(D,2);ke(te,{absolute:!0});var fe=o(te,2);Re(fe,{absolute:!0}),i(H,C)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(ue,ae),ye()}export{Qe as component};
