import{a as n,n as Lr,t as f,e as pe,d as rr}from"../chunks/disclose-version.BP4T4xdV.js";import{t as b,c as d,r as u,l,a5 as Mr,aa as ne,f as K,p as Sr,a as Tr,j as e,k as t,a6 as Wr,s as c,a7 as _e,a9 as we}from"../chunks/index-client.hxMyB_b4.js";import{h as Br,s as M}from"../chunks/render.yNX9q8-B.js";import{i as p}from"../chunks/if.BeBa1Kxb.js";import{e as Rr}from"../chunks/each.BUp7aLCc.js";import{s as V}from"../chunks/class.CF2J4YCf.js";import{p as s}from"../chunks/proxy.DaVNR9vk.js";import{e as tr,I as Ur,J as jr,K as Ar,t as Cr,M as Er,j as Fr,k as Gr,_ as Hr,P as Kr,N as Vr}from"../chunks/helpers.CchIKxjM.js";import{B as be}from"../chunks/Button.BR1gOfNn.js";import{W as Jr}from"../chunks/WebauthnRequest.DmvtxDuu.js";import{I as Or}from"../chunks/pow.BMnvYon0.js";import{L as Pr}from"../chunks/LangSelector.Bl8L6Wq4.js";import{p as Re}from"../chunks/props.DNAkfByl.js";import{M as Xr}from"../chunks/Main.Rc9oYaw1.js";import{C as Dr}from"../chunks/ContentCenter.lHeEkgTE.js";import{u as Nr}from"../chunks/i18n.svelte.Ci9wvqOq.js";import{T as N}from"../chunks/Template.Ih924_PB.js";import{u as j}from"../chunks/param.svelte.BbzO27-O.js";import{T as Yr}from"../chunks/ThemeSwitch.DTJa252X.js";import{I as Zr}from"../chunks/InputPassword.DvK4K3vC.js";import{b as le}from"../chunks/fetch.Bq59EV_b.js";import{u as ar}from"../chunks/is_dev.svelte.CWG7yUVe.js";import{F as Qr}from"../chunks/Form.BnvI_UPN.js";import{B as et}from"../chunks/ButtonAuthProvider.Dl19OW4p.js";var rt=Lr(`<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125
            1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504
            1.125-1.125V9.75M8.25 21h8.25"></path></svg>`);function tt(Y,A){let S=Re(A,"opacity",3,.9),v=Re(A,"width",3,"1.5rem"),Z=Re(A,"color",3,"currentColor");var C=rt();V(C,"stroke-width",2),b(()=>{V(C,"stroke",Z()),V(C,"width",v()),V(C,"opacity",S())}),n(Y,C)}var at=f('<div class="logo svelte-1gwy16z"><img alt="No Logo Available"></div>');function ot(Y,A){console.log("rendering clientLogo");var S=at(),v=d(S);u(S),b(()=>V(v,"src",`/auth/v1/clients/${A.clientId}/logo`)),n(Y,S)}var st=f('<a class="home svelte-1hqs85f"><!></a>'),it=f('<div class="forgotten svelte-1hqs85f"><!></div>'),nt=f("<!> <!>",1),lt=f('<div class="btn flex-col svelte-1hqs85f"><!></div>'),ct=f('<div class="btn flex-col svelte-1hqs85f"><!></div>'),vt=f("<!> <!> <!>",1),dt=f('<a class="reg svelte-1hqs85f" target="_blank"> </a>'),ut=f('<a class="reg svelte-1hqs85f" href="/auth/v1/users/register" target="_blank"> </a>'),ft=f("<!> <!>",1),ht=f('<div class="errMsg svelte-1hqs85f"> </div>'),mt=f('<div class="success svelte-1hqs85f"> </div>'),gt=f('<div class="btn flex-col svelte-1hqs85f"><!></div>'),pt=f('<div class="providers flex-col svelte-1hqs85f"><div class="providersSeparator svelte-1hqs85f"><div class="separator svelte-1hqs85f"></div> <div class="loginWith svelte-1hqs85f"><div class="svelte-1hqs85f"> </div></div></div> <!></div>'),_t=f('<div class="container svelte-1hqs85f"><div class="head svelte-1hqs85f"><!> <!></div> <div class="name svelte-1hqs85f"><h2> </h2></div> <!> <!> <!> <!> <!> <!></div> <!> <!>',1),wt=f("<!> <!> <!> <!> <!> <!> <!>",1);function bt(Y,A){var Je;Tr(A,!0);const S="18rem";let v=Nr(),Z=ar().get(),C=we(()=>Z?"/auth/v1/dev/authorize":"/auth/v1/oidc/authorize"),_=j("client_id").get(),ce=l(""),T=l(s(Z?"/auth/v1":"")),J=j("redirect_uri").get(),qe=j("nonce").get(),ye=((Je=j("scope").get())==null?void 0:Je.split(" "))||[],ke=l(void 0),ze=l(void 0),$e=j("state").get(),Q=j("code_challenge").get(),$=j("code_challenge_method").get(),Ue=!1,xe=l(void 0),ve=l(s([])),de=l(void 0),O=l(!1),h=l(""),ee=l(""),ue=l(""),W=l(!1),E=l(!1),fe=l(!1),he=l(!1),me=l(!1),F=l(!1),je=l(""),Ie=l(!1),y=l(s(j("login_hint").get()||"")),B=l(""),Le=l("");Mr(()=>{var r;e(W)||((r=e(ke))==null||r.focus())}),ne(()=>{Ue&&(_!=null&&_.length)&&ir()}),ne(()=>{e(me)&&setTimeout(()=>{t(me,!1),t(fe,!1),t(he,!1)},3e3)}),ne(()=>{var r;(r=e(ze))==null||r.focus()}),ne(()=>{var r;if(e(ee)==="Refresh")Ue=!0;else if((r=e(ee))!=null&&r.startsWith("MfaLogin ")){let o=e(ee).replace("MfaLogin ","");t(y,s(o)),t(xe,s(o))}}),ne(()=>{Z?or():e(ue)&&tr(e(ue))});async function or(){var o;let r=await le("/auth/v1/oidc/session");console.log("manual session",r.body),(o=r.body)!=null&&o.csrf_token?tr(r.body.csrf_token):console.error(r.error)}function sr(){t(h,""),t(fe,!0),t(B,"")}async function ir(){if(!_){console.error("clientId is undefined");return}if(!J){console.error("redirectUri is undefined");return}t(O,!0);const r={client_id:_,redirect_uri:J,state:$e,nonce:qe,scopes:ye};Q&&$&&($==="plain"||$==="S256")&&(r.code_challenge=Q,r.code_challenge_method=$);let o=await le("/auth/v1/oidc/authorize/refresh",r);await Ae(o)}async function nr(r,o){if(t(h,""),!_){console.error("clientId is undefined");return}if(!J){console.error("redirectUri is undefined");return}const w={email:e(y),client_id:_,redirect_uri:J,state:$e,nonce:qe,scopes:ye};if(Q&&$&&($==="plain"||$==="S256")&&(w.code_challenge=Q,w.code_challenge_method=$),e(W)&&e(y)!==e(xe)){if(!e(B)){t(h,s(v.authorize.passwordRequired));return}if(e(B).length>256){t(h,"max 256");return}w.password=e(B)}t(O,!0);let q="/auth/v1/oidc/authorize";ar().get()&&(q="/auth/v1/dev/authorize");let x=await le(q,w);await Ae(x)}async function Ae(r){if(r.status===202){let o=r.headers.get("location");if(!o){console.error("location header missing");return}window.location.replace(o)}else if(r.status===200){t(h,"");let o=r.body;o&&"user_id"in o&&"code"in o?(t(Le,s(o.user_id)),t(de,s({Login:o.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else if(r.status===406)t(h,s(v.authorize.clientForceMfa)),t(E,!0);else if(r.status===429){let o=r.headers.get("x-retry-not-before");if(!o){console.error("x-retry-not-before header missing");return}let w=Number.parseInt(o),q=Gr(w),x=w*1e3-new Date().getTime();t(F,!0),t(h,`${v.authorize.http429} ${q}`),t(y,""),t(B,""),t(W,!1),setTimeout(()=>{t(F,!1),t(h,"")},x)}else e(W)?(t(h,s(v.authorize.invalidCredentials)),t(he,!0)):(t(W,!0),t(je,s(e(y))));t(O,!1)}function lr(){e(W)&&e(je)!==e(y)&&(t(W,!1),t(B,""),t(h,""))}function cr(r){Hr(64,(o,{challenge:w,verifier:q})=>{o||(localStorage.setItem(Kr,q),vr(r,w))})}async function vr(r,o){var x;if(!_){console.error("clientId is undefined");return}if(!J){console.error("redirectUri is undefined");return}let w={email:e(y)||void 0,client_id:_,redirect_uri:J,scopes:ye,state:$e,nonce:qe,code_challenge:Q,code_challenge_method:$,provider_id:r,pkce_challenge:o},q=await le("/auth/v1/providers/login",w);if(q.text){Vr(q.text);let P=q.headers.get("location");if(!P){console.error("no location header set for provider login");return}window.location.href=P}else t(h,s(((x=q.error)==null?void 0:x.message)||"Error"))}function dr(r){t(de,void 0),t(h,s(r))}function ur(r){console.log("onWebauthnSuccess",r),r&&"loc"in r&&window.location.replace(r.loc)}async function fr(){let r={email:e(y)};e(T)&&(r.redirect_uri=encodeURI(e(T))),t(O,!0);let o=await le("/auth/v1/users/request_reset",r);o.error?t(h,s(o.error.message)):t(me,!0),t(O,!1)}var Ce=wt();Br(r=>{b(()=>Wr.title=`Login ${(e(ce)||_)??""}`)});var Ee=K(Ce);N(Ee,{id:Ur,get value(){return e(ve)},set value(r){t(ve,s(r))}});var Fe=c(Ee,2);N(Fe,{id:jr,get value(){return e(ce)},set value(r){t(ce,s(r))}});var Ge=c(Fe,2);N(Ge,{id:Ar,get value(){return e(T)},set value(r){t(T,s(r))}});var He=c(Ge,2);N(He,{id:Cr,get value(){return e(ue)},set value(r){t(ue,s(r))}});var Ke=c(He,2);N(Ke,{id:Er,get value(){return e(ee)},set value(r){t(ee,s(r))}});var Ve=c(Ke,2);N(Ve,{id:Fr,get value(){return e(Ie)},set value(r){t(Ie,s(r))}});var hr=c(Ve,2);Xr(hr,{children:(r,o)=>{Dr(r,{children:(w,q)=>{var x=_t(),P=K(x),Me=d(P),Oe=d(Me);{var mr=a=>{ot(a,{clientId:_})};p(Oe,a=>{_&&a(mr)})}var gr=c(Oe,2);{var pr=a=>{var i=st(),g=d(i);tt(g,{color:"hsla(var(--text) / .4)"}),u(i),b(()=>V(i,"href",e(T))),n(a,i)};p(gr,a=>{e(T)&&a(pr)})}u(Me);var Se=c(Me,2),Pe=d(Se),_r=d(Pe,!0);u(Pe),u(Se);var Xe=c(Se,2);{var wr=a=>{Jr(a,{get userId(){return e(Le)},get purpose(){return e(de)},onSuccess:ur,onError:dr})};p(Xe,a=>{e(de)&&e(Le)&&a(wr)})}var De=c(Xe,2);{var br=a=>{var i=ft(),g=K(i);Qr(g,{get action(){return e(C)},onSubmit:nr,children:(I,te)=>{var R=vt(),G=K(R),ae=we(()=>e(F)||e(E));Or(G,{typ:"email",name:"email",autocomplete:"email",get label(){return v.common.email},get placeholder(){return v.common.email},get disabled(){return e(ae)},onInput:lr,width:S,required:!0,get ref(){return e(ke)},set ref(k){t(ke,s(k))},get value(){return e(y)},set value(k){t(y,s(k))}});var L=c(G,2);{var z=k=>{var se=nt(),ge=K(se),Te=we(()=>e(F)||e(E));Zr(ge,{name:"password",autocomplete:"current-password",get label(){return v.common.password},get placeholder(){return v.common.password},maxLength:256,get disabled(){return e(Te)},width:S,required:!0,get ref(){return e(ze)},set ref(m){t(ze,s(m))},get value(){return e(B)},set value(m){t(B,s(m))}});var We=c(ge,2);{var U=m=>{var H=it(),ie=d(H);be(ie,{invisible:!0,onclick:sr,children:(Be,D)=>{_e();var er=pe();b(()=>M(er,v.authorize.passwordForgotten)),n(Be,er)},$$slots:{default:!0}}),u(H),n(m,H)};p(We,m=>{e(he)&&!e(F)&&m(U)})}n(k,se)};p(L,k=>{e(W)&&e(xe)!==e(y)&&!e(fe)&&k(z)})}var oe=c(L,2);{var Ir=k=>{var se=rr(),ge=K(se);{var Te=U=>{var m=lt(),H=d(m);be(H,{onclick:fr,children:(ie,Be)=>{_e();var D=pe();b(()=>M(D,v.authorize.passwordRequest)),n(ie,D)},$$slots:{default:!0}}),u(m),n(U,m)},We=U=>{var m=ct(),H=d(m);be(H,{type:"submit",get isLoading(){return e(O)},children:(ie,Be)=>{_e();var D=pe();b(()=>M(D,v.authorize.login)),n(ie,D)},$$slots:{default:!0}}),u(m),n(U,m)};p(ge,U=>{e(fe)?U(Te):U(We,!1)})}n(k,se)};p(oe,k=>{!e(F)&&!e(E)&&k(Ir)})}n(I,R)},$$slots:{default:!0}});var X=c(g,2);{var re=I=>{var te=rr(),R=K(te);{var G=L=>{var z=dt(),oe=d(z,!0);u(z),b(()=>{V(z,"href",`/auth/v1/users/register?redirect_uri=${e(T)??""}`),M(oe,v.authorize.signUp)}),n(L,z)},ae=L=>{var z=ut(),oe=d(z,!0);u(z),b(()=>M(oe,v.authorize.signUp)),n(L,z)};p(R,L=>{e(T)?L(G):L(ae,!1)})}n(I,te)};p(X,I=>{e(Ie)&&!e(he)&&!e(F)&&I(re)})}n(a,i)};p(De,a=>{e(E)||a(br)})}var Ne=c(De,2);{var qr=a=>{var i=ht(),g=d(i,!0);u(i),b(()=>M(g,e(h))),n(a,i)};p(Ne,a=>{e(h)&&a(qr)})}var Ye=c(Ne,2);{var yr=a=>{var i=mt(),g=d(i,!0);u(i),b(()=>M(g,v.authorize.emailSentMsg)),n(a,i)};p(Ye,a=>{e(me)&&a(yr)})}var Ze=c(Ye,2);{var kr=a=>{var i=gt(),g=d(i);be(g,{onclick:()=>window.location.href="/auth/v1/account",children:(X,re)=>{_e();var I=pe("Account");n(X,I)},$$slots:{default:!0}}),u(i),n(a,i)};p(Ze,a=>{e(E)&&a(kr)})}var zr=c(Ze,2);{var $r=a=>{var i=pt(),g=d(i),X=c(d(g),2),re=d(X),I=d(re,!0);u(re),u(X),u(g);var te=c(g,2);Rr(te,17,()=>e(ve),R=>R.id,(R,G)=>{var ae=we(()=>`Login: ${e(G).name}`);et(R,{get ariaLabel(){return e(ae)},get provider(){return e(G)},onclick:cr})}),u(i),b(()=>M(I,v.authorize.orLoginWith)),n(a,i)};p(zr,a=>{!e(E)&&e(ve)&&a($r)})}u(P);var Qe=c(P,2);Yr(Qe,{absolute:!0});var xr=c(Qe,2);Pr(xr,{absolute:!0}),b(()=>M(_r,e(ce)||_)),n(w,x)},$$slots:{default:!0}})},$$slots:{default:!0}}),n(Y,Ce),Sr()}export{bt as component};
