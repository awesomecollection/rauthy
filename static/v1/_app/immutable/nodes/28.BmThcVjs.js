import"../chunks/disclose-version.BDr9Qe-U.js";import{p as re,P as $,o as te,a as ie,j as i,T as v,$ as se,Q as I,R as l,g as t,X as me,U as N,W as y,V as b}from"../chunks/index-client.CzqVbBUo.js";import{s as o}from"../chunks/render.DOFZNw8l.js";import{p as n,i as M}from"../chunks/if.BnegfJmL.js";import{t as C,a as d,b as _,c as oe}from"../chunks/template.C3U8HW1x.js";import{h as le}from"../chunks/svelte-head.BSz900xL.js";import{r as ne}from"../chunks/legacy-client.DtCljIS0.js";import{I as Q,c as ce,a as W}from"../chunks/Input.BRe7i--g.js";import{g as ve,n as de,r as ue,t as ge,u as pe}from"../chunks/dataFetching.CF6CPDU9.js";import{B as fe}from"../chunks/Button.65naIT6w.js";import{L as $e}from"../chunks/LangSelector.DlaDUv8u.js";import{f as Ne}from"../chunks/pow.CWO_5_vv.js";import{M as ye,C as he}from"../chunks/ContentCenter.D3vmDIv7.js";import"../chunks/is_dev.svelte.BuX_eKSD.js";import{u as we}from"../chunks/i18n.svelte.C_qSL0ZA.js";var ke=_(" <br> <code> </code>",1),Ee=_('<div class="success svelte-1ks9oi1"> <br> </div>'),xe=_('<div class="err svelte-1ks9oi1"> </div>'),Ue=_('<div class="container svelte-1ks9oi1"><div class="domainTxt svelte-1ks9oi1"><h1> </h1> <!></div> <!> <!> <!> <!> <!></div> <!>',1);function be(H,O){re(O,!0);let a=we(),h=$(void 0),w,x=$(!1),g=$(""),q=$(!1),m=n({email:"",givenName:"",familyName:""}),u=$(n({})),A=$(n({}));ne(()=>{a&&i(A,n(ce().shape({email:W().required(a.common.required).email(a.register.emailBadFormat),givenName:W().required(a.common.required).matches(ge,a.register.regexName),familyName:W().matches(pe,a.register.regexName)})))}),te(()=>{const c=window.document.getElementsByName("rauthy-data")[0].id;c!=="{{ data }}"&&i(h,n(c)),w=ve().redirect_uri});function R(c){c.detail.code==="Enter"&&F()}async function F(){i(q,!1),i(g,"");try{await t(A).validate(m,{abortEarly:!1}),i(u,n({}))}catch(k){i(u,n(de(k)));return}if(t(h)&&!m.email.endsWith(t(h))){i(g,n(a.register.domainErr));return}i(x,!0),await me();let c=await Ne();const j={email:m.email,given_name:m.givenName,family_name:m.familyName.length>0?m.familyName:void 0,pow:c};w&&(j.redirect_uri=w);const U=await ue(j);if(U.ok)i(g,""),i(q,!0),w&&setTimeout(()=>{window.location.replace(w)},3e3);else{const k=await U.json();k.message.includes("UNIQUE constraint")?i(g,"E-Mail is already registered"):i(g,n(k.message))}i(x,!1)}le(c=>{v(()=>se.title=(a==null?void 0:a.register)||"Register")}),ye(H,{children:(c,j)=>{he(c,{children:(U,k)=>{var P=Ue(),B=I(P),L=N(B),T=N(L),S=N(T,!0);y(T);var D=l(T,2);{var J=e=>{var s=ke(),r=I(s,!0),p=l(r,2),f=l(p),E=N(f);y(f),v(()=>{o(r,a.register.domainRestricted),o(p,` ${a.register.domainAllowed??""} `),o(E,`@${t(h)??""}`)}),d(e,s)};M(D,e=>{t(h)&&e(J)})}y(L);var V=l(L,2);Q(V,{type:"email",autocomplete:"email",get placeholder(){return a.common.email},get value(){return m.email},set value(e){m.email=e},get error(){return t(u).email},set error(e){t(u).email=e},$$events:{keypress:R},children:(e,s)=>{b();var r=C();v(()=>o(r,a.common.email.toUpperCase())),d(e,r)},$$slots:{default:!0}});var X=l(V,2);Q(X,{autocomplete:"given-name",get placeholder(){return a.account.givenName},get value(){return m.givenName},set value(e){m.givenName=e},get error(){return t(u).givenName},set error(e){t(u).givenName=e},$$events:{keypress:R},children:(e,s)=>{b();var r=C();v(()=>o(r,a.account.givenName.toUpperCase())),d(e,r)},$$slots:{default:!0}});var z=l(X,2);Q(z,{autocomplete:"family-name",get placeholder(){return a.account.familyName},get value(){return m.familyName},set value(e){m.familyName=e},get error(){return t(u).familyName},set error(e){t(u).familyName=e},$$events:{keypress:R},children:(e,s)=>{b();var r=C();v(()=>o(r,a.account.familyName.toUpperCase())),d(e,r)},$$slots:{default:!0}});var G=l(z,2);fe(G,{get isLoading(){return t(x)},set isLoading(e){i(x,n(e))},$$events:{click:F},children:(e,s)=>{b();var r=C();v(()=>o(r,a.register.register)),d(e,r)},$$slots:{default:!0}});var K=l(G,2);{var Y=e=>{var s=Ee(),r=N(s,!0),p=l(r,2);y(s),v(()=>{o(r,a.register.success),o(p,` ${a.register.emailCheck??""}`)}),d(e,s)},Z=e=>{var s=oe(),r=I(s);{var p=f=>{var E=xe(),ae=N(E,!0);y(E),v(()=>o(ae,t(g))),d(f,E)};M(r,f=>{t(g)&&f(p)},!0)}d(e,s)};M(K,e=>{t(q)?e(Y):e(Z,!1)})}y(B);var ee=l(B,2);$e(ee,{absolute:!0}),v(()=>o(S,a.register.userReg)),d(U,P)},$$slots:{default:!0}})},$$slots:{default:!0}}),ie()}export{be as component};
