import"../chunks/disclose-version.BDr9Qe-U.js";import{p as ie,P as N,o as oe,Q as C,a as me,T as v,$ as le,g as t,j as s,R as m,X as ne,U as y,W as h,V as R}from"../chunks/index-client.CzqVbBUo.js";import{s as l}from"../chunks/render.CK5MTJQL.js";import{p as n,i as I}from"../chunks/if.BnegfJmL.js";import{a as c,t as E,b as _,c as ce}from"../chunks/template.io25wnf1.js";import{h as ve}from"../chunks/svelte-head.BSz900xL.js";import{r as ue}from"../chunks/legacy-client.DPLAlLYD.js";import{I as P,c as de,a as Q}from"../chunks/Input.jkTumKYK.js";import{g as ge,t as pe,o as fe,u as $e,v as Ne,w as ye}from"../chunks/dataFetching.Br47vc1D.js";import{B as he}from"../chunks/Button.JzTZa4bh.js";import{L as ke}from"../chunks/LangSelector.DQTzLAdQ.js";import{f as we}from"../chunks/pow.CkxCHWs-.js";import{M as xe,C as Ee}from"../chunks/ContentCenter.B2VsFG_i.js";import{u as Ue}from"../chunks/i18n.svelte.C_qSL0ZA.js";import{T as be}from"../chunks/Template.mSBxkRZ-.js";var Ce=E(" <br> <code> </code>",1),Re=E('<div class="success svelte-1ks9oi1"> <br> </div>'),_e=E('<div class="err svelte-1ks9oi1"> </div>'),qe=E('<div class="container svelte-1ks9oi1"><div class="domainTxt svelte-1ks9oi1"><h1> </h1> <!></div> <!> <!> <!> <!> <!></div> <!>',1),Le=E("<!> <!>",1);function Te(J,S){ie(S,!0);let a=Ue(),p=N(""),k,U=N(!1),g=N(""),q=N(!1),o=n({email:"",givenName:"",familyName:""}),u=N(n({})),W=N(n({}));ue(()=>{a&&s(W,n(de().shape({email:Q().required(a.common.required).email(a.register.emailBadFormat),givenName:Q().required(a.common.required).matches(Ne,a.register.regexName),familyName:Q().matches(ye,a.register.regexName)})))}),oe(()=>{k=ge().redirect_uri});function L(d){d.detail.code==="Enter"&&A()}async function A(){s(q,!1),s(g,"");try{await t(W).validate(o,{abortEarly:!1}),s(u,n({}))}catch(w){s(u,n(fe(w)));return}if(t(p)&&!o.email.endsWith(t(p))){s(g,n(a.register.domainErr));return}s(U,!0),await ne();let d=await we();const T={email:o.email,given_name:o.givenName,family_name:o.familyName.length>0?o.familyName:void 0,pow:d};k&&(T.redirect_uri=k);const b=await $e(T);if(b.ok)s(g,""),s(q,!0),k&&setTimeout(()=>{window.location.replace(k)},3e3);else{const w=await b.json();w.message.includes("UNIQUE constraint")?s(g,"E-Mail is already registered"):s(g,n(w.message))}s(U,!1)}var F=Le();ve(d=>{v(()=>le.title=(a==null?void 0:a.register)||"Register")});var K=C(F);be(K,{id:pe,get value(){return t(p)},set value(d){s(p,n(d))}});var Y=m(K,2);xe(Y,{children:(d,T)=>{Ee(d,{children:(b,w)=>{var V=qe(),M=C(V),j=y(M),B=y(j),z=y(B,!0);h(B);var O=m(B,2);{var Z=e=>{var i=Ce(),r=C(i,!0),f=m(r,2),$=m(f),x=y($);h($),v(()=>{l(r,a.register.domainRestricted),l(f,` ${a.register.domainAllowed??""} `),l(x,`@${t(p)??""}`)}),c(e,i)};I(O,e=>{t(p)&&e(Z)})}h(j);var X=m(j,2);P(X,{type:"email",autocomplete:"email",get placeholder(){return a.common.email},get value(){return o.email},set value(e){o.email=e},get error(){return t(u).email},set error(e){t(u).email=e},$$events:{keypress:L},children:(e,i)=>{R();var r=_();v(()=>l(r,a.common.email.toUpperCase())),c(e,r)},$$slots:{default:!0}});var D=m(X,2);P(D,{autocomplete:"given-name",get placeholder(){return a.account.givenName},get value(){return o.givenName},set value(e){o.givenName=e},get error(){return t(u).givenName},set error(e){t(u).givenName=e},$$events:{keypress:L},children:(e,i)=>{R();var r=_();v(()=>l(r,a.account.givenName.toUpperCase())),c(e,r)},$$slots:{default:!0}});var G=m(D,2);P(G,{autocomplete:"family-name",get placeholder(){return a.account.familyName},get value(){return o.familyName},set value(e){o.familyName=e},get error(){return t(u).familyName},set error(e){t(u).familyName=e},$$events:{keypress:L},children:(e,i)=>{R();var r=_();v(()=>l(r,a.account.familyName.toUpperCase())),c(e,r)},$$slots:{default:!0}});var H=m(G,2);he(H,{get isLoading(){return t(U)},set isLoading(e){s(U,n(e))},$$events:{click:A},children:(e,i)=>{R();var r=_();v(()=>l(r,a.register.register)),c(e,r)},$$slots:{default:!0}});var ee=m(H,2);{var ae=e=>{var i=Re(),r=y(i,!0),f=m(r,2);h(i),v(()=>{l(r,a.register.success),l(f,` ${a.register.emailCheck??""}`)}),c(e,i)},re=e=>{var i=ce(),r=C(i);{var f=$=>{var x=_e(),se=y(x,!0);h(x),v(()=>l(se,t(g))),c($,x)};I(r,$=>{t(g)&&$(f)},!0)}c(e,i)};I(ee,e=>{t(q)?e(ae):e(re,!1)})}h(M);var te=m(M,2);ke(te,{absolute:!0}),v(()=>l(z,a.register.userReg)),c(b,V)},$$slots:{default:!0}})},$$slots:{default:!0}}),c(J,F),me()}export{Te as component};
