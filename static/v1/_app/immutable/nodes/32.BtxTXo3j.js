import{a as c,t as k,d as H,e as q}from"../chunks/disclose-version.BP4T4xdV.js";import{a5 as B,f as T,p as D,a as G,k as e,a6 as I,j as i,s as P,l as g,c as W,a7 as J,r as F,t as K}from"../chunks/index-client.hxMyB_b4.js";import{h as N,s as O}from"../chunks/render.yNX9q8-B.js";import{i as _}from"../chunks/if.BeBa1Kxb.js";import{p as m}from"../chunks/proxy.DaVNR9vk.js";import{u as Q,v as V}from"../chunks/helpers.CchIKxjM.js";import{W as X}from"../chunks/WebauthnRequest.DmvtxDuu.js";import{L as Y}from"../chunks/LangSelector.Bl8L6Wq4.js";import{B as Z}from"../chunks/Button.BR1gOfNn.js";import{u as rr}from"../chunks/i18n.svelte.Ci9wvqOq.js";import{u as h}from"../chunks/param.svelte.BbzO27-O.js";import{T as ar}from"../chunks/ThemeSwitch.DTJa252X.js";import{b as er}from"../chunks/fetch.Bq59EV_b.js";import{u as or}from"../chunks/is_dev.svelte.CWG7yUVe.js";var tr=k('<div class="btn flex-col svelte-17xvymb"><!></div>'),sr=k('<div class="err"> </div>'),ir=k("<!> <!> <!>",1);function nr(R,S){G(S,!0);let j=rr(),$=g(!1),t=g(""),b=g(void 0),v=g(void 0);B(async()=>{var s,n;let r=h("error").get();if(r){let o=h("error_description").get();e(t,`${r}: ${o}`);return}let l=h("state").get();if(!l){e(t,"'state' is missing in URL");return}let d=h("code").get();if(!d){e(t,"'code' is missing in URL");return}let w={state:l,code:d,pkce_verifier:Q(),xsrf_token:V()},f="/auth/v1/providers/callback";or().get()&&(f="/auth/v1/dev/providers_callback");let a=await er(f,w);if(a.status===202)window.location.replace(a.headers.get("location")||"/auth/v1/account");else if(a.status===200){e(t,"");let o=a.body;o&&"user_id"in o&&"code"in o?(e(b,m(o.user_id)),e(v,m({Login:o.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else a.status===204?window.location.replace("/auth/v1/account"):a.status===403?e(t,m(((s=a.error)==null?void 0:s.message)||"HTTP 403 Forbidden")):a.status===406?(e(t,m(j.authorize.clientForceMfa)),e($,!0)):e(t,`HTTP ${a.status}: ${(n=a.error)==null?void 0:n.message}`)});function z(r){e(t,m(r)),e(v,void 0)}function A(r){console.log("onWebauthnSuccess",r),r&&"loc"in r&&window.location.replace(r.loc)}var x=ir();N(r=>{I.title="Callback"});var L=T(x);{var C=r=>{X(r,{get userId(){return i(b)},get purpose(){return i(v)},onSuccess:A,onError:z})},E=r=>{var l=H(),d=T(l);{var w=a=>{var s=tr(),n=W(s);Z(n,{onclick:()=>window.location.href="/auth/v1/account",children:(o,p)=>{J();var u=q("Account");c(o,u)},$$slots:{default:!0}}),F(s),c(a,s)},f=a=>{var s=H(),n=T(s);{var o=p=>{var u=sr(),U=W(u,!0);F(u),K(()=>O(U,i(t))),c(p,u)};_(n,p=>{i(t)&&p(o)},!0)}c(a,s)};_(d,a=>{i($)?a(w):a(f,!1)},!0)}c(r,l)};_(L,r=>{i(v)&&i(b)?r(C):r(E,!1)})}var y=P(L,2);ar(y,{absolute:!0});var M=P(y,2);Y(M,{absolute:!0}),c(R,x),D()}export{nr as component};
