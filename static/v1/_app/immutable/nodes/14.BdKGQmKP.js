import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.Dn68_YLB.js";import{p as he,c as p,Q as wt,r as m,s as l,t as oe,a as _e,aH as It,i as N,h as n,g as e,O as Pe,f as te,ap as h}from"../chunks/runtime.BsghBUX9.js";import{k as Et,s as ve}from"../chunks/render.CTp9lacC.js";import{e as it}from"../chunks/each.URXtkKAp.js";import{a as o,t as C,d as f,e as He}from"../chunks/template.jENAUvUX.js";import{p as d}from"../chunks/proxy.YH42NwLs.js";import{c as Ct,o as Ue}from"../chunks/index-client.ClP8y9aT.js";import{i as M}from"../chunks/if.6Ov_EDLa.js";import{p as se,r as yt}from"../chunks/props.CslUVmW_.js";import{r as ke}from"../chunks/legacy-client.DY3VEcT0.js";import{E as lt}from"../chunks/ExpandContainer.BAZSCBeT.js";import{c as Ge,a as A,I as S}from"../chunks/Input.B4ccwD4n.js";import{m as ae,Z as nt,$ as ot,a0 as je,n as Ze}from"../chunks/helpers.CBl6QeM5.js";import{g as ct,B as fe}from"../chunks/Button.CHwcFOJ-.js";import{O as kt,y as At,z as Rt,A as Tt,B as Lt,C as Nt,D as St,E as Dt}from"../chunks/OptionSelect.Cn2sqgid.js";import{S as ie,P as dt}from"../chunks/PasswordInput.CnOR-d9I.js";import{C as ut}from"../chunks/CheckIcon.CMbYrOAg.js";import{s as Ot}from"../chunks/snippet.C6jUNrz1.js";import{a as Ae,s as Me,i as xt,b as Re,c as Te}from"../chunks/index.G5lyZbma.js";import{T as vt}from"../chunks/Tooltip.D8Tbt6Nb.js";import{T as Pt}from"../chunks/TabBar.g4Oe_bq5.js";import{I as Ut}from"../chunks/ImageUploadRaw.Bzhki7lp.js";var Mt=C(`<div class="desc svelte-i817w5"><h4 class="svelte-i817w5">ID token claim mappings</h4> <p class="svelte-i817w5">Values from the ID token after a successful upstream login can be mapped automatically.</p> <p class="svelte-i817w5">The <code class="svelte-i817w5">path</code> needs to be given in a regex like syntax. It can resolve to
        single JSON values or resolve to a value in a JSON object or array.</p> <p class="svelte-i817w5"><code class="svelte-i817w5">$.</code> marks the start of the JSON object</p> <p class="svelte-i817w5"><code class="svelte-i817w5">*</code> can be used as a wildcard in your path</p> <p class="svelte-i817w5"><code class="svelte-i817w5">$.roles</code> would target <code class="svelte-i817w5">&#123;"roles": "value"&#125;</code></p> <p class="svelte-i817w5"><code class="svelte-i817w5">$.roles.*</code> can target a value inside an object or array like<br> <code class="svelte-i817w5">&#123;"roles": ["value", "notMyValue"]&#125;</code></p></div>`);function mt(G){var g=Mt();o(G,g)}var zt=C('<div class="err font-label svelte-w61ts0"> </div>'),qt=C('<div class="container svelte-w61ts0"><div class="label svelte-w61ts0"><div class="labelInner font-label noselect svelte-w61ts0"><label><!></label></div></div> <textarea></textarea> <!></div>');function Je(G,g){he(g,!0);let a=se(g,"rows",3,10),v=se(g,"cols",3,10),R=se(g,"name",19,ct),b=se(g,"disabled",3,!1),I=se(g,"error",3,""),w=se(g,"value",15),D=se(g,"width",3,"32rem"),P=se(g,"fixed",3,!0),u=yt(g,["$$slots","$$events","$$legacy","rows","cols","name","disabled","error","value","width","fixed","children"]);const _=Ct();async function i(F){await It(),w(F.target.value),_("input",w())}function z(){_("focus",!0)}function c(){_("blur",!0)}var s=qt(),E=p(s),K=p(E),Y=p(K),U=p(Y);Ot(U,()=>g.children??wt),m(Y),m(K),m(E);var V=l(E,2);Et(V);let q;var j=l(V,2);{var ce=F=>{var Z=zt(),ne=p(Z,!0);m(Z),oe(()=>{Ae(Z,"width",D()),ve(ne,I())}),Re(7,Z,()=>Te,()=>({duration:250})),o(F,Z)};M(j,F=>{I()&&F(ce)})}m(s),oe(()=>{Ae(s,"width",`calc(${D()??""} + 12px)`),Ae(K,"background",b()?"var(--col-gmid)":"var(--col-bg)"),Me(Y,"for",R()),q=xt(V,q,{name:R(),disabled:b(),value:w(),rows:a(),cols:v(),...u,oninput:i,onfocus:z,onblur:c},"svelte-w61ts0"),Ae(V,"resize",P()?"none":""),Ae(V,"width",D())}),o(G,s),_e()}var Ft=C('<div class="header font-label svelte-1m46su9">ADD NEW AUTHENTICATION PROVIDER</div>'),Kt=C('<div class="header svelte-1m46su9">Allow insecure TLS certificates</div> <div class="ml mb svelte-1m46su9"><!></div>',1),Vt=C('<div class="header svelte-1m46su9">Custom Root CA PEM</div> <div class="ml mb svelte-1m46su9"><!></div> <!>',1),Ht=C("<!> <!>",1),Gt=C("<!> <!>",1),jt=C('<div class="header svelte-1m46su9">Allow insecure TLS certificates</div> <div class="ml mb svelte-1m46su9"><!></div>',1),Zt=C(`<!> <!> <!> <!> <!> <div class="header svelte-1m46su9">Use PKCE</div> <div class="ml svelte-1m46su9"><!></div> <div class="desc svelte-1m46su9">The scope the client should use when redirecting to the login.<br> Provide the values separated by space.</div> <!> <div class="desc svelte-1m46su9">Client name for the Rauthy login form</div> <!> <div class="desc svelte-1m46su9">Client ID given by the auth provider</div> <!> <div class="desc svelte-1m46su9">Client Secret given by the auth provider.<br> At least a client secret or PKCE is required.</div> <!> <div class="desc svelte-1m46su9"><p class="svelte-1m46su9">The authentication method to use on the <code>/token</code> endpoint.<br> Most providers should work with <code>basic</code>, some only with <code>post</code>.
                        In rare situations, you need both, while it can lead to errors with others.</p></div> <div class="switchRow svelte-1m46su9"><div>client_secret_basic</div> <!></div> <div class="switchRow svelte-1m46su9"><div>client_secret_post</div> <!></div> <!> <div class="desc svelte-1m46su9"><p class="svelte-1m46su9">You can map a user to be a rauthy admin depending on an upstream ID claim.</p></div> <!> <!> <div class="desc svelte-1m46su9"><p class="svelte-1m46su9">If your provider issues a claim indicating that the user has used at least 2FA during
                        login, you can specify the mfa claim path.</p></div> <!> <!> <!> <!>`,1),Jt=C('<div class="success svelte-1m46su9">Success</div>'),Yt=C('<div class="err svelte-1m46su9"> </div>'),Bt=C('<div class="container svelte-1m46su9"><div class="header svelte-1m46su9">Type</div> <div class="ml mb svelte-1m46su9"><!></div> <!> <!> <!> <!></div>');function Qt(G,g){he(g,!0);let a=se(g,"idx",31,()=>-1);const v="25rem";let R=N(!1),b=N(!1),I=N(""),w=N(!1),D=N(!1),P=N(void 0),u=N(!1),_=N(d({issuer:null,metadata_url:null,danger_allow_insecure:!1,root_pem:null})),i=N(d({enabled:!0,typ:"oidc",issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",token_auth_method_basic:!1,userinfo_endpoint:"",use_pkce:!0,client_secret_basic:!0,client_secret_post:!1,name:"",client_id:"",client_secret:"",scope:"",root_pem:null,admin_claim_path:null,admin_claim_value:null,mfa_claim_path:null,mfa_claim_value:null})),z=["OIDC","Auto","Custom","Github","Google"],c=N(d(z[0])),s=N(d({}));const E=Ge().shape({issuer:A().trim().matches(ae,"Can only contain URI safe characters, length max: 128").required("Required"),authorization_endpoint:A().url().required("Required"),token_endpoint:A().url().required("Required"),userinfo_endpoint:A().url().required("Required"),name:A().trim().matches(nt,"Can only contain: 'a-zA-Z0-9\xC0-\xFF- ', length max: 128").required("Required"),client_id:A().trim().matches(ae,"Can only contain URI safe characters, length max: 128").required("Required"),client_secret:A().trim().max(256,"Max 256 characters"),scope:A().trim().matches(ot,"Can only contain: 'a-zA-Z0-9-_/ ', length max: 128").required("Required"),root_pem:A().trim().nullable().matches(je,"Invalid PEM certificate"),admin_claim_path:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),admin_claim_value:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),mfa_claim_path:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),mfa_claim_value:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128")}),K=Ge().shape({issuer:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),metadata_url:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),root_pem:A().trim().nullable().matches(je,"Valid PEM certificate")});Ue(()=>()=>{n(R,!1),clearTimeout(e(P))});async function Y(){if(!await q())return;if(!e(i).use_pkce&&!e(i).client_secret){n(I,"Must at least be a confidential client or use PKCE");return}n(I,""),n(b,!0),e(i).root_pem&&(e(i).danger_allow_insecure=!1,e(i).root_pem=e(i).root_pem.trim()),e(ce)?e(i).typ="custom":e(i).typ=e(c).toLowerCase(),e(i).scope=e(i).scope.trim();let L=await Rt(e(i));if(L.ok)n(D,!0);else{let T=await L.json();T.message.includes("InvalidCertificate")?n(I,"Insecure connection not allowed"):n(I,d(T.message))}n(b,!1)}async function U(){if(!await j()){n(I,"Invalid input");return}n(I,""),n(b,!0);let L=await At(e(_));if(L.ok){const T=await L.json();e(i).issuer=T.issuer,e(i).authorization_endpoint=T.authorization_endpoint,e(i).danger_allow_insecure=T.danger_allow_insecure,e(i).token_endpoint=T.token_endpoint,e(i).userinfo_endpoint=T.userinfo_endpoint,e(i).token_auth_method_basic=T.token_auth_method_basic,e(i).use_pkce=T.use_pkce,e(i).client_secret_basic=T.client_secret_basic,e(i).client_secret_post=!T.client_secret_basic&&T.client_secret_post,e(i).scope=T.scope,e(i).root_pem=T.root_pem,n(w,!0)}else{let T=await L.json();T.message.includes("InvalidCertificate")?n(I,"Insecure connection not allowed"):n(I,d(T.message))}n(b,!1)}function V(){n(_,d({issuer:null,metadata_url:null,danger_allow_insecure:!1,root_pem:null})),n(i,d({enabled:!0,issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",userinfo_endpoint:"",use_pkce:!0,client_secret_basic:!0,client_secret_post:!1,scope:"",root_pem:null,admin_claim_path:null,admin_claim_value:null,mfa_claim_path:null,mfa_claim_value:null})),n(w,!1),n(u,!1)}async function q(){n(s,d({}));try{return await E.validate(e(i),{abortEarly:!1}),e(i).client_secret&&!(e(i).client_secret_basic||e(i).client_secret_post)?(n(I,"You have given a client secret, but no client auth method is active"),!1):(n(I,"Invalid input"),!0)}catch(L){return n(s,d(Ze(L))),L="Invalid input",!1}}async function j(){n(s,d({}));try{return await K.validate(e(_),{abortEarly:!1}),!e(_).issuer&&!e(_).metadata_url?(e(s).issuer="Required",e(s).metadata_url=e(s).issuer,!1):!0}catch(L){return n(s,d(Ze(L))),!1}}let ce=Pe(()=>e(c)===z[1]),F=Pe(()=>e(c)===z[2]),Z=Pe(()=>e(c)===z[0]),ne=Pe(()=>!e(ce)&&!e(F)&&!e(Z));ke(()=>{if(e(c))switch(n(w,!1),n(s,d({})),n(_,d({issuer:null,metadata_url:null,danger_allow_insecure:!1,root_pem:null})),e(c)){case"Github":n(i,d({enabled:!0,issuer:"github.com",danger_allow_insecure:!1,authorization_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",token_auth_method_basic:!1,userinfo_endpoint:"https://api.github.com/user",use_pkce:!1,name:"Github",client_id:"",client_secret:"",scope:"user:email",root_pem:null,admin_claim_path:null,admin_claim_value:null,mfa_claim_path:"$.two_factor_authentication",mfa_claim_value:"true"}));break;case"Google":n(_,d({issuer:"accounts.google.com",metadata_url:null,danger_allow_insecure:!1,root_pem:null})),U();break;default:n(i,d({enabled:!0,typ:"oidc",issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",token_auth_method_basic:!1,userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret:"",scope:"",root_pem:null,admin_claim_path:null,admin_claim_value:null,mfa_claim_path:null,mfa_claim_value:null}))}}),ke(()=>{e(D)&&n(P,d(setTimeout(()=>{g.onSave(),n(D,!1),n(R,!1),V()},1500)))}),lt(G,{get idx(){return a()},set idx(L){a(L)},get show(){return e(R)},set show(L){n(R,d(L))},header:L=>{var T=Ft();o(L,T)},body:L=>{var T=Bt(),ge=l(p(T),2),Ie=p(ge);kt(Ie,{options:z,get value(){return e(c)},set value(O){n(c,d(O))}}),m(ge);var Le=l(ge,2);{var Ne=O=>{var J=Vt(),re=l(te(J),2),me=p(re);ie(me,{get selected(){return e(u)},set selected(Q){n(u,d(Q))}}),m(re);var B=l(re,2);{var X=Q=>{Je(Q,{rows:17,name:"rootPem",placeholder:`-----BEGIN CERTIFICATE-----
    -----END CERTIFICATE-----`,get error(){return e(s).root_pem},get value(){return e(_).root_pem},set value(le){e(_).root_pem=le},children:(le,H)=>{h();var de=f("Root Certificate in PEM format");o(le,de)},$$slots:{default:!0}})},ee=Q=>{var le=Kt(),H=l(te(le),2),de=p(H);ie(de,{get selected(){return e(_).danger_allow_insecure},set selected(t){e(_).danger_allow_insecure=t}}),m(H),o(Q,le)};M(B,Q=>{e(u)?Q(X):Q(ee,!1)})}o(O,J)};M(Le,O=>{e(w)||O(Ne)})}var Ee=l(Le,2);{var Se=O=>{var J=Ht(),re=te(J);S(re,{type:"url",name:"issuer",placeholder:"Issuer URL",width:v,get value(){return e(_).issuer},set value(B){e(_).issuer=B},get error(){return e(s).issuer},set error(B){e(s).issuer=B},$$events:{input:j,enter:U},children:(B,X)=>{h();var ee=f("ISSUER URL");o(B,ee)},$$slots:{default:!0}});var me=l(re,2);fe(me,{level:1,width:"6rem",get isLoading(){return e(b)},set isLoading(B){n(b,d(B))},$$events:{click:U},children:(B,X)=>{h();var ee=f("LOOKUP");o(B,ee)},$$slots:{default:!0}}),o(O,J)},De=O=>{var J=He(),re=te(J);{var me=X=>{var ee=Gt(),Q=te(ee);S(Q,{type:"url",name:"metadata",placeholder:".../.well-known/openid-configuration",width:v,get value(){return e(_).metadata_url},set value(H){e(_).metadata_url=H},get error(){return e(s).metadata_url},set error(H){e(s).metadata_url=H},$$events:{input:j,enter:U},children:(H,de)=>{h();var t=f("METADATA URL");o(H,t)},$$slots:{default:!0}});var le=l(Q,2);fe(le,{level:1,width:"6rem",get isLoading(){return e(b)},set isLoading(H){n(b,d(H))},$$events:{click:U},children:(H,de)=>{h();var t=f("LOOKUP");o(H,t)},$$slots:{default:!0}}),o(X,ee)},B=X=>{var ee=He(),Q=te(ee);{var le=H=>{var de=Zt(),t=te(de);{var k=r=>{Je(r,{rows:17,name:"rootPem",placeholder:`-----BEGIN CERTIFICATE-----
    -----END CERTIFICATE-----`,get error(){return e(s).root_pem},get disabled(){return e(w)},get value(){return e(i).root_pem},set value(x){e(i).root_pem=x},children:(x,y)=>{h();var Ve=f("Root Certificate in PEM format");o(x,Ve)},$$slots:{default:!0}})},$=r=>{var x=jt(),y=l(te(x),2),Ve=p(y);{var gt=we=>{ut(we,{get check(){return e(i).danger_allow_insecure}})},$t=we=>{ie(we,{get selected(){return e(i).danger_allow_insecure},set selected(bt){e(i).danger_allow_insecure=bt}})};M(Ve,we=>{e(w)?we(gt):we($t,!1)})}m(y),o(r,x)};M(t,r=>{e(u)?r(k):r($,!1)})}var ue=l(t,2);S(ue,{type:"url",name:"issuer",placeholder:"Issuer URL",width:v,get disabled(){return e(w)},get value(){return e(i).issuer},set value(r){e(i).issuer=r},get error(){return e(s).issuer},set error(r){e(s).issuer=r},$$events:{input:j},children:(r,x)=>{h();var y=f("ISSUER URL");o(r,y)},$$slots:{default:!0}});var be=l(ue,2);S(be,{type:"url",name:"auth_endpoint",placeholder:"Authorization Endpoint",width:v,get disabled(){return e(w)},get value(){return e(i).authorization_endpoint},set value(r){e(i).authorization_endpoint=r},get error(){return e(s).authorization_endpoint},set error(r){e(s).authorization_endpoint=r},$$events:{input:j},children:(r,x)=>{h();var y=f("AUTHORIZATION ENDPOINT");o(r,y)},$$slots:{default:!0}});var Oe=l(be,2);S(Oe,{type:"url",name:"token_endpoint",placeholder:"Token Endpoint",width:v,get disabled(){return e(w)},get value(){return e(i).token_endpoint},set value(r){e(i).token_endpoint=r},get error(){return e(s).token_endpoint},set error(r){e(s).token_endpoint=r},$$events:{input:j},children:(r,x)=>{h();var y=f("TOKEN ENDPOINT");o(r,y)},$$slots:{default:!0}});var xe=l(Oe,2);S(xe,{type:"url",name:"userinfo_endpoint",placeholder:"Userinfo Endpoint",width:v,get disabled(){return e(w)},get value(){return e(i).userinfo_endpoint},set value(r){e(i).userinfo_endpoint=r},get error(){return e(s).userinfo_endpoint},set error(r){e(s).userinfo_endpoint=r},$$events:{input:j},children:(r,x)=>{h();var y=f("USERINFO ENDPOINT");o(r,y)},$$slots:{default:!0}});var W=l(xe,4),pe=p(W);{var ye=r=>{ut(r,{get check(){return e(i).use_pkce}})},pt=r=>{ie(r,{get selected(){return e(i).use_pkce},set selected(x){e(i).use_pkce=x}})};M(pe,r=>{e(w)?r(ye):r(pt,!1)})}m(W);var Ye=l(W,4);S(Ye,{name:"scope",placeholder:"openid profile email",width:v,get value(){return e(i).scope},set value(r){e(i).scope=r},get error(){return e(s).scope},set error(r){e(s).scope=r},$$events:{input:q},children:(r,x)=>{h();var y=f("SCOPE");o(r,y)},$$slots:{default:!0}});var Be=l(Ye,4);S(Be,{name:"client_name",placeholder:"Client Name",width:v,get value(){return e(i).name},set value(r){e(i).name=r},get error(){return e(s).name},set error(r){e(s).name=r},$$events:{input:q},children:(r,x)=>{h();var y=f("CLIENT NAME");o(r,y)},$$slots:{default:!0}});var Qe=l(Be,4);S(Qe,{name:"client_id",autocomplete:"off",placeholder:"Client ID",width:v,get value(){return e(i).client_id},set value(r){e(i).client_id=r},get error(){return e(s).client_id},set error(r){e(s).client_id=r},$$events:{input:q},children:(r,x)=>{h();var y=f("CLIENT ID");o(r,y)},$$slots:{default:!0}});var We=l(Qe,4);dt(We,{name:"client_secret",get error(){return e(s).client_secret},autocomplete:"off",placeholder:"Client Secret",width:v,get value(){return e(i).client_secret},set value(r){e(i).client_secret=r},$$events:{input:q},children:(r,x)=>{h();var y=f("CLIENT SECRET");o(r,y)},$$slots:{default:!0}});var Fe=l(We,4),ht=l(p(Fe),2);ie(ht,{get selected(){return e(i).client_secret_basic},set selected(r){e(i).client_secret_basic=r}}),m(Fe);var Ke=l(Fe,2),_t=l(p(Ke),2);ie(_t,{get selected(){return e(i).client_secret_post},set selected(r){e(i).client_secret_post=r}}),m(Ke);var Xe=l(Ke,2);mt(Xe);var et=l(Xe,4);S(et,{name:"admin_claim_path",placeholder:"$.roles.*",width:v,get value(){return e(i).admin_claim_path},set value(r){e(i).admin_claim_path=r},get error(){return e(s).admin_claim_path},set error(r){e(s).admin_claim_path=r},$$events:{input:q},children:(r,x)=>{h();var y=f("ADMIN CLAIM PATH");o(r,y)},$$slots:{default:!0}});var tt=l(et,2);S(tt,{name:"admin_claim_value",placeholder:"rauthy_admin",width:v,get value(){return e(i).admin_claim_value},set value(r){e(i).admin_claim_value=r},get error(){return e(s).admin_claim_value},set error(r){e(s).admin_claim_value=r},$$events:{input:q},children:(r,x)=>{h();var y=f("ADMIN CLAIM VALUE");o(r,y)},$$slots:{default:!0}});var at=l(tt,4);S(at,{name:"mfa_claim_path",placeholder:"$.amr.*",width:v,get value(){return e(i).mfa_claim_path},set value(r){e(i).mfa_claim_path=r},get error(){return e(s).mfa_claim_path},set error(r){e(s).mfa_claim_path=r},$$events:{input:q},children:(r,x)=>{h();var y=f("MFA CLAIM PATH");o(r,y)},$$slots:{default:!0}});var rt=l(at,2);S(rt,{name:"mfa_claim_value",placeholder:"mfa",width:v,get value(){return e(i).mfa_claim_value},set value(r){e(i).mfa_claim_value=r},get error(){return e(s).mfa_claim_value},set error(r){e(s).mfa_claim_value=r},$$events:{input:q},children:(r,x)=>{h();var y=f("MFA CLAIM VALUE");o(r,y)},$$slots:{default:!0}});var st=l(rt,2);fe(st,{level:1,width:"6rem",get isLoading(){return e(b)},set isLoading(r){n(b,d(r))},$$events:{click:Y},children:(r,x)=>{h();var y=f("SAVE");o(r,y)},$$slots:{default:!0}});var ft=l(st,2);fe(ft,{level:4,width:"6rem",get isLoading(){return e(b)},set isLoading(r){n(b,d(r))},$$events:{click:V},children:(r,x)=>{h();var y=f("RESET");o(r,y)},$$slots:{default:!0}}),o(H,de)};M(Q,H=>{(e(ne)||e(F)||e(w))&&H(le)},!0)}o(X,ee)};M(re,X=>{e(ce)&&!e(w)?X(me):X(B,!1)},!0)}o(O,J)};M(Ee,O=>{e(Z)&&!e(w)?O(Se):O(De,!1)})}var $e=l(Ee,2);{var ze=O=>{var J=Jt();o(O,J)};M($e,O=>{e(D)&&O(ze)})}var Ce=l($e,2);{var qe=O=>{var J=Yt(),re=p(J,!0);m(J),oe(()=>ve(re,e(I))),o(O,J)};M(Ce,O=>{e(I)&&O(qe)})}m(T),o(L,T)},$$slots:{header:!0,body:!0}}),_e()}var Wt=C('<img alt="No Logo Available">');function Xt(G,g){he(g,!0);var a=Wt();oe(()=>Me(a,"src",`/auth/v1/providers/${g.providerId}/img?${ct(6)}`)),Me(a,"width",20),Me(a,"height",20),o(G,a),_e()}var ea=C('<div class="header svelte-19hes5">Allow insecure TLS certificates</div> <div class="ml mb svelte-19hes5"><!></div>',1),ta=C('<div class="success svelte-19hes5">Success</div>'),aa=C('<div class="mainErr err svelte-19hes5"> </div>'),ra=C("<!> <!> <!>",1),sa=C(`<div class="container svelte-19hes5"><div class="unit svelte-19hes5"><div class="label font-label svelte-19hes5">ID</div> <div class="value font-mono svelte-19hes5"> </div></div> <div class="separator"></div> <div class="header svelte-19hes5">Enabled</div> <div class="ml mb svelte-19hes5"><!></div> <div class="header svelte-19hes5">Custom Root CA PEM</div> <div class="ml mb svelte-19hes5"><!></div> <!> <!> <!> <!> <!> <div class="header svelte-19hes5">Use PKCE</div> <div class="ml mb svelte-19hes5"><!></div> <div class="desc svelte-19hes5">The scope the client should use when redirecting to the login.<br> Provide the values separated by space.</div> <!> <div class="desc svelte-19hes5">Client name for the Rauthy login form</div> <!> <div class="desc svelte-19hes5">Client ID given by the auth provider</div> <!> <div class="desc svelte-19hes5">Client Secret given by the auth provider.<br> At least a client secret or PKCE is required.</div> <!> <div class="desc svelte-19hes5"><p class="svelte-19hes5">The authentication method to use on the <code>/token</code> endpoint.<br> Most providers should work with <code>basic</code>, some only with <code>post</code>.
            In rare situations, you need both, while it can lead to errors with others.</p></div> <div class="switchRow svelte-19hes5"><div>client_secret_basic</div> <!></div> <div class="switchRow svelte-19hes5"><div>client_secret_post</div> <!></div> <!> <div class="desc svelte-19hes5"><p class="svelte-19hes5">You can map a user to be a rauthy admin depending on an upstream ID claim.</p></div> <!> <!> <div class="desc svelte-19hes5"><p class="svelte-19hes5">If your provider issues a claim indicating that the user has used at least 2FA during
            login, you can specify the mfa claim path.</p></div> <!> <!> <div class="logo svelte-19hes5"><!> <!></div> <!></div>`);function ia(G,g){he(g,!0);let a=se(g,"provider",31,()=>d({}));const v="25rem";let R=N(!1),b=N(""),I=N(!1),w=N(void 0),D=N(d(a().root_pem)),P=N(void 0);Ue(()=>()=>clearTimeout(e(w)));let u=N(d({}));const _=Ge().shape({issuer:A().trim().matches(ae,"Can only contain URI safe characters, length max: 128"),authorization_endpoint:A().url(),token_endpoint:A().url(),userinfo_endpoint:A().url(),name:A().trim().matches(nt,"Can only contain: 'a-zA-Z0-9\xC0-\xFF- ', length max: 128"),client_id:A().trim().matches(ae,"Can only contain URI safe characters, length max: 128"),client_secret:A().trim().max(256,"Max 256 characters"),scope:A().trim().matches(ot,"Can only contain: 'a-zA-Z0-9-_/ ', length max: 128"),admin_claim_path:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),admin_claim_value:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),mfa_claim_path:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),mfa_claim_value:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128")});async function i(){if(e(D)||a(a().root_pem=void 0,!0),!await c())return;if(!a().use_pkce&&!a().client_secret){n(b,"Must at least be a confidential client or use PKCE");return}n(b,""),n(R,!0),a().root_pem?(a(a().danger_allow_insecure=!1,!0),a(a().root_pem=a().root_pem.trim(),!0)):a(a().root_pem=void 0,!0);let t=await Lt(a().id,a());if(t.ok)n(I,!0);else{let k=await t.json();n(b,d(k.message))}n(R,!1)}async function z(t){n(R,!0);let k=await Tt(a().id,t);if(!k.ok){let $=await k.json();console.error($.message)}n(R,!1)}async function c(){n(u,d({}));try{return await _.validate(a(),{abortEarly:!1}),a().client_secret&&!(a().client_secret_basic||a().client_secret_post)?(n(b,"You have given a client secret, but no client auth method is active"),!1):(a().root_pem&&a().root_pem.length>0?je.test(a().root_pem.trim())||(e(u).root_pem="Invalid PEM certificate"):n(b,"Invalid input"),!0)}catch(t){return n(u,d(Ze(t))),!1}}ke(()=>{e(I)&&n(w,d(setTimeout(()=>{n(I,!1),g.onSave()},2e3)))}),ke(()=>{a().scope&&a(a().scope=a().scope.replaceAll("+"," "),!0)}),ke(()=>{e(P)&&z(e(P))});var s=sa(),E=p(s),K=l(p(E),2),Y=p(K,!0);m(K),m(E);var U=l(E,6),V=p(U);ie(V,{get selected(){return a().enabled},set selected(t){a(a().enabled=t,!0)}}),m(U);var q=l(U,4),j=p(q);ie(j,{get selected(){return e(D)},set selected(t){n(D,d(t))}}),m(q);var ce=l(q,2);{var F=t=>{Je(t,{rows:17,name:"rootPem",placeholder:`-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----`,get error(){return e(u).root_pem},get value(){return a().root_pem},set value(k){a(a().root_pem=k,!0)},children:(k,$)=>{h();var ue=f("Root Certificate in PEM format");o(k,ue)},$$slots:{default:!0}})},Z=t=>{var k=ea(),$=l(te(k),2),ue=p($);ie(ue,{get selected(){return a().danger_allow_insecure},set selected(be){a(a().danger_allow_insecure=be,!0)}}),m($),o(t,k)};M(ce,t=>{e(D)?t(F):t(Z,!1)})}var ne=l(ce,2);S(ne,{autocomplete:"off",placeholder:"Issuer URL",width:v,get value(){return a().issuer},set value(t){a(a().issuer=t,!0)},get error(){return e(u).issuer},set error(t){e(u).issuer=t},$$events:{input:c},children:(t,k)=>{h();var $=f("ISSUER URL");o(t,$)},$$slots:{default:!0}});var L=l(ne,2);S(L,{autocomplete:"off",placeholder:"Authorization Endpoint",width:v,get value(){return a().authorization_endpoint},set value(t){a(a().authorization_endpoint=t,!0)},get error(){return e(u).authorization_endpoint},set error(t){e(u).authorization_endpoint=t},$$events:{input:c},children:(t,k)=>{h();var $=f("AUTHORIZATION ENDPOINT");o(t,$)},$$slots:{default:!0}});var T=l(L,2);S(T,{autocomplete:"off",placeholder:"Token Endpoint",width:v,get value(){return a().token_endpoint},set value(t){a(a().token_endpoint=t,!0)},get error(){return e(u).token_endpoint},set error(t){e(u).token_endpoint=t},$$events:{input:c},children:(t,k)=>{h();var $=f("TOKEN ENDPOINT");o(t,$)},$$slots:{default:!0}});var ge=l(T,2);S(ge,{autocomplete:"off",placeholder:"Userinfo Endpoint",width:v,get value(){return a().userinfo_endpoint},set value(t){a(a().userinfo_endpoint=t,!0)},get error(){return e(u).userinfo_endpoint},set error(t){e(u).userinfo_endpoint=t},$$events:{input:c},children:(t,k)=>{h();var $=f("USERINFO ENDPOINT");o(t,$)},$$slots:{default:!0}});var Ie=l(ge,4),Le=p(Ie);ie(Le,{get selected(){return a().use_pkce},set selected(t){a(a().use_pkce=t,!0)}}),m(Ie);var Ne=l(Ie,4);S(Ne,{autocomplete:"off",placeholder:"openid profile email",width:v,get value(){return a().scope},set value(t){a(a().scope=t,!0)},get error(){return e(u).scope},set error(t){e(u).scope=t},$$events:{input:c},children:(t,k)=>{h();var $=f("SCOPE");o(t,$)},$$slots:{default:!0}});var Ee=l(Ne,4);S(Ee,{autocomplete:"off",placeholder:"Client Name",width:v,get value(){return a().name},set value(t){a(a().name=t,!0)},get error(){return e(u).name},set error(t){e(u).name=t},$$events:{input:c},children:(t,k)=>{h();var $=f("CLIENT NAME");o(t,$)},$$slots:{default:!0}});var Se=l(Ee,4);S(Se,{autocomplete:"off",placeholder:"Client ID",width:v,get value(){return a().client_id},set value(t){a(a().client_id=t,!0)},get error(){return e(u).client_id},set error(t){e(u).client_id=t},$$events:{input:c},children:(t,k)=>{h();var $=f("CLIENT ID");o(t,$)},$$slots:{default:!0}});var De=l(Se,4);dt(De,{get error(){return e(u).client_secret},autocomplete:"off",placeholder:"Client Secret",width:v,get value(){return a().client_secret},set value(t){a(a().client_secret=t,!0)},$$events:{input:c},children:(t,k)=>{h();var $=f("CLIENT SECRET");o(t,$)},$$slots:{default:!0}});var $e=l(De,4),ze=l(p($e),2);ie(ze,{get selected(){return a().client_secret_basic},set selected(t){a(a().client_secret_basic=t,!0)}}),m($e);var Ce=l($e,2),qe=l(p(Ce),2);ie(qe,{get selected(){return a().client_secret_post},set selected(t){a(a().client_secret_post=t,!0)}}),m(Ce);var O=l(Ce,2);mt(O);var J=l(O,4);S(J,{autocomplete:"off",placeholder:"$.roles.*",width:v,get value(){return a().admin_claim_path},set value(t){a(a().admin_claim_path=t,!0)},get error(){return e(u).admin_claim_path},set error(t){e(u).admin_claim_path=t},$$events:{input:c},children:(t,k)=>{h();var $=f("ADMIN CLAIM PATH");o(t,$)},$$slots:{default:!0}});var re=l(J,2);S(re,{autocomplete:"off",placeholder:"rauthy_admin",width:v,get value(){return a().admin_claim_value},set value(t){a(a().admin_claim_value=t,!0)},get error(){return e(u).admin_claim_value},set error(t){e(u).admin_claim_value=t},$$events:{input:c},children:(t,k)=>{h();var $=f("ADMIN CLAIM VALUE");o(t,$)},$$slots:{default:!0}});var me=l(re,4);S(me,{autocomplete:"off",placeholder:"$.amr.*",width:v,get value(){return a().mfa_claim_path},set value(t){a(a().mfa_claim_path=t,!0)},get error(){return e(u).mfa_claim_path},set error(t){e(u).mfa_claim_path=t},$$events:{input:c},children:(t,k)=>{h();var $=f("MFA CLAIM PATH");o(t,$)},$$slots:{default:!0}});var B=l(me,2);S(B,{autocomplete:"off",placeholder:"mfa",width:v,get value(){return a().mfa_claim_value},set value(t){a(a().mfa_claim_value=t,!0)},get error(){return e(u).mfa_claim_value},set error(t){e(u).mfa_claim_value=t},$$events:{input:c},children:(t,k)=>{h();var $=f("MFA CLAIM VALUE");o(t,$)},$$slots:{default:!0}});var X=l(B,2),ee=p(X);Ut(ee,{get image(){return e(P)},set image(t){n(P,d(t))}});var Q=l(ee,2);{var le=t=>{Xt(t,{get providerId(){return a().id}})};M(Q,t=>{e(R)||t(le)})}m(X);var H=l(X,2);{var de=t=>{var k=ra(),$=te(k);fe($,{level:1,width:"4rem",get isLoading(){return e(R)},set isLoading(W){n(R,d(W))},$$events:{click:i},children:(W,pe)=>{h();var ye=f("SAVE");o(W,ye)},$$slots:{default:!0}});var ue=l($,2);{var be=W=>{var pe=ta();o(W,pe)};M(ue,W=>{e(I)&&W(be)})}var Oe=l(ue,2);{var xe=W=>{var pe=aa(),ye=p(pe,!0);m(pe),oe(()=>ve(ye,e(b))),o(W,pe)};M(Oe,W=>{e(b)&&W(xe)})}o(t,k)};M(H,t=>{t(de)})}m(s),oe(()=>ve(Y,a().id)),o(G,s),_e()}var la=C("<p> </p>"),na=C(`<div class="label svelte-1tncxap"><p>This provider is in use by active users.</p> <p>You can force delete it, but users without a local password or passkey
                will not be able to log in anymore.</p> <details><summary>Linked Users</summary> <!></details></div> <div class="label svelte-1tncxap"><p>Are you sure you want to delete this provider?</p> <div class="forceDelete svelte-1tncxap">FORCE DELETE <!></div></div> <!>`,1),oa=C('<div class="label svelte-1tncxap">Are you sure, you want to delete this provider?</div> <!>',1),ca=C('<div class="err svelte-1tncxap"> </div>'),da=C('<div class="container svelte-1tncxap"><!> <!></div>');function ua(G,g){he(g,!0);let a=se(g,"provider",19,()=>({})),v=N(!0),R=N(""),b=N(!1),I=N(d([]));Ue(async()=>{let c=await Nt(a().id),s=await c.json();c.status===406?n(I,d(s)):n(R,d(s.message)),n(v,!1)});async function w(){n(R,""),n(v,!0);let c=await St(a().id);if(c.ok)g.onSave();else{let s=await c.json();n(R,d(s.message))}n(v,!1)}var D=da(),P=p(D);{var u=c=>{var s=na(),E=te(s),K=l(p(E),4),Y=l(p(K),2);it(Y,17,()=>e(I),F=>F.id,(F,Z)=>{var ne=la(),L=p(ne);m(ne),oe(()=>ve(L,`${e(Z).id??""} ${e(Z).email??""}`)),o(F,ne)}),m(K),m(E);var U=l(E,2),V=l(p(U),2),q=l(p(V));ie(q,{get selected(){return e(b)},set selected(F){n(b,d(F))}}),m(V),m(U);var j=l(U,2);{var ce=F=>{fe(F,{level:1,get isLoading(){return e(v)},set isLoading(Z){n(v,d(Z))},$$events:{click:w},children:(Z,ne)=>{h();var L=f("DELETE");o(Z,L)},$$slots:{default:!0}})};M(j,F=>{e(b)&&F(ce)})}o(c,s)},_=c=>{var s=oa(),E=l(te(s),2);fe(E,{level:1,get isLoading(){return e(v)},set isLoading(K){n(v,d(K))},$$events:{click:w},children:(K,Y)=>{h();var U=f("DELETE");o(K,U)},$$slots:{default:!0}}),o(c,s)};M(P,c=>{e(I).length>0?c(u):c(_,!1)})}var i=l(P,2);{var z=c=>{var s=ca(),E=p(s,!0);m(s),oe(()=>ve(E,e(R))),o(c,s)};M(i,c=>{e(R)&&c(z)})}m(D),o(G,D),_e()}var va=C('<div class="data font-mono svelte-115hohv"> </div>'),ma=C('<div class="data svelte-115hohv"> </div>'),pa=C('<div class="header svelte-115hohv"><!> <!></div>'),ha=C("<div><!></div>"),_a=C("<div><!></div>"),fa=C("<div><!> <!></div>");function ga(G,g){he(g,!0);let a=se(g,"provider",31,()=>d({})),v=se(g,"onSave",15),R=N(void 0);const b=["Config","Delete"];let I=N(d(b[0]));const w=200,D=w/2;lt(G,{get show(){return e(R)},set show(P){n(R,d(P))},header:P=>{var u=pa(),_=p(u);vt(_,{text:"Provider ID",children:(z,c)=>{var s=va(),E=p(s,!0);m(s),oe(()=>ve(E,a().id)),o(z,s)},$$slots:{default:!0}});var i=l(_,2);vt(i,{text:"Provider Name",children:(z,c)=>{var s=ma(),E=p(s,!0);m(s),oe(()=>ve(E,a().name)),o(z,s)},$$slots:{default:!0}}),m(u),o(P,u)},body:P=>{var u=fa(),_=p(u);Pt(_,{labels:b,get selected(){return e(I)},set selected(s){n(I,d(s))}});var i=l(_,2);{var z=s=>{var E=ha(),K=p(E);ia(K,{get provider(){return a()},set provider(Y){a(Y)},get onSave(){return v()},set onSave(Y){v(Y)}}),m(E),Re(1,E,()=>Te,()=>({delay:D,duration:w})),Re(2,E,()=>Te,()=>({duration:w})),o(s,E)},c=s=>{var E=He(),K=te(E);{var Y=U=>{var V=_a(),q=p(V);ua(q,{get provider(){return a()},set provider(j){a(j)},get onSave(){return v()},set onSave(j){v(j)}}),m(V),Re(1,V,()=>Te,()=>({delay:D,duration:w})),Re(2,V,()=>Te,()=>({duration:w})),o(U,V)};M(K,U=>{e(I)==="Delete"&&U(Y)},!0)}o(s,E)};M(i,s=>{e(I)==="Config"?s(z):s(c,!1)})}m(u),o(P,u)},$$slots:{header:!0,body:!0}}),_e()}var $a=C('<div class="svelte-4dnryh"><!></div>'),ba=C(' <div class="content"><!> <div id="federation" class="svelte-4dnryh"></div> <div style="height: 20px"></div></div>',1);function wa(G,g){he(g,!0);let a=N(""),v=N(d([]));Ue(()=>{R()});async function R(){let _=await Dt(),i=await _.json();_.ok?n(v,d([...i])):n(a,d(i.message))}function b(){R()}h();var I=ba(),w=te(I),D=l(w),P=p(D);Qt(P,{onSave:b});var u=l(P,2);it(u,23,()=>e(v),_=>_.id,(_,i,z)=>{var c=$a(),s=p(c);ga(s,{onSave:b,get provider(){return e(v)[e(z)]},set provider(E){e(v)[e(z)]=E}}),m(c),o(_,c)}),m(u),h(2),m(D),oe(()=>ve(w,`${e(a)??""} `)),o(G,I),_e()}function Ia(G){wa(G,{})}export{Ia as component};
