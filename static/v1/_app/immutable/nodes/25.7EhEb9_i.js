import"../chunks/disclose-version.BDr9Qe-U.js";import{t as $,p as Sr,w as n,F as se,f as V,a as qr,u as e,v as t,$ as Tr,s as c,c as v,r as d,ap as fe,O as he}from"../chunks/runtime.BONl2e88.js";import{s as S}from"../chunks/render.AqJWcVDb.js";import{i as g}from"../chunks/if.DS90EFHs.js";import{e as Fr}from"../chunks/each.Bce--_O8.js";import{a as l,n as Wr,t as p,d as ge,e as rr}from"../chunks/template.B7ldVCvc.js";import{h as Gr}from"../chunks/svelte-head.DBtDtmZn.js";import{s as j}from"../chunks/index.BJiFQ8Di.js";import{p as i}from"../chunks/proxy.0BECmVET.js";import{o as Hr}from"../chunks/index-client.Bjp_k6xO.js";import{p as Rr}from"../chunks/dataFetching.CUoxx_U8.js";import{c as tr,D as Ur,F as Ar,G as Br,n as Cr,H as Vr,h as jr,z as Dr,_ as Er,P as Nr,I as Jr}from"../chunks/helpers.CQGRRstl.js";import{a as we,B as _e}from"../chunks/fetch.JUNnB5kv.js";import{W as Or}from"../chunks/WebauthnRequest.B-jwabRJ.js";import{I as Zr}from"../chunks/Input.DGOkRo_r.js";import{T as Pr,L as Qr}from"../chunks/LangSelector.Zw9l5r2b.js";import{p as He}from"../chunks/props.BlbrNjWf.js";import{M as Xr}from"../chunks/Main.DMwa1Kwf.js";import{C as Yr}from"../chunks/ContentCenter.BNNwHQjF.js";import{u as Kr}from"../chunks/i18n.svelte.B1gwAzk0.js";import{T as O}from"../chunks/Template.DIImK_q5.js";import{u as H}from"../chunks/param.svelte.BwWxV1Sm.js";import{I as et}from"../chunks/InputPassword.B__efQ7l.js";import{u as ar}from"../chunks/is_dev.svelte.CjWXM2Cb.js";import{F as rt}from"../chunks/Form.CE2yJgP5.js";import{B as tt}from"../chunks/ButtonAuthProvider.C1AJY70X.js";var at=Wr(`<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125
            1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504
            1.125-1.125V9.75M8.25 21h8.25"></path></svg>`);function ot(be,Z){let ie=He(Z,"opacity",3,.9),u=He(Z,"width",3,"1.5rem"),P=He(Z,"color",3,"currentColor");var R=at();j(R,"stroke-width",2),$(()=>{j(R,"stroke",P()),j(R,"width",u()),j(R,"opacity",ie())}),l(be,R)}var st=p('<img alt="No Logo Available">'),it=p('<a class="home svelte-1rplcwr"><!></a>'),lt=p('<div class="forgotten svelte-1rplcwr"><!></div>'),nt=p("<!> <!>",1),ct=p('<div class="btn flex-col svelte-1rplcwr"><!></div>'),vt=p('<div class="btn flex-col svelte-1rplcwr"><!></div>'),dt=p("<!> <!> <!>",1),ut=p('<a class="reg svelte-1rplcwr" target="_blank"> </a>'),pt=p('<a class="reg svelte-1rplcwr" href="/auth/v1/users/register" target="_blank"> </a>'),mt=p("<!> <!>",1),ft=p('<div class="errMsg svelte-1rplcwr"> </div>'),ht=p('<div class="success svelte-1rplcwr"> </div>'),gt=p('<div class="btn flex-col svelte-1rplcwr"><!></div>'),wt=p('<div class="providers flex-col svelte-1rplcwr"><div class="providersSeparator svelte-1rplcwr"><div class="separator svelte-1rplcwr"></div> <div class="loginWith svelte-1rplcwr"><div class="svelte-1rplcwr"> </div></div></div> <!></div>'),_t=p('<div class="container svelte-1rplcwr"><div class="head svelte-1rplcwr"><div class="logo svelte-1rplcwr"><!></div> <!></div> <div class="name svelte-1rplcwr"><h2> </h2></div> <!> <!> <!> <!> <!> <!></div> <!> <!>',1),bt=p("<!> <!> <!> <!> <!> <!> <!>",1);function $t(be,Z){var Je;Sr(Z,!0);const ie="18rem";let u=Kr(),P=ar().get(),R=he(()=>P?"/auth/v1/dev/authorize":"/auth/v1/oidc/authorize"),_=H("client_id").get(),le=n(""),q=n(i(P?"/auth/v1":"")),Q=H("redirect_uri").get(),$e=H("nonce").get(),ze=((Je=H("scope").get())==null?void 0:Je.split(" "))||[],xe=n(void 0),ye=n(void 0),ke=H("state").get(),X=H("code_challenge").get(),I=H("code_challenge_method").get(),Re=!1,Ie=n(void 0),ne=n(i([])),ce=n(void 0),D=n(!1),m=n(""),Y=n(""),ve=n(""),T=n(!1),U=n(!1),de=n(!1),ue=n(!1),pe=n(!1),A=n(!1),Ue=n(""),Le=n(!1),z=n(i(H("login_hint").get()||"")),F=n(""),Me=n("");Hr(()=>{var r;e(T)||((r=e(xe))==null||r.focus())}),se(()=>{Re&&(_!=null&&_.length)&&ir()}),se(()=>{e(pe)&&setTimeout(()=>{t(pe,!1),t(de,!1),t(ue,!1)},3e3)}),se(()=>{var r;(r=e(ye))==null||r.focus()}),se(()=>{var r;if(e(Y)==="Refresh")Re=!0;else if((r=e(Y))!=null&&r.startsWith("MfaLogin ")){let o=e(Y).replace("MfaLogin ","");t(z,i(o)),t(Ie,i(o))}}),se(()=>{P?or():e(ve)&&tr(e(ve))});async function or(){var o;let r=await we("/auth/v1/oidc/session");console.log("manual session",r.body),(o=r.body)!=null&&o.csrf_token?tr(r.body.csrf_token):console.error(r.error)}function sr(){t(m,""),t(de,!0),t(F,"")}async function ir(){if(!_){console.error("clientId is undefined");return}if(!Q){console.error("redirectUri is undefined");return}t(D,!0);const r={client_id:_,redirect_uri:Q,state:ke,nonce:$e,scopes:ze};X&&I&&(I==="plain"||I==="S256")&&(r.code_challenge=X,r.code_challenge_method=I);let o=await we("/auth/v1/oidc/authorize/refresh",r);await Ae(o)}async function lr(r,o){if(t(m,""),!_){console.error("clientId is undefined");return}if(!Q){console.error("redirectUri is undefined");return}const w={email:e(z),client_id:_,redirect_uri:Q,state:ke,nonce:$e,scopes:ze};if(X&&I&&(I==="plain"||I==="S256")&&(w.code_challenge=X,w.code_challenge_method=I),e(T)&&e(z)!==e(Ie)){if(!e(F)){t(m,i(u.authorize.passwordRequired));return}if(e(F).length>256){t(m,"max 256");return}w.password=e(F)}t(D,!0);let b="/auth/v1/oidc/authorize";ar().get()&&(b="/auth/v1/dev/authorize");let y=await we(b,w);await Ae(y)}async function Ae(r){if(r.status===202){let o=r.headers.get("location");if(!o){console.error("location header missing");return}window.location.replace(o)}else if(r.status===200){t(m,"");let o=r.body;o&&"user_id"in o&&"code"in o?(t(Me,i(o.user_id)),t(ce,i({Login:o.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else if(r.status===406)t(m,i(u.authorize.clientForceMfa)),t(U,!0);else if(r.status===429){let o=r.headers.get("x-retry-not-before");if(!o){console.error("x-retry-not-before header missing");return}let w=Number.parseInt(o),b=Dr(w),y=w*1e3-new Date().getTime();t(A,!0),t(m,`${u.authorize.http429} ${b}`),t(z,""),t(F,""),t(T,!1),setTimeout(()=>{t(A,!1),t(m,"")},y)}else e(T)?(t(m,i(u.authorize.invalidCredentials)),t(ue,!0)):(t(T,!0),t(Ue,i(e(z))));t(D,!1)}function nr(){e(T)&&e(Ue)!==e(z)&&(t(T,!1),t(F,""),t(m,""))}function cr(r){Er(64,(o,{challenge:w,verifier:b})=>{o||(localStorage.setItem(Nr,b),vr(r,w))})}async function vr(r,o){let w={email:e(z)||null,client_id:_,redirect_uri:Q,scopes:ze,state:ke,nonce:$e,code_challenge:X,code_challenge_method:I,provider_id:r,pkce_challenge:o},b=await Rr(w);if(b.ok){const y=await b.text();Jr(y);let E=b.headers.get("location");if(!E){console.error("no location header set for provider login");return}window.location.href=E}else{let y=await b.json();t(m,i(y.message))}}function dr(r){t(ce,void 0),t(m,i(r))}function ur(r){console.log("onWebauthnSuccess",r),r&&"loc"in r&&window.location.replace(r.loc)}async function pr(){let r={email:e(z)};e(q)&&(r.redirect_uri=encodeURI(e(q))),t(D,!0);let o=await we("/auth/v1/users/request_reset",r);o.error?t(m,i(o.error.message)):t(pe,!0),t(D,!1)}var Be=bt();Gr(r=>{$(()=>Tr.title=`Login ${(e(le)||_)??""}`)});var Ce=V(Be);O(Ce,{id:Ur,get value(){return e(ne)},set value(r){t(ne,i(r))}});var Ve=c(Ce,2);O(Ve,{id:Ar,get value(){return e(le)},set value(r){t(le,i(r))}});var je=c(Ve,2);O(je,{id:Br,get value(){return e(q)},set value(r){t(q,i(r))}});var De=c(je,2);O(De,{id:Cr,get value(){return e(ve)},set value(r){t(ve,i(r))}});var Ee=c(De,2);O(Ee,{id:Vr,get value(){return e(Y)},set value(r){t(Y,i(r))}});var Ne=c(Ee,2);O(Ne,{id:jr,get value(){return e(Le)},set value(r){t(Le,i(r))}});var mr=c(Ne,2);Xr(mr,{children:(r,o)=>{Yr(r,{children:(w,b)=>{var y=_t(),E=V(y),Se=v(E),qe=v(Se),fr=v(qe);{var hr=a=>{var s=st();j(s,"src",`/auth/v1/clients/${_}/logo`),l(a,s)};g(fr,a=>{_&&a(hr)})}d(qe);var gr=c(qe,2);{var wr=a=>{var s=it(),h=v(s);ot(h,{color:"hsla(var(--text) / .4)"}),d(s),$(()=>j(s,"href",e(q))),l(a,s)};g(gr,a=>{e(q)&&a(wr)})}d(Se);var Te=c(Se,2),Oe=v(Te),_r=v(Oe,!0);d(Oe),d(Te);var Ze=c(Te,2);{var br=a=>{Or(a,{get userId(){return e(Me)},get purpose(){return e(ce)},onSuccess:ur,onError:dr})};g(Ze,a=>{e(ce)&&e(Me)&&a(br)})}var Pe=c(Ze,2);{var $r=a=>{var s=mt(),h=V(s);rt(h,{get action(){return e(R)},onSubmit:lr,children:(L,ee)=>{var W=dt(),B=V(W),re=he(()=>e(A)||e(U));Zr(B,{typ:"email",name:"email",autocomplete:"email",get label(){return u.common.email},get placeholder(){return u.common.email},get disabled(){return e(re)},onInput:nr,width:ie,required:!0,get ref(){return e(xe)},set ref(x){t(xe,i(x))},get value(){return e(z)},set value(x){t(z,i(x))}});var M=c(B,2);{var k=x=>{var ae=nt(),me=V(ae),Fe=he(()=>e(A)||e(U));et(me,{name:"password",autocomplete:"current-password",get label(){return u.common.password},get placeholder(){return u.common.password},maxLength:256,get disabled(){return e(Fe)},width:ie,required:!0,get ref(){return e(ye)},set ref(f){t(ye,i(f))},get value(){return e(F)},set value(f){t(F,i(f))}});var We=c(me,2);{var G=f=>{var C=lt(),oe=v(C);_e(oe,{invisible:!0,onclick:sr,children:(Ge,J)=>{fe();var er=ge();$(()=>S(er,u.authorize.passwordForgotten)),l(Ge,er)},$$slots:{default:!0}}),d(C),l(f,C)};g(We,f=>{e(ue)&&!e(A)&&f(G)})}l(x,ae)};g(M,x=>{e(T)&&e(Ie)!==e(z)&&!e(de)&&x(k)})}var te=c(M,2);{var Mr=x=>{var ae=rr(),me=V(ae);{var Fe=G=>{var f=ct(),C=v(f);_e(C,{onclick:pr,children:(oe,Ge)=>{fe();var J=ge();$(()=>S(J,u.authorize.passwordRequest)),l(oe,J)},$$slots:{default:!0}}),d(f),l(G,f)},We=G=>{var f=vt(),C=v(f);_e(C,{type:"submit",get isLoading(){return e(D)},children:(oe,Ge)=>{fe();var J=ge();$(()=>S(J,u.authorize.login)),l(oe,J)},$$slots:{default:!0}}),d(f),l(G,f)};g(me,G=>{e(de)?G(Fe):G(We,!1)})}l(x,ae)};g(te,x=>{!e(A)&&!e(U)&&x(Mr)})}l(L,W)},$$slots:{default:!0}});var N=c(h,2);{var K=L=>{var ee=rr(),W=V(ee);{var B=M=>{var k=ut(),te=v(k,!0);d(k),$(()=>{j(k,"href",`/auth/v1/users/register?redirect_uri=${e(q)??""}`),S(te,u.authorize.signUp)}),l(M,k)},re=M=>{var k=pt(),te=v(k,!0);d(k),$(()=>S(te,u.authorize.signUp)),l(M,k)};g(W,M=>{e(q)?M(B):M(re,!1)})}l(L,ee)};g(N,L=>{e(Le)&&!e(ue)&&!e(A)&&L(K)})}l(a,s)};g(Pe,a=>{e(U)||a($r)})}var Qe=c(Pe,2);{var zr=a=>{var s=ft(),h=v(s,!0);d(s),$(()=>S(h,e(m))),l(a,s)};g(Qe,a=>{e(m)&&a(zr)})}var Xe=c(Qe,2);{var xr=a=>{var s=ht(),h=v(s,!0);d(s),$(()=>S(h,u.authorize.emailSentMsg)),l(a,s)};g(Xe,a=>{e(pe)&&a(xr)})}var Ye=c(Xe,2);{var yr=a=>{var s=gt(),h=v(s);_e(h,{onclick:()=>window.location.href="/auth/v1/account",children:(N,K)=>{fe();var L=ge("Account");l(N,L)},$$slots:{default:!0}}),d(s),l(a,s)};g(Ye,a=>{e(U)&&a(yr)})}var kr=c(Ye,2);{var Ir=a=>{var s=wt(),h=v(s),N=c(v(h),2),K=v(N),L=v(K,!0);d(K),d(N),d(h);var ee=c(h,2);Fr(ee,17,()=>e(ne),W=>W.id,(W,B)=>{var re=he(()=>`Login: ${e(B).name}`);tt(W,{get ariaLabel(){return e(re)},get provider(){return e(B)},onclick:cr})}),d(s),$(()=>S(L,u.authorize.orLoginWith)),l(a,s)};g(kr,a=>{!e(U)&&e(ne)&&a(Ir)})}d(E);var Ke=c(E,2);Pr(Ke,{absolute:!0});var Lr=c(Ke,2);Qr(Lr,{absolute:!0}),$(()=>S(_r,e(le)||_)),l(w,y)},$$slots:{default:!0}})},$$slots:{default:!0}}),l(be,Be),qr()}export{$t as component};
