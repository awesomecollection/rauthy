import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DtyiMpWz.js";import{p as he,aJ as wt,c as p,F as It,r as m,s as l,t as oe,a as _e,aN as Et,i as L,ao as Pe,h as n,g as e,a9 as Ue,f as te,aq as h}from"../chunks/index-client.DAoU_hDn.js";import{k as Ct,s as ve}from"../chunks/render.mNhspeV3.js";import{e as it}from"../chunks/each.DTG73tix.js";import{a as o,t as C,d as f,e as Ge}from"../chunks/template.DcxtE4ym.js";import{p as d}from"../chunks/proxy.D3ASEzk3.js";import{i as M}from"../chunks/if.BANCODOf.js";import{p as se,r as yt}from"../chunks/props.VJ8UyA45.js";import{r as ke}from"../chunks/legacy-client.rYJ80fHr.js";import{E as lt}from"../chunks/ExpandContainer.mM6ZiTQe.js";import{c as He,a as A,I as S}from"../chunks/Input.C04-Kl2S.js";import{n as ae,$ as nt,a0 as ot,a1 as je,o as Ye}from"../chunks/helpers.BV-akmwW.js";import{B as fe}from"../chunks/Button.CKHLXer8.js";import{y as kt,z as At,A as Rt,B as Tt,C as Nt,D as Lt,E as St}from"../chunks/dataFetchingAdmin.D7RWqeRL.js";import{S as ie,P as ct}from"../chunks/PasswordInput.JBBIMWuW.js";import{C as dt}from"../chunks/CheckIcon.CrU43zqd.js";import{O as Dt,T as ut}from"../chunks/OptionSelect.CBlj_bre.js";import{s as Ot}from"../chunks/snippet.DHnbbgSs.js";import{s as Me,d as xt}from"../chunks/class.DWa3OhYO.js";import{s as Ae,t as Re,a as Te}from"../chunks/index.DER1jHiU.js";import{g as vt}from"../chunks/helpers.mrWtKrwW.js";import{T as Pt}from"../chunks/TabBar.BqcS880p.js";import{I as Ut}from"../chunks/ImageUploadRaw.BJmDAa-L.js";var Mt=C(`<div class="desc svelte-i817w5"><h4 class="svelte-i817w5">ID token claim mappings</h4> <p class="svelte-i817w5">Values from the ID token after a successful upstream login can be mapped automatically.</p> <p class="svelte-i817w5">The <code class="svelte-i817w5">path</code> needs to be given in a regex like syntax. It can resolve to
        single JSON values or resolve to a value in a JSON object or array.</p> <p class="svelte-i817w5"><code class="svelte-i817w5">$.</code> marks the start of the JSON object</p> <p class="svelte-i817w5"><code class="svelte-i817w5">*</code> can be used as a wildcard in your path</p> <p class="svelte-i817w5"><code class="svelte-i817w5">$.roles</code> would target <code class="svelte-i817w5">&#123;"roles": "value"&#125;</code></p> <p class="svelte-i817w5"><code class="svelte-i817w5">$.roles.*</code> can target a value inside an object or array like<br> <code class="svelte-i817w5">&#123;"roles": ["value", "notMyValue"]&#125;</code></p></div>`);function mt(H){var g=Mt();o(H,g)}var zt=C('<div class="err font-label svelte-w61ts0"> </div>'),qt=C('<div class="container svelte-w61ts0"><div class="label svelte-w61ts0"><div class="labelInner font-label noselect svelte-w61ts0"><label><!></label></div></div> <textarea></textarea> <!></div>');function Ze(H,g){he(g,!0);let a=se(g,"rows",3,10),v=se(g,"cols",3,10),R=se(g,"name",19,vt),b=se(g,"disabled",3,!1),I=se(g,"error",3,""),w=se(g,"value",15),D=se(g,"width",3,"32rem"),P=se(g,"fixed",3,!0),u=yt(g,["$$slots","$$events","$$legacy","rows","cols","name","disabled","error","value","width","fixed","children"]);const _=wt();async function i(F){await Et(),w(F.target.value),_("input",w())}function z(){_("focus",!0)}function c(){_("blur",!0)}var s=qt(),E=p(s),K=p(E),B=p(K),U=p(B);Ot(U,()=>g.children??It),m(B),m(K),m(E);var V=l(E,2);Ct(V);let q;var j=l(V,2);{var ce=F=>{var Y=zt(),ne=p(Y,!0);m(Y),oe(()=>{Ae(Y,"width",D()),ve(ne,I())}),Re(7,Y,()=>Te,()=>({duration:250})),o(F,Y)};M(j,F=>{I()&&F(ce)})}m(s),oe(()=>{Ae(s,"width",`calc(${D()??""} + 12px)`),Ae(K,"background",b()?"var(--col-gmid)":"var(--col-bg)"),Me(B,"for",R()),q=xt(V,q,{name:R(),disabled:b(),value:w(),rows:a(),cols:v(),...u,oninput:i,onfocus:z,onblur:c},"svelte-w61ts0"),Ae(V,"resize",P()?"none":""),Ae(V,"width",D())}),o(H,s),_e()}var Ft=C('<div class="header font-label svelte-1m46su9">ADD NEW AUTHENTICATION PROVIDER</div>'),Kt=C('<div class="header svelte-1m46su9">Allow insecure TLS certificates</div> <div class="ml mb svelte-1m46su9"><!></div>',1),Vt=C('<div class="header svelte-1m46su9">Custom Root CA PEM</div> <div class="ml mb svelte-1m46su9"><!></div> <!>',1),Gt=C("<!> <!>",1),Ht=C("<!> <!>",1),jt=C('<div class="header svelte-1m46su9">Allow insecure TLS certificates</div> <div class="ml mb svelte-1m46su9"><!></div>',1),Yt=C(`<!> <!> <!> <!> <!> <div class="header svelte-1m46su9">Use PKCE</div> <div class="ml svelte-1m46su9"><!></div> <div class="desc svelte-1m46su9">The scope the client should use when redirecting to the login.<br> Provide the values separated by space.</div> <!> <div class="desc svelte-1m46su9">Client name for the Rauthy login form</div> <!> <div class="desc svelte-1m46su9">Client ID given by the auth provider</div> <!> <div class="desc svelte-1m46su9">Client Secret given by the auth provider.<br> At least a client secret or PKCE is required.</div> <!> <div class="desc svelte-1m46su9"><p class="svelte-1m46su9">The authentication method to use on the <code>/token</code> endpoint.<br> Most providers should work with <code>basic</code>, some only with <code>post</code>.
                        In rare situations, you need both, while it can lead to errors with others.</p></div> <div class="switchRow svelte-1m46su9"><div>client_secret_basic</div> <!></div> <div class="switchRow svelte-1m46su9"><div>client_secret_post</div> <!></div> <!> <div class="desc svelte-1m46su9"><p class="svelte-1m46su9">You can map a user to be a rauthy admin depending on an upstream ID claim.</p></div> <!> <!> <div class="desc svelte-1m46su9"><p class="svelte-1m46su9">If your provider issues a claim indicating that the user has used at least 2FA during
                        login, you can specify the mfa claim path.</p></div> <!> <!> <!> <!>`,1),Zt=C('<div class="success svelte-1m46su9">Success</div>'),Bt=C('<div class="err svelte-1m46su9"> </div>'),Jt=C('<div class="container svelte-1m46su9"><div class="header svelte-1m46su9">Type</div> <div class="ml mb svelte-1m46su9"><!></div> <!> <!> <!> <!></div>');function Wt(H,g){he(g,!0);let a=se(g,"idx",31,()=>-1);const v="25rem";let R=L(!1),b=L(!1),I=L(""),w=L(!1),D=L(!1),P=L(void 0),u=L(!1),_=L(d({issuer:null,metadata_url:null,danger_allow_insecure:!1,root_pem:null})),i=L(d({enabled:!0,typ:"oidc",issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",token_auth_method_basic:!1,userinfo_endpoint:"",use_pkce:!0,client_secret_basic:!0,client_secret_post:!1,name:"",client_id:"",client_secret:"",scope:"",root_pem:null,admin_claim_path:null,admin_claim_value:null,mfa_claim_path:null,mfa_claim_value:null})),z=["OIDC","Auto","Custom","Github","Google"],c=L(d(z[0])),s=L(d({}));const E=He().shape({issuer:A().trim().matches(ae,"Can only contain URI safe characters, length max: 128").required("Required"),authorization_endpoint:A().url().required("Required"),token_endpoint:A().url().required("Required"),userinfo_endpoint:A().url().required("Required"),name:A().trim().matches(nt,"Can only contain: 'a-zA-Z0-9\xC0-\xFF- ', length max: 128").required("Required"),client_id:A().trim().matches(ae,"Can only contain URI safe characters, length max: 128").required("Required"),client_secret:A().trim().max(256,"Max 256 characters"),scope:A().trim().matches(ot,"Can only contain: 'a-zA-Z0-9-_/ ', length max: 128").required("Required"),root_pem:A().trim().nullable().matches(je,"Invalid PEM certificate"),admin_claim_path:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),admin_claim_value:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),mfa_claim_path:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),mfa_claim_value:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128")}),K=He().shape({issuer:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),metadata_url:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),root_pem:A().trim().nullable().matches(je,"Valid PEM certificate")});Pe(()=>()=>{n(R,!1),clearTimeout(e(P))});async function B(){if(!await q())return;if(!e(i).use_pkce&&!e(i).client_secret){n(I,"Must at least be a confidential client or use PKCE");return}n(I,""),n(b,!0),e(i).root_pem&&(e(i).danger_allow_insecure=!1,e(i).root_pem=e(i).root_pem.trim()),e(ce)?e(i).typ="custom":e(i).typ=e(c).toLowerCase(),e(i).scope=e(i).scope.trim();let N=await At(e(i));if(N.ok)n(D,!0);else{let T=await N.json();T.message.includes("InvalidCertificate")?n(I,"Insecure connection not allowed"):n(I,d(T.message))}n(b,!1)}async function U(){if(!await j()){n(I,"Invalid input");return}n(I,""),n(b,!0);let N=await kt(e(_));if(N.ok){const T=await N.json();e(i).issuer=T.issuer,e(i).authorization_endpoint=T.authorization_endpoint,e(i).danger_allow_insecure=T.danger_allow_insecure,e(i).token_endpoint=T.token_endpoint,e(i).userinfo_endpoint=T.userinfo_endpoint,e(i).token_auth_method_basic=T.token_auth_method_basic,e(i).use_pkce=T.use_pkce,e(i).client_secret_basic=T.client_secret_basic,e(i).client_secret_post=!T.client_secret_basic&&T.client_secret_post,e(i).scope=T.scope,e(i).root_pem=T.root_pem,n(w,!0)}else{let T=await N.json();T.message.includes("InvalidCertificate")?n(I,"Insecure connection not allowed"):n(I,d(T.message))}n(b,!1)}function V(){n(_,d({issuer:null,metadata_url:null,danger_allow_insecure:!1,root_pem:null})),n(i,d({enabled:!0,issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",userinfo_endpoint:"",use_pkce:!0,client_secret_basic:!0,client_secret_post:!1,scope:"",root_pem:null,admin_claim_path:null,admin_claim_value:null,mfa_claim_path:null,mfa_claim_value:null})),n(w,!1),n(u,!1)}async function q(){n(s,d({}));try{return await E.validate(e(i),{abortEarly:!1}),e(i).client_secret&&!(e(i).client_secret_basic||e(i).client_secret_post)?(n(I,"You have given a client secret, but no client auth method is active"),!1):(n(I,"Invalid input"),!0)}catch(N){return n(s,d(Ye(N))),N="Invalid input",!1}}async function j(){n(s,d({}));try{return await K.validate(e(_),{abortEarly:!1}),!e(_).issuer&&!e(_).metadata_url?(e(s).issuer="Required",e(s).metadata_url=e(s).issuer,!1):!0}catch(N){return n(s,d(Ye(N))),!1}}let ce=Ue(()=>e(c)===z[1]),F=Ue(()=>e(c)===z[2]),Y=Ue(()=>e(c)===z[0]),ne=Ue(()=>!e(ce)&&!e(F)&&!e(Y));ke(()=>{if(e(c))switch(n(w,!1),n(s,d({})),n(_,d({issuer:null,metadata_url:null,danger_allow_insecure:!1,root_pem:null})),e(c)){case"Github":n(i,d({enabled:!0,issuer:"github.com",danger_allow_insecure:!1,authorization_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",token_auth_method_basic:!1,userinfo_endpoint:"https://api.github.com/user",use_pkce:!1,name:"Github",client_id:"",client_secret:"",scope:"user:email",root_pem:null,admin_claim_path:null,admin_claim_value:null,mfa_claim_path:"$.two_factor_authentication",mfa_claim_value:"true"}));break;case"Google":n(_,d({issuer:"accounts.google.com",metadata_url:null,danger_allow_insecure:!1,root_pem:null})),U();break;default:n(i,d({enabled:!0,typ:"oidc",issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",token_auth_method_basic:!1,userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret:"",scope:"",root_pem:null,admin_claim_path:null,admin_claim_value:null,mfa_claim_path:null,mfa_claim_value:null}))}}),ke(()=>{e(D)&&n(P,d(setTimeout(()=>{g.onSave(),n(D,!1),n(R,!1),V()},1500)))}),lt(H,{get idx(){return a()},set idx(N){a(N)},get show(){return e(R)},set show(N){n(R,d(N))},header:N=>{var T=Ft();o(N,T)},body:N=>{var T=Jt(),ge=l(p(T),2),Ie=p(ge);Dt(Ie,{options:z,get value(){return e(c)},set value(O){n(c,d(O))}}),m(ge);var Ne=l(ge,2);{var Le=O=>{var Z=Vt(),re=l(te(Z),2),me=p(re);ie(me,{get selected(){return e(u)},set selected(W){n(u,d(W))}}),m(re);var J=l(re,2);{var X=W=>{Ze(W,{rows:17,name:"rootPem",placeholder:`-----BEGIN CERTIFICATE-----
    -----END CERTIFICATE-----`,get error(){return e(s).root_pem},get value(){return e(_).root_pem},set value(le){e(_).root_pem=le},children:(le,G)=>{h();var de=f("Root Certificate in PEM format");o(le,de)},$$slots:{default:!0}})},ee=W=>{var le=Kt(),G=l(te(le),2),de=p(G);ie(de,{get selected(){return e(_).danger_allow_insecure},set selected(t){e(_).danger_allow_insecure=t}}),m(G),o(W,le)};M(J,W=>{e(u)?W(X):W(ee,!1)})}o(O,Z)};M(Ne,O=>{e(w)||O(Le)})}var Ee=l(Ne,2);{var Se=O=>{var Z=Gt(),re=te(Z);S(re,{type:"url",name:"issuer",placeholder:"Issuer URL",width:v,get value(){return e(_).issuer},set value(J){e(_).issuer=J},get error(){return e(s).issuer},set error(J){e(s).issuer=J},$$events:{input:j,enter:U},children:(J,X)=>{h();var ee=f("ISSUER URL");o(J,ee)},$$slots:{default:!0}});var me=l(re,2);fe(me,{level:1,width:"6rem",get isLoading(){return e(b)},set isLoading(J){n(b,d(J))},$$events:{click:U},children:(J,X)=>{h();var ee=f("LOOKUP");o(J,ee)},$$slots:{default:!0}}),o(O,Z)},De=O=>{var Z=Ge(),re=te(Z);{var me=X=>{var ee=Ht(),W=te(ee);S(W,{type:"url",name:"metadata",placeholder:".../.well-known/openid-configuration",width:v,get value(){return e(_).metadata_url},set value(G){e(_).metadata_url=G},get error(){return e(s).metadata_url},set error(G){e(s).metadata_url=G},$$events:{input:j,enter:U},children:(G,de)=>{h();var t=f("METADATA URL");o(G,t)},$$slots:{default:!0}});var le=l(W,2);fe(le,{level:1,width:"6rem",get isLoading(){return e(b)},set isLoading(G){n(b,d(G))},$$events:{click:U},children:(G,de)=>{h();var t=f("LOOKUP");o(G,t)},$$slots:{default:!0}}),o(X,ee)},J=X=>{var ee=Ge(),W=te(ee);{var le=G=>{var de=Yt(),t=te(de);{var k=r=>{Ze(r,{rows:17,name:"rootPem",placeholder:`-----BEGIN CERTIFICATE-----
    -----END CERTIFICATE-----`,get error(){return e(s).root_pem},get disabled(){return e(w)},get value(){return e(i).root_pem},set value(x){e(i).root_pem=x},children:(x,y)=>{h();var Ve=f("Root Certificate in PEM format");o(x,Ve)},$$slots:{default:!0}})},$=r=>{var x=jt(),y=l(te(x),2),Ve=p(y);{var gt=we=>{dt(we,{get check(){return e(i).danger_allow_insecure}})},$t=we=>{ie(we,{get selected(){return e(i).danger_allow_insecure},set selected(bt){e(i).danger_allow_insecure=bt}})};M(Ve,we=>{e(w)?we(gt):we($t,!1)})}m(y),o(r,x)};M(t,r=>{e(u)?r(k):r($,!1)})}var ue=l(t,2);S(ue,{type:"url",name:"issuer",placeholder:"Issuer URL",width:v,get disabled(){return e(w)},get value(){return e(i).issuer},set value(r){e(i).issuer=r},get error(){return e(s).issuer},set error(r){e(s).issuer=r},$$events:{input:j},children:(r,x)=>{h();var y=f("ISSUER URL");o(r,y)},$$slots:{default:!0}});var be=l(ue,2);S(be,{type:"url",name:"auth_endpoint",placeholder:"Authorization Endpoint",width:v,get disabled(){return e(w)},get value(){return e(i).authorization_endpoint},set value(r){e(i).authorization_endpoint=r},get error(){return e(s).authorization_endpoint},set error(r){e(s).authorization_endpoint=r},$$events:{input:j},children:(r,x)=>{h();var y=f("AUTHORIZATION ENDPOINT");o(r,y)},$$slots:{default:!0}});var Oe=l(be,2);S(Oe,{type:"url",name:"token_endpoint",placeholder:"Token Endpoint",width:v,get disabled(){return e(w)},get value(){return e(i).token_endpoint},set value(r){e(i).token_endpoint=r},get error(){return e(s).token_endpoint},set error(r){e(s).token_endpoint=r},$$events:{input:j},children:(r,x)=>{h();var y=f("TOKEN ENDPOINT");o(r,y)},$$slots:{default:!0}});var xe=l(Oe,2);S(xe,{type:"url",name:"userinfo_endpoint",placeholder:"Userinfo Endpoint",width:v,get disabled(){return e(w)},get value(){return e(i).userinfo_endpoint},set value(r){e(i).userinfo_endpoint=r},get error(){return e(s).userinfo_endpoint},set error(r){e(s).userinfo_endpoint=r},$$events:{input:j},children:(r,x)=>{h();var y=f("USERINFO ENDPOINT");o(r,y)},$$slots:{default:!0}});var Q=l(xe,4),pe=p(Q);{var ye=r=>{dt(r,{get check(){return e(i).use_pkce}})},pt=r=>{ie(r,{get selected(){return e(i).use_pkce},set selected(x){e(i).use_pkce=x}})};M(pe,r=>{e(w)?r(ye):r(pt,!1)})}m(Q);var Be=l(Q,4);S(Be,{name:"scope",placeholder:"openid profile email",width:v,get value(){return e(i).scope},set value(r){e(i).scope=r},get error(){return e(s).scope},set error(r){e(s).scope=r},$$events:{input:q},children:(r,x)=>{h();var y=f("SCOPE");o(r,y)},$$slots:{default:!0}});var Je=l(Be,4);S(Je,{name:"client_name",placeholder:"Client Name",width:v,get value(){return e(i).name},set value(r){e(i).name=r},get error(){return e(s).name},set error(r){e(s).name=r},$$events:{input:q},children:(r,x)=>{h();var y=f("CLIENT NAME");o(r,y)},$$slots:{default:!0}});var We=l(Je,4);S(We,{name:"client_id",autocomplete:"off",placeholder:"Client ID",width:v,get value(){return e(i).client_id},set value(r){e(i).client_id=r},get error(){return e(s).client_id},set error(r){e(s).client_id=r},$$events:{input:q},children:(r,x)=>{h();var y=f("CLIENT ID");o(r,y)},$$slots:{default:!0}});var Qe=l(We,4);ct(Qe,{name:"client_secret",get error(){return e(s).client_secret},autocomplete:"off",placeholder:"Client Secret",width:v,get value(){return e(i).client_secret},set value(r){e(i).client_secret=r},$$events:{input:q},children:(r,x)=>{h();var y=f("CLIENT SECRET");o(r,y)},$$slots:{default:!0}});var Fe=l(Qe,4),ht=l(p(Fe),2);ie(ht,{get selected(){return e(i).client_secret_basic},set selected(r){e(i).client_secret_basic=r}}),m(Fe);var Ke=l(Fe,2),_t=l(p(Ke),2);ie(_t,{get selected(){return e(i).client_secret_post},set selected(r){e(i).client_secret_post=r}}),m(Ke);var Xe=l(Ke,2);mt(Xe);var et=l(Xe,4);S(et,{name:"admin_claim_path",placeholder:"$.roles.*",width:v,get value(){return e(i).admin_claim_path},set value(r){e(i).admin_claim_path=r},get error(){return e(s).admin_claim_path},set error(r){e(s).admin_claim_path=r},$$events:{input:q},children:(r,x)=>{h();var y=f("ADMIN CLAIM PATH");o(r,y)},$$slots:{default:!0}});var tt=l(et,2);S(tt,{name:"admin_claim_value",placeholder:"rauthy_admin",width:v,get value(){return e(i).admin_claim_value},set value(r){e(i).admin_claim_value=r},get error(){return e(s).admin_claim_value},set error(r){e(s).admin_claim_value=r},$$events:{input:q},children:(r,x)=>{h();var y=f("ADMIN CLAIM VALUE");o(r,y)},$$slots:{default:!0}});var at=l(tt,4);S(at,{name:"mfa_claim_path",placeholder:"$.amr.*",width:v,get value(){return e(i).mfa_claim_path},set value(r){e(i).mfa_claim_path=r},get error(){return e(s).mfa_claim_path},set error(r){e(s).mfa_claim_path=r},$$events:{input:q},children:(r,x)=>{h();var y=f("MFA CLAIM PATH");o(r,y)},$$slots:{default:!0}});var rt=l(at,2);S(rt,{name:"mfa_claim_value",placeholder:"mfa",width:v,get value(){return e(i).mfa_claim_value},set value(r){e(i).mfa_claim_value=r},get error(){return e(s).mfa_claim_value},set error(r){e(s).mfa_claim_value=r},$$events:{input:q},children:(r,x)=>{h();var y=f("MFA CLAIM VALUE");o(r,y)},$$slots:{default:!0}});var st=l(rt,2);fe(st,{level:1,width:"6rem",get isLoading(){return e(b)},set isLoading(r){n(b,d(r))},$$events:{click:B},children:(r,x)=>{h();var y=f("SAVE");o(r,y)},$$slots:{default:!0}});var ft=l(st,2);fe(ft,{level:4,width:"6rem",get isLoading(){return e(b)},set isLoading(r){n(b,d(r))},$$events:{click:V},children:(r,x)=>{h();var y=f("RESET");o(r,y)},$$slots:{default:!0}}),o(G,de)};M(W,G=>{(e(ne)||e(F)||e(w))&&G(le)},!0)}o(X,ee)};M(re,X=>{e(ce)&&!e(w)?X(me):X(J,!1)},!0)}o(O,Z)};M(Ee,O=>{e(Y)&&!e(w)?O(Se):O(De,!1)})}var $e=l(Ee,2);{var ze=O=>{var Z=Zt();o(O,Z)};M($e,O=>{e(D)&&O(ze)})}var Ce=l($e,2);{var qe=O=>{var Z=Bt(),re=p(Z,!0);m(Z),oe(()=>ve(re,e(I))),o(O,Z)};M(Ce,O=>{e(I)&&O(qe)})}m(T),o(N,T)},$$slots:{header:!0,body:!0}}),_e()}var Qt=C('<img alt="No Logo Available">');function Xt(H,g){he(g,!0);var a=Qt();oe(()=>Me(a,"src",`/auth/v1/providers/${g.providerId}/img?${vt(6)}`)),Me(a,"width",20),Me(a,"height",20),o(H,a),_e()}var ea=C('<div class="header svelte-19hes5">Allow insecure TLS certificates</div> <div class="ml mb svelte-19hes5"><!></div>',1),ta=C('<div class="success svelte-19hes5">Success</div>'),aa=C('<div class="mainErr err svelte-19hes5"> </div>'),ra=C("<!> <!> <!>",1),sa=C(`<div class="container svelte-19hes5"><div class="unit svelte-19hes5"><div class="label font-label svelte-19hes5">ID</div> <div class="value font-mono svelte-19hes5"> </div></div> <div class="separator"></div> <div class="header svelte-19hes5">Enabled</div> <div class="ml mb svelte-19hes5"><!></div> <div class="header svelte-19hes5">Custom Root CA PEM</div> <div class="ml mb svelte-19hes5"><!></div> <!> <!> <!> <!> <!> <div class="header svelte-19hes5">Use PKCE</div> <div class="ml mb svelte-19hes5"><!></div> <div class="desc svelte-19hes5">The scope the client should use when redirecting to the login.<br> Provide the values separated by space.</div> <!> <div class="desc svelte-19hes5">Client name for the Rauthy login form</div> <!> <div class="desc svelte-19hes5">Client ID given by the auth provider</div> <!> <div class="desc svelte-19hes5">Client Secret given by the auth provider.<br> At least a client secret or PKCE is required.</div> <!> <div class="desc svelte-19hes5"><p class="svelte-19hes5">The authentication method to use on the <code>/token</code> endpoint.<br> Most providers should work with <code>basic</code>, some only with <code>post</code>.
            In rare situations, you need both, while it can lead to errors with others.</p></div> <div class="switchRow svelte-19hes5"><div>client_secret_basic</div> <!></div> <div class="switchRow svelte-19hes5"><div>client_secret_post</div> <!></div> <!> <div class="desc svelte-19hes5"><p class="svelte-19hes5">You can map a user to be a rauthy admin depending on an upstream ID claim.</p></div> <!> <!> <div class="desc svelte-19hes5"><p class="svelte-19hes5">If your provider issues a claim indicating that the user has used at least 2FA during
            login, you can specify the mfa claim path.</p></div> <!> <!> <div class="logo svelte-19hes5"><!> <!></div> <!></div>`);function ia(H,g){he(g,!0);let a=se(g,"provider",31,()=>d({}));const v="25rem";let R=L(!1),b=L(""),I=L(!1),w=L(void 0),D=L(d(a().root_pem)),P=L(void 0);Pe(()=>()=>clearTimeout(e(w)));let u=L(d({}));const _=He().shape({issuer:A().trim().matches(ae,"Can only contain URI safe characters, length max: 128"),authorization_endpoint:A().url(),token_endpoint:A().url(),userinfo_endpoint:A().url(),name:A().trim().matches(nt,"Can only contain: 'a-zA-Z0-9\xC0-\xFF- ', length max: 128"),client_id:A().trim().matches(ae,"Can only contain URI safe characters, length max: 128"),client_secret:A().trim().max(256,"Max 256 characters"),scope:A().trim().matches(ot,"Can only contain: 'a-zA-Z0-9-_/ ', length max: 128"),admin_claim_path:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),admin_claim_value:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),mfa_claim_path:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128"),mfa_claim_value:A().trim().nullable().matches(ae,"Can only contain URI safe characters, length max: 128")});async function i(){if(e(D)||a(a().root_pem=void 0,!0),!await c())return;if(!a().use_pkce&&!a().client_secret){n(b,"Must at least be a confidential client or use PKCE");return}n(b,""),n(R,!0),a().root_pem?(a(a().danger_allow_insecure=!1,!0),a(a().root_pem=a().root_pem.trim(),!0)):a(a().root_pem=void 0,!0);let t=await Tt(a().id,a());if(t.ok)n(I,!0);else{let k=await t.json();n(b,d(k.message))}n(R,!1)}async function z(t){n(R,!0);let k=await Rt(a().id,t);if(!k.ok){let $=await k.json();console.error($.message)}n(R,!1)}async function c(){n(u,d({}));try{return await _.validate(a(),{abortEarly:!1}),a().client_secret&&!(a().client_secret_basic||a().client_secret_post)?(n(b,"You have given a client secret, but no client auth method is active"),!1):(a().root_pem&&a().root_pem.length>0?je.test(a().root_pem.trim())||(e(u).root_pem="Invalid PEM certificate"):n(b,"Invalid input"),!0)}catch(t){return n(u,d(Ye(t))),!1}}ke(()=>{e(I)&&n(w,d(setTimeout(()=>{n(I,!1),g.onSave()},2e3)))}),ke(()=>{a().scope&&a(a().scope=a().scope.replaceAll("+"," "),!0)}),ke(()=>{e(P)&&z(e(P))});var s=sa(),E=p(s),K=l(p(E),2),B=p(K,!0);m(K),m(E);var U=l(E,6),V=p(U);ie(V,{get selected(){return a().enabled},set selected(t){a(a().enabled=t,!0)}}),m(U);var q=l(U,4),j=p(q);ie(j,{get selected(){return e(D)},set selected(t){n(D,d(t))}}),m(q);var ce=l(q,2);{var F=t=>{Ze(t,{rows:17,name:"rootPem",placeholder:`-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----`,get error(){return e(u).root_pem},get value(){return a().root_pem},set value(k){a(a().root_pem=k,!0)},children:(k,$)=>{h();var ue=f("Root Certificate in PEM format");o(k,ue)},$$slots:{default:!0}})},Y=t=>{var k=ea(),$=l(te(k),2),ue=p($);ie(ue,{get selected(){return a().danger_allow_insecure},set selected(be){a(a().danger_allow_insecure=be,!0)}}),m($),o(t,k)};M(ce,t=>{e(D)?t(F):t(Y,!1)})}var ne=l(ce,2);S(ne,{autocomplete:"off",placeholder:"Issuer URL",width:v,get value(){return a().issuer},set value(t){a(a().issuer=t,!0)},get error(){return e(u).issuer},set error(t){e(u).issuer=t},$$events:{input:c},children:(t,k)=>{h();var $=f("ISSUER URL");o(t,$)},$$slots:{default:!0}});var N=l(ne,2);S(N,{autocomplete:"off",placeholder:"Authorization Endpoint",width:v,get value(){return a().authorization_endpoint},set value(t){a(a().authorization_endpoint=t,!0)},get error(){return e(u).authorization_endpoint},set error(t){e(u).authorization_endpoint=t},$$events:{input:c},children:(t,k)=>{h();var $=f("AUTHORIZATION ENDPOINT");o(t,$)},$$slots:{default:!0}});var T=l(N,2);S(T,{autocomplete:"off",placeholder:"Token Endpoint",width:v,get value(){return a().token_endpoint},set value(t){a(a().token_endpoint=t,!0)},get error(){return e(u).token_endpoint},set error(t){e(u).token_endpoint=t},$$events:{input:c},children:(t,k)=>{h();var $=f("TOKEN ENDPOINT");o(t,$)},$$slots:{default:!0}});var ge=l(T,2);S(ge,{autocomplete:"off",placeholder:"Userinfo Endpoint",width:v,get value(){return a().userinfo_endpoint},set value(t){a(a().userinfo_endpoint=t,!0)},get error(){return e(u).userinfo_endpoint},set error(t){e(u).userinfo_endpoint=t},$$events:{input:c},children:(t,k)=>{h();var $=f("USERINFO ENDPOINT");o(t,$)},$$slots:{default:!0}});var Ie=l(ge,4),Ne=p(Ie);ie(Ne,{get selected(){return a().use_pkce},set selected(t){a(a().use_pkce=t,!0)}}),m(Ie);var Le=l(Ie,4);S(Le,{autocomplete:"off",placeholder:"openid profile email",width:v,get value(){return a().scope},set value(t){a(a().scope=t,!0)},get error(){return e(u).scope},set error(t){e(u).scope=t},$$events:{input:c},children:(t,k)=>{h();var $=f("SCOPE");o(t,$)},$$slots:{default:!0}});var Ee=l(Le,4);S(Ee,{autocomplete:"off",placeholder:"Client Name",width:v,get value(){return a().name},set value(t){a(a().name=t,!0)},get error(){return e(u).name},set error(t){e(u).name=t},$$events:{input:c},children:(t,k)=>{h();var $=f("CLIENT NAME");o(t,$)},$$slots:{default:!0}});var Se=l(Ee,4);S(Se,{autocomplete:"off",placeholder:"Client ID",width:v,get value(){return a().client_id},set value(t){a(a().client_id=t,!0)},get error(){return e(u).client_id},set error(t){e(u).client_id=t},$$events:{input:c},children:(t,k)=>{h();var $=f("CLIENT ID");o(t,$)},$$slots:{default:!0}});var De=l(Se,4);ct(De,{get error(){return e(u).client_secret},autocomplete:"off",placeholder:"Client Secret",width:v,get value(){return a().client_secret},set value(t){a(a().client_secret=t,!0)},$$events:{input:c},children:(t,k)=>{h();var $=f("CLIENT SECRET");o(t,$)},$$slots:{default:!0}});var $e=l(De,4),ze=l(p($e),2);ie(ze,{get selected(){return a().client_secret_basic},set selected(t){a(a().client_secret_basic=t,!0)}}),m($e);var Ce=l($e,2),qe=l(p(Ce),2);ie(qe,{get selected(){return a().client_secret_post},set selected(t){a(a().client_secret_post=t,!0)}}),m(Ce);var O=l(Ce,2);mt(O);var Z=l(O,4);S(Z,{autocomplete:"off",placeholder:"$.roles.*",width:v,get value(){return a().admin_claim_path},set value(t){a(a().admin_claim_path=t,!0)},get error(){return e(u).admin_claim_path},set error(t){e(u).admin_claim_path=t},$$events:{input:c},children:(t,k)=>{h();var $=f("ADMIN CLAIM PATH");o(t,$)},$$slots:{default:!0}});var re=l(Z,2);S(re,{autocomplete:"off",placeholder:"rauthy_admin",width:v,get value(){return a().admin_claim_value},set value(t){a(a().admin_claim_value=t,!0)},get error(){return e(u).admin_claim_value},set error(t){e(u).admin_claim_value=t},$$events:{input:c},children:(t,k)=>{h();var $=f("ADMIN CLAIM VALUE");o(t,$)},$$slots:{default:!0}});var me=l(re,4);S(me,{autocomplete:"off",placeholder:"$.amr.*",width:v,get value(){return a().mfa_claim_path},set value(t){a(a().mfa_claim_path=t,!0)},get error(){return e(u).mfa_claim_path},set error(t){e(u).mfa_claim_path=t},$$events:{input:c},children:(t,k)=>{h();var $=f("MFA CLAIM PATH");o(t,$)},$$slots:{default:!0}});var J=l(me,2);S(J,{autocomplete:"off",placeholder:"mfa",width:v,get value(){return a().mfa_claim_value},set value(t){a(a().mfa_claim_value=t,!0)},get error(){return e(u).mfa_claim_value},set error(t){e(u).mfa_claim_value=t},$$events:{input:c},children:(t,k)=>{h();var $=f("MFA CLAIM VALUE");o(t,$)},$$slots:{default:!0}});var X=l(J,2),ee=p(X);Ut(ee,{get image(){return e(P)},set image(t){n(P,d(t))}});var W=l(ee,2);{var le=t=>{Xt(t,{get providerId(){return a().id}})};M(W,t=>{e(R)||t(le)})}m(X);var G=l(X,2);{var de=t=>{var k=ra(),$=te(k);fe($,{level:1,width:"4rem",get isLoading(){return e(R)},set isLoading(Q){n(R,d(Q))},$$events:{click:i},children:(Q,pe)=>{h();var ye=f("SAVE");o(Q,ye)},$$slots:{default:!0}});var ue=l($,2);{var be=Q=>{var pe=ta();o(Q,pe)};M(ue,Q=>{e(I)&&Q(be)})}var Oe=l(ue,2);{var xe=Q=>{var pe=aa(),ye=p(pe,!0);m(pe),oe(()=>ve(ye,e(b))),o(Q,pe)};M(Oe,Q=>{e(b)&&Q(xe)})}o(t,k)};M(G,t=>{t(de)})}m(s),oe(()=>ve(B,a().id)),o(H,s),_e()}var la=C("<p> </p>"),na=C(`<div class="label svelte-1tncxap"><p>This provider is in use by active users.</p> <p>You can force delete it, but users without a local password or passkey
                will not be able to log in anymore.</p> <details><summary>Linked Users</summary> <!></details></div> <div class="label svelte-1tncxap"><p>Are you sure you want to delete this provider?</p> <div class="forceDelete svelte-1tncxap">FORCE DELETE <!></div></div> <!>`,1),oa=C('<div class="label svelte-1tncxap">Are you sure, you want to delete this provider?</div> <!>',1),ca=C('<div class="err svelte-1tncxap"> </div>'),da=C('<div class="container svelte-1tncxap"><!> <!></div>');function ua(H,g){he(g,!0);let a=se(g,"provider",19,()=>({})),v=L(!0),R=L(""),b=L(!1),I=L(d([]));Pe(async()=>{let c=await Nt(a().id),s=await c.json();c.status===406?n(I,d(s)):n(R,d(s.message)),n(v,!1)});async function w(){n(R,""),n(v,!0);let c=await Lt(a().id);if(c.ok)g.onSave();else{let s=await c.json();n(R,d(s.message))}n(v,!1)}var D=da(),P=p(D);{var u=c=>{var s=na(),E=te(s),K=l(p(E),4),B=l(p(K),2);it(B,17,()=>e(I),F=>F.id,(F,Y)=>{var ne=la(),N=p(ne);m(ne),oe(()=>ve(N,`${e(Y).id??""} ${e(Y).email??""}`)),o(F,ne)}),m(K),m(E);var U=l(E,2),V=l(p(U),2),q=l(p(V));ie(q,{get selected(){return e(b)},set selected(F){n(b,d(F))}}),m(V),m(U);var j=l(U,2);{var ce=F=>{fe(F,{level:1,get isLoading(){return e(v)},set isLoading(Y){n(v,d(Y))},$$events:{click:w},children:(Y,ne)=>{h();var N=f("DELETE");o(Y,N)},$$slots:{default:!0}})};M(j,F=>{e(b)&&F(ce)})}o(c,s)},_=c=>{var s=oa(),E=l(te(s),2);fe(E,{level:1,get isLoading(){return e(v)},set isLoading(K){n(v,d(K))},$$events:{click:w},children:(K,B)=>{h();var U=f("DELETE");o(K,U)},$$slots:{default:!0}}),o(c,s)};M(P,c=>{e(I).length>0?c(u):c(_,!1)})}var i=l(P,2);{var z=c=>{var s=ca(),E=p(s,!0);m(s),oe(()=>ve(E,e(R))),o(c,s)};M(i,c=>{e(R)&&c(z)})}m(D),o(H,D),_e()}var va=C('<div class="data font-mono svelte-115hohv"> </div>'),ma=C('<div class="data svelte-115hohv"> </div>'),pa=C('<div class="header svelte-115hohv"><!> <!></div>'),ha=C("<div><!></div>"),_a=C("<div><!></div>"),fa=C("<div><!> <!></div>");function ga(H,g){he(g,!0);let a=se(g,"provider",31,()=>d({})),v=se(g,"onSave",15),R=L(void 0);const b=["Config","Delete"];let I=L(d(b[0]));const w=200,D=w/2;lt(H,{get show(){return e(R)},set show(P){n(R,d(P))},header:P=>{var u=pa(),_=p(u);ut(_,{text:"Provider ID",children:(z,c)=>{var s=va(),E=p(s,!0);m(s),oe(()=>ve(E,a().id)),o(z,s)},$$slots:{default:!0}});var i=l(_,2);ut(i,{text:"Provider Name",children:(z,c)=>{var s=ma(),E=p(s,!0);m(s),oe(()=>ve(E,a().name)),o(z,s)},$$slots:{default:!0}}),m(u),o(P,u)},body:P=>{var u=fa(),_=p(u);Pt(_,{labels:b,get selected(){return e(I)},set selected(s){n(I,d(s))}});var i=l(_,2);{var z=s=>{var E=ha(),K=p(E);ia(K,{get provider(){return a()},set provider(B){a(B)},get onSave(){return v()},set onSave(B){v(B)}}),m(E),Re(1,E,()=>Te,()=>({delay:D,duration:w})),Re(2,E,()=>Te,()=>({duration:w})),o(s,E)},c=s=>{var E=Ge(),K=te(E);{var B=U=>{var V=_a(),q=p(V);ua(q,{get provider(){return a()},set provider(j){a(j)},get onSave(){return v()},set onSave(j){v(j)}}),m(V),Re(1,V,()=>Te,()=>({delay:D,duration:w})),Re(2,V,()=>Te,()=>({duration:w})),o(U,V)};M(K,U=>{e(I)==="Delete"&&U(B)},!0)}o(s,E)};M(i,s=>{e(I)==="Config"?s(z):s(c,!1)})}m(u),o(P,u)},$$slots:{header:!0,body:!0}}),_e()}var $a=C('<div class="svelte-4dnryh"><!></div>'),ba=C(' <div class="content"><!> <div id="federation" class="svelte-4dnryh"></div> <div style="height: 20px"></div></div>',1);function wa(H,g){he(g,!0);let a=L(""),v=L(d([]));Pe(()=>{R()});async function R(){let _=await St(),i=await _.json();_.ok?n(v,d([...i])):n(a,d(i.message))}function b(){R()}h();var I=ba(),w=te(I),D=l(w),P=p(D);Wt(P,{onSave:b});var u=l(P,2);it(u,23,()=>e(v),_=>_.id,(_,i,z)=>{var c=$a(),s=p(c);ga(s,{onSave:b,get provider(){return e(v)[e(z)]},set provider(E){e(v)[e(z)]=E}}),m(c),o(_,c)}),m(u),h(2),m(D),oe(()=>ve(w,`${e(a)??""} `)),o(H,I),_e()}function Ia(H){wa(H,{})}export{Ia as component};
