import"../chunks/disclose-version.BDr9Qe-U.js";import{f as j,p as Ee,c as r,r as a,s as v,y as e,t as y,a as qe,ab as ke,ar as fe,A as E,z as n,ap as sa,a6 as Qe,aq as Ja}from"../chunks/index-client.CVQra9Cu.js";import{h as Xa}from"../chunks/svelte-head.Cv719s3a.js";import{e as ge,a as i,t as I,d as we,n as ja}from"../chunks/template.4ZWi6dE6.js";import{i as k}from"../chunks/if._4yhN2kP.js";import{p as h}from"../chunks/proxy.Dc6q2r8X.js";import{s as l,d as Oa}from"../chunks/render.CkKFmY3E.js";import{b as Ya}from"../chunks/window.jqEf7WoA.js";import{p as $e}from"../chunks/props.BVYR8gU-.js";import{l as Ge,V as da,_ as Qa,P as Za,I as er,z as ar,W as rr,D as tr,r as sr}from"../chunks/helpers.B0e_YzoL.js";import{e as ka}from"../chunks/each.D7w_Y1pv.js";import{h as $a}from"../chunks/html.DBwFzVLh.js";import{a as K,c as G,s as We,t as xa,r as vr}from"../chunks/class.BnbJV1WX.js";import{I as va}from"../chunks/IconCheck.jhQYM7vu.js";import{I as nr}from"../chunks/IconStop.DlqoW6sr.js";import{B as xe}from"../chunks/Button.B6DffihK.js";import{M as or}from"../chunks/Modal.BoPoPiDZ.js";import{u as Ae}from"../chunks/i18n.svelte.DVZudxvm.js";import{c as ir,b as _a,d as Ia,f as Ze}from"../chunks/fetch.B_P4c8fm.js";import{B as lr}from"../chunks/ButtonAuthProvider.avA5-tta.js";import{t as Ue,f as He,a as ua,s as cr}from"../chunks/index.CkVfMYgG.js";import{I as Te}from"../chunks/Input.kE1yFgI6.js";import{F as dr}from"../chunks/Form.9PZRDz5w.js";import{a as pa,k as ur,l as Ca,m as pr}from"../chunks/patterns.DpOwmcHv.js";import{I as mr}from"../chunks/InputDateTimeCombo.Rc-MRb7l.js";import{w as fr,d as gr,e as hr}from"../chunks/dataFetching.DIr6exGg.js";import{u as Pa}from"../chunks/session.svelte.DKWvbSSq.js";import{w as wr}from"../chunks/registration.BWnHuFT6.js";import{W as za}from"../chunks/WebauthnRequest.g8yijDni.js";import{T as yr}from"../chunks/Tooltip.Q92keWA_.js";import{P as br}from"../chunks/PasswordPolicy.C-eS1uVN.js";import{I as ma}from"../chunks/InputPassword.BoC-LeDj.js";import{C as kr}from"../chunks/CheckIcon.BEZpWWv8.js";import{s as $r}from"../chunks/snippet.BBxd9sB6.js";import{a as xr}from"../chunks/input.DW316tIw.js";import{A as _r}from"../chunks/A.BxAeTR7E.js";import{I as Ir}from"../chunks/InputArea.CPIIXA8-.js";import"../chunks/legacy.Dmu0D13_.js";import{D as Ma}from"../chunks/Devices.DvoOTJH_.js";import{T as Cr}from"../chunks/Template.DyugG9eh.js";import{u as Pr}from"../chunks/param.svelte.CY-AzddN.js";import{T as Na}from"../chunks/Tabs.BGGYqHwk.js";import{M as zr}from"../chunks/Main.Caps8oUu.js";import{C as Mr}from"../chunks/ContentCenter.DfrWDKi1.js";import{T as Nr,L as Er}from"../chunks/LangSelector.Dpy0n1ms.js";function fa(ee,p){var s=ge(),t=j(s);{var q=C=>{va(C,{color:"hsl(var(--action))"})},o=C=>{nr(C,{color:"hsl(var(--error))"})};k(t,C=>{p.checked?C(q):C(o,!1)})}i(ee,s)}var qr=I('<div class="link-err value svelte-1tea8v4"> </div>'),Tr=I('<div class="fed-btn svelte-1tea8v4"><!> <!></div>'),Lr=I('<h3> </h3> <p> </p> <div class="providers svelte-1tea8v4"></div>',1),Dr=I("<!> <!>",1),Vr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Wr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Ar=I('<div><div>WebID:</div> <span class="value svelte-1tea8v4"><a target="_blank"><!></a></span></div>'),Br=I('<div><div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <div><div class="value svelte-1tea8v4"> </div> <!></div></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <!> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <!> <!></div>');function Ea(ee,p){Ee(p,!0);let s=$e(p,"user",15),t=Ae(),q=E(!1),o=E(!1),C=ke(()=>{var B;return(B=s().account_type)==null?void 0:B.startsWith("federated")}),$=ke(()=>{var B;return e(C)?`${s().account_type}: ${((B=p.authProvider)==null?void 0:B.name)||""}`:s().account_type}),d=ke(()=>p.viewModePhone?"rowPhone":"row"),w=ke(()=>p.viewModePhone?"labelPhone":"label");function u(B){Qa(64,(re,{challenge:ce,verifier:he})=>{re||(localStorage.setItem(Za,he),O(B,ce))})}async function O(B,re){let ce={email:s().email,client_id:"rauthy",redirect_uri:window.location.href,provider_id:B,pkce_challenge:re},he=await _a(`/auth/v1/providers/${B}/link`,ce);if(he.text){er(he.text);let me=he.headers.get("location");me&&(window.location.href=me)}else console.error(he.error)}async function R(){let B=await ir("/auth/v1/providers/link");B.body?s(B.body):(console.error(B.error),n(q,!0))}var T=Br(),H=r(T),ae=r(H),ie=r(ae,!0);a(ae);var z=v(ae,2),M=r(z,!0);a(z),a(H);var U=v(H,2),Y=r(U),le=r(Y,!0);a(Y);var ve=v(Y,2),ne=r(ve,!0);a(ve),a(U);var Z=v(U,2),g=r(Z),m=r(g,!0);a(g);var P=v(g,2),c=r(P,!0);a(P),a(Z);var S=v(Z,2),te=r(S),ue=r(te);a(te);var f=v(te,2),D=r(f,!0);a(f),a(S);var V=v(S,2),L=r(V),A=r(L,!0);a(L);var Q=v(L,2),F=r(Q),de=r(F,!0);a(F);var se=v(F,2);{var ye=B=>{var re=Tr(),ce=r(re);xe(ce,{get ariaLabel(){return t.account.providerUnlink},level:3,onclick:R,children:(Ce,Be)=>{fe();var Ke=we();y(()=>l(Ke,t.account.providerUnlink)),i(Ce,Ke)},$$slots:{default:!0}});var he=v(ce,2);{var me=Ce=>{var Be=qr(),Ke=r(Be,!0);a(Be),y(()=>l(Ke,t.account.providerUnlinkDesc)),i(Ce,Be)};k(he,Ce=>{e(q)&&Ce(me)})}a(re),i(B,re)},W=B=>{var re=ge(),ce=j(re);{var he=me=>{var Ce=Dr(),Be=j(Ce);xe(Be,{level:2,onclick:()=>n(o,!0),children:(Oe,Ra)=>{fe();var Ye=we();y(()=>l(Ye,t.account.providerLink)),i(Oe,Ye)},$$slots:{default:!0}});var Ke=v(Be,2);or(Ke,{get showModal(){return e(o)},set showModal(Oe){n(o,h(Oe))},children:(Oe,Ra)=>{var Ye=Lr(),ia=j(Ye),Ka=r(ia,!0);a(ia);var la=v(ia,2),Ga=r(la,!0);a(la);var ya=v(la,2);ka(ya,21,()=>p.providers,ca=>ca.id,(ca,ba)=>{var Ha=ke(()=>`${t.account.providerLink}: ${e(ba).name}`);lr(ca,{get ariaLabel(){return e(Ha)},get provider(){return e(ba)},onclick:u})}),a(ya),y(()=>{l(Ka,t.account.providerLink),l(Ga,t.account.providerLinkDesc)}),i(Oe,Ye)},$$slots:{default:!0}}),i(me,Ce)};k(ce,me=>{p.providers.length>0&&me(he)},!0)}i(B,re)};k(se,B=>{e(C)?B(ye):B(W,!1)})}a(Q),a(V);var x=v(V,2),b=r(x),N=r(b,!0);a(b);var J=v(b,2),pe=r(J,!0);a(J),a(x);var _=v(x,2),X=r(_),oe=r(X,!0);a(X);var _e=v(X,2),Ie=r(_e,!0);a(_e),a(_);var be=v(_,2),Pe=r(be),Je=r(Pe,!0);a(Pe);var Se=v(Pe,2),ea=ke(()=>!!s().webauthn_user_id);fa(Se,{get checked(){return e(ea)}}),a(be);var ze=v(be,2),Le=r(ze),na=r(Le,!0);a(Le);var aa=v(Le,2);fa(aa,{get checked(){return s().enabled}}),a(ze);var Fe=v(ze,2),Re=r(Fe),oa=r(Re,!0);a(Re);var Ne=v(Re,2);fa(Ne,{get checked(){return s().email_verified}}),a(Fe);var De=v(Fe,2);{var Xe=B=>{var re=Vr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,Ge(s().last_login))),a(me),a(re),y(()=>{K(re,G(e(d)),"svelte-1tea8v4"),K(ce,G(e(w)),"svelte-1tea8v4"),l(he,t.account.lastLogin)}),i(B,re)};k(De,B=>{s().last_login&&B(Xe)})}var Me=v(De,2),Ve=r(Me),ga=r(Ve,!0);a(Ve);var je=v(Ve,2),Wa=r(je,!0);y(()=>l(Wa,s().password_expires&&Ge(s().password_expires)||t.common.never)),a(je),a(Me);var ra=v(Me,2),ta=r(ra),Aa=r(ta,!0);a(ta);var ha=v(ta,2),Ba=r(ha,!0);y(()=>l(Ba,Ge(s().created_at))),a(ha),a(ra);var wa=v(ra,2);{var Ua=B=>{var re=Wr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,Ge(s().user_expires))),a(me),a(re),y(()=>{K(re,G(e(d)),"svelte-1tea8v4"),K(ce,G(e(w)),"svelte-1tea8v4"),l(he,t.account.userExpiry)}),i(B,re)};k(wa,B=>{s().user_expires&&B(Ua)})}var Sa=v(wa,2);{var Fa=B=>{var re=Ar(),ce=r(re),he=v(ce,2),me=r(he);y(()=>We(me,"href",da(s().id)));var Ce=r(me);$a(Ce,()=>da(s().id).replace("/auth/","/auth/<wbr/>")),a(me),a(he),a(re),y(()=>{K(re,G(e(d)),"svelte-1tea8v4"),K(ce,G(e(w)),"svelte-1tea8v4")}),i(B,re)};k(Sa,B=>{p.webIdData&&B(Fa)})}a(T),y(()=>{K(H,G(e(d)),"svelte-1tea8v4"),K(ae,G(e(w)),"svelte-1tea8v4"),l(ie,t.common.email),l(M,s().email),K(U,G(e(d)),"svelte-1tea8v4"),K(Y,G(e(w)),"svelte-1tea8v4"),l(le,t.account.givenName),l(ne,s().given_name),K(Z,G(e(d)),"svelte-1tea8v4"),K(g,G(e(w)),"svelte-1tea8v4"),l(m,t.account.familyName),l(c,s().family_name),K(S,G(e(d)),"svelte-1tea8v4"),K(te,G(e(w)),"svelte-1tea8v4"),l(ue,`${t.account.user??""} ID`),l(D,s().id),K(V,G(e(d)),"svelte-1tea8v4"),K(L,G(e(w)),"svelte-1tea8v4"),l(A,t.account.accType),l(de,e($)||""),K(x,G(e(d)),"svelte-1tea8v4"),K(b,G(e(w)),"svelte-1tea8v4"),l(N,t.account.roles),l(pe,s().roles||"None"),K(_,G(e(d)),"svelte-1tea8v4"),K(X,G(e(w)),"svelte-1tea8v4"),l(oe,t.account.groups),l(Ie,s().groups||"None"),K(be,G(e(d)),"svelte-1tea8v4"),K(Pe,G(e(w)),"svelte-1tea8v4"),l(Je,t.account.mfaActivated),K(ze,G(e(d)),"svelte-1tea8v4"),K(Le,G(e(w)),"svelte-1tea8v4"),l(na,t.account.userEnabled),K(Fe,G(e(d)),"svelte-1tea8v4"),K(Re,G(e(w)),"svelte-1tea8v4"),l(oa,t.account.emailVerified),K(Me,G(e(d)),"svelte-1tea8v4"),K(Ve,G(e(w)),"svelte-1tea8v4"),l(ga,t.account.passwordExpiry),K(ra,G(e(d)),"svelte-1tea8v4"),K(ta,G(e(w)),"svelte-1tea8v4"),l(Aa,t.account.userCreated)}),i(ee,T),qe()}var Ur=I('<div class="success svelte-4ogr3z"><!></div>'),Sr=I("<p> </p>"),Fr=I('<div class="err svelte-4ogr3z"> </div>'),Rr=I('<div class="formInner svelte-4ogr3z"><div><!> <!> <!> <!></div> <div><!> <!> <!> <!> <!></div></div> <div class="bottom svelte-4ogr3z"><div><!></div> <!></div> <!>',1),Kr=I('<div class="container svelte-4ogr3z"><!></div>');function qa(ee,p){var O;Ee(p,!0);let s=$e(p,"user",15);(O=s().user_values)!=null&&O.birthdate||s(s().user_values.birthdate="",!0);let t=Ae(),q=E(""),o=E(!1),C=E(!1);async function $(R,T){var m;const H=T.get("email"),ae=T.get("family_name")||void 0,ie=T.get("given_name")||void 0,z=T.get("birthdate")||void 0,M=((m=T.get("phone"))==null?void 0:m.replaceAll(" ",""))||void 0,U=T.get("street")||void 0,Y=T.get("zip")||void 0,le=Y?Number.parseInt(Y):void 0,ve=T.get("city")||void 0,ne=T.get("country")||void 0;let Z={email:H,family_name:ae,given_name:ie,user_values:{birthdate:z,phone:M,street:U,zip:le,city:ve,country:ne}},g=await Ia(`/auth/v1/users/${s().id}/self`,Z);if(g.body){n(o,!0),s(g.body);let P=3e3;g.status===202&&(n(C,!0),P=3e4),setTimeout(()=>{n(o,!1)},P)}else g.error&&(console.error(g.error),n(q,h(g.error.message)))}var d=Kr(),w=r(d),u=ke(()=>`/auth/v1/users/${s().id}/self`);dr(w,{get action(){return e(u)},onSubmit:$,children:(R,T)=>{var H=Rr(),ae=j(H),ie=r(ae),z=r(ie);Te(z,{typ:"email",name:"email",get label(){return t.common.email},get placeholder(){return t.common.email},get value(){return s().email},required:!0});var M=v(z,2);Te(M,{name:"given_name",autocomplete:"given-name",get label(){return t.account.givenName},get placeholder(){return t.account.givenName},get value(){return s().given_name},required:!0,maxLength:32,pattern:pa});var U=v(M,2);Te(U,{name:"family_name",autocomplete:"family-name",get label(){return t.account.familyName},get placeholder(){return t.account.familyName},get value(){return s().family_name},maxLength:32,pattern:pa});var Y=v(U,2);mr(Y,{name:"birthdate",get label(){return t.account.birthdate},withDelete:!0,get value(){return s().user_values.birthdate},set value(L){s(s().user_values.birthdate=L,!0)}}),a(ie);var le=v(ie,2),ve=r(le);Te(ve,{name:"street",autocomplete:"street-address",get label(){return t.account.street},get placeholder(){return t.account.street},get value(){return s().user_values.street},maxLength:48,pattern:ur});var ne=v(ve,2);Te(ne,{typ:"number",name:"zip",autocomplete:"postal-code",get label(){return t.account.zip},get placeholder(){return t.account.zip},get value(){return s().user_values.zip},min:"1000",max:"9999999"});var Z=v(ne,2);Te(Z,{name:"city",autocomplete:"address-level2",get label(){return t.account.city},get placeholder(){return t.account.city},get value(){return s().user_values.city},maxLength:48,pattern:Ca});var g=v(Z,2);Te(g,{name:"country",autocomplete:"country",get label(){return t.account.country},get placeholder(){return t.account.country},get value(){return s().user_values.country},maxLength:48,pattern:Ca});var m=v(g,2);Te(m,{name:"phone",autocomplete:"tel",get label(){return t.account.phone},get placeholder(){return t.account.phone},get value(){return s().user_values.phone},maxLength:32,pattern:pr}),a(le),a(ae);var P=v(ae,2),c=r(P),S=r(c);xe(S,{type:"submit",children:(L,A)=>{fe();var Q=we();y(()=>l(Q,t.common.save)),i(L,Q)},$$slots:{default:!0}}),a(c);var te=v(c,2);{var ue=L=>{var A=Ur(),Q=r(A);va(Q,{}),a(A),Ue(3,A,()=>He),i(L,A)};k(te,L=>{e(o)&&L(ue)})}a(P);var f=v(P,2);{var D=L=>{var A=Sr(),Q=r(A,!0);a(A),y(()=>l(Q,t.account.emailUpdateConfirm)),i(L,A)},V=L=>{var A=ge(),Q=j(A);{var F=de=>{var se=Fr(),ye=r(se,!0);a(se),y(()=>l(ye,e(q))),Ue(3,se,()=>He),i(de,se)};k(Q,de=>{e(q)&&de(F)},!0)}i(L,A)};k(f,L=>{e(C)?L(D):L(V,!1)})}i(R,H)},$$slots:{default:!0}}),a(d),i(ee,d),qe()}var Gr=ja('<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7.864 4.243A7.5 7.5 0 0119.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 004.5 10.5a7.464 7.464 0 01-1.15 3.993m1.989 3.559A11.209 11.209 0 008.25 10.5a3.75 3.75 0 117.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 01-3.6 9.75m6.633-4.596a18.666 18.666 0 01-2.485 5.33"></path></svg>');function Hr(ee,p){let s=$e(p,"opacity",3,.9),t=$e(p,"width",3,24),q=$e(p,"color",3,"currentColor");var o=Gr();We(o,"stroke-width",2),y(()=>{We(o,"stroke",q()),We(o,"width",t()),We(o,"opacity",s())}),i(ee,o)}var Jr=I('<div class="err svelte-qkgdvy"><b>Your browser does not support Webauthn credentials and must be updated.</b></div>'),Xr=I('<!> <div class="regBtns svelte-qkgdvy"><!> <!></div>',1),jr=I('<div class="regNewBtn svelte-qkgdvy"><!></div>'),Or=I('<div class="keysHeader svelte-qkgdvy"> </div>'),Yr=I("<div><!></div>"),Qr=I('<div class="row svelte-qkgdvy"><div></div> <div class="deleteBtn svelte-qkgdvy"><!></div></div>'),Zr=I('<div class="keyContainer svelte-qkgdvy"><div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <div class="nameUv svelte-qkgdvy"><b> </b> <!></div></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <!></div>'),et=I('<div class="button svelte-qkgdvy"><!></div>'),at=I('<!> <p class="svelte-qkgdvy"> <br><br> </p> <!> <!> <div class="keysContainer svelte-qkgdvy"></div> <!> <div class="svelte-qkgdvy"> </div>',1),rt=I('<div class="container svelte-qkgdvy"><!></div>');function Ta(ee,p){Ee(p,!0);const s="credentials"in navigator;let t=Ae(),q=Pa("account"),o=ke(()=>{var g;return(g=q.get())==null?void 0:g.user_id}),C=E(void 0),$=E(!1),d=E(""),w=E(!1),u=E(p.user.account_type==="password"),O=E(void 0),R=E(""),T=E(!1),H=E(h([]));sa(()=>{ie()}),Qe(()=>{e(H).length>0&&p.user.account_type==="passkey"&&n(u,e(H).length>1)}),Qe(()=>{var g;(g=e(C))==null||g.focus()});function ae(){n($,!1),n(d,"")}async function ie(){var m;let g=await Ze(`/auth/v1/users/${(m=q.get())==null?void 0:m.user_id}/webauthn`);g.body?n(H,h(g.body)):console.error(g.error)}async function z(){if(ae(),e(T)||!e(o))return;if(e(R).length<1){n($,!0),n(d,h(t.mfa.passkeyNameErr));return}let g=await wr(e(o),e(R),t.authorize.invalidKeyUsed,t.authorize.requestExpired);g.error?(n($,!0),n(d,`${t.mfa.errorReg} - ${g.error}`)):(n(w,!1),n(R,""),await ie())}async function M(g){let m=await fr(p.user.id,g);if(m.status===200)await ie();else{let P=await m.json();n($,!0),n(d,h(P.message))}}function U(g){n(O,void 0),n($,!0),n(d,h(g)),setTimeout(()=>{n($,!1),n(d,"")},5e3)}function Y(g){n(O,void 0),n(d,h(t.mfa.testSuccess)),setTimeout(()=>{n(d,"")},3e3)}var le=rt(),ve=r(le);{var ne=g=>{var m=Jr();i(g,m)},Z=g=>{var m=at(),P=j(m);{var c=W=>{za(W,{get userId(){return p.user.id},get purpose(){return e(O)},onSuccess:Y,onError:U})};k(P,W=>{e(O)&&W(c)})}var S=v(P,2),te=r(S),ue=v(te,3);a(S);var f=v(S,2);{var D=W=>{var x=Xr(),b=j(x);Te(b,{autocomplete:"off",get label(){return t.mfa.passkeyName},get placeholder(){return t.mfa.passkeyName},maxLength:32,pattern:pa,onEnter:z,get ref(){return e(C)},set ref(_){n(C,h(_))},get value(){return e(R)},set value(_){n(R,h(_))},get isError(){return e(T)},set isError(_){n(T,h(_))}});var N=v(b,2),J=r(N);xe(J,{onclick:z,children:(_,X)=>{fe();var oe=we();y(()=>l(oe,t.mfa.register)),i(_,oe)},$$slots:{default:!0}});var pe=v(J,2);xe(pe,{level:3,onclick:()=>n(w,!1),children:(_,X)=>{fe();var oe=we();y(()=>l(oe,t.common.cancel)),i(_,oe)},$$slots:{default:!0}}),a(N),i(W,x)},V=W=>{var x=jr(),b=r(x),N=ke(()=>e(H).length===0?1:2);xe(b,{get level(){return e(N)},onclick:()=>n(w,!0),children:(J,pe)=>{fe();var _=we();y(()=>l(_,t.mfa.registerNew)),i(J,_)},$$slots:{default:!0}}),a(x),i(W,x)};k(f,W=>{e(w)?W(D):W(V,!1)})}var L=v(f,2);{var A=W=>{var x=Or(),b=r(x,!0);a(x),y(()=>l(b,t.mfa.registerdKeys)),i(W,x)};k(L,W=>{e(H).length>0&&W(A)})}var Q=v(L,2);ka(Q,21,()=>e(H),W=>W.name,(W,x)=>{var b=Zr(),N=r(b),J=r(N),pe=r(J,!0);a(J);var _=v(J,2),X=r(_),oe=r(X,!0);a(X);var _e=v(X,2);{var Ie=Ne=>{yr(Ne,{get text(){return t.account.userVerifiedTooltip},children:(De,Xe)=>{var Me=Yr();ua(Me,"margin-bottom","-.25rem");var Ve=r(Me);Hr(Ve,{width:18,color:"var(--col-acnt)"}),a(Me),i(De,Me)},$$slots:{default:!0}})};k(_e,Ne=>{e(x).user_verified&&Ne(Ie)})}a(_),a(N);var be=v(N,2),Pe=r(be),Je=r(Pe,!0);a(Pe);var Se=v(Pe,2),ea=r(Se,!0);y(()=>l(ea,Ge(e(x).registered))),a(Se),a(be);var ze=v(be,2),Le=r(ze),na=r(Le,!0);a(Le);var aa=v(Le,2),Fe=r(aa,!0);y(()=>l(Fe,Ge(e(x).last_used))),a(aa),a(ze);var Re=v(ze,2);{var oa=Ne=>{var De=Qr(),Xe=v(r(De),2),Me=r(Xe);xe(Me,{level:-3,onclick:()=>M(e(x).name),children:(Ve,ga)=>{fe();var je=we();y(()=>l(je,t.common.delete)),i(Ve,je)},$$slots:{default:!0}}),a(Xe),a(De),i(Ne,De)};k(Re,Ne=>{e(u)&&Ne(oa)})}a(b),y(()=>{l(pe,t.mfa.passkeyName),l(oe,e(x).name),l(Je,t.mfa.registerd),l(na,t.mfa.lastUsed)}),i(W,b)}),a(Q);var F=v(Q,2);{var de=W=>{var x=et(),b=r(x);xe(b,{onclick:()=>n(O,"Test"),children:(N,J)=>{fe();var pe=we();y(()=>l(pe,t.mfa.test)),i(N,pe)},$$slots:{default:!0}}),a(x),i(W,x)};k(F,W=>{e(H).length>0&&W(de)})}var se=v(F,2),ye=r(se,!0);a(se),y(()=>{l(te,`${t.mfa.p1??""} `),l(ue,` ${t.mfa.p2??""}`),xa(se,"success",!e($)),xa(se,"err",e($)),l(ye,e(d))}),i(g,m)};k(ve,g=>{s?g(Z,!1):g(ne)})}a(le),i(ee,le),qe()}var tt=I('<div class="container svelte-ue7bk2"><!> <!> <!> <!> <div class="btn svelte-ue7bk2"><!></div> <div class="err svelte-ue7bk2"> </div></div>');function st(ee,p){Ee(p,!0);let s=$e(p,"passwords",15),t=$e(p,"hideCurrentPassword",3,!1),q=$e(p,"isValid",15),o=Ae();q(R);let C=E(!1),$=E(""),d=E(void 0),w=ke(()=>{var z;return((z=s().new)==null?void 0:z.length)>6&&s().new===s().newConfirm}),u=E(void 0),O=E(void 0);sa(async()=>{let z=await Ze("/auth/v1/password_policy");z.body?n(d,h(z.body)):console.error(z.error)});function R(){return n($,""),!t()&&!s().current?(n($,h(o.account.passwordCurrReq)),!1):s().new?s().newConfirm?e(C)?s().new.length>256?(n($,"max 256"),!1):s().new!==s().newConfirm?(n($,h(o.account.passwordNoMatch)),!1):!0:(n($,h(o.account.passwordPolicyFollow)),!1):(n($,h(o.account.passwordNewReq)),!1):(n($,h(o.account.passwordNewReq)),!1)}function T(){if(n($,""),e(d)){let z=ar(e(d));s(s().new=z,!0),s(s().newConfirm=z,!0)}requestAnimationFrame(()=>{var z,M;(z=e(u))==null||z(),(M=e(O))==null||M()})}var H=ge(),ae=j(H);{var ie=z=>{var M=tt(),U=r(M);br(U,{get policy(){return e(d)},get password(){return s().new},get accepted(){return e(C)},set accepted(c){n(C,h(c))}});var Y=v(U,2);{var le=c=>{ma(c,{autocomplete:"current-password",get label(){return o.account.passwordCurr},get placeholder(){return o.account.passwordCurr},onInput:R,get width(){return p.inputWidth},get value(){return s().current},set value(S){s(s().current=S,!0)}})};k(Y,c=>{t()||c(le)})}var ve=v(Y,2);ma(ve,{autocomplete:"new-password",get label(){return o.account.passwordNew},get placeholder(){return o.account.passwordNew},onInput:R,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().new},set value(c){s(s().new=c,!0)},get reportValidity(){return e(u)},set reportValidity(c){n(u,h(c))}});var ne=v(ve,2);ma(ne,{autocomplete:"new-password",get label(){return o.account.passwordConfirm},get placeholder(){return o.account.passwordConfirm},onInput:R,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().newConfirm},set value(c){s(s().newConfirm=c,!0)},get reportValidity(){return e(O)},set reportValidity(c){n(O,h(c))}});var Z=v(ne,2),g=r(Z);xe(g,{onclick:T,level:2,children:(c,S)=>{fe();var te=we();y(()=>l(te,o.account.generateRandom)),i(c,te)},$$slots:{default:!0}}),a(Z);var m=v(Z,2),P=r(m,!0);a(m),a(M),y(()=>l(P,e($))),i(z,M)};k(ae,z=>{e(d)&&z(ie)})}return i(ee,H),qe({isPwdValid:R})}var vt=I('<div class="m-05 svelte-1h4zvzu"><p> </p> <p><b> </b></p> <div></div> <p> </p> <!></div>'),nt=I("<p> </p> <p> </p> <p> </p> <div><!></div>",1),ot=I('<div class="success svelte-1h4zvzu"><!></div>'),it=I('<div class="err"> </div>'),lt=I('<div class="cancel"><!></div>'),ct=I('<div class="convertPasskey svelte-1h4zvzu"><h3> </h3> <p> </p> <!></div>'),dt=I('<div><!> <div class="save svelte-1h4zvzu"><!> <!></div></div> <!>',1),ut=I('<div class="container svelte-1h4zvzu"><!> <!> <!> <!></div>');function La(ee,p){Ee(p,!0);let s=$e(p,"user",15),t=Ae(),q=ke(()=>p.viewModePhone?"calc(100vw - 1.5rem)":"300px"),o=E(h(s().account_type)),C=E(h([])),$=E(void 0),d=E(!1),w=E(!1),u=E(""),O=E(!1),R=E(void 0),T=E(h({current:"",new:"",newConfirm:""})),H=ke(()=>e(C).filter(f=>f.user_verified).length>0);sa(()=>{ae()});async function ae(){let f=await Ze(`/auth/v1/users/${s().id}/webauthn`);f.body?n(C,h(f.body)):console.error("error fetching passkeys: "+f.error)}async function ie(){let f=await _a(`/auth/v1/users/${s().id}/self/convert_passkey`);f.error?console.error("error fetching passkeys: "+f.error):window.location.reload()}async function z(){n(u,""),e(C).length>0?await M():await U()}async function M(){var f;if(!((f=e($))!=null&&f())){n(u,h(t.common.invalidInput));return}n(R,"PasswordNew")}async function U(f){var L,A;if(!((L=e($))!=null&&L())){n(u,h(t.common.invalidInput));return}n(w,!0);let D={password_new:e(T).new};f?D.mfa_code=f:D.password_current=e(T).current;let V=await Ia(`/auth/v1/users/${s().id}/self`,D);V.body?(n(O,!0),n(T,h({current:"",new:"",newConfirm:""})),s(V.body),n(o,h(V.body.account_type)),setTimeout(()=>{n(O,!1),n(d,!1)},3e3)):n(u,h(((A=V.error)==null?void 0:A.message)||"Error")),n(w,!1)}function Y(f){n(R,void 0),n(u,h(f)),setTimeout(()=>{n(u,"")},5e3)}function le(f){n(R,void 0),f&&"code"in f&&U(f.code)}async function ve(){let f=await gr({email:s().email});if(f.ok)n(O,!0);else{let D=await f.json();n(u,h(D.message))}}var ne=ut(),Z=r(ne);{var g=f=>{za(f,{get userId(){return s().id},get purpose(){return e(R)},onSuccess:le,onError:Y})};k(Z,f=>{e(R)&&f(g)})}var m=v(Z,2);{var P=f=>{var D=vt(),V=r(D),L=r(V,!0);a(V);var A=v(V,2),Q=r(A),F=r(Q,!0);a(Q),a(A);var de=v(A,2);ua(de,"height",".3rem");var se=v(de,2),ye=r(se,!0);a(se);var W=v(se,2);{var x=N=>{kr(N,{check:!0})},b=N=>{xe(N,{level:2,onclick:ve,children:(J,pe)=>{fe();var _=we();y(()=>l(_,t.account.passwordReset)),i(J,_)},$$slots:{default:!0}})};k(W,N=>{e(O)?N(x):N(b,!1)})}a(D),y(()=>{var N;l(L,t.account.federatedConvertPassword1),l(F,((N=p.authProvider)==null?void 0:N.name)||"UNKNOWN"),l(ye,t.account.federatedConvertPassword2)}),i(f,D)};k(m,f=>{e(o)==="federated"&&f(P)})}var c=v(m,2);{var S=f=>{var D=nt(),V=j(D),L=r(V,!0);a(V);var A=v(V,2),Q=r(A,!0);a(A);var F=v(A,2),de=r(F,!0);a(F);var se=v(F,2),ye=r(se);xe(ye,{level:2,onclick:()=>n(d,!0),children:(W,x)=>{fe();var b=we();y(()=>l(b,t.account.convertAccount)),i(W,b)},$$slots:{default:!0}}),a(se),y(()=>{l(L,t.account.accTypePasskeyText1),l(Q,t.account.accTypePasskeyText2),l(de,t.account.accTypePasskeyText3)}),i(f,D)};k(c,f=>{(e(o)==="passkey"||e(o)==="federated_passkey")&&!e(d)&&f(S)})}var te=v(c,2);{var ue=f=>{var D=dt(),V=j(D),L=r(V),A=ke(()=>!(e(o)==="password"&&e(C).length<1));st(L,{get inputWidth(){return e(q)},get hideCurrentPassword(){return e(A)},get passwords(){return e(T)},set passwords(b){n(T,h(b))},get isValid(){return e($)},set isValid(b){n($,h(b))}});var Q=v(L,2),F=r(Q);xe(F,{onclick:z,level:1,get isLoading(){return e(w)},children:(b,N)=>{fe();var J=we();y(()=>l(J,t.common.save)),i(b,J)},$$slots:{default:!0}});var de=v(F,2);{var se=b=>{var N=ot(),J=r(N);va(J,{}),a(N),Ue(3,N,()=>He),i(b,N)},ye=b=>{var N=ge(),J=j(N);{var pe=X=>{var oe=it(),_e=r(oe,!0);a(oe),y(()=>l(_e,e(u))),Ue(3,oe,()=>He),i(X,oe)},_=X=>{var oe=ge(),_e=j(oe);{var Ie=be=>{var Pe=lt(),Je=r(Pe);xe(Je,{level:3,onclick:()=>n(d,!1),children:(Se,ea)=>{fe();var ze=we();y(()=>l(ze,t.common.cancel)),i(Se,ze)},$$slots:{default:!0}}),a(Pe),i(be,Pe)};k(_e,be=>{e(d)&&!e(w)&&be(Ie)},!0)}i(X,oe)};k(J,X=>{e(u)?X(pe):X(_,!1)},!0)}i(b,N)};k(de,b=>{e(O)?b(se):b(ye,!1)})}a(Q),a(V);var W=v(V,2);{var x=b=>{var N=ct(),J=r(N),pe=r(J,!0);a(J);var _=v(J,2),X=r(_,!0);a(_);var oe=v(_,2);xe(oe,{level:2,onclick:ie,children:(_e,Ie)=>{fe();var be=we();y(()=>l(be,t.account.convertAccount)),i(_e,be)},$$slots:{default:!0}}),a(N),y(()=>{l(pe,t.account.convertAccount),l(X,t.account.convertAccountP1)}),i(b,N)};k(W,b=>{!e(d)&&e(H)&&b(x)})}i(f,D)};k(te,f=>{(e(o)==="password"||e(o)==="federated_password"||e(d))&&f(ue)})}a(ne),i(ee,ne),qe()}function pt(ee,p){ee.code==="Enter"&&p()}var mt=I('<div class="flex"><div class="label font-label noselect svelte-1xf5lr3"><!></div> <label class="switch svelte-1xf5lr3"><input type="checkbox" class="svelte-1xf5lr3"> <span class="slider slider-round svelte-1xf5lr3"></span></label></div>');function Da(ee,p){Ee(p,!0);let s=$e(p,"checked",15,!1),t=$e(p,"ariaLabel",3,""),q=$e(p,"name",3,"");function o(){s(!s())}var C=mt(),$=r(C),d=r($);$r(d,()=>p.children),a($);var w=v($,2),u=r(w);vr(u),u.__click=o,u.__keydown=[pt,o],fe(2),a(w),a(C),y(()=>{ua($,"width",p.labelWidth),We(u,"name",q()),u.disabled=p.disabled,We(u,"aria-checked",s()),We(u,"aria-label",t())}),xr(u,s),i(ee,C),qe()}Oa(["click","keydown"]);var ft=I("<div><p> </p> <!></div>"),gt=I('<div class="success svelte-5kivuv"><!></div>'),ht=I('<div class="err svelte-5kivuv"> </div>'),wt=I('<div class="container svelte-5kivuv"><p> </p> <p><!></p> <div class="switch svelte-5kivuv"><!></div> <div class="switch svelte-5kivuv"><!></div> <!> <div class="bottom svelte-5kivuv"><!> <!></div></div>');function Va(ee,p){Ee(p,!0);let s=$e(p,"webIdData",15),t=Ae();const q="14rem";let o=E(""),C=E(!1),$=E(!!s().custom_triples),d=da(s().user_id);Qe(()=>{e(C)&&setTimeout(()=>{n(C,!1)},3e3)});async function w(){n(o,"");let m=await hr(s().user_id,s());if(m.ok)n(C,!0);else{let P=await m.json();n(o,h(P.message))}}var u=wt(),O=r(u),R=r(O,!0);a(O);var T=v(O,2),H=r(T);_r(H,{href:d,target:"_blank",children:(m,P)=>{var c=ge(),S=j(c);$a(S,()=>d.replace("/auth/","/auth/<wbr/>")),i(m,c)},$$slots:{default:!0}}),a(T);var ae=v(T,2),ie=r(ae);Da(ie,{ariaLabel:"E-Mail",labelWidth:q,get checked(){return s().expose_email},set checked(m){s(s().expose_email=m,!0)},children:(m,P)=>{fe();var c=we("E-Mail");i(m,c)},$$slots:{default:!0}}),a(ae);var z=v(ae,2),M=r(z);Da(M,{get ariaLabel(){return t.account.webIdExpertMode},labelWidth:q,get checked(){return e($)},set checked(m){n($,h(m))},children:(m,P)=>{fe();var c=we();y(()=>l(c,t.account.webIdExpertMode)),i(m,c)},$$slots:{default:!0}}),a(z);var U=v(z,2);{var Y=m=>{var P=ft(),c=r(P),S=r(c,!0);a(c);var te=v(c,2);Ir(te,{placeholder:"FOAF",rows:15,get value(){return s().custom_triples},set value(ue){s(s().custom_triples=ue,!0)}}),a(P),y(()=>l(S,t.account.webIdDescData)),Ue(3,P,()=>cr),i(m,P)};k(U,m=>{e($)&&m(Y)})}var le=v(U,2),ve=r(le);xe(ve,{onclick:w,children:(m,P)=>{fe();var c=we();y(()=>l(c,t.common.save)),i(m,c)},$$slots:{default:!0}});var ne=v(ve,2);{var Z=m=>{var P=gt(),c=r(P);va(c,{}),a(P),Ue(3,P,()=>He),i(m,P)},g=m=>{var P=ge(),c=j(P);{var S=te=>{var ue=ht(),f=r(ue,!0);a(ue),y(()=>l(f,e(o))),Ue(3,ue,()=>He),i(te,ue)};k(c,te=>{e(o)&&te(S)},!0)}i(m,P)};k(ne,m=>{e(C)?m(Z):m(g,!1)})}a(le),a(u),y(()=>l(R,t.account.webIdDesc)),i(ee,u),qe()}function yt(ee){Ma(ee,{viewMode:"account"})}var bt=I("<h3> </h3>"),kt=I('<div class="headerPhone svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="innerPhone svelte-k6hxbm"><!></div></div>',1),$t=I('<div class="header svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="inner svelte-k6hxbm"><!></div></div>',1),xt=I('<!> <div class="wrapper svelte-k6hxbm"><!></div>',1);function _t(ee,p){Ee(p,!0);const s=M=>{var U=bt(),Y=r(U,!0);a(U),y(()=>l(Y,`${t().given_name} ${t().family_name||""}`)),i(M,U)};let t=$e(p,"user",15),q=$e(p,"webIdData",15),o=Ae(),C=E(void 0),$=E(h([])),d=ke(()=>{var M;if((M=t().account_type)!=null&&M.startsWith("federated"))return e($).filter(U=>U.id===t().auth_provider_id)[0]}),w=ke(()=>e(C)&&e(C)<500),u=E(h(o.account.navInfo)),O=h(q()?[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,"WebID",o.account.devices,o.account.navLogout]:[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,o.account.devices,o.account.navLogout]);sa(()=>{Pr("v").get()==="devices"&&n(u,h(o.account.devices))}),Qe(()=>{e(u)===o.account.navLogout&&rr()});var R=xt(),T=j(R);Cr(T,{id:tr,get value(){return e($)},set value(M){n($,h(M))}});var H=v(T,2),ae=r(H);{var ie=M=>{var U=kt(),Y=j(U),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);Na(ne,{get tabs(){return O},get selected(){return e(u)},set selected(c){n(u,h(c))}});var Z=v(ne,2),g=r(Z);{var m=c=>{Ea(c,{get providers(){return e($)},get authProvider(){return e(d)},viewModePhone:!0,get webIdData(){return q()},get user(){return t()},set user(S){t(S)}})},P=c=>{var S=ge(),te=j(S);{var ue=D=>{qa(D,{viewModePhone:!0,get user(){return t()},set user(V){t(V)}})},f=D=>{var V=ge(),L=j(V);{var A=F=>{La(F,{get user(){return t()},get authProvider(){return e(d)},viewModePhone:!0})},Q=F=>{var de=ge(),se=j(de);{var ye=x=>{Ta(x,{get user(){return t()}})},W=x=>{var b=ge(),N=j(b);{var J=_=>{Va(_,{get webIdData(){return q()},set webIdData(X){q(X)}})},pe=_=>{var X=ge(),oe=j(X);{var _e=Ie=>{Ma(Ie,{viewMode:"account"})};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,X)};k(N,_=>{e(u)==="WebID"?_(J):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(W,!1)},!0)}i(F,de)};k(L,F=>{e(u)===o.common.password?F(A):F(Q,!1)},!0)}i(D,V)};k(te,D=>{e(u)===o.account.navEdit?D(ue):D(f,!1)},!0)}i(c,S)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(Z),a(ve),i(M,U)},z=M=>{var U=$t(),Y=j(U),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);Na(ne,{get tabs(){return O},center:!0,get selected(){return e(u)},set selected(c){n(u,h(c))}});var Z=v(ne,2),g=r(Z);{var m=c=>{Ea(c,{get webIdData(){return q()},get providers(){return e($)},get authProvider(){return e(d)},get user(){return t()},set user(S){t(S)}})},P=c=>{var S=ge(),te=j(S);{var ue=D=>{qa(D,{get user(){return t()},set user(V){t(V)}})},f=D=>{var V=ge(),L=j(V);{var A=F=>{La(F,{get user(){return t()},get authProvider(){return e(d)}})},Q=F=>{var de=ge(),se=j(de);{var ye=x=>{Ta(x,{get user(){return t()}})},W=x=>{var b=ge(),N=j(b);{var J=_=>{Va(_,{get webIdData(){return q()},set webIdData(X){q(X)}})},pe=_=>{var X=ge(),oe=j(X);{var _e=Ie=>{yt(Ie)};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,X)};k(N,_=>{e(u)==="WebID"?_(J):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(W,!1)},!0)}i(F,de)};k(L,F=>{e(u)===o.common.password?F(A):F(Q,!1)},!0)}i(D,V)};k(te,D=>{e(u)===o.account.navEdit?D(ue):D(f,!1)},!0)}i(c,S)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(Z),a(ve),i(M,U)};k(ae,M=>{e(w)?M(ie):M(z,!1)})}a(H),Ya("innerWidth",M=>n(C,h(M))),i(ee,R),qe()}var It=I("<!> <!> <!>",1);function Ct(ee,p){Ee(p,!0);let s=Ae(),t=Pa("account"),q=E(void 0),o=E(void 0),C=E(!1);Qe(()=>{let d=t.get();d&&$(d)});async function $(d){const w=d.user_id;if(w){let u=await Promise.all([Ze(`/auth/v1/users/${w}`),Ze(`/auth/v1/users/${w}/webid/data`)]);u[0].body?n(q,h(u[0].body)):sr("account"),u[1].body?n(o,h(u[1].body)):u[1].status===404&&n(o,h({user_id:w,expose_email:!1})),n(C,!0)}else console.error("no user_id in session")}Xa(d=>{y(()=>{var w;return Ja.title=`${((s==null?void 0:s.account.account)||"Account")??""} ${((w=e(q))==null?void 0:w.email)??""}`})}),zr(ee,{children:(d,w)=>{Mr(d,{children:(u,O)=>{var R=It(),T=j(R);{var H=z=>{_t(z,{get user(){return e(q)},set user(M){n(q,h(M))},get webIdData(){return e(o)},set webIdData(M){n(o,h(M))}})};k(T,z=>{e(C)&&t&&e(q)&&z(H)})}var ae=v(T,2);Nr(ae,{absolute:!0});var ie=v(ae,2);Er(ie,{absolute:!0}),i(u,R)},$$slots:{default:!0}})},$$slots:{default:!0}}),qe()}export{Ct as component};
