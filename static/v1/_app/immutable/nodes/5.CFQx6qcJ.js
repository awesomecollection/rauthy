import"../chunks/disclose-version.BDr9Qe-U.js";import{f as j,p as qe,c as r,r as a,s as v,y as e,t as y,a as Te,ab as ke,ar as fe,A as q,z as n,ap as sa,a6 as Je,aq as Qa}from"../chunks/index-client.Di99sPv0.js";import{h as Xa}from"../chunks/svelte-head.B7nS6fh6.js";import{e as ge,a as i,t as I,d as we,n as ja}from"../chunks/template.BEKX6jgL.js";import{i as k}from"../chunks/if.DgeUjMU2.js";import{p as h}from"../chunks/proxy.BQ2dmY0t.js";import{s as l,d as Oa}from"../chunks/render.Cjc4CIr8.js";import{b as Ya}from"../chunks/window.jI-ViO5i.js";import{p as $e}from"../chunks/props.ClgLgKUv.js";import{l as Ge,V as da,_ as Ja,Q as Za,S as er,B as ar,W as rr,M as tr,r as sr}from"../chunks/helpers.D3KrX4pz.js";import{e as ka}from"../chunks/each.DxtmCefA.js";import{h as $a}from"../chunks/html.CddWxNhc.js";import{a as K,c as G,s as Ve,t as xa,r as vr}from"../chunks/class.BCapn1bP.js";import{I as va}from"../chunks/IconCheck.K_67dytm.js";import{I as nr}from"../chunks/IconStop.8S4C4V3m.js";import{B as xe}from"../chunks/Button.D-14suAe.js";import{M as or}from"../chunks/Modal.BTuJV0y2.js";import{u as Ae}from"../chunks/i18n.svelte.Bc6aINkd.js";import{c as ir,b as _a,d as Ia,f as Ze}from"../chunks/fetch.DxJS_Pk_.js";import{B as lr}from"../chunks/ButtonAuthProvider.Ct2rZk8A.js";import{t as Ue,f as He,a as ua,s as cr}from"../chunks/index.BnJsthXQ.js";import{I as ze}from"../chunks/Input.-lhBsjDF.js";import{F as dr}from"../chunks/Form.C0Yvca1O.js";import{a as pa,k as ur,l as Ca,m as pr}from"../chunks/patterns.BDQXnG3O.js";import{I as mr}from"../chunks/InputDateTimeCombo.C0589-57.js";import{w as fr,d as gr,e as hr}from"../chunks/dataFetching.B_eQV28B.js";import{u as Pa}from"../chunks/session.svelte.BocnM0Us.js";import{w as wr}from"../chunks/registration.DWog0zj0.js";import{W as Da}from"../chunks/WebauthnRequest.BW_iBuNs.js";import{T as yr}from"../chunks/Tooltip.59ZAsezP.js";import{P as br}from"../chunks/PasswordPolicy.DyPst8KB.js";import{I as ma}from"../chunks/InputPassword.Bl28d8lQ.js";import{C as kr}from"../chunks/CheckIcon.CxdBm3CC.js";import{s as $r}from"../chunks/snippet.D2r9qTNj.js";import{a as xr}from"../chunks/input.NYWjhvEE.js";import{A as _r}from"../chunks/A.ZMe8srAj.js";import{I as Ir}from"../chunks/InputArea.DX3kGdfA.js";import"../chunks/legacy.DJEB66nf.js";import{D as Na}from"../chunks/Devices.Cxlqo-B6.js";import{T as Cr}from"../chunks/Template.DiUnptz0.js";import{u as Pr}from"../chunks/param.svelte.CXpV4U96.js";import{T as Ea}from"../chunks/Tabs.CTmGp6-A.js";import{M as Dr}from"../chunks/Main.DKi4VjsM.js";import{C as Nr}from"../chunks/ContentCenter.BgFVBEpa.js";import{T as Er}from"../chunks/ThemeSwitch._9IF3ElF.js";import{L as qr}from"../chunks/LangSelector.BxiGX-yu.js";function fa(ee,p){var s=ge(),t=j(s);{var T=C=>{va(C,{color:"hsl(var(--action))"})},o=C=>{nr(C,{color:"hsl(var(--error))"})};k(t,C=>{p.checked?C(T):C(o,!1)})}i(ee,s)}var Tr=I('<div class="link-err value svelte-1tea8v4"> </div>'),zr=I('<div class="fed-btn svelte-1tea8v4"><!> <!></div>'),Lr=I('<h3> </h3> <p> </p> <div class="providers svelte-1tea8v4"></div>',1),Wr=I("<!> <!>",1),Mr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Vr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Ar=I('<div><div>WebID:</div> <span class="value svelte-1tea8v4"><a target="_blank"><!></a></span></div>'),Br=I('<div><div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <div><div class="value svelte-1tea8v4"> </div> <!></div></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <!> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <!> <!></div>');function qa(ee,p){qe(p,!0);let s=$e(p,"user",15),t=Ae(),T=q(!1),o=q(!1),C=ke(()=>{var B;return(B=s().account_type)==null?void 0:B.startsWith("federated")}),$=ke(()=>{var B;return e(C)?`${s().account_type}: ${((B=p.authProvider)==null?void 0:B.name)||""}`:s().account_type}),d=ke(()=>p.viewModePhone?"rowPhone":"row"),w=ke(()=>p.viewModePhone?"labelPhone":"label");function u(B){Ja(64,(re,{challenge:ce,verifier:he})=>{re||(localStorage.setItem(Za,he),O(B,ce))})}async function O(B,re){let ce={email:s().email,client_id:"rauthy",redirect_uri:window.location.href,provider_id:B,pkce_challenge:re},he=await _a(`/auth/v1/providers/${B}/link`,ce);if(he.text){er(he.text);let me=he.headers.get("location");me&&(window.location.href=me)}else console.error(he.error)}async function R(){let B=await ir("/auth/v1/providers/link");B.body?s(B.body):(console.error(B.error),n(T,!0))}var z=Br(),H=r(z),ae=r(H),ie=r(ae,!0);a(ae);var D=v(ae,2),N=r(D,!0);a(D),a(H);var U=v(H,2),Y=r(U),le=r(Y,!0);a(Y);var ve=v(Y,2),ne=r(ve,!0);a(ve),a(U);var Z=v(U,2),g=r(Z),m=r(g,!0);a(g);var P=v(g,2),c=r(P,!0);a(P),a(Z);var S=v(Z,2),te=r(S),ue=r(te);a(te);var f=v(te,2),W=r(f,!0);a(f),a(S);var M=v(S,2),L=r(M),A=r(L,!0);a(L);var J=v(L,2),F=r(J),de=r(F,!0);a(F);var se=v(F,2);{var ye=B=>{var re=zr(),ce=r(re);xe(ce,{get ariaLabel(){return t.account.providerUnlink},level:3,onclick:R,children:(Ce,Be)=>{fe();var Ke=we();y(()=>l(Ke,t.account.providerUnlink)),i(Ce,Ke)},$$slots:{default:!0}});var he=v(ce,2);{var me=Ce=>{var Be=Tr(),Ke=r(Be,!0);a(Be),y(()=>l(Ke,t.account.providerUnlinkDesc)),i(Ce,Be)};k(he,Ce=>{e(T)&&Ce(me)})}a(re),i(B,re)},V=B=>{var re=ge(),ce=j(re);{var he=me=>{var Ce=Wr(),Be=j(Ce);xe(Be,{level:2,onclick:()=>n(o,!0),children:(Oe,Ra)=>{fe();var Ye=we();y(()=>l(Ye,t.account.providerLink)),i(Oe,Ye)},$$slots:{default:!0}});var Ke=v(Be,2);or(Ke,{get showModal(){return e(o)},set showModal(Oe){n(o,h(Oe))},children:(Oe,Ra)=>{var Ye=Lr(),ia=j(Ye),Ka=r(ia,!0);a(ia);var la=v(ia,2),Ga=r(la,!0);a(la);var ya=v(la,2);ka(ya,21,()=>p.providers,ca=>ca.id,(ca,ba)=>{var Ha=ke(()=>`${t.account.providerLink}: ${e(ba).name}`);lr(ca,{get ariaLabel(){return e(Ha)},get provider(){return e(ba)},onclick:u})}),a(ya),y(()=>{l(Ka,t.account.providerLink),l(Ga,t.account.providerLinkDesc)}),i(Oe,Ye)},$$slots:{default:!0}}),i(me,Ce)};k(ce,me=>{p.providers.length>0&&me(he)},!0)}i(B,re)};k(se,B=>{e(C)?B(ye):B(V,!1)})}a(J),a(M);var x=v(M,2),b=r(x),E=r(b,!0);a(b);var Q=v(b,2),pe=r(Q,!0);a(Q),a(x);var _=v(x,2),X=r(_),oe=r(X,!0);a(X);var _e=v(X,2),Ie=r(_e,!0);a(_e),a(_);var be=v(_,2),Pe=r(be),Qe=r(Pe,!0);a(Pe);var Se=v(Pe,2),ea=ke(()=>!!s().webauthn_user_id);fa(Se,{get checked(){return e(ea)}}),a(be);var De=v(be,2),Le=r(De),na=r(Le,!0);a(Le);var aa=v(Le,2);fa(aa,{get checked(){return s().enabled}}),a(De);var Fe=v(De,2),Re=r(Fe),oa=r(Re,!0);a(Re);var Ee=v(Re,2);fa(Ee,{get checked(){return s().email_verified}}),a(Fe);var We=v(Fe,2);{var Xe=B=>{var re=Mr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,Ge(s().last_login))),a(me),a(re),y(()=>{K(re,G(e(d)),"svelte-1tea8v4"),K(ce,G(e(w)),"svelte-1tea8v4"),l(he,t.account.lastLogin)}),i(B,re)};k(We,B=>{s().last_login&&B(Xe)})}var Ne=v(We,2),Me=r(Ne),ga=r(Me,!0);a(Me);var je=v(Me,2),Va=r(je,!0);y(()=>l(Va,s().password_expires&&Ge(s().password_expires)||t.common.never)),a(je),a(Ne);var ra=v(Ne,2),ta=r(ra),Aa=r(ta,!0);a(ta);var ha=v(ta,2),Ba=r(ha,!0);y(()=>l(Ba,Ge(s().created_at))),a(ha),a(ra);var wa=v(ra,2);{var Ua=B=>{var re=Vr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,Ge(s().user_expires))),a(me),a(re),y(()=>{K(re,G(e(d)),"svelte-1tea8v4"),K(ce,G(e(w)),"svelte-1tea8v4"),l(he,t.account.userExpiry)}),i(B,re)};k(wa,B=>{s().user_expires&&B(Ua)})}var Sa=v(wa,2);{var Fa=B=>{var re=Ar(),ce=r(re),he=v(ce,2),me=r(he);y(()=>Ve(me,"href",da(s().id)));var Ce=r(me);$a(Ce,()=>da(s().id).replace("/auth/","/auth/<wbr/>")),a(me),a(he),a(re),y(()=>{K(re,G(e(d)),"svelte-1tea8v4"),K(ce,G(e(w)),"svelte-1tea8v4")}),i(B,re)};k(Sa,B=>{p.webIdData&&B(Fa)})}a(z),y(()=>{K(H,G(e(d)),"svelte-1tea8v4"),K(ae,G(e(w)),"svelte-1tea8v4"),l(ie,t.common.email),l(N,s().email),K(U,G(e(d)),"svelte-1tea8v4"),K(Y,G(e(w)),"svelte-1tea8v4"),l(le,t.account.givenName),l(ne,s().given_name),K(Z,G(e(d)),"svelte-1tea8v4"),K(g,G(e(w)),"svelte-1tea8v4"),l(m,t.account.familyName),l(c,s().family_name),K(S,G(e(d)),"svelte-1tea8v4"),K(te,G(e(w)),"svelte-1tea8v4"),l(ue,`${t.account.user??""} ID`),l(W,s().id),K(M,G(e(d)),"svelte-1tea8v4"),K(L,G(e(w)),"svelte-1tea8v4"),l(A,t.account.accType),l(de,e($)||""),K(x,G(e(d)),"svelte-1tea8v4"),K(b,G(e(w)),"svelte-1tea8v4"),l(E,t.account.roles),l(pe,s().roles||"None"),K(_,G(e(d)),"svelte-1tea8v4"),K(X,G(e(w)),"svelte-1tea8v4"),l(oe,t.account.groups),l(Ie,s().groups||"None"),K(be,G(e(d)),"svelte-1tea8v4"),K(Pe,G(e(w)),"svelte-1tea8v4"),l(Qe,t.account.mfaActivated),K(De,G(e(d)),"svelte-1tea8v4"),K(Le,G(e(w)),"svelte-1tea8v4"),l(na,t.account.userEnabled),K(Fe,G(e(d)),"svelte-1tea8v4"),K(Re,G(e(w)),"svelte-1tea8v4"),l(oa,t.account.emailVerified),K(Ne,G(e(d)),"svelte-1tea8v4"),K(Me,G(e(w)),"svelte-1tea8v4"),l(ga,t.account.passwordExpiry),K(ra,G(e(d)),"svelte-1tea8v4"),K(ta,G(e(w)),"svelte-1tea8v4"),l(Aa,t.account.userCreated)}),i(ee,z),Te()}var Ur=I('<div class="success svelte-4ogr3z"><!></div>'),Sr=I("<p> </p>"),Fr=I('<div class="err svelte-4ogr3z"> </div>'),Rr=I('<div class="formInner svelte-4ogr3z"><div><!> <!> <!> <!></div> <div><!> <!> <!> <!> <!></div></div> <div class="bottom svelte-4ogr3z"><div><!></div> <!></div> <!>',1),Kr=I('<div class="container svelte-4ogr3z"><!></div>');function Ta(ee,p){var O;qe(p,!0);let s=$e(p,"user",15);(O=s().user_values)!=null&&O.birthdate||s(s().user_values.birthdate="",!0);let t=Ae(),T=q(""),o=q(!1),C=q(!1);async function $(R,z){var m;const H=z.get("email"),ae=z.get("family_name")||void 0,ie=z.get("given_name")||void 0,D=z.get("birthdate")||void 0,N=((m=z.get("phone"))==null?void 0:m.replaceAll(" ",""))||void 0,U=z.get("street")||void 0,Y=z.get("zip")||void 0,le=Y?Number.parseInt(Y):void 0,ve=z.get("city")||void 0,ne=z.get("country")||void 0;let Z={email:H,family_name:ae,given_name:ie,user_values:{birthdate:D,phone:N,street:U,zip:le,city:ve,country:ne}},g=await Ia(`/auth/v1/users/${s().id}/self`,Z);if(g.body){n(o,!0),s(g.body);let P=3e3;g.status===202&&(n(C,!0),P=3e4),setTimeout(()=>{n(o,!1)},P)}else g.error&&(console.error(g.error),n(T,h(g.error.message)))}var d=Kr(),w=r(d),u=ke(()=>`/auth/v1/users/${s().id}/self`);dr(w,{get action(){return e(u)},onSubmit:$,children:(R,z)=>{var H=Rr(),ae=j(H),ie=r(ae),D=r(ie);ze(D,{typ:"email",name:"email",get label(){return t.common.email},get placeholder(){return t.common.email},get value(){return s().email},required:!0});var N=v(D,2);ze(N,{name:"given_name",autocomplete:"given-name",get label(){return t.account.givenName},get placeholder(){return t.account.givenName},get value(){return s().given_name},required:!0,maxLength:32,pattern:pa});var U=v(N,2);ze(U,{name:"family_name",autocomplete:"family-name",get label(){return t.account.familyName},get placeholder(){return t.account.familyName},get value(){return s().family_name},maxLength:32,pattern:pa});var Y=v(U,2);mr(Y,{name:"birthdate",get label(){return t.account.birthdate},withDelete:!0,get value(){return s().user_values.birthdate},set value(L){s(s().user_values.birthdate=L,!0)}}),a(ie);var le=v(ie,2),ve=r(le);ze(ve,{name:"street",autocomplete:"street-address",get label(){return t.account.street},get placeholder(){return t.account.street},get value(){return s().user_values.street},maxLength:48,pattern:ur});var ne=v(ve,2);ze(ne,{typ:"number",name:"zip",autocomplete:"postal-code",get label(){return t.account.zip},get placeholder(){return t.account.zip},get value(){return s().user_values.zip},min:"1000",max:"9999999"});var Z=v(ne,2);ze(Z,{name:"city",autocomplete:"address-level2",get label(){return t.account.city},get placeholder(){return t.account.city},get value(){return s().user_values.city},maxLength:48,pattern:Ca});var g=v(Z,2);ze(g,{name:"country",autocomplete:"country",get label(){return t.account.country},get placeholder(){return t.account.country},get value(){return s().user_values.country},maxLength:48,pattern:Ca});var m=v(g,2);ze(m,{name:"phone",autocomplete:"tel",get label(){return t.account.phone},get placeholder(){return t.account.phone},get value(){return s().user_values.phone},maxLength:32,pattern:pr}),a(le),a(ae);var P=v(ae,2),c=r(P),S=r(c);xe(S,{type:"submit",children:(L,A)=>{fe();var J=we();y(()=>l(J,t.common.save)),i(L,J)},$$slots:{default:!0}}),a(c);var te=v(c,2);{var ue=L=>{var A=Ur(),J=r(A);va(J,{}),a(A),Ue(3,A,()=>He),i(L,A)};k(te,L=>{e(o)&&L(ue)})}a(P);var f=v(P,2);{var W=L=>{var A=Sr(),J=r(A,!0);a(A),y(()=>l(J,t.account.emailUpdateConfirm)),i(L,A)},M=L=>{var A=ge(),J=j(A);{var F=de=>{var se=Fr(),ye=r(se,!0);a(se),y(()=>l(ye,e(T))),Ue(3,se,()=>He),i(de,se)};k(J,de=>{e(T)&&de(F)},!0)}i(L,A)};k(f,L=>{e(C)?L(W):L(M,!1)})}i(R,H)},$$slots:{default:!0}}),a(d),i(ee,d),Te()}var Gr=ja('<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7.864 4.243A7.5 7.5 0 0119.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 004.5 10.5a7.464 7.464 0 01-1.15 3.993m1.989 3.559A11.209 11.209 0 008.25 10.5a3.75 3.75 0 117.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 01-3.6 9.75m6.633-4.596a18.666 18.666 0 01-2.485 5.33"></path></svg>');function Hr(ee,p){let s=$e(p,"opacity",3,.9),t=$e(p,"width",3,24),T=$e(p,"color",3,"currentColor");var o=Gr();Ve(o,"stroke-width",2),y(()=>{Ve(o,"stroke",T()),Ve(o,"width",t()),Ve(o,"opacity",s())}),i(ee,o)}var Qr=I('<div class="err svelte-qkgdvy"><b>Your browser does not support Webauthn credentials and must be updated.</b></div>'),Xr=I('<!> <div class="regBtns svelte-qkgdvy"><!> <!></div>',1),jr=I('<div class="regNewBtn svelte-qkgdvy"><!></div>'),Or=I('<div class="keysHeader svelte-qkgdvy"> </div>'),Yr=I("<div><!></div>"),Jr=I('<div class="row svelte-qkgdvy"><div></div> <div class="deleteBtn svelte-qkgdvy"><!></div></div>'),Zr=I('<div class="keyContainer svelte-qkgdvy"><div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <div class="nameUv svelte-qkgdvy"><b> </b> <!></div></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <!></div>'),et=I('<div class="button svelte-qkgdvy"><!></div>'),at=I('<!> <p class="svelte-qkgdvy"> <br><br> </p> <!> <!> <div class="keysContainer svelte-qkgdvy"></div> <!> <div class="svelte-qkgdvy"> </div>',1),rt=I('<div class="container svelte-qkgdvy"><!></div>');function za(ee,p){qe(p,!0);const s="credentials"in navigator;let t=Ae(),T=Pa("account"),o=ke(()=>{var g;return(g=T.get())==null?void 0:g.user_id}),C=q(void 0),$=q(!1),d=q(""),w=q(!1),u=q(p.user.account_type==="password"),O=q(void 0),R=q(""),z=q(!1),H=q(h([]));sa(()=>{ie()}),Je(()=>{e(H).length>0&&p.user.account_type==="passkey"&&n(u,e(H).length>1)}),Je(()=>{var g;(g=e(C))==null||g.focus()});function ae(){n($,!1),n(d,"")}async function ie(){var m;let g=await Ze(`/auth/v1/users/${(m=T.get())==null?void 0:m.user_id}/webauthn`);g.body?n(H,h(g.body)):console.error(g.error)}async function D(){if(ae(),e(z)||!e(o))return;if(e(R).length<1){n($,!0),n(d,h(t.mfa.passkeyNameErr));return}let g=await wr(e(o),e(R),t.authorize.invalidKeyUsed,t.authorize.requestExpired);g.error?(n($,!0),n(d,`${t.mfa.errorReg} - ${g.error}`)):(n(w,!1),n(R,""),await ie())}async function N(g){let m=await fr(p.user.id,g);if(m.status===200)await ie();else{let P=await m.json();n($,!0),n(d,h(P.message))}}function U(g){n(O,void 0),n($,!0),n(d,h(g)),setTimeout(()=>{n($,!1),n(d,"")},5e3)}function Y(g){n(O,void 0),n(d,h(t.mfa.testSuccess)),setTimeout(()=>{n(d,"")},3e3)}var le=rt(),ve=r(le);{var ne=g=>{var m=Qr();i(g,m)},Z=g=>{var m=at(),P=j(m);{var c=V=>{Da(V,{get userId(){return p.user.id},get purpose(){return e(O)},onSuccess:Y,onError:U})};k(P,V=>{e(O)&&V(c)})}var S=v(P,2),te=r(S),ue=v(te,3);a(S);var f=v(S,2);{var W=V=>{var x=Xr(),b=j(x);ze(b,{autocomplete:"off",get label(){return t.mfa.passkeyName},get placeholder(){return t.mfa.passkeyName},maxLength:32,pattern:pa,onEnter:D,get ref(){return e(C)},set ref(_){n(C,h(_))},get value(){return e(R)},set value(_){n(R,h(_))},get isError(){return e(z)},set isError(_){n(z,h(_))}});var E=v(b,2),Q=r(E);xe(Q,{onclick:D,children:(_,X)=>{fe();var oe=we();y(()=>l(oe,t.mfa.register)),i(_,oe)},$$slots:{default:!0}});var pe=v(Q,2);xe(pe,{level:3,onclick:()=>n(w,!1),children:(_,X)=>{fe();var oe=we();y(()=>l(oe,t.common.cancel)),i(_,oe)},$$slots:{default:!0}}),a(E),i(V,x)},M=V=>{var x=jr(),b=r(x),E=ke(()=>e(H).length===0?1:2);xe(b,{get level(){return e(E)},onclick:()=>n(w,!0),children:(Q,pe)=>{fe();var _=we();y(()=>l(_,t.mfa.registerNew)),i(Q,_)},$$slots:{default:!0}}),a(x),i(V,x)};k(f,V=>{e(w)?V(W):V(M,!1)})}var L=v(f,2);{var A=V=>{var x=Or(),b=r(x,!0);a(x),y(()=>l(b,t.mfa.registerdKeys)),i(V,x)};k(L,V=>{e(H).length>0&&V(A)})}var J=v(L,2);ka(J,21,()=>e(H),V=>V.name,(V,x)=>{var b=Zr(),E=r(b),Q=r(E),pe=r(Q,!0);a(Q);var _=v(Q,2),X=r(_),oe=r(X,!0);a(X);var _e=v(X,2);{var Ie=Ee=>{yr(Ee,{get text(){return t.account.userVerifiedTooltip},children:(We,Xe)=>{var Ne=Yr();ua(Ne,"margin-bottom","-.25rem");var Me=r(Ne);Hr(Me,{width:18,color:"var(--col-acnt)"}),a(Ne),i(We,Ne)},$$slots:{default:!0}})};k(_e,Ee=>{e(x).user_verified&&Ee(Ie)})}a(_),a(E);var be=v(E,2),Pe=r(be),Qe=r(Pe,!0);a(Pe);var Se=v(Pe,2),ea=r(Se,!0);y(()=>l(ea,Ge(e(x).registered))),a(Se),a(be);var De=v(be,2),Le=r(De),na=r(Le,!0);a(Le);var aa=v(Le,2),Fe=r(aa,!0);y(()=>l(Fe,Ge(e(x).last_used))),a(aa),a(De);var Re=v(De,2);{var oa=Ee=>{var We=Jr(),Xe=v(r(We),2),Ne=r(Xe);xe(Ne,{level:-3,onclick:()=>N(e(x).name),children:(Me,ga)=>{fe();var je=we();y(()=>l(je,t.common.delete)),i(Me,je)},$$slots:{default:!0}}),a(Xe),a(We),i(Ee,We)};k(Re,Ee=>{e(u)&&Ee(oa)})}a(b),y(()=>{l(pe,t.mfa.passkeyName),l(oe,e(x).name),l(Qe,t.mfa.registerd),l(na,t.mfa.lastUsed)}),i(V,b)}),a(J);var F=v(J,2);{var de=V=>{var x=et(),b=r(x);xe(b,{onclick:()=>n(O,"Test"),children:(E,Q)=>{fe();var pe=we();y(()=>l(pe,t.mfa.test)),i(E,pe)},$$slots:{default:!0}}),a(x),i(V,x)};k(F,V=>{e(H).length>0&&V(de)})}var se=v(F,2),ye=r(se,!0);a(se),y(()=>{l(te,`${t.mfa.p1??""} `),l(ue,` ${t.mfa.p2??""}`),xa(se,"success",!e($)),xa(se,"err",e($)),l(ye,e(d))}),i(g,m)};k(ve,g=>{s?g(Z,!1):g(ne)})}a(le),i(ee,le),Te()}var tt=I('<div class="container svelte-ue7bk2"><!> <!> <!> <!> <div class="btn svelte-ue7bk2"><!></div> <div class="err svelte-ue7bk2"> </div></div>');function st(ee,p){qe(p,!0);let s=$e(p,"passwords",15),t=$e(p,"hideCurrentPassword",3,!1),T=$e(p,"isValid",15),o=Ae();T(R);let C=q(!1),$=q(""),d=q(void 0),w=ke(()=>{var D;return((D=s().new)==null?void 0:D.length)>6&&s().new===s().newConfirm}),u=q(void 0),O=q(void 0);sa(async()=>{let D=await Ze("/auth/v1/password_policy");D.body?n(d,h(D.body)):console.error(D.error)});function R(){return n($,""),!t()&&!s().current?(n($,h(o.account.passwordCurrReq)),!1):s().new?s().newConfirm?e(C)?s().new.length>256?(n($,"max 256"),!1):s().new!==s().newConfirm?(n($,h(o.account.passwordNoMatch)),!1):!0:(n($,h(o.account.passwordPolicyFollow)),!1):(n($,h(o.account.passwordNewReq)),!1):(n($,h(o.account.passwordNewReq)),!1)}function z(){if(n($,""),e(d)){let D=ar(e(d));s(s().new=D,!0),s(s().newConfirm=D,!0)}requestAnimationFrame(()=>{var D,N;(D=e(u))==null||D(),(N=e(O))==null||N()})}var H=ge(),ae=j(H);{var ie=D=>{var N=tt(),U=r(N);br(U,{get policy(){return e(d)},get password(){return s().new},get accepted(){return e(C)},set accepted(c){n(C,h(c))}});var Y=v(U,2);{var le=c=>{ma(c,{autocomplete:"current-password",get label(){return o.account.passwordCurr},get placeholder(){return o.account.passwordCurr},onInput:R,get width(){return p.inputWidth},get value(){return s().current},set value(S){s(s().current=S,!0)}})};k(Y,c=>{t()||c(le)})}var ve=v(Y,2);ma(ve,{autocomplete:"new-password",get label(){return o.account.passwordNew},get placeholder(){return o.account.passwordNew},onInput:R,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().new},set value(c){s(s().new=c,!0)},get reportValidity(){return e(u)},set reportValidity(c){n(u,h(c))}});var ne=v(ve,2);ma(ne,{autocomplete:"new-password",get label(){return o.account.passwordConfirm},get placeholder(){return o.account.passwordConfirm},onInput:R,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().newConfirm},set value(c){s(s().newConfirm=c,!0)},get reportValidity(){return e(O)},set reportValidity(c){n(O,h(c))}});var Z=v(ne,2),g=r(Z);xe(g,{onclick:z,level:2,children:(c,S)=>{fe();var te=we();y(()=>l(te,o.account.generateRandom)),i(c,te)},$$slots:{default:!0}}),a(Z);var m=v(Z,2),P=r(m,!0);a(m),a(N),y(()=>l(P,e($))),i(D,N)};k(ae,D=>{e(d)&&D(ie)})}return i(ee,H),Te({isPwdValid:R})}var vt=I('<div class="m-05 svelte-1h4zvzu"><p> </p> <p><b> </b></p> <div></div> <p> </p> <!></div>'),nt=I("<p> </p> <p> </p> <p> </p> <div><!></div>",1),ot=I('<div class="success svelte-1h4zvzu"><!></div>'),it=I('<div class="err"> </div>'),lt=I('<div class="cancel"><!></div>'),ct=I('<div class="convertPasskey svelte-1h4zvzu"><h3> </h3> <p> </p> <!></div>'),dt=I('<div><!> <div class="save svelte-1h4zvzu"><!> <!></div></div> <!>',1),ut=I('<div class="container svelte-1h4zvzu"><!> <!> <!> <!></div>');function La(ee,p){qe(p,!0);let s=$e(p,"user",15),t=Ae(),T=ke(()=>p.viewModePhone?"calc(100vw - 1.5rem)":"300px"),o=q(h(s().account_type)),C=q(h([])),$=q(void 0),d=q(!1),w=q(!1),u=q(""),O=q(!1),R=q(void 0),z=q(h({current:"",new:"",newConfirm:""})),H=ke(()=>e(C).filter(f=>f.user_verified).length>0);sa(()=>{ae()});async function ae(){let f=await Ze(`/auth/v1/users/${s().id}/webauthn`);f.body?n(C,h(f.body)):console.error("error fetching passkeys: "+f.error)}async function ie(){let f=await _a(`/auth/v1/users/${s().id}/self/convert_passkey`);f.error?console.error("error fetching passkeys: "+f.error):window.location.reload()}async function D(){n(u,""),e(C).length>0?await N():await U()}async function N(){var f;if(!((f=e($))!=null&&f())){n(u,h(t.common.invalidInput));return}n(R,"PasswordNew")}async function U(f){var L,A;if(!((L=e($))!=null&&L())){n(u,h(t.common.invalidInput));return}n(w,!0);let W={password_new:e(z).new};f?W.mfa_code=f:W.password_current=e(z).current;let M=await Ia(`/auth/v1/users/${s().id}/self`,W);M.body?(n(O,!0),n(z,h({current:"",new:"",newConfirm:""})),s(M.body),n(o,h(M.body.account_type)),setTimeout(()=>{n(O,!1),n(d,!1)},3e3)):n(u,h(((A=M.error)==null?void 0:A.message)||"Error")),n(w,!1)}function Y(f){n(R,void 0),n(u,h(f)),setTimeout(()=>{n(u,"")},5e3)}function le(f){n(R,void 0),f&&"code"in f&&U(f.code)}async function ve(){let f=await gr({email:s().email});if(f.ok)n(O,!0);else{let W=await f.json();n(u,h(W.message))}}var ne=ut(),Z=r(ne);{var g=f=>{Da(f,{get userId(){return s().id},get purpose(){return e(R)},onSuccess:le,onError:Y})};k(Z,f=>{e(R)&&f(g)})}var m=v(Z,2);{var P=f=>{var W=vt(),M=r(W),L=r(M,!0);a(M);var A=v(M,2),J=r(A),F=r(J,!0);a(J),a(A);var de=v(A,2);ua(de,"height",".3rem");var se=v(de,2),ye=r(se,!0);a(se);var V=v(se,2);{var x=E=>{kr(E,{check:!0})},b=E=>{xe(E,{level:2,onclick:ve,children:(Q,pe)=>{fe();var _=we();y(()=>l(_,t.account.passwordReset)),i(Q,_)},$$slots:{default:!0}})};k(V,E=>{e(O)?E(x):E(b,!1)})}a(W),y(()=>{var E;l(L,t.account.federatedConvertPassword1),l(F,((E=p.authProvider)==null?void 0:E.name)||"UNKNOWN"),l(ye,t.account.federatedConvertPassword2)}),i(f,W)};k(m,f=>{e(o)==="federated"&&f(P)})}var c=v(m,2);{var S=f=>{var W=nt(),M=j(W),L=r(M,!0);a(M);var A=v(M,2),J=r(A,!0);a(A);var F=v(A,2),de=r(F,!0);a(F);var se=v(F,2),ye=r(se);xe(ye,{level:2,onclick:()=>n(d,!0),children:(V,x)=>{fe();var b=we();y(()=>l(b,t.account.convertAccount)),i(V,b)},$$slots:{default:!0}}),a(se),y(()=>{l(L,t.account.accTypePasskeyText1),l(J,t.account.accTypePasskeyText2),l(de,t.account.accTypePasskeyText3)}),i(f,W)};k(c,f=>{(e(o)==="passkey"||e(o)==="federated_passkey")&&!e(d)&&f(S)})}var te=v(c,2);{var ue=f=>{var W=dt(),M=j(W),L=r(M),A=ke(()=>!(e(o)==="password"&&e(C).length<1));st(L,{get inputWidth(){return e(T)},get hideCurrentPassword(){return e(A)},get passwords(){return e(z)},set passwords(b){n(z,h(b))},get isValid(){return e($)},set isValid(b){n($,h(b))}});var J=v(L,2),F=r(J);xe(F,{onclick:D,level:1,get isLoading(){return e(w)},children:(b,E)=>{fe();var Q=we();y(()=>l(Q,t.common.save)),i(b,Q)},$$slots:{default:!0}});var de=v(F,2);{var se=b=>{var E=ot(),Q=r(E);va(Q,{}),a(E),Ue(3,E,()=>He),i(b,E)},ye=b=>{var E=ge(),Q=j(E);{var pe=X=>{var oe=it(),_e=r(oe,!0);a(oe),y(()=>l(_e,e(u))),Ue(3,oe,()=>He),i(X,oe)},_=X=>{var oe=ge(),_e=j(oe);{var Ie=be=>{var Pe=lt(),Qe=r(Pe);xe(Qe,{level:3,onclick:()=>n(d,!1),children:(Se,ea)=>{fe();var De=we();y(()=>l(De,t.common.cancel)),i(Se,De)},$$slots:{default:!0}}),a(Pe),i(be,Pe)};k(_e,be=>{e(d)&&!e(w)&&be(Ie)},!0)}i(X,oe)};k(Q,X=>{e(u)?X(pe):X(_,!1)},!0)}i(b,E)};k(de,b=>{e(O)?b(se):b(ye,!1)})}a(J),a(M);var V=v(M,2);{var x=b=>{var E=ct(),Q=r(E),pe=r(Q,!0);a(Q);var _=v(Q,2),X=r(_,!0);a(_);var oe=v(_,2);xe(oe,{level:2,onclick:ie,children:(_e,Ie)=>{fe();var be=we();y(()=>l(be,t.account.convertAccount)),i(_e,be)},$$slots:{default:!0}}),a(E),y(()=>{l(pe,t.account.convertAccount),l(X,t.account.convertAccountP1)}),i(b,E)};k(V,b=>{!e(d)&&e(H)&&b(x)})}i(f,W)};k(te,f=>{(e(o)==="password"||e(o)==="federated_password"||e(d))&&f(ue)})}a(ne),i(ee,ne),Te()}function pt(ee,p){ee.code==="Enter"&&p()}var mt=I('<div class="flex"><div class="label font-label noselect svelte-1xf5lr3"><!></div> <label class="switch svelte-1xf5lr3"><input type="checkbox" class="svelte-1xf5lr3"> <span class="slider slider-round svelte-1xf5lr3"></span></label></div>');function Wa(ee,p){qe(p,!0);let s=$e(p,"checked",15,!1),t=$e(p,"ariaLabel",3,""),T=$e(p,"name",3,"");function o(){s(!s())}var C=mt(),$=r(C),d=r($);$r(d,()=>p.children),a($);var w=v($,2),u=r(w);vr(u),u.__click=o,u.__keydown=[pt,o],fe(2),a(w),a(C),y(()=>{ua($,"width",p.labelWidth),Ve(u,"name",T()),u.disabled=p.disabled,Ve(u,"aria-checked",s()),Ve(u,"aria-label",t())}),xr(u,s),i(ee,C),Te()}Oa(["click","keydown"]);var ft=I("<div><p> </p> <!></div>"),gt=I('<div class="success svelte-5kivuv"><!></div>'),ht=I('<div class="err svelte-5kivuv"> </div>'),wt=I('<div class="container svelte-5kivuv"><p> </p> <p><!></p> <div class="switch svelte-5kivuv"><!></div> <div class="switch svelte-5kivuv"><!></div> <!> <div class="bottom svelte-5kivuv"><!> <!></div></div>');function Ma(ee,p){qe(p,!0);let s=$e(p,"webIdData",15),t=Ae();const T="14rem";let o=q(""),C=q(!1),$=q(!!s().custom_triples),d=da(s().user_id);Je(()=>{e(C)&&setTimeout(()=>{n(C,!1)},3e3)});async function w(){n(o,"");let m=await hr(s().user_id,s());if(m.ok)n(C,!0);else{let P=await m.json();n(o,h(P.message))}}var u=wt(),O=r(u),R=r(O,!0);a(O);var z=v(O,2),H=r(z);_r(H,{href:d,target:"_blank",children:(m,P)=>{var c=ge(),S=j(c);$a(S,()=>d.replace("/auth/","/auth/<wbr/>")),i(m,c)},$$slots:{default:!0}}),a(z);var ae=v(z,2),ie=r(ae);Wa(ie,{ariaLabel:"E-Mail",labelWidth:T,get checked(){return s().expose_email},set checked(m){s(s().expose_email=m,!0)},children:(m,P)=>{fe();var c=we("E-Mail");i(m,c)},$$slots:{default:!0}}),a(ae);var D=v(ae,2),N=r(D);Wa(N,{get ariaLabel(){return t.account.webIdExpertMode},labelWidth:T,get checked(){return e($)},set checked(m){n($,h(m))},children:(m,P)=>{fe();var c=we();y(()=>l(c,t.account.webIdExpertMode)),i(m,c)},$$slots:{default:!0}}),a(D);var U=v(D,2);{var Y=m=>{var P=ft(),c=r(P),S=r(c,!0);a(c);var te=v(c,2);Ir(te,{placeholder:"FOAF",rows:15,get value(){return s().custom_triples},set value(ue){s(s().custom_triples=ue,!0)}}),a(P),y(()=>l(S,t.account.webIdDescData)),Ue(3,P,()=>cr),i(m,P)};k(U,m=>{e($)&&m(Y)})}var le=v(U,2),ve=r(le);xe(ve,{onclick:w,children:(m,P)=>{fe();var c=we();y(()=>l(c,t.common.save)),i(m,c)},$$slots:{default:!0}});var ne=v(ve,2);{var Z=m=>{var P=gt(),c=r(P);va(c,{}),a(P),Ue(3,P,()=>He),i(m,P)},g=m=>{var P=ge(),c=j(P);{var S=te=>{var ue=ht(),f=r(ue,!0);a(ue),y(()=>l(f,e(o))),Ue(3,ue,()=>He),i(te,ue)};k(c,te=>{e(o)&&te(S)},!0)}i(m,P)};k(ne,m=>{e(C)?m(Z):m(g,!1)})}a(le),a(u),y(()=>l(R,t.account.webIdDesc)),i(ee,u),Te()}function yt(ee){Na(ee,{viewMode:"account"})}var bt=I("<h3> </h3>"),kt=I('<div class="headerPhone svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="innerPhone svelte-k6hxbm"><!></div></div>',1),$t=I('<div class="header svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="inner svelte-k6hxbm"><!></div></div>',1),xt=I('<!> <div class="wrapper svelte-k6hxbm"><!></div>',1);function _t(ee,p){qe(p,!0);const s=N=>{var U=bt(),Y=r(U,!0);a(U),y(()=>l(Y,`${t().given_name} ${t().family_name||""}`)),i(N,U)};let t=$e(p,"user",15),T=$e(p,"webIdData",15),o=Ae(),C=q(void 0),$=q(h([])),d=ke(()=>{var N;if((N=t().account_type)!=null&&N.startsWith("federated"))return e($).filter(U=>U.id===t().auth_provider_id)[0]}),w=ke(()=>e(C)&&e(C)<500),u=q(h(o.account.navInfo)),O=h(T()?[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,"WebID",o.account.devices,o.account.navLogout]:[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,o.account.devices,o.account.navLogout]);sa(()=>{Pr("v").get()==="devices"&&n(u,h(o.account.devices))}),Je(()=>{e(u)===o.account.navLogout&&rr()});var R=xt(),z=j(R);Cr(z,{id:tr,get value(){return e($)},set value(N){n($,h(N))}});var H=v(z,2),ae=r(H);{var ie=N=>{var U=kt(),Y=j(U),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);Ea(ne,{get tabs(){return O},get selected(){return e(u)},set selected(c){n(u,h(c))}});var Z=v(ne,2),g=r(Z);{var m=c=>{qa(c,{get providers(){return e($)},get authProvider(){return e(d)},viewModePhone:!0,get webIdData(){return T()},get user(){return t()},set user(S){t(S)}})},P=c=>{var S=ge(),te=j(S);{var ue=W=>{Ta(W,{viewModePhone:!0,get user(){return t()},set user(M){t(M)}})},f=W=>{var M=ge(),L=j(M);{var A=F=>{La(F,{get user(){return t()},get authProvider(){return e(d)},viewModePhone:!0})},J=F=>{var de=ge(),se=j(de);{var ye=x=>{za(x,{get user(){return t()}})},V=x=>{var b=ge(),E=j(b);{var Q=_=>{Ma(_,{get webIdData(){return T()},set webIdData(X){T(X)}})},pe=_=>{var X=ge(),oe=j(X);{var _e=Ie=>{Na(Ie,{viewMode:"account"})};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,X)};k(E,_=>{e(u)==="WebID"?_(Q):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(V,!1)},!0)}i(F,de)};k(L,F=>{e(u)===o.common.password?F(A):F(J,!1)},!0)}i(W,M)};k(te,W=>{e(u)===o.account.navEdit?W(ue):W(f,!1)},!0)}i(c,S)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(Z),a(ve),i(N,U)},D=N=>{var U=$t(),Y=j(U),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);Ea(ne,{get tabs(){return O},center:!0,get selected(){return e(u)},set selected(c){n(u,h(c))}});var Z=v(ne,2),g=r(Z);{var m=c=>{qa(c,{get webIdData(){return T()},get providers(){return e($)},get authProvider(){return e(d)},get user(){return t()},set user(S){t(S)}})},P=c=>{var S=ge(),te=j(S);{var ue=W=>{Ta(W,{get user(){return t()},set user(M){t(M)}})},f=W=>{var M=ge(),L=j(M);{var A=F=>{La(F,{get user(){return t()},get authProvider(){return e(d)}})},J=F=>{var de=ge(),se=j(de);{var ye=x=>{za(x,{get user(){return t()}})},V=x=>{var b=ge(),E=j(b);{var Q=_=>{Ma(_,{get webIdData(){return T()},set webIdData(X){T(X)}})},pe=_=>{var X=ge(),oe=j(X);{var _e=Ie=>{yt(Ie)};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,X)};k(E,_=>{e(u)==="WebID"?_(Q):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(V,!1)},!0)}i(F,de)};k(L,F=>{e(u)===o.common.password?F(A):F(J,!1)},!0)}i(W,M)};k(te,W=>{e(u)===o.account.navEdit?W(ue):W(f,!1)},!0)}i(c,S)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(Z),a(ve),i(N,U)};k(ae,N=>{e(w)?N(ie):N(D,!1)})}a(H),Ya("innerWidth",N=>n(C,h(N))),i(ee,R),Te()}var It=I("<!> <!> <!>",1);function Ct(ee,p){qe(p,!0);let s=Ae(),t=Pa("account"),T=q(void 0),o=q(void 0),C=q(!1);Je(()=>{let d=t.get();d&&$(d)});async function $(d){const w=d.user_id;if(w){let u=await Promise.all([Ze(`/auth/v1/users/${w}`),Ze(`/auth/v1/users/${w}/webid/data`)]);u[0].body?n(T,h(u[0].body)):sr("account"),u[1].body?n(o,h(u[1].body)):u[1].status===404&&n(o,h({user_id:w,expose_email:!1})),n(C,!0)}else console.error("no user_id in session")}Xa(d=>{y(()=>{var w;return Qa.title=`${((s==null?void 0:s.account.account)||"Account")??""} ${((w=e(T))==null?void 0:w.email)??""}`})}),Dr(ee,{children:(d,w)=>{Nr(d,{children:(u,O)=>{var R=It(),z=j(R);{var H=D=>{_t(D,{get user(){return e(T)},set user(N){n(T,h(N))},get webIdData(){return e(o)},set webIdData(N){n(o,h(N))}})};k(z,D=>{e(C)&&t&&e(T)&&D(H)})}var ae=v(z,2);Er(ae,{absolute:!0});var ie=v(ae,2);qr(ie,{absolute:!0}),i(u,R)},$$slots:{default:!0}})},$$slots:{default:!0}}),Te()}export{Ct as component};
