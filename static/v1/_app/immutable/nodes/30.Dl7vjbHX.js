import"../chunks/disclose-version.BDr9Qe-U.js";import{p as ur,k as pe,f as m,a as pr,t as b,$ as Ae,g as e,b as s,s as o,d as f,c as u,a9 as q,r as p,y as ne}from"../chunks/index-client.BTDbhFDr.js";import{s as l}from"../chunks/render.Bnf33Vuq.js";import{i as v}from"../chunks/if.DAPrgfY3.js";import{a as t,t as g,c as K,b as N}from"../chunks/template.WjkCsOA4.js";import{h as vr}from"../chunks/svelte-head.j24Rpelw.js";import{t as Se,d as Ve}from"../chunks/index.C-OHSz9E.js";import{p as w}from"../chunks/proxy.RLXrsQTM.js";import{t as wr,u as mr}from"../chunks/helpers.DwhnXD2f.js";import{T as fr,B as E}from"../chunks/ThemeSwitch.roIqycWj.js";import{P as gr}from"../chunks/PasswordPolicy.Cl5PT5DD.js";import{I as hr}from"../chunks/Input.CUSPvo5Z.js";import{W as $r}from"../chunks/WebauthnRequest.DdM1Tehs.js";import{u as yr,L as _r}from"../chunks/LangSelector.C4OT_tcu.js";import{u as kr}from"../chunks/i18n.svelte.CR36i7o7.js";import{M as Rr,C as br}from"../chunks/ContentCenter.BfmJnKUc.js";import{T as Ar}from"../chunks/Template.CAvnUEat.js";import{u as xr}from"../chunks/param.svelte.Bo6XdOlX.js";import{I as Te}from"../chunks/InputPassword.CdjaKT40.js";import{A as Ue,w as Lr}from"../chunks/A._XWgsO21.js";import{F as Oe}from"../chunks/Form.D12CCp_z.js";import{a as Cr}from"../chunks/patterns.BdncpE46.js";var Pr=g('<!> <!> <!> <div class="generate svelte-1w50bpj"><!></div> <!>',1),qr=g('<div class="dev svelte-1w50bpj"><p>This window shows up during local dev,<br> only to be able to switch modes easily.<br></p> <!> <!></div>'),Nr=g("<p> <br> <br> <br> <!></p>"),jr=g("<div><!></div>"),Ir=g("<!> <!>",1),Wr=g('<div class="success"><p> </p> <p> </p> <!></div>'),Dr=g("<div><!> <!></div>"),Fr=g('<h1> </h1> <p> </p> <p> <!></p> <div class="typeChoice svelte-1w50bpj"><!> <!></div> <!>',1),Mr=g("<h1>Password Reset</h1> <!>",1),Er=g('<div class="err svelte-1w50bpj"> </div>'),Sr=g('<div class="container"><!> <!></div>'),Vr=g("<!> <!> <!>",1),Tr=g("<!> <!> <!> <!>",1);function Ur(ze,Je){ur(Je,!0);const xe=r=>{var h=K(),$=m(h);{var I=c=>{Oe(c,{action:"",onSubmit:Ge,children:(y,W)=>{var V=Pr(),G=m(V);gr(G,{get policy(){return e(n).password_policy},get password(){return e(j)},get accepted(){return e(fe)},set accepted(i){s(fe,w(i))}});var H=o(G,2),D=ne(()=>e(j).length>=e(n).password_policy.length_min);Te(H,{autocomplete:"new-password",get label(){return a.account.passwordNew},get placeholder(){return a.account.passwordNew},get maxLength(){return e(n).password_policy.length_max},required:!0,get showCopy(){return e(D)},width:ve,get ref(){return e(me)},set ref(i){s(me,w(i))},get value(){return e(j)},set value(i){s(j,w(i))},get reportValidity(){return se},set reportValidity(i){se=i}});var d=o(H,2);Te(d,{autocomplete:"new-password",get label(){return a.account.passwordConfirm},get placeholder(){return a.account.passwordConfirm},get maxLength(){return e(n).password_policy.length_max},required:!0,width:ve,get value(){return e(re)},set value(i){s(re,w(i))},get reportValidity(){return te},set reportValidity(i){te=i}});var _=o(d,2),M=u(_);E(M,{level:2,onclick:Qe,children:(i,T)=>{q();var L=N();b(()=>l(L,a.passwordReset.generate)),t(i,L)},$$slots:{default:!0}}),p(_);var F=o(_,2);E(F,{type:"submit",get isLoading(){return e(Z)},children:(i,T)=>{q();var L=N();b(()=>l(L,a.common.save)),t(i,L)},$$slots:{default:!0}}),t(y,V)},$$slots:{default:!0}})};v($,c=>{e(n)&&c(I)})}t(r,h)},ve="20rem";let a=kr(),Ke=yr().get(),n=f(void 0),we=f(void 0),me=f(void 0),Z=f(!1),A=f(""),Q=xr("type","password_reset"),S=f(""),de=f(""),B=f(!1),fe=f(!1),Y=f(void 0),ee=f(""),j=f(""),re=f(""),se,te;pe(()=>{e(S)&&ge()}),pe(()=>{var r;(r=e(we))==null||r.focus()}),pe(()=>{var r;(r=e(me))==null||r.focus()}),pe(()=>{e(B)&&setTimeout(()=>{e(de)?window.location.replace(e(de)):Le()},5e3)});function Le(){window.location.replace("/auth/v1/account")}function Qe(){if(e(n)){let r=mr(e(n).password_policy);s(j,w(r)),s(re,w(r)),requestAnimationFrame(()=>{se==null||se(),te==null||te()})}}async function Be(){if(!e(n)){console.error("template data is undefined");return}if(s(A,""),e(ee).length<1){s(A,w(a.mfa.passkeyNameErr));return}let r=await Lr(e(n).user_id,e(ee),a.authorize.invalidKeyUsed,a.authorize.requestExpired);r.error?s(A,`${a.mfa.errorReg} - ${r.error}`):(ge(),s(B,!0))}async function Ge(){var r;if(s(A,""),!!e(fe)){if(e(j)!==e(re)){s(A,w(a.passwordReset.passwordNoMatch));return}if(e(j).length>256){s(A,"max 256");return}(r=e(n))!=null&&r.needs_mfa?s(Y,"PasswordReset"):await Ce()}}async function Ce(r){var I;if(!e(n))return;s(Z,!0);const h={password:e(j),magic_link_id:e(n).magic_link_id,mfa_code:r};let $=await fetch(`/auth/v1/users/${e(n).user_id}/reset`,{method:"PUT",headers:{"content-type":"application/json","pwd-csrf-token":(I=e(n))==null?void 0:I.csrf_token},body:JSON.stringify(h)});if($.ok)ge(),s(de,w($.headers.get("location")||"/auth/v1/account")),s(B,!0);else{const c=await $.json();s(A,w(c.message))}s(Z,!1)}function He(r){s(A,w(r)),s(Y,void 0)}function Xe(r){s(Y,void 0),r&&"code"in r?Ce(r.code):console.error("invalid webauthn response",r)}function ge(){s(A,""),s(ee,""),s(j,""),s(re,"")}var Pe=Tr();vr(r=>{var h=K(),$=m(h);{var I=y=>{var W=K(),V=m(W);{var G=D=>{b(()=>Ae.title=a.passwordReset.newAccount)},H=D=>{var d=K(),_=m(d);{var M=F=>{b(()=>Ae.title=a.passwordReset.passwordReset)};v(_,F=>{Q.get()==="password_reset"&&F(M)},!0)}t(D,d)};v(V,D=>{var d;(d=Q.get())!=null&&d.startsWith("new_user")?D(G):D(H,!1)})}t(y,W)},c=y=>{Ae.title="Password"};v($,y=>{a?y(I):y(c,!1)})}t(r,h)});var qe=m(Pe);Ar(qe,{id:wr,get value(){return e(n)},set value(r){s(n,w(r))}});var Ne=o(qe,2);{var Ze=r=>{var h=qr(),$=o(u(h),2);E($,{level:2,onclick:()=>Q.set("new_user"),children:(c,y)=>{q();var W=N("new_user");t(c,W)},$$slots:{default:!0}});var I=o($,2);E(I,{level:2,onclick:()=>Q.set("password_reset"),children:(c,y)=>{q();var W=N("password_reset");t(c,W)},$$slots:{default:!0}}),p(h),t(r,h)};v(Ne,r=>{Ke&&r(Ze)})}var je=o(Ne,2);Rr(je,{children:(r,h)=>{br(r,{children:($,I)=>{var c=Vr(),y=m(c);{var W=d=>{$r(d,{get userId(){return e(n).user_id},get purpose(){return e(Y)},onSuccess:Xe,onError:He})};v(y,d=>{e(Y)&&e(n)&&d(W)})}var V=o(y,2);{var G=d=>{var _=Nr(),M=u(_),F=o(M,2),i=o(F,4),T=o(i),L=ne(()=>e(de)||"/auth/v1/account");Ue(T,{get href(){return e(L)},children:(he,Ie)=>{q();var $e=N("Account");t(he,$e)},$$slots:{default:!0}}),p(_),b(()=>{l(M,`${a.passwordReset.success1??""} `),l(F,` ${a.passwordReset.success2??""} `),l(i,` ${a.passwordReset.success3??""} `)}),t(d,_)},H=d=>{var _=K(),M=m(_);{var F=i=>{var T=Sr(),L=u(T);{var he=C=>{var k=Fr(),U=m(k),ye=u(U,!0);p(U);var O=o(U,2),z=u(O,!0);p(O);var ae=o(O,2),We=u(ae),rr=o(We);Ue(rr,{get href(){return a.passwordReset.fidoLink},target:"_blank",children:(R,P)=>{q();var x=N("FIDO Alliance");t(R,x)},$$slots:{default:!0}}),p(ae);var _e=o(ae,2),De=u(_e),sr=ne(()=>e(S)?3:1);E(De,{get level(){return e(sr)},onclick:()=>s(S,"passkey"),get isLoading(){return e(Z)},children:(R,P)=>{q();var x=N();b(()=>l(x,a.passwordReset.passwordless)),t(R,x)},$$slots:{default:!0}});var tr=o(De,2),ar=ne(()=>e(S)?3:2);E(tr,{get level(){return e(ar)},onclick:()=>s(S,"password"),get isLoading(){return e(Z)},children:(R,P)=>{q();var x=N();b(()=>l(x,a.passwordReset.password)),t(R,x)},$$slots:{default:!0}}),p(_e);var or=o(_e,2);{var ir=R=>{var P=jr(),x=u(P);xe(x),p(P),Se(3,P,()=>Ve),t(R,P)},nr=R=>{var P=K(),x=m(P);{var dr=ke=>{var le=Dr(),Fe=u(le);Oe(Fe,{action:"",onSubmit:Be,children:(oe,ce)=>{var X=Ir(),ue=m(X);hr(ue,{autocomplete:"off",get label(){return a.mfa.passkeyName},get placeholder(){return a.mfa.passkeyName},width:ve,maxLength:32,pattern:Cr,required:!0,get ref(){return e(we)},set ref(J){s(we,w(J))},get value(){return e(ee)},set value(J){s(ee,w(J))}});var ie=o(ue,2),Re=ne(()=>e(B)?2:1);E(ie,{type:"submit",get level(){return e(Re)},children:(J,Me)=>{q();var be=N();b(()=>l(be,a.mfa.register)),t(J,be)},$$slots:{default:!0}}),t(oe,X)},$$slots:{default:!0}});var lr=o(Fe,2);{var cr=oe=>{var ce=Wr(),X=u(ce),ue=u(X,!0);p(X);var ie=o(X,2),Re=u(ie,!0);p(ie);var J=o(ie,2);E(J,{onclick:Le,children:(Me,be)=>{q();var Ee=N();b(()=>l(Ee,a.passwordReset.accountLogin)),t(Me,Ee)},$$slots:{default:!0}}),p(ce),b(()=>{l(ue,a.passwordReset.successPasskey1),l(Re,a.passwordReset.successPasskey2)}),t(oe,ce)};v(lr,oe=>{e(B)&&oe(cr)})}p(le),Se(3,le,()=>Ve),t(ke,le)};v(x,ke=>{e(S)==="passkey"&&ke(dr)},!0)}t(R,P)};v(or,R=>{e(S)==="password"?R(ir):R(nr,!1)})}b(()=>{l(ye,a.passwordReset.newAccount),l(z,a.passwordReset.newAccDesc1),l(We,`${a.passwordReset.newAccDesc2??""} `)}),t(C,k)},Ie=C=>{var k=K(),U=m(k);{var ye=O=>{var z=Mr(),ae=o(m(z),2);xe(ae),t(O,z)};v(U,O=>{var z;(z=Q.get())!=null&&z.startsWith("password_reset")&&O(ye)},!0)}t(C,k)};v(L,C=>{var k;(k=Q.get())!=null&&k.startsWith("new_user")?C(he):C(Ie,!1)})}var $e=o(L,2);{var er=C=>{var k=Er(),U=u(k,!0);p(k),b(()=>l(U,e(A))),t(C,k)};v($e,C=>{e(A)&&C(er)})}p(T),t(i,T)};v(M,i=>{e(n)&&i(F)},!0)}t(d,_)};v(V,d=>{e(B)?d(G):d(H,!1)})}var D=o(V,2);fr(D,{absolute:!0}),t($,c)},$$slots:{default:!0}})},$$slots:{default:!0}});var Ye=o(je,2);_r(Ye,{absolute:!0}),t(ze,Pe),pr()}export{Ur as component};
