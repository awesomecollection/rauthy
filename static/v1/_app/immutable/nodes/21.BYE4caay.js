import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DtyiMpWz.js";import{p as H,c as r,r as l,t as P,a as J,s as v,i as $,ao as oe,h as t,g as a,aq as ve,f as K}from"../chunks/index-client.DAoU_hDn.js";import{s as k}from"../chunks/render.mNhspeV3.js";import{i as Q}from"../chunks/if.BANCODOf.js";import{e as V}from"../chunks/each.DTG73tix.js";import{a as b,t as _,d as ne,e as W}from"../chunks/template.DcxtE4ym.js";import{s as ce}from"../chunks/index.DER1jHiU.js";import{p as d}from"../chunks/proxy.D3ASEzk3.js";import{b as pe,c as me,e as Y}from"../chunks/dataFetchingAdmin.D7RWqeRL.js";import{k as N,r as be}from"../chunks/helpers.BV-akmwW.js";import{B as ge}from"../chunks/Button.CKHLXer8.js";import{O as ue,P as fe}from"../chunks/Pagination.DF9sn7Vj.js";import{P as he}from"../chunks/PaginationServer.CSS8vRPq.js";import{t as we}from"../chunks/class.DWa3OhYO.js";import{p as Z}from"../chunks/props.VJ8UyA45.js";import{C as xe}from"../chunks/CheckIcon.CrU43zqd.js";import{E as Ie}from"../chunks/ExpandContainer.mM6ZiTQe.js";import{T as U}from"../chunks/OptionSelect.CBlj_bre.js";var $e=_('<div class="uid svelte-psgb3d"> </div>'),ke=_('<div class="ip svelte-psgb3d"> </div>'),Se=_('<div class="date svelte-psgb3d"> </div>'),_e=_('<div class="header svelte-psgb3d"><!> <div class="header svelte-psgb3d"><!> <!></div></div>'),Ce=_('<div class="details svelte-psgb3d"><div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">Session ID:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">User ID:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">Expires:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">Last Seen:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">State:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">IP:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">MFA:</div> <!></div></div>'),Pe=_('<div class="container svelte-psgb3d"><!></div>');function ee(F,q){H(q,!0);let n=Z(q,"session",27,()=>d({})),y=Z(q,"now",11,0);var h=Pe(),D=r(h);Ie(D,{header:w=>{var c=_e(),g=r(c);U(g,{text:"User ID",children:(u,A)=>{var o=$e(),S=r(o,!0);l(o),P(()=>k(S,n().user_id)),b(u,o)},$$slots:{default:!0}});var x=v(g,2),p=r(x);U(p,{text:"Peer IP",children:(u,A)=>{var o=ke(),S=r(o,!0);l(o),P(()=>k(S,n().remote_ip)),b(u,o)},$$slots:{default:!0}});var m=v(p,2);U(m,{text:"Last Seen",children:(u,A)=>{var o=Se(),S=r(o,!0);P(()=>k(S,N(n().last_seen))),l(o),b(u,o)},$$slots:{default:!0}}),l(x),l(c),b(w,c)},body:w=>{var c=Ce(),g=r(c),x=v(r(g));l(g);var p=v(g,2),m=v(r(p));l(p);var u=v(p,2),A=v(r(u));P(()=>k(A,` ${N(n().exp)??""}`)),l(u);var o=v(u,2),S=v(r(o));P(()=>k(S,` ${N(n().last_seen)??""}`)),l(o);var B=v(o,2),T=v(r(B));l(B);var L=v(B,2),M=v(r(L));l(L);var O=v(L,2),R=v(r(O),2);xe(R,{get check(){return n().is_mfa}}),l(O),l(c),P(()=>{k(x,` ${n().id??""}`),k(m,` ${n().user_id??""}`),k(T,` ${n().state??""}`),k(M,` ${n().remote_ip??""}`)}),b(w,c)},$$slots:{header:!0,body:!0}}),l(h),P(()=>we(h,"expired",n().exp<y())),b(F,h),J()}var ye=_('<div class="svelte-1rjd8yh"><!></div>'),De=_('<div class="svelte-1rjd8yh"><!></div>'),Le=_('<div class="content"><div class="row svelte-1rjd8yh"><!> <div class="button svelte-1rjd8yh"><!></div></div> <div id="sessions" class="svelte-1rjd8yh"><!></div> <!></div>');function je(F,q){H(q,!0);let n=$(""),y=$(d([])),h=$(d([])),D=$(d([])),w=$(Date.now()/1e3),c=$(""),g=$(!1),x=$(15),p=$(""),m=$(1),u=[{label:"User ID",callback:(e,s)=>{var i;return(i=e.user_id)==null?void 0:i.toLowerCase().includes(s.toLowerCase())}},{label:"Session ID",callback:(e,s)=>e.id.toLowerCase().includes(s.toLowerCase())},{label:"IP",callback:(e,s)=>{var i;return(i=e.remote_ip)==null?void 0:i.toLowerCase().includes(s.toLowerCase())}}],A=[{label:"Expires",callback:(e,s)=>e.exp-s.exp},{label:"Last Seen",callback:(e,s)=>e.last_seen-s.last_seen},{label:"Session ID",callback:(e,s)=>e.id.localeCompare(s.id)},{label:"User ID",callback:(e,s)=>{var i;return(i=e.user_id)==null?void 0:i.localeCompare(s.user_id)}},{label:"State",callback:(e,s)=>e.state.localeCompare(s.state)},{label:"IP",callback:(e,s)=>{var i;return(i=e.remote_ip)==null?void 0:i.localeCompare(s.remote_ip)}}];oe(()=>{o()});async function o(e,s,i,I){let f;if(e===!0?i&&a(m)===2?f=await Y(I||a(x),s,void 0,!1):f=await Y(I||a(x),s,a(p),i):f=await pe(),!f.ok)t(n,"Error fetching sessions: "+f.body.message);else{f.status===206?(t(x,d(Number.parseInt(f.headers.get("x-page-size"),10))),t(p,d(f.headers.get("x-continuation-token"))),t(c,"session")):t(c,"");let C=await f.json();t(y,d([...C])),t(h,d([...C])),t(w,Date.now()/1e3)}}async function S(e,s){await o(!0,e,s),s?t(m,a(m)-1):t(m,a(m)+1)}async function B(e){t(p,""),await o(!0,0,!1,e),t(m,1)}async function T(){let e=await me();if(e.ok)be();else{let s=await e.json();t(n,d(s.message))}t(w,d(new Date))}var L=Le(),M=r(L),O=r(M);ue(O,{get items(){return a(y)},searchOptions:u,orderOptions:A,firstDirReverse:!0,get resItems(){return a(h)},set resItems(e){t(h,d(e))},get useServerSideIdx(){return a(c)},set useServerSideIdx(e){t(c,d(e))},get isSearchFiltered(){return a(g)},set isSearchFiltered(e){t(g,d(e))}});var R=v(O,2);ce(R,"margin-top","-10px");var se=r(R);ge(se,{level:3,$$events:{click:T},children:(e,s)=>{ve();var i=ne("Invalidate All Sessions");b(e,i)},$$slots:{default:!0}}),l(R),l(M);var X=v(M),z=v(X),ae=r(z);{var te=e=>{var s=W(),i=K(s);V(i,19,()=>a(y),I=>I.id,(I,f,C)=>{var j=ye(),G=r(j);ee(G,{get session(){return a(y)[a(C)]},set session(E){a(y)[a(C)]=E},get now(){return a(w)},set now(E){t(w,d(E))}}),l(j),b(I,j)}),b(e,s)},ie=e=>{var s=W(),i=K(s);V(i,19,()=>a(D),I=>I.id,(I,f,C)=>{var j=De(),G=r(j);ee(G,{get session(){return a(D)[a(C)]},set session(E){a(D)[a(C)]=E},get now(){return a(w)},set now(E){t(w,d(E))}}),l(j),b(I,j)}),b(e,s)};Q(ae,e=>{a(c)&&!a(g)?e(te):e(ie,!1)})}l(z);var re=v(z,2);{var le=e=>{he(e,{fetchPageCallback:S,sspPageSizeChange:B,get sspPage(){return a(m)},set sspPage(s){t(m,d(s))},get sspPageSize(){return a(x)},set sspPageSize(s){t(x,d(s))},get sspContinuationToken(){return a(p)},set sspContinuationToken(s){t(p,d(s))}})},de=e=>{fe(e,{get items(){return a(h)},set items(s){t(h,d(s))},get resItems(){return a(D)},set resItems(s){t(D,d(s))}})};Q(re,e=>{a(c)&&!a(g)?e(le):e(de,!1)})}l(L),P(()=>k(X,` ${a(n)??""} `)),b(F,L),J()}function Ee(F){je(F,{})}export{Ee as component};
