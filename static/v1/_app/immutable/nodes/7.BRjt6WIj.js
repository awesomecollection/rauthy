import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DJEB66nf.js";import{p as H,a6 as W,s as f,c as u,a as J,y as e,ar as G,t as N,r as m,K as fe,ab as F,A as C,z as s,f as R,ap as ke}from"../chunks/index-client.Di99sPv0.js";import{s as j,r as Ae}from"../chunks/render.Cjc4CIr8.js";import{i as B}from"../chunks/if.DgeUjMU2.js";import{e as ge,i as Ce}from"../chunks/each.DxtmCefA.js";import{a as y,t as P,d as M,e as ue}from"../chunks/template.BEKX6jgL.js";import{s as oe,d as Le}from"../chunks/class.BCapn1bP.js";import{t as ee,s as re,a as ne}from"../chunks/index.BnJsthXQ.js";import{p as g}from"../chunks/proxy.BQ2dmY0t.js";import{d as he,c as Ve,b as Te,f as Pe}from"../chunks/fetch.DxJS_Pk_.js";import{C as Oe}from"../chunks/ContentAdmin.BWiTVMIY.js";import{N as De}from"../chunks/NavButtonTile.BjzIPqLk.js";import{N as Ne}from"../chunks/NavSub.D01RyWn2.js";import{B as je}from"../chunks/ButtonAddModal.DLvLHw-v.js";import{u as Ee}from"../chunks/param.svelte.CXpV4U96.js";import{u as ae}from"../chunks/i18n_admin.svelte.DI6l2V4l.js";import{O as Ke}from"../chunks/OrderSearchBar.CS_Hs5DC.js";import{p as Q,r as Ue}from"../chunks/props.ClgLgKUv.js";import{D as ye}from"../chunks/helpers.D3KrX4pz.js";import{B as X}from"../chunks/Button.D-14suAe.js";import{I as qe}from"../chunks/IconCheck.K_67dytm.js";import{L as Ge}from"../chunks/LabeledValue.D0BXhgF2.js";import{I as te}from"../chunks/InputCheckbox.BTJtACoe.js";import{I as be}from"../chunks/InputDateTimeCombo.C0589-57.js";import{u as ie}from"../chunks/i18n.svelte.Bc6aINkd.js";import{f as se,a as me}from"../chunks/form.DekAF1-C.js";import{k as $e}from"../chunks/key.DB5VoPJt.js";import{h as pe}from"../chunks/html.CddWxNhc.js";import{I as Re,a as Be,b as Fe}from"../chunks/PasswordInput.FVm9hQ20.js";import{b as Me}from"../chunks/input.NYWjhvEE.js";import{I as Ze}from"../chunks/InputPassword.Bl28d8lQ.js";import{T as He}from"../chunks/Tabs.CTmGp6-A.js";import{I as We}from"../chunks/Input.-lhBsjDF.js";import{j as Je}from"../chunks/patterns.BDQXnG3O.js";import{F as Qe}from"../chunks/Form.C0Yvca1O.js";var Xe=P('<div class="center svelte-opxw4z"><!></div>'),Ye=P("<div><!></div>"),er=P('<div class="row svelte-opxw4z"><!> <div class="center svelte-opxw4z"><!></div> <div class="center svelte-opxw4z"><!></div> <div class="center svelte-opxw4z"><!></div> <div class="center svelte-opxw4z"><!></div></div>'),rr=P('<div class="matrix svelte-opxw4z"><div class="row svelte-opxw4z"><div></div> <!> <!> <!> <!></div> <!></div>');function we(E,o){H(o,!0),Q(o,"finalize",15)(z);let h=g([["Blacklist",!1,!1,!1,!1],["Clients",!1,!1,!1,!1],["Events",!1,!1,!1,!1],["Generic",!1,!1,!1,!1],["Groups",!1,!1,!1,!1],["Roles",!1,!1,!1,!1],["Secrets",!1,!1,!1,!1],["Sessions",!1,!1,!1,!1],["Scopes",!1,!1,!1,!1],["UserAttributes",!1,!1,!1,!1],["Users",!1,!1,!1,!1]]);W(()=>{if(T(),o.key)for(let t of o.key.access){let r;switch(t.group){case"Blacklist":r=0;break;case"Clients":r=1;break;case"Events":r=2;break;case"Generic":r=3;break;case"Groups":r=4;break;case"Roles":r=5;break;case"Secrets":r=6;break;case"Sessions":r=7;break;case"Scopes":r=8;break;case"UserAttributes":r=9;break;case"Users":r=10;break}if(r===void 0){console.error("invalid idx during access key buildup");return}t.access_rights.includes("create")&&(h[r][1]=!0),t.access_rights.includes("read")&&(h[r][2]=!0),t.access_rights.includes("update")&&(h[r][3]=!0),t.access_rights.includes("delete")&&(h[r][4]=!0)}});function z(){let t=[];for(let r of h){let w=[];r[1]&&w.push("create"),r[2]&&w.push("read"),r[3]&&w.push("update"),r[4]&&w.push("delete"),w.length>0&&t.push({group:r[0],access_rights:w})}return t}function T(){for(let t of h)t[1]=!1,t[2]=!1,t[3]=!1,t[4]=!1}function c(t){for(let r of h)if(r[0]===t){r[1]&&r[2]&&r[3]&&r[4]?(r[1]=!1,r[2]=!1,r[3]=!1,r[4]=!1):(r[1]=!0,r[2]=!0,r[3]=!0,r[4]=!0);break}}function x(t){let r;switch(t){case"create":r=1;break;case"read":r=2;break;case"update":r=3;break;case"delete":r=4;break}if(!r){console.error("logic error in toggleRight, idx is undefined");return}let w=!0;for(let k of h)if(!k[r]){w=!1;break}for(let k of h)k[r]=!w}var b=rr();{const t=(w,k=fe)=>{var p=Xe(),V=u(p),n=F(()=>`Toggle: ${k()}`);X(V,{get ariaLabel(){return e(n)},invisible:!0,onclick:()=>x(k()),children:(d,l)=>{G();var _=M();N(()=>j(_,k())),y(d,_)},$$slots:{default:!0}}),m(p),y(w,p)},r=(w,k=fe)=>{var p=Ye(),V=u(p),n=F(()=>`Toggle: ${k()}`);X(V,{get ariaLabel(){return e(n)},invisible:!0,onclick:()=>c(k()),children:(d,l)=>{G();var _=M();N(()=>j(_,k())),y(d,_)},$$slots:{default:!0}}),m(p),y(w,p)};var L=u(b),S=f(u(L),2);t(S,()=>"create");var I=f(S,2);t(I,()=>"read");var O=f(I,2);t(O,()=>"update");var A=f(O,2);t(A,()=>"delete"),m(L);var $=f(L,2);ge($,17,()=>h,Ce,(w,k,p)=>{var V=er(),n=u(V);r(n,()=>e(k)[0]);var d=f(n,2),l=u(d),_=F(()=>`${e(k)[0]}: create`);te(l,{get ariaLabel(){return e(_)},get checked(){return h[p][1]},set checked(q){h[p][1]=q}}),m(d);var a=f(d,2),i=u(a),v=F(()=>`${e(k)[0]}: read`);te(i,{get ariaLabel(){return e(v)},get checked(){return h[p][2]},set checked(q){h[p][2]=q}}),m(a);var D=f(a,2),U=u(D),K=F(()=>`${e(k)[0]}: update`);te(U,{get ariaLabel(){return e(K)},get checked(){return h[p][3]},set checked(q){h[p][3]=q}}),m(D);var Z=f(D,2),le=u(Z),Y=F(()=>`${e(k)[0]}: delete`);te(le,{get ariaLabel(){return e(Y)},get checked(){return h[p][4]},set checked(q){h[p][4]=q}}),m(Z),m(V),y(w,V)}),m(b)}y(E,b),J()}var ar=P("<div><!></div>"),tr=P('<div class="err"> </div>'),ir=P('<!> <!> <!> <!> <div class="btn svelte-1j50zcx"><!> <!> <!></div>',1);function sr(E,o){H(o,!0);let h=ie(),z=ae();const T=se();let c=C(""),x=C(!1),b=C(!!o.key.expires),L=C(g(se())),S=C(g(me())),I=C(void 0);W(()=>{o.key.name&&s(b,!!o.key.expires)}),W(()=>{if(e(b)){let a;o.key.expires?a=new Date(o.key.expires*1e3):a=new Date,s(L,g(se(a))),s(S,g(me(a)))}});async function O(){if(s(c,""),!e(I)){console.error("finalizeMatrix is undefined");return}let a={name:o.key.name,access:e(I)()};if(a.access.length===0){s(c,"Grant the API Key at least one permission");return}if(e(b)){let v=ye(e(L),e(S));if(!v){s(c,"Invalid Date Input: User Expires");return}a.exp=v}let i=await he(`/auth/v1/api_keys/${o.key.name}`,a);i.error?s(c,g(i.error.message)):(o.onSave(),s(x,!0),setTimeout(()=>{s(x,!1),o.onSave()},2e3))}var A=ir(),$=R(A);Ge($,{get label(){return z.api_key.keyName},children:(a,i)=>{G();var v=M();N(()=>j(v,o.key.name)),y(a,v)},$$slots:{default:!0}});var t=f($,2);te(t,{get ariaLabel(){return z.api_key.limitedValidity},get checked(){return e(b)},set checked(a){s(b,g(a))},children:(a,i)=>{G();var v=M();N(()=>j(v,z.api_key.limitedValidity)),y(a,v)},$$slots:{default:!0}});var r=f(t,2);{var w=a=>{var i=ar(),v=u(i);be(v,{get label(){return z.api_key.expires},withTime:!0,min:T,required:!0,get value(){return e(L)},set value(D){s(L,g(D))},get timeValue(){return e(S)},set timeValue(D){s(S,g(D))}}),m(i),ee(3,i,()=>re),y(a,i)};B(r,a=>{e(b)&&a(w)})}var k=f(r,2);we(k,{get key(){return o.key},get finalize(){return e(I)},set finalize(a){s(I,g(a))}});var p=f(k,2),V=u(p);X(V,{onclick:O,children:(a,i)=>{G();var v=M();N(()=>j(v,h.common.save)),y(a,v)},$$slots:{default:!0}});var n=f(V,2);{var d=a=>{qe(a,{})};B(n,a=>{e(x)&&a(d)})}var l=f(n,2);{var _=a=>{var i=tr(),v=u(i,!0);m(i),N(()=>j(v,e(c))),y(a,i)};B(l,a=>{e(c)&&a(_)})}m(p),y(E,A),J()}var or=P("<div><!></div>"),nr=P("<div><!></div>"),lr=P("<div><!></div>"),vr=P('<div><div class="iconsOuter svelte-1pc4fk7"><div class="iconsInner svelte-1pc4fk7"><!> <!></div></div> <textarea></textarea></div>');function xe(E,o){H(o,!0);let h=Q(o,"ariaLabel",3,""),z=Q(o,"value",3,""),T=Q(o,"rows",3,10),c=Q(o,"cols",3,60),x=Q(o,"show",15,!1),b=Q(o,"width",3,"min(25rem, calc(100dvw - .5rem))"),L=Ue(o,["$$slots","$$events","$$legacy","ariaLabel","value","rows","cols","show","width"]),S=ie(),I=C(""),O=C("");W(()=>{x()?s(O,z()):s(O,g(e(I)))}),ke(()=>{for(let l=0;l<z().length;l++)s(I,e(I)+"*");s(O,g(e(I))),x(!1)});function A(){navigator.clipboard.writeText(z())}function $(){x(!x())}var t=vr(),r=u(t),w=u(r),k=u(w),p=F(()=>x()?S.common.hide:S.common.show);X(k,{get ariaLabel(){return e(p)},invisible:!0,onclick:$,children:(l,_)=>{var a=ue(),i=R(a);{var v=U=>{var K=or(),Z=u(K);Be(Z,{width:22}),m(K),N(()=>oe(K,"title",S.common.hide)),y(U,K)},D=U=>{var K=nr(),Z=u(K);Fe(Z,{width:22}),m(K),N(()=>oe(K,"title",S.common.show)),y(U,K)};B(i,U=>{x()?U(v):U(D,!1)})}y(l,a)},$$slots:{default:!0}});var V=f(k,2);X(V,{get ariaLabel(){return S.common.copyToClip},invisible:!0,onclick:A,children:(l,_)=>{var a=lr(),i=u(a);Re(i,{}),m(a),N(()=>oe(a,"title",S.common.copyToClip)),y(l,a)},$$slots:{default:!0}}),m(w),m(r);var n=f(r,2);Ae(n);let d;m(t),N(()=>{ne(t,"width",`${b()}`),d=Le(n,d,{"aria-label":h(),disabled:!0,rows:T(),cols:c(),...L},"svelte-1pc4fk7"),ne(n,"width",b()),ne(n,"padding-right","2.75rem")}),Me(n,()=>e(O),l=>s(O,l)),y(E,t),J()}var cr=P('<div class="secret font-mono svelte-1ii2aob"><!></div> <div><p><!></p> <p><span class="headerCode"><b><code></code></b></span></p></div> <div><p><!></p> <!></div> <div><p><!></p> <!></div>',1),dr=P('<p> </p> <p> </p> <div class="btn svelte-1ii2aob"><!></div> <!> <div class="err"> </div>',1);function ur(E,o){H(o,!0);let h=ie(),z=ae(),T=C(""),c=C(""),x=C(""),b=C("");W(()=>{o.key.name&&s(c,"")});async function L(){var l;let d=await he(`/auth/v1/api_keys/${o.key.name}/secret`);d.text?(s(c,g(d.text)),s(x,`curl -s -H 'Authorization: API-Key ${d.text}' ${window.location.origin}/auth/v1/api_keys/${o.key.name}/test`),s(b,`${e(x)} | jq`)):s(T,g(((l=d.error)==null?void 0:l.message)||"Error"))}var S=dr(),I=R(S),O=u(I,!0);m(I);var A=f(I,2),$=u(A,!0);m(A);var t=f(A,2),r=u(t),w=F(()=>e(c)?3:1);X(r,{get level(){return e(w)},onclick:L,children:(d,l)=>{G();var _=M();N(()=>j(_,h.passwordReset.generate)),y(d,_)},$$slots:{default:!0}}),m(t);var k=f(t,2);{var p=d=>{var l=cr(),_=R(l),a=u(_);Ze(a,{autocomplete:"off",get value(){return e(c)},label:"API Key",placeholder:"API Key",disabled:!0,showCopy:!0,width:"min(25rem, calc(100dvw - .5rem))"}),m(_);var i=f(_,2),v=u(i),D=u(v);pe(D,()=>z.api_key.generate3),m(v);var U=f(v,2),K=u(U),Z=u(K),le=u(Z);le.textContent="API-Key <api_key>",m(Z),m(K),m(U),m(i);var Y=f(i,2),q=u(Y),_e=u(q);pe(_e,()=>z.api_key.generate4),m(q);var Se=f(q,2);$e(Se,()=>e(b),de=>{xe(de,{ariaLabel:"curl text command with jq",rows:5,get value(){return e(b)}})}),m(Y);var ve=f(Y,2),ce=u(ve),ze=u(ce);pe(ze,()=>z.api_key.generate5),m(ce);var Ie=f(ce,2);$e(Ie,()=>e(b),de=>{xe(de,{ariaLabel:"curl text command simple",rows:5,get value(){return e(x)}})}),m(ve),ee(3,_,()=>re,()=>({duration:150})),ee(3,i,()=>re,()=>({duration:150})),ee(3,Y,()=>re,()=>({duration:150})),ee(3,ve,()=>re,()=>({duration:150})),y(d,l)};B(k,d=>{e(c)&&d(p)})}var V=f(k,2),n=u(V,!0);m(V),N(()=>{j(O,z.api_key.generate1),j($,z.api_key.generate2),j(n,e(T))}),y(E,S),J()}var mr=P('<div class="err"> </div>'),pr=P("<p> </p> <!> <!>",1);function fr(E,o){H(o,!0);let h=ie(),z=ae(),T=C("");async function c(){s(T,"");let A=await Ve(`/auth/v1/api_keys/${o.key.name}`);A.error?s(T,g(A.error.message)):o.onSave()}var x=pr(),b=R(x),L=u(b,!0);m(b);var S=f(b,2);X(S,{level:-1,onclick:c,children:(A,$)=>{G();var t=M();N(()=>j(t,h.common.delete)),y(A,t)},$$slots:{default:!0}});var I=f(S,2);{var O=A=>{var $=mr(),t=u($,!0);m($),N(()=>j(t,e(T))),y(A,$)};B(I,A=>{e(T)&&A(O)})}N(()=>j(L,z.api_key.delete1)),y(E,x),J()}var kr=P('<div><div class="flex"><!></div> <!></div>');function gr(E,o){H(o,!0);let h=Q(o,"key",15),z=ae();const T=[z.tabs.config,"Secret",z.tabs.delete];let c=C(g(T[0])),x=C(void 0);W(()=>{var $;h().name&&(($=e(x))==null||$())});var b=kr(),L=u(b),S=u(L);He(S,{tabs:T,get selected(){return e(c)},set selected($){s(c,g($))},get focusFirst(){return e(x)},set focusFirst($){s(x,g($))}}),m(L);var I=f(L,2);{var O=$=>{sr($,{get onSave(){return o.onSave},get key(){return h()},set key(t){h(t)}})},A=$=>{var t=ue(),r=R(t);{var w=p=>{ur(p,{get key(){return h()}})},k=p=>{var V=ue(),n=R(V);{var d=l=>{fr(l,{get key(){return h()},get onSave(){return o.onSave}})};B(n,l=>{e(c)===z.tabs.delete&&l(d)},!0)}y(p,V)};B(r,p=>{e(c)==="Secret"?p(w):p(k,!1)},!0)}y($,t)};B(I,$=>{e(c)===z.tabs.config?$(O):$(A,!1)})}m(b),y(E,b),J()}var hr=P("<div><!></div>"),yr=P('<!> <!> <!> <!> <!> <div class="err"> </div>',1),br=P('<div class="container svelte-1dweyfr"><!></div>');function $r(E,o){H(o,!0);const h=se();let z=ie(),T=ae(),c=C(""),x=C(!1),b=C(void 0),L=C(""),S=C(g(se())),I=C(g(me()));async function O(t,r){var V;s(c,"");for(let n of o.keys)if(n.name===e(L)){s(c,"Name already exists");return}let w=(V=e(b))==null?void 0:V();if(!w){console.error("access rights is undefined");return}let k={name:e(L),access:w};if(k.access.length===0){s(c,"Grant the new API Key at least one permission");return}if(e(x)){if(console.log(),!e(S)||!e(I)){s(c,"Disable expiry or provide an valid date and time");return}let n=ye(e(S),e(I));if(!n){s(c,"Invalid Date Input: User Expires");return}k.exp=n}let p=await Te(t.action,k);p.error?s(c,g(p.error.message)):o.onSave()}var A=br(),$=u(A);Qe($,{action:"/auth/v1/api_keys",onSubmit:O,children:(t,r)=>{var w=yr(),k=R(w);We(k,{get label(){return T.api_key.keyName},get placeholder(){return T.api_key.keyName},autocomplete:"off",required:!0,min:"2",max:"24",pattern:Je,get value(){return e(L)},set value(i){s(L,g(i))}});var p=f(k,2);te(p,{get ariaLabel(){return T.api_key.limitedValidity},get checked(){return e(x)},set checked(i){s(x,g(i))},children:(i,v)=>{G();var D=M();N(()=>j(D,T.api_key.limitedValidity)),y(i,D)},$$slots:{default:!0}});var V=f(p,2);{var n=i=>{var v=hr(),D=u(v);be(D,{get label(){return T.api_key.expires},withTime:!0,min:h,required:!0,get value(){return e(S)},set value(U){s(S,g(U))},get timeValue(){return e(I)},set timeValue(U){s(I,g(U))}}),m(v),ee(3,v,()=>re),y(i,v)};B(V,i=>{e(x)&&i(n)})}var d=f(V,2);we(d,{get finalize(){return e(b)},set finalize(i){s(b,g(i))}});var l=f(d,2);X(l,{type:"submit",children:(i,v)=>{G();var D=M();N(()=>j(D,z.common.save)),y(i,D)},$$slots:{default:!0}});var _=f(l,2),a=u(_,!0);m(_),N(()=>j(a,e(c))),y(t,w)},$$slots:{default:!0}}),m(A),y(E,A),J()}var wr=P("<div></div> <!>",1),xr=P("<!> <!>",1),_r=P('<div id="keys"><!></div>'),Sr=P(" <!> <!>",1);function zr(E,o){H(o,!0);let h=ae(),z=C(void 0),T=C(""),c=C(g([])),x=C(g([])),b=C(void 0),L=Ee("kn");const S=["Name"],I=["Name"];let O=C(g(I[0])),A=C("");ke(()=>{$()}),W(()=>{s(b,g(e(c).find(n=>n.name===L.get())))}),W(()=>{let n=e(A).toLowerCase();n?e(O)===I[0]&&s(x,g(e(c).filter(d=>{var l;return(l=d.name)==null?void 0:l.includes(n)}))):s(x,g(e(c)))});async function $(){var d;let n=await Pe("/auth/v1/api_keys");n.body?s(c,g(n.body.keys)):s(T,g(((d=n.error)==null?void 0:d.message)||"Error"))}function t(n,d){let l=d==="up";n===S[0]&&e(c).sort((_,a)=>l?_.name.localeCompare(a.name):a.name.localeCompare(_.name))}function r(){var n;(n=e(z))==null||n(),$()}G();var w=Sr(),k=R(w),p=f(k);Ne(p,{paddingTop:"2.1rem",buttonTilesAriaControls:"keys",width:"min(20rem, 100dvw)",thresholdNavSub:700,buttonTiles:n=>{var d=wr(),l=R(d);ne(l,"height",".5rem");var _=f(l,2);ge(_,17,()=>e(x),a=>a.name,(a,i)=>{var v=F(()=>L.get()===e(i).name);De(a,{onclick:()=>L.set(e(i).name),get selected(){return e(v)},children:(D,U)=>{G();var K=M();N(()=>j(K,e(i).name)),y(D,K)},$$slots:{default:!0}})}),y(n,d)},children:(n,d)=>{var l=xr(),_=R(l),a=F(()=>e(c).length===0?1:2);je(_,{get level(){return e(a)},alignRight:!0,get closeModal(){return e(z)},set closeModal(v){s(z,g(v))},children:(v,D)=>{$r(v,{get keys(){return e(c)},onSave:r})},$$slots:{default:!0}});var i=f(_,2);Ke(i,{searchOptions:I,orderOptions:S,onChangeOrder:t,searchWidth:"min(19.5rem, 100dvw - .5rem)",get searchOption(){return e(O)},set searchOption(v){s(O,g(v))},get value(){return e(A)},set value(v){s(A,g(v))}}),y(n,l)},$$slots:{buttonTiles:!0,default:!0}});var V=f(p,2);Oe(V,{children:(n,d)=>{var l=_r(),_=u(l);{var a=i=>{gr(i,{onSave:$,get key(){return e(b)},set key(v){s(b,g(v))}})};B(_,i=>{e(b)&&i(a)})}m(l),N(()=>oe(l,"aria-label",h.common.details)),y(n,l)},$$slots:{default:!0}}),N(()=>j(k,`${e(T)??""} `)),y(E,w),J()}function Ir(E){zr(E,{})}export{Ir as component};
