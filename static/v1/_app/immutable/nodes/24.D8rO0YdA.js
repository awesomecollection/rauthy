import"../chunks/disclose-version.BDr9Qe-U.js";import{t as $,p as Sr,d as n,o as Tr,k as oe,f as V,a as Wr,g as e,$ as Fr,b as t,s as c,c as v,r as d,a9 as fe,y as ge}from"../chunks/index-client.B6iEebqi.js";import{s as S}from"../chunks/render.Bsso_k3p.js";import{i as h}from"../chunks/if.1XSPtMho.js";import{T as jr,a as me,B as he,e as qr}from"../chunks/ThemeSwitch.CRSTiBZD.js";import{a as i,n as Br,t as p,b as we,c as tr}from"../chunks/template.BMDtqFuO.js";import{h as Rr}from"../chunks/svelte-head.BZpVhBz3.js";import{s as E}from"../chunks/index.CmB1UnQy.js";import{p as l}from"../chunks/proxy.CjI65D-A.js";import{p as Ur}from"../chunks/dataFetching.BAtorGRX.js";import{u as Ar,v as Cr,w as Hr,l as Vr,x as Er,h as Nr,c as ar,y as Zr,_ as Dr,P as Yr,z as Gr}from"../chunks/helpers.Cbcu7vP_.js";import{W as Jr}from"../chunks/WebauthnRequest.B12HRIW8.js";import{I as Or}from"../chunks/Input.Bd9f6bUF.js";import{L as Pr,u as Be}from"../chunks/LangSelector.BbriGzIU.js";import{p as Re}from"../chunks/props.C6aLk1Bq.js";import{M as Qr,C as Xr}from"../chunks/ContentCenter.CrmYuxhV.js";import{u as Kr}from"../chunks/i18n.svelte.CSnrsaW1.js";import{T as G}from"../chunks/Template.C8mYZqXV.js";import{u as B}from"../chunks/param.svelte.BdhMoRpL.js";import{I as et}from"../chunks/InputPassword.DGTcf7PR.js";import{F as rt}from"../chunks/Form.2JZBppzc.js";import{B as tt}from"../chunks/ButtonAuthProvider.DuFgUSOU.js";var at=Br('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>');function ot(_e,J){let se=Re(J,"color",3,"var(--col-text)"),u=Re(J,"opacity",3,.9),be=Re(J,"width",3,24);var R=at();E(R,"stroke-width",2),$(()=>{E(R,"width",be()),E(R,"color",se()),E(R,"opacity",u())}),i(_e,R)}var st=p('<img alt="No Logo Available">'),it=p('<a class="home svelte-1rplcwr"><!></a>'),lt=p('<div class="forgotten svelte-1rplcwr"><!></div>'),nt=p("<!> <!>",1),ct=p('<div class="btn flex-col svelte-1rplcwr"><!></div>'),vt=p('<div class="btn flex-col svelte-1rplcwr"><!></div>'),dt=p("<!> <!> <!>",1),ut=p('<a class="reg svelte-1rplcwr" target="_blank"> </a>'),pt=p('<a class="reg svelte-1rplcwr" href="/auth/v1/users/register" target="_blank"> </a>'),ft=p("<!> <!>",1),gt=p('<div class="errMsg svelte-1rplcwr"> </div>'),mt=p('<div class="success svelte-1rplcwr"> </div>'),ht=p('<div class="btn flex-col svelte-1rplcwr"><!></div>'),wt=p('<div class="providers flex-col svelte-1rplcwr"><div class="providersSeparator svelte-1rplcwr"><div class="separator svelte-1rplcwr"></div> <div class="loginWith svelte-1rplcwr"><div class="svelte-1rplcwr"> </div></div></div> <!></div>'),_t=p('<div class="container svelte-1rplcwr"><div class="head svelte-1rplcwr"><div class="logo svelte-1rplcwr"><!></div> <!></div> <div class="name svelte-1rplcwr"><h2> </h2></div> <!> <!> <!> <!> <!> <!></div> <!> <!>',1),bt=p("<!> <!> <!> <!> <!> <!> <!>",1);function $t(_e,J){var Ge;Sr(J,!0);const se="18rem";let u=Kr(),be=Be(),R=ge(()=>Be().get()?"/auth/v1/dev/authorize":"/auth/v1/oidc/authorize"),_=B("client_id").get(),ie=n(""),T=n(""),O=B("redirect_uri").get(),$e=B("nonce").get(),ye=((Ge=B("scope").get())==null?void 0:Ge.split(" "))||[],ze=n(void 0),Le=n(void 0),ke=B("state").get(),P=B("code_challenge").get(),x=B("code_challenge_method").get(),Ue=!1,xe=n(void 0),le=n(l([])),ne=n(void 0),N=n(!1),f=n(""),Q=n(""),ce=n(""),W=n(!1),U=n(!1),ve=n(!1),de=n(!1),ue=n(!1),A=n(!1),Ae=n(""),Ie=n(!1),y=n(l(B("login_hint").get()||"")),F=n(""),Me=n("");Tr(()=>{var r;e(W)||((r=e(ze))==null||r.focus())}),oe(()=>{Ue&&(_!=null&&_.length)&&ir()}),oe(()=>{e(ue)&&setTimeout(()=>{t(ue,!1),t(ve,!1),t(de,!1)},3e3)}),oe(()=>{var r;(r=e(Le))==null||r.focus()}),oe(()=>{var r;if(e(Q)==="Refresh")Ue=!0;else if((r=e(Q))!=null&&r.startsWith("MfaLogin ")){let o=e(Q).replace("MfaLogin ","");t(y,l(o)),t(xe,l(o))}}),oe(()=>{be.get()?or():e(ce)&&ar(e(ce))});async function or(){var o;let r=await me("/auth/v1/oidc/session");console.log("manual session",r.body),(o=r.body)!=null&&o.csrf_token?ar(r.body.csrf_token):console.error(r.error)}function sr(){t(f,""),t(ve,!0),t(F,"")}async function ir(){if(!_){console.error("clientId is undefined");return}if(!O){console.error("redirectUri is undefined");return}t(N,!0);const r={client_id:_,redirect_uri:O,state:ke,nonce:$e,scopes:ye};P&&x&&(x==="plain"||x==="S256")&&(r.code_challenge=P,r.code_challenge_method=x);let o=await me("/auth/v1/oidc/authorize/refresh",r);await Ce(o)}async function lr(r,o){if(t(f,""),!_){console.error("clientId is undefined");return}if(!O){console.error("redirectUri is undefined");return}const w={email:e(y),client_id:_,redirect_uri:O,state:ke,nonce:$e,scopes:ye};if(P&&x&&(x==="plain"||x==="S256")&&(w.code_challenge=P,w.code_challenge_method=x),e(W)&&e(y)!==e(xe)){if(!e(F)){t(f,l(u.authorize.passwordRequired));return}if(e(F).length>256){t(f,"max 256");return}w.password=e(F)}t(N,!0);let b="/auth/v1/oidc/authorize";Be().get()&&(b="/auth/v1/dev/authorize");let L=await me(b,w);await Ce(L)}async function Ce(r){if(r.status===202){let o=r.headers.get("location");if(!o){console.error("location header missing");return}window.location.replace(o)}else if(r.status===200){t(f,"");let o=r.body;o&&"user_id"in o&&"code"in o?(t(Me,l(o.user_id)),t(ne,l({Login:o.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else if(r.status===406)t(f,l(u.authorize.clientForceMfa)),t(U,!0);else if(r.status===429){let o=r.headers.get("x-retry-not-before");if(!o){console.error("x-retry-not-before header missing");return}let w=Number.parseInt(o),b=Zr(w),L=w*1e3-new Date().getTime();t(A,!0),t(f,`${u.authorize.http429} ${b}`),t(y,""),t(F,""),t(W,!1),setTimeout(()=>{t(A,!1),t(f,"")},L)}else e(W)?(t(f,l(u.authorize.invalidCredentials)),t(de,!0)):(t(W,!0),t(Ae,l(e(y))));t(N,!1)}function nr(){e(W)&&e(Ae)!==e(y)&&(t(W,!1),t(F,""),t(f,""))}function cr(r){Dr(64,(o,{challenge:w,verifier:b})=>{o||(localStorage.setItem(Yr,b),vr(r,w))})}async function vr(r,o){let w={email:e(y)||null,client_id:_,redirect_uri:O,scopes:ye,state:ke,nonce:$e,code_challenge:P,code_challenge_method:x,provider_id:r,pkce_challenge:o},b=await Ur(w);if(b.ok){const L=await b.text();Gr(L);let Z=b.headers.get("location");if(!Z){console.error("no location header set for provider login");return}window.location.href=Z}else{let L=await b.json();t(f,l(L.message))}}function dr(r){t(ne,void 0),t(f,l(r))}function ur(r){console.log("onWebauthnSuccess",r),r&&"loc"in r&&window.location.replace(r.loc)}async function pr(){let r={email:e(y)};e(T)&&(r.redirect_uri=encodeURI(e(T))),t(N,!0);let o=await me("/auth/v1/users/request_reset",r);o.error?t(f,l(o.error.message)):t(ue,!0),t(N,!1)}var He=bt();Rr(r=>{$(()=>Fr.title=`Login ${(e(ie)||_)??""}`)});var Ve=V(He);G(Ve,{id:Ar,get value(){return e(le)},set value(r){t(le,l(r))}});var Ee=c(Ve,2);G(Ee,{id:Cr,get value(){return e(ie)},set value(r){t(ie,l(r))}});var Ne=c(Ee,2);G(Ne,{id:Hr,get value(){return e(T)},set value(r){t(T,l(r))}});var Ze=c(Ne,2);G(Ze,{id:Vr,get value(){return e(ce)},set value(r){t(ce,l(r))}});var De=c(Ze,2);G(De,{id:Er,get value(){return e(Q)},set value(r){t(Q,l(r))}});var Ye=c(De,2);G(Ye,{id:Nr,get value(){return e(Ie)},set value(r){t(Ie,l(r))}});var fr=c(Ye,2);Qr(fr,{children:(r,o)=>{Xr(r,{children:(w,b)=>{var L=_t(),Z=V(L),Se=v(Z),Te=v(Se),gr=v(Te);{var mr=a=>{var s=st();E(s,"src",`/auth/v1/clients/${_}/logo`),i(a,s)};h(gr,a=>{_&&a(mr)})}d(Te);var hr=c(Te,2);{var wr=a=>{var s=it(),m=v(s);ot(m,{opacity:.5}),d(s),$(()=>E(s,"href",e(T))),i(a,s)};h(hr,a=>{e(T)&&a(wr)})}d(Se);var We=c(Se,2),Je=v(We),_r=v(Je,!0);d(Je),d(We);var Oe=c(We,2);{var br=a=>{Jr(a,{get userId(){return e(Me)},get purpose(){return e(ne)},onSuccess:ur,onError:dr})};h(Oe,a=>{e(ne)&&e(Me)&&a(br)})}var Pe=c(Oe,2);{var $r=a=>{var s=ft(),m=V(s);rt(m,{get action(){return e(R)},onSubmit:lr,children:(I,K)=>{var j=dt(),C=V(j),ee=ge(()=>e(A)||e(U));Or(C,{typ:"email",name:"email",autocomplete:"email",get label(){return u.common.email},get placeholder(){return u.common.email},get disabled(){return e(ee)},onInput:nr,width:se,required:!0,get ref(){return e(ze)},set ref(z){t(ze,l(z))},get value(){return e(y)},set value(z){t(y,l(z))}});var M=c(C,2);{var k=z=>{var te=nt(),pe=V(te),Fe=ge(()=>e(A)||e(U));et(pe,{name:"password",autocomplete:"current-password",get label(){return u.common.password},get placeholder(){return u.common.password},maxLength:256,get disabled(){return e(Fe)},width:se,required:!0,get ref(){return e(Le)},set ref(g){t(Le,l(g))},get value(){return e(F)},set value(g){t(F,l(g))}});var je=c(pe,2);{var q=g=>{var H=lt(),ae=v(H);he(ae,{invisible:!0,onclick:sr,children:(qe,Y)=>{fe();var rr=we();$(()=>S(rr,u.authorize.passwordForgotten)),i(qe,rr)},$$slots:{default:!0}}),d(H),i(g,H)};h(je,g=>{e(de)&&!e(A)&&g(q)})}i(z,te)};h(M,z=>{e(W)&&e(xe)!==e(y)&&!e(ve)&&z(k)})}var re=c(M,2);{var Mr=z=>{var te=tr(),pe=V(te);{var Fe=q=>{var g=ct(),H=v(g);he(H,{onclick:pr,children:(ae,qe)=>{fe();var Y=we();$(()=>S(Y,u.authorize.passwordRequest)),i(ae,Y)},$$slots:{default:!0}}),d(g),i(q,g)},je=q=>{var g=vt(),H=v(g);he(H,{type:"submit",get isLoading(){return e(N)},children:(ae,qe)=>{fe();var Y=we();$(()=>S(Y,u.authorize.login)),i(ae,Y)},$$slots:{default:!0}}),d(g),i(q,g)};h(pe,q=>{e(ve)?q(Fe):q(je,!1)})}i(z,te)};h(re,z=>{!e(A)&&!e(U)&&z(Mr)})}i(I,j)},$$slots:{default:!0}});var D=c(m,2);{var X=I=>{var K=tr(),j=V(K);{var C=M=>{var k=ut(),re=v(k,!0);d(k),$(()=>{E(k,"href",`/auth/v1/users/register?redirect_uri=${e(T)??""}`),S(re,u.authorize.signUp)}),i(M,k)},ee=M=>{var k=pt(),re=v(k,!0);d(k),$(()=>S(re,u.authorize.signUp)),i(M,k)};h(j,M=>{e(T)?M(C):M(ee,!1)})}i(I,K)};h(D,I=>{e(Ie)&&!e(de)&&!e(A)&&I(X)})}i(a,s)};h(Pe,a=>{e(U)||a($r)})}var Qe=c(Pe,2);{var yr=a=>{var s=gt(),m=v(s,!0);d(s),$(()=>S(m,e(f))),i(a,s)};h(Qe,a=>{e(f)&&a(yr)})}var Xe=c(Qe,2);{var zr=a=>{var s=mt(),m=v(s,!0);d(s),$(()=>S(m,u.authorize.emailSentMsg)),i(a,s)};h(Xe,a=>{e(ue)&&a(zr)})}var Ke=c(Xe,2);{var Lr=a=>{var s=ht(),m=v(s);he(m,{onclick:()=>window.location.href="/auth/v1/account",children:(D,X)=>{fe();var I=we("Account");i(D,I)},$$slots:{default:!0}}),d(s),i(a,s)};h(Ke,a=>{e(U)&&a(Lr)})}var kr=c(Ke,2);{var xr=a=>{var s=wt(),m=v(s),D=c(v(m),2),X=v(D),I=v(X,!0);d(X),d(D),d(m);var K=c(m,2);qr(K,17,()=>e(le),j=>j.id,(j,C)=>{var ee=ge(()=>`Login: ${e(C).name}`);tt(j,{get ariaLabel(){return e(ee)},get provider(){return e(C)},onclick:cr})}),d(s),$(()=>S(I,u.authorize.orLoginWith)),i(a,s)};h(kr,a=>{!e(U)&&e(le)&&a(xr)})}d(Z);var er=c(Z,2);jr(er,{absolute:!0});var Ir=c(er,2);Pr(Ir,{absolute:!0}),$(()=>S(_r,e(ie)||_)),i(w,L)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(_e,He),Wr()}export{$t as component};
