import"../chunks/disclose-version.BDr9Qe-U.js";import{p as pr,F as ce,f as h,a as ur,u as e,v as s,t as k,$ as Ae,s as o,w as u,c as w,ap as N,r as f,O as oe}from"../chunks/runtime.BONl2e88.js";import{s as v}from"../chunks/render.AqJWcVDb.js";import{i as g}from"../chunks/if.DS90EFHs.js";import{a as t,t as $,e as K,d as j}from"../chunks/template.B7ldVCvc.js";import{h as vr}from"../chunks/svelte-head.DBtDtmZn.js";import{a as Pe,c as Se}from"../chunks/index.BJiFQ8Di.js";import{p as l}from"../chunks/proxy.0BECmVET.js";import{v as mr,w as wr}from"../chunks/helpers.CQGRRstl.js";import{B as O}from"../chunks/fetch.JUNnB5kv.js";import{P as fr}from"../chunks/PasswordPolicy.Difs7H-Z.js";import{I as gr}from"../chunks/Input.DGOkRo_r.js";import{W as hr}from"../chunks/WebauthnRequest.B-jwabRJ.js";import{L as $r,T as yr}from"../chunks/LangSelector.Zw9l5r2b.js";import{u as _r}from"../chunks/i18n.svelte.B1gwAzk0.js";import{M as br}from"../chunks/Main.DMwa1Kwf.js";import{C as Rr}from"../chunks/ContentCenter.BNNwHQjF.js";import{T as kr}from"../chunks/Template.DIImK_q5.js";import{u as Ar}from"../chunks/param.svelte.BwWxV1Sm.js";import{I as Ve}from"../chunks/InputPassword.B__efQ7l.js";import{A as Te}from"../chunks/A.UEWOjmpJ.js";import{u as xr}from"../chunks/is_dev.svelte.CjWXM2Cb.js";import{w as Lr}from"../chunks/registration.nxjf7GXU.js";import{F as Ue}from"../chunks/Form.CE2yJgP5.js";import{a as Cr}from"../chunks/patterns.BdncpE46.js";var qr=$('<!> <!> <!> <div class="generate svelte-1w50bpj"><!></div> <!>',1),Nr=$('<div class="dev svelte-1w50bpj"><p>This window shows up during local dev,<br> only to be able to switch modes easily.<br></p> <!> <!></div>'),jr=$("<p> <br> <br> <br> <!></p>"),Fr=$("<div><!></div>"),Ir=$("<!> <!>",1),Wr=$('<div class="success"><p> </p> <p> </p> <!></div>'),Dr=$("<div><!> <!></div>"),Mr=$('<h1> </h1> <p> </p> <p> <!></p> <div class="typeChoice svelte-1w50bpj"><!> <!></div> <!>',1),Er=$("<h1>Password Reset</h1> <!>",1),Or=$('<div class="err svelte-1w50bpj"> </div>'),Pr=$('<div class="container"><!> <!></div>'),Sr=$("<!> <!> <!>",1),Vr=$("<!> <!> <!> <!>",1);function Tr(ze,Je){pr(Je,!0);const xe=r=>{var c=K(),p=h(c);{var I=m=>{Ue(m,{action:"",onSubmit:Ge,children:(y,W)=>{var S=qr(),G=h(S);fr(G,{get policy(){return e(n).password_policy},get password(){return e(F)},get accepted(){return e(me)},set accepted(i){s(me,l(i))}});var H=o(G,2),D=oe(()=>e(F).length>=e(n).password_policy.length_min);Ve(H,{autocomplete:"new-password",get label(){return a.account.passwordNew},get placeholder(){return a.account.passwordNew},get maxLength(){return e(n).password_policy.length_max},required:!0,get showCopy(){return e(D)},width:pe,get ref(){return e(ve)},set ref(i){s(ve,l(i))},get value(){return e(F)},set value(i){s(F,l(i))},get reportValidity(){return e(we)},set reportValidity(i){s(we,l(i))}});var d=o(H,2);Ve(d,{autocomplete:"new-password",get label(){return a.account.passwordConfirm},get placeholder(){return a.account.passwordConfirm},get maxLength(){return e(n).password_policy.length_max},required:!0,width:pe,get value(){return e(re)},set value(i){s(re,l(i))},get reportValidity(){return e(fe)},set reportValidity(i){s(fe,l(i))}});var _=o(d,2),E=w(_);O(E,{level:2,onclick:Qe,children:(i,V)=>{N();var L=j();k(()=>v(L,a.passwordReset.generate)),t(i,L)},$$slots:{default:!0}}),f(_);var M=o(_,2);O(M,{type:"submit",get isLoading(){return e(Z)},children:(i,V)=>{N();var L=j();k(()=>v(L,a.common.save)),t(i,L)},$$slots:{default:!0}}),t(y,S)},$$slots:{default:!0}})};g(p,m=>{e(n)&&m(I)})}t(r,c)},pe="20rem";let a=_r(),Ke=xr().get(),n=u(void 0),ue=u(void 0),ve=u(void 0),Z=u(!1),A=u(""),Q=Ar("type","password_reset"),P=u(""),ie=u(""),B=u(!1),me=u(!1),Y=u(void 0),ee=u(""),F=u(""),re=u(""),we=u(void 0),fe=u(void 0);ce(()=>{e(P)&&ge()}),ce(()=>{var r;(r=e(ue))==null||r.focus()}),ce(()=>{var r;(r=e(ve))==null||r.focus()}),ce(()=>{e(B)&&setTimeout(()=>{e(ie)?window.location.replace(e(ie)):Le()},5e3)});function Le(){window.location.replace("/auth/v1/account")}function Qe(){if(e(n)){let r=wr(e(n).password_policy);s(F,l(r)),s(re,l(r)),requestAnimationFrame(()=>{var c,p;(c=e(we))==null||c(),(p=e(fe))==null||p()})}}async function Be(){if(!e(n)){console.error("template data is undefined");return}if(s(A,""),e(ee).length<1){s(A,l(a.mfa.passkeyNameErr));return}let r=await Lr(e(n).user_id,e(ee),a.authorize.invalidKeyUsed,a.authorize.requestExpired);r.error?s(A,`${a.mfa.errorReg} - ${r.error}`):(ge(),s(B,!0))}async function Ge(){var r;if(s(A,""),!!e(me)){if(e(F)!==e(re)){s(A,l(a.passwordReset.passwordNoMatch));return}if(e(F).length>256){s(A,"max 256");return}(r=e(n))!=null&&r.needs_mfa?s(Y,"PasswordReset"):await Ce()}}async function Ce(r){var I;if(!e(n))return;s(Z,!0);const c={password:e(F),magic_link_id:e(n).magic_link_id,mfa_code:r};let p=await fetch(`/auth/v1/users/${e(n).user_id}/reset`,{method:"PUT",headers:{"content-type":"application/json","pwd-csrf-token":(I=e(n))==null?void 0:I.csrf_token},body:JSON.stringify(c)});if(p.ok)ge(),s(ie,l(p.headers.get("location")||"/auth/v1/account")),s(B,!0);else{const m=await p.json();s(A,l(m.message))}s(Z,!1)}function He(r){s(A,l(r)),s(Y,void 0)}function Xe(r){s(Y,void 0),r&&"code"in r?Ce(r.code):console.error("invalid webauthn response",r)}function ge(){s(A,""),s(ee,""),s(F,""),s(re,"")}var qe=Vr();vr(r=>{var c=K(),p=h(c);{var I=y=>{var W=K(),S=h(W);{var G=D=>{k(()=>Ae.title=a.passwordReset.newAccount)},H=D=>{var d=K(),_=h(d);{var E=M=>{k(()=>Ae.title=a.passwordReset.passwordReset)};g(_,M=>{Q.get()==="password_reset"&&M(E)},!0)}t(D,d)};g(S,D=>{var d;(d=Q.get())!=null&&d.startsWith("new_user")?D(G):D(H,!1)})}t(y,W)},m=y=>{Ae.title="Password"};g(p,y=>{a?y(I):y(m,!1)})}t(r,c)});var Ne=h(qe);kr(Ne,{id:mr,get value(){return e(n)},set value(r){s(n,l(r))}});var je=o(Ne,2);{var Ze=r=>{var c=Nr(),p=o(w(c),2);O(p,{level:2,onclick:()=>Q.set("new_user"),children:(m,y)=>{N();var W=j("new_user");t(m,W)},$$slots:{default:!0}});var I=o(p,2);O(I,{level:2,onclick:()=>Q.set("password_reset"),children:(m,y)=>{N();var W=j("password_reset");t(m,W)},$$slots:{default:!0}}),f(c),t(r,c)};g(je,r=>{Ke&&r(Ze)})}var Fe=o(je,2);br(Fe,{children:(r,c)=>{Rr(r,{children:(p,I)=>{var m=Sr(),y=h(m);{var W=d=>{hr(d,{get userId(){return e(n).user_id},get purpose(){return e(Y)},onSuccess:Xe,onError:He})};g(y,d=>{e(Y)&&e(n)&&d(W)})}var S=o(y,2);{var G=d=>{var _=jr(),E=w(_),M=o(E,2),i=o(M,4),V=o(i),L=oe(()=>e(ie)||"/auth/v1/account");Te(V,{get href(){return e(L)},children:(he,Ie)=>{N();var $e=j("Account");t(he,$e)},$$slots:{default:!0}}),f(_),k(()=>{v(E,`${a.passwordReset.success1??""} `),v(M,` ${a.passwordReset.success2??""} `),v(i,` ${a.passwordReset.success3??""} `)}),t(d,_)},H=d=>{var _=K(),E=h(_);{var M=i=>{var V=Pr(),L=w(V);{var he=C=>{var b=Mr(),T=h(b),ye=w(T,!0);f(T);var U=o(T,2),z=w(U,!0);f(U);var se=o(U,2),We=w(se),rr=o(We);Te(rr,{get href(){return a.passwordReset.fidoLink},target:"_blank",children:(R,q)=>{N();var x=j("FIDO Alliance");t(R,x)},$$slots:{default:!0}}),f(se);var _e=o(se,2),De=w(_e),sr=oe(()=>e(P)?3:1);O(De,{get level(){return e(sr)},onclick:()=>s(P,"passkey"),get isLoading(){return e(Z)},children:(R,q)=>{N();var x=j();k(()=>v(x,a.passwordReset.passwordless)),t(R,x)},$$slots:{default:!0}});var tr=o(De,2),ar=oe(()=>e(P)?3:2);O(tr,{get level(){return e(ar)},onclick:()=>s(P,"password"),get isLoading(){return e(Z)},children:(R,q)=>{N();var x=j();k(()=>v(x,a.passwordReset.password)),t(R,x)},$$slots:{default:!0}}),f(_e);var or=o(_e,2);{var ir=R=>{var q=Fr(),x=w(q);xe(x),f(q),Pe(3,q,()=>Se),t(R,q)},nr=R=>{var q=K(),x=h(q);{var dr=be=>{var ne=Dr(),Me=w(ne);Ue(Me,{action:"",onSubmit:Be,children:(te,de)=>{var X=Ir(),le=h(X);gr(le,{autocomplete:"off",get label(){return a.mfa.passkeyName},get placeholder(){return a.mfa.passkeyName},width:pe,maxLength:32,pattern:Cr,required:!0,get ref(){return e(ue)},set ref(J){s(ue,l(J))},get value(){return e(ee)},set value(J){s(ee,l(J))}});var ae=o(le,2),Re=oe(()=>e(B)?2:1);O(ae,{type:"submit",get level(){return e(Re)},children:(J,Ee)=>{N();var ke=j();k(()=>v(ke,a.mfa.register)),t(J,ke)},$$slots:{default:!0}}),t(te,X)},$$slots:{default:!0}});var lr=o(Me,2);{var cr=te=>{var de=Wr(),X=w(de),le=w(X,!0);f(X);var ae=o(X,2),Re=w(ae,!0);f(ae);var J=o(ae,2);O(J,{onclick:Le,children:(Ee,ke)=>{N();var Oe=j();k(()=>v(Oe,a.passwordReset.accountLogin)),t(Ee,Oe)},$$slots:{default:!0}}),f(de),k(()=>{v(le,a.passwordReset.successPasskey1),v(Re,a.passwordReset.successPasskey2)}),t(te,de)};g(lr,te=>{e(B)&&te(cr)})}f(ne),Pe(3,ne,()=>Se),t(be,ne)};g(x,be=>{e(P)==="passkey"&&be(dr)},!0)}t(R,q)};g(or,R=>{e(P)==="password"?R(ir):R(nr,!1)})}k(()=>{v(ye,a.passwordReset.newAccount),v(z,a.passwordReset.newAccDesc1),v(We,`${a.passwordReset.newAccDesc2??""} `)}),t(C,b)},Ie=C=>{var b=K(),T=h(b);{var ye=U=>{var z=Er(),se=o(h(z),2);xe(se),t(U,z)};g(T,U=>{var z;(z=Q.get())!=null&&z.startsWith("password_reset")&&U(ye)},!0)}t(C,b)};g(L,C=>{var b;(b=Q.get())!=null&&b.startsWith("new_user")?C(he):C(Ie,!1)})}var $e=o(L,2);{var er=C=>{var b=Or(),T=w(b,!0);f(b),k(()=>v(T,e(A))),t(C,b)};g($e,C=>{e(A)&&C(er)})}f(V),t(i,V)};g(E,i=>{e(n)&&i(M)},!0)}t(d,_)};g(S,d=>{e(B)?d(G):d(H,!1)})}var D=o(S,2);yr(D,{absolute:!0}),t(p,m)},$$slots:{default:!0}})},$$slots:{default:!0}});var Ye=o(Fe,2);$r(Ye,{absolute:!0}),t(ze,qe),ur()}export{Tr as component};
