import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.Cdp_P06_.js";import{T as $,p as fa,o as pa,ad as S,ae as $a,Q as D,a as wa,j as a,af as C,g as e,$ as ja,R as n,ag as i,U as g,W as d,V as oe,X as _a,ah as Pe}from"../chunks/index-client.CzqVbBUo.js";import{s as R,e as Se}from"../chunks/render.DOFZNw8l.js";import{i as _}from"../chunks/if.BnegfJmL.js";import{e as ya}from"../chunks/OptionSelect.CIygkAfc.js";import{a as o,n as ba,b as h,t as ce,c as We}from"../chunks/template.C3U8HW1x.js";import{h as ka}from"../chunks/svelte-head.BSz900xL.js";import{s as V,B as ue,t as xa,b as za}from"../chunks/Button.65naIT6w.js";import{i as Ma}from"../chunks/lifecycle.BPrHSQsT.js";import{g as Ca,E as Ra,F as La,G as Ta,o as Ea,H as Ua,I as Na,n as qe,J as Va,K as Ba,_ as Fa,P as Aa,M as Ga,N as Ia,O as He,e as Qe,Q as Oa}from"../chunks/dataFetching.CF6CPDU9.js";import{I as Pa,c as Sa,a as Wa,y as qa}from"../chunks/Input.BRe7i--g.js";import{W as Ha}from"../chunks/WebauthnRequest.Dv2jfFi4.js";import{P as Qa}from"../chunks/PasswordInput.BNTSsZot.js";import{L as Da}from"../chunks/LangSelector.DlaDUv8u.js";import{p as ke}from"../chunks/props.C_MHtC74.js";import{M as Ka,C as Xa}from"../chunks/ContentCenter.D3vmDIv7.js";import{u as Ya}from"../chunks/i18n.svelte.C_qSL0ZA.js";import{T as K}from"../chunks/Template.CJON1Uel.js";var Za=ba('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>');function Ja(me,X){let c=ke(X,"color",3,"var(--col-text)"),y=ke(X,"opacity",3,.9),W=ke(X,"width",3,24);var w=Za();V(w,"stroke-width",2),$(()=>{V(w,"width",W()),V(w,"color",c()),V(w,"opacity",y())}),o(me,w)}var et=h('<img alt="No Logo Available">'),at=h('<a class="home svelte-1ljcjf3"><!></a>'),tt=h('<div role="button" tabindex="0" class="forgotten svelte-1ljcjf3"> </div>'),rt=h("<!> <!>",1),st=h('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),lt=h('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),it=h("<!> <!> <!>",1),ot=h('<div class="flex-inline svelte-1ljcjf3"><img alt="" width="20" height="20"> <span class="providerName svelte-1ljcjf3"> </span></div>'),ct=h('<div class="providers flex-col svelte-1ljcjf3"></div>'),nt=h('<div class="errMsg errMsgApi svelte-1ljcjf3"> </div>'),vt=h('<div class="success svelte-1ljcjf3"> </div>'),dt=h('<a class="reg svelte-1ljcjf3" target="_blank"> </a>'),ut=h('<a class="reg svelte-1ljcjf3" href="/auth/v1/users/register" target="_blank"> </a>'),mt=h('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),gt=h('<div class="container svelte-1ljcjf3"><div class="head svelte-1ljcjf3"><div class="logo svelte-1ljcjf3"><!></div> <!></div> <div class="name svelte-1ljcjf3"><h2> </h2></div> <!> <!> <!> <!> <!> <!> <!></div> <!>',1),ht=h("<!> <!> <!> <!> <!> <!> <!>",1);function ft(me,X){fa(X,!1);let c=Ya(),y=i(),W=i(""),w=i(""),q=i(""),Y=i(""),Z=i([]),J=i(),ee=i(),ae=i(),te=i(),ge=i(!1),H=i(),ne=i([]),re=i(),B=i(!1),b=i(""),F=i(""),se=i(""),A=i(!1),G=i(!1),ve=i(!1),de=i(!1),le=i(!1),I=i(!1),xe="",he=i(!1),l=i({email:"",password:""}),k=i({}),fe=i({});pa(async()=>{const t=Ca();a(y,t.client_id),a(q,t.redirect_uri),a(Y,t.nonce),a(Z,t.scope.split(" ")),a(ee,t.state),a(ae,t.code_challenge),a(te,t.code_challenge_method),t.login_hint&&C(l,e(l).email=t.login_hint)});function ze(){a(b,""),a(ve,!0),C(l,e(l).password="")}async function pe(){a(b,"");try{await e(fe).validate(e(l),{abortEarly:!1}),a(k,{})}catch(p){a(k,qe(p));return}const t={email:e(l).email,client_id:e(y),redirect_uri:e(q),state:e(ee),code_challenge:e(ae),code_challenge_method:e(te),nonce:e(Y),scopes:e(Z)};if(e(A)&&e(l).email!==e(H)){if(!e(l).password){C(k,e(k).password=c.passwordRequired);return}if(e(l).password.length>256){C(k,e(k).password="max 256");return}t.password=e(l).password}a(B,!0);let f=await Va(t);await Me(f)}async function Me(t){if(t.status===202)window.location.replace(t.headers.get("location"));else if(t.status===200)a(b,""),a(re,await t.json());else if(t.status===406)a(b,c.authorize.clientForceMfa),a(G,!0);else if(t.status===429){let f=Number.parseInt(t.headers.get("x-retry-not-before")),p=Ba(f),x=f*1e3-new Date().getTime();a(I,!0),a(b,`${c.authorize.http429} ${p}`),C(l,e(l).email=""),C(l,e(l).password=""),a(A,!1),setTimeout(()=>{a(I,!1),a(b,"")},x)}else e(A)?(a(b,c.authorize.invalidCredentials),a(de,!0)):(a(A,!0),xe=e(l).email);a(B,!1)}function De(){e(A)&&xe!==e(l).email&&(a(A,!1),C(l,e(l).password=""),a(b,""))}function Ke(t){Fa(64,(f,{challenge:p,verifier:x})=>{f||(localStorage.setItem(Aa,x),Xe(t,p))})}async function Xe(t,f){let p={email:e(l).email||null,client_id:e(y),redirect_uri:e(q),scopes:e(Z),state:e(ee),nonce:e(Y),code_challenge:e(ae),code_challenge_method:e(te),provider_id:t,pkce_challenge:f},x=await Ga(p);if(x.ok){const Q=await x.text();Ia(Q),window.location.href=x.headers.get("location")}else{let Q=await x.json();a(b,Q.message)}}function Ye(){a(re,void 0)}function Ze(t){t&&window.location.replace(t.loc)}async function Je(){try{await e(fe).validate(e(l),{abortEarly:!1}),a(k,{})}catch(p){a(k,qe(p));return}let t={email:e(l).email};e(w)&&(t.redirect_uri=encodeURI(e(w))),a(B,!0);let f=await Oa(t);if(f.ok)a(le,!0);else{let p=await f.json();a(b,p.message)}a(B,!1)}S(()=>qa,()=>{c&&a(fe,Sa().shape({email:Wa().required(c.authorize.emailRequired).email(c.authorize.emailBadFormat)}))}),S(()=>e(F),()=>{var t;e(F)&&(e(F)==="Refresh"?a(ge,!0):(t=e(F))!=null&&t.startsWith("MfaLogin ")&&a(H,e(F).replace("MfaLogin ","")))}),S(()=>(e(ge),e(y),e(q),e(ee),e(ae),e(te),e(Y),e(Z),He),()=>{var t,f;if(e(ge)&&((t=e(y))==null?void 0:t.length)>0&&((f=e(q))==null?void 0:f.length)>0){a(B,!0);const p={client_id:e(y),redirect_uri:e(q),state:e(ee),code_challenge:e(ae),code_challenge_method:e(te),nonce:e(Y),scopes:e(Z)};_a().then(()=>He(p).then(x=>Me(x)))}}),S(()=>e(H),()=>{e(H)&&C(l,e(l).email=e(H))}),S(()=>e(le),()=>{e(le)&&setTimeout(()=>{a(le,!1),a(ve,!1),a(de,!1)},3e3)}),S(()=>e(J),()=>{e(J)&&e(J).focus()}),S(()=>(e(se),Qe),()=>{e(se)&&Qe(e(se))}),$a(),Ma();var Ce=ht();ka(t=>{$(()=>ja.title=`Login ${(e(W)||e(y))??""}`)});var Re=D(Ce);K(Re,{id:Ra,get value(){return e(ne)},set value(t){a(ne,t)},$$legacy:!0});var Le=n(Re,2);K(Le,{id:La,get value(){return e(W)},set value(t){a(W,t)},$$legacy:!0});var Te=n(Le,2);K(Te,{id:Ta,get value(){return e(w)},set value(t){a(w,t)},$$legacy:!0});var Ee=n(Te,2);K(Ee,{id:Ea,get value(){return e(se)},set value(t){a(se,t)},$$legacy:!0});var Ue=n(Ee,2);K(Ue,{id:Ua,get value(){return e(F)},set value(t){a(F,t)},$$legacy:!0});var Ne=n(Ue,2);K(Ne,{id:Na,get value(){return e(he)},set value(t){a(he,t)},$$legacy:!0});var ea=n(Ne,2);Ka(ea,{children:(t,f)=>{Xa(t,{children:(p,x)=>{var Q=gt(),$e=D(Q),we=g($e),je=g(we),aa=g(je);{var ta=r=>{var s=et();$(()=>V(s,"src",`/auth/v1/clients/${e(y)}/logo`)),o(r,s)};_(aa,r=>{e(y)&&r(ta)})}d(je);var ra=n(je,2);{var sa=r=>{var s=at(),u=g(s);Ja(u,{opacity:.5}),d(s),$(()=>V(s,"href",e(w))),o(r,s)};_(ra,r=>{e(w)&&r(sa)})}d(we);var _e=n(we,2),Ve=g(_e),la=g(Ve,!0);d(Ve),d(_e);var Be=n(_e,2);{var ia=r=>{Ha(r,{t:c,onSuccess:Ze,onError:Ye,get data(){return e(re)},set data(s){a(re,s)},$$legacy:!0})};_(Be,r=>{e(re)&&r(ia)})}var Fe=n(Be,2);{var oa=r=>{var s=it(),u=D(s),T=Pe(()=>e(I)||e(G));Pa(u,{type:"email",name:"rauthyEmail",autocomplete:"email",get placeholder(){return c.common.email},get disabled(){return e(T)},get value(){return e(l).email},set value(m){C(l,e(l).email=m)},get error(){return e(k).email},set error(m){C(k,e(k).email=m)},$$events:{enter:pe,input:De},children:(m,U)=>{oe();var P=ce();$(()=>R(P,c.common.email.toUpperCase())),o(m,P)},$$slots:{default:!0},$$legacy:!0});var O=n(u,2);{var z=m=>{var U=rt(),P=D(U),ye=Pe(()=>e(I)||e(G));Qa(P,{name:"rauthyPassword",get error(){return e(k).password},autocomplete:"current-password",get placeholder(){return c.common.password},get disabled(){return e(ye)},get bindThis(){return e(J)},set bindThis(v){a(J,v)},get value(){return e(l).password},set value(v){C(l,e(l).password=v)},$$events:{enter:pe},children:(v,M)=>{oe();var L=ce();$(()=>R(L,c.common.password.toUpperCase())),o(v,L)},$$slots:{default:!0},$$legacy:!0});var be=n(P,2);{var N=v=>{var M=tt(),L=g(M,!0);d(M),$(()=>R(L,c.authorize.passwordForgotten)),xa(7,M,()=>za),Se("click",M,ze),Se("keypress",M,ze),o(v,M)};_(be,v=>{e(de)&&!e(I)&&v(N)})}o(m,U)};_(O,m=>{e(A)&&e(H)!==e(l).email&&!e(ve)&&m(z)})}var j=n(O,2);{var E=m=>{var U=We(),P=D(U);{var ye=N=>{var v=st(),M=g(v);ue(M,{$$events:{click:Je},children:(L,ha)=>{oe();var ie=ce();$(()=>R(ie,c.authorize.passwordRequest)),o(L,ie)},$$slots:{default:!0}}),d(v),o(N,v)},be=N=>{var v=lt(),M=g(v);ue(M,{get isLoading(){return e(B)},set isLoading(L){a(B,L)},$$events:{click:pe},children:(L,ha)=>{oe();var ie=ce();$(()=>R(ie,c.authorize.login)),o(L,ie)},$$slots:{default:!0},$$legacy:!0}),d(v),o(N,v)};_(P,N=>{e(ve)?N(ye):N(be,!1)})}o(m,U)};_(j,m=>{!e(I)&&!e(G)&&m(E)})}o(r,s)};_(Fe,r=>{e(G)||r(oa)})}var Ae=n(Fe,2);{var ca=r=>{var s=ct();ya(s,5,()=>e(ne),u=>u.id,(u,T)=>{ue(u,{level:3,$$events:{click:()=>Ke(e(T).id)},children:(O,z)=>{var j=ot(),E=g(j),m=n(E,2),U=g(m,!0);d(m),d(j),$(()=>{V(E,"src",`/auth/v1/providers/${e(T).id}/img`),R(U,e(T).name)}),o(O,j)},$$slots:{default:!0}})}),d(s),o(r,s)};_(Ae,r=>{e(ne)&&r(ca)})}var Ge=n(Ae,2);{var na=r=>{var s=nt(),u=g(s,!0);d(s),$(()=>R(u,e(b))),o(r,s)};_(Ge,r=>{e(b)&&r(na)})}var Ie=n(Ge,2);{var va=r=>{var s=vt(),u=g(s,!0);d(s),$(()=>R(u,c.authorize.emailSentMsg)),o(r,s)};_(Ie,r=>{e(le)&&r(va)})}var Oe=n(Ie,2);{var da=r=>{var s=We(),u=D(s);{var T=z=>{var j=dt(),E=g(j,!0);d(j),$(()=>{V(j,"href",`/auth/v1/users/register?redirect_uri=${e(w)??""}`),R(E,c.authorize.signUp)}),o(z,j)},O=z=>{var j=ut(),E=g(j,!0);d(j),$(()=>R(E,c.authorize.signUp)),o(z,j)};_(u,z=>{e(w)?z(T):z(O,!1)})}o(r,s)};_(Oe,r=>{e(he)&&!e(G)&&!e(de)&&!e(I)&&r(da)})}var ua=n(Oe,2);{var ma=r=>{var s=mt(),u=g(s);ue(u,{$$events:{click:()=>window.location.href="/auth/v1/account"},children:(T,O)=>{oe();var z=ce("ACCOUNT");o(T,z)},$$slots:{default:!0}}),d(s),o(r,s)};_(ua,r=>{e(G)&&r(ma)})}d($e);var ga=n($e,2);Da(ga,{absolute:!0}),$(()=>R(la,e(W)||e(y))),o(p,Q)},$$slots:{default:!0}})},$$slots:{default:!0}}),o(me,Ce),wa()}export{ft as component};
