import"../chunks/disclose-version.BDr9Qe-U.js";import{j as e,U as c,g as s,R as u,W as o,T as m,P as f,p as Be,o as De,Q as U,a as Oe,$ as Se,V as ee}from"../chunks/index-client.CzqVbBUo.js";import{e as V,s as p}from"../chunks/render.DOFZNw8l.js";import{i as z,p as v}from"../chunks/if.BnegfJmL.js";import{e as Ue,i as Ve}from"../chunks/OptionSelect.CIygkAfc.js";import{a,b as x,t as te,c as he}from"../chunks/template.C3U8HW1x.js";import{h as _e}from"../chunks/svelte-head.BSz900xL.js";import{r as qe}from"../chunks/legacy-client.DtCljIS0.js";import{g as Ee,Y as Fe,Z as we,$ as Ge,l as Je,a0 as Ne,n as Qe}from"../chunks/dataFetching.CF6CPDU9.js";import{t as X,s as Xe,b as ve,f as Ce,B as le}from"../chunks/Button.65naIT6w.js";import{t as ne}from"../chunks/helpers.BvaXa0cv.js";import{p as ue}from"../chunks/props.C_MHtC74.js";import{L as Ye}from"../chunks/LangSelector.DlaDUv8u.js";import{c as Ze,a as He,I as Ie}from"../chunks/Input.BRe7i--g.js";import{f as Ke}from"../chunks/pow.CWO_5_vv.js";import{M as Re,C as Me}from"../chunks/ContentCenter.D3vmDIv7.js";import{u as et}from"../chunks/i18n.svelte.C_qSL0ZA.js";import{T as tt}from"../chunks/Template.CJON1Uel.js";var st=x('<div class="circle svelte-10pff2x"></div>'),at=x('<div class="circle svelte-10pff2x"></div>'),rt=x('<div class="circle svelte-10pff2x"></div>'),ot=x('<div class="container svelte-10pff2x"><div class="inner svelte-10pff2x"><!> <!> <!></div></div>');function it(se,_){let Y=ue(_,"offset",3,0),t=ue(_,"background",3,!0),q=ue(_,"local",3,!1),y=f(!0),$=f(!1),l=f(!1);setTimeout(()=>{e($,!0)},300),setTimeout(()=>{e(l,!0)},600);var g=ot(),b=c(g),E=c(b);{var Z=i=>{var r=st();V("introend",r,()=>e(y,!1)),V("outroend",r,()=>e(y,!0)),X(7,r,()=>ve,()=>({delay:600,duration:1e3})),a(i,r)};z(E,i=>{s(y)&&i(Z)})}var L=u(E,2);{var B=i=>{var r=at();V("introend",r,()=>e($,!1)),V("outroend",r,()=>e($,!0)),X(7,r,()=>ve,()=>({delay:600,duration:1e3})),a(i,r)};z(L,i=>{s($)&&i(B)})}var H=u(L,2);{var ae=i=>{var r=rt();V("introend",r,()=>e(l,!1)),V("outroend",r,()=>e(l,!0)),X(7,r,()=>ve,()=>({delay:600,duration:1e3})),a(i,r)};z(H,i=>{s(l)&&i(ae)})}o(b),o(g),m(()=>{ne(g,"global",!q()),ne(g,"local",q()),ne(g,"background",t()),Xe(b,"style",`margin-top: ${`${Y()}px`??""}`)}),X(3,b,()=>Ce,()=>({duration:100})),X(7,g,()=>Ce,()=>({duration:100})),a(se,g)}var dt=x('<div class="desc svelte-19xxeot"> </div> <!> <!>',1),ct=x('<div class="desc svelte-19xxeot"><p> </p> <p> </p></div>'),vt=x('<div class="desc svelte-19xxeot"><p class="declined svelte-19xxeot"> </p> <p> </p></div>'),lt=x("<li> </li>"),nt=x('<div class="desc svelte-19xxeot"> <ul></ul></div> <div class="inline svelte-19xxeot"><!> <!></div>',1),ut=x('<div class="container svelte-19xxeot"><div class="name svelte-19xxeot"><h2> </h2></div> <!> <div class="err svelte-19xxeot"> </div></div>'),pt=x("<!> <!>",1),mt=x("<!> <!>",1);function ft(se,_){Be(_,!0);const Y="8rem";let t=et(),q=f(void 0),y=f(""),$=f(8),l=f(!1),g=!1,b=f(void 0),E=f(!1),Z=f(!1),L=v({userCode:""}),B=f(v({userCode:""})),H=f(v({}));qe(()=>{t&&s($)&&e(H,v(Ze().shape({userCode:He().trim().min(s($),t.common.errTooShort).max(s($),t.common.errTooLong).matches(Je,t.common.invalidInput)})))}),De(async()=>{const n=Ee();n.code&&(L.userCode=n.code);let F=await Fe();F.ok?e(q,v(await F.json())):n.code?we(`device?code=${n.code}`):we("device")});function ae(){g&&r()}async function i(n){var G;if(e(y,""),g=!0,!await r())return;e(l,!0);let F=await Ke(),re={user_code:L.userCode,pow:F,device_accepted:n};const j=await Ne(re);if(j.status===200){const P=await j.json();console.log(P),e(b,v(((G=P.scopes)==null?void 0:G.split(" "))||["openid"]))}else if(j.status===202)e(E,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3);else if(j.status===204)e(Z,!0);else if(j.status===404)e(y,v(t.device.wrongOrExpired));else{const P=await j.json();e(y,v(P.message))}e(l,!1)}async function r(){try{return await s(H).validate(L,{abortEarly:!1}),e(B,v({userCode:""})),!0}catch(n){return e(B,v(Qe(n))),!1}}var pe=mt();_e(n=>{m(()=>Se.title=(t==null?void 0:t.device.title)||"Device Authorization")});var me=U(pe);tt(me,{id:Ge,get value(){return s($)},set value(n){e($,v(n))}});var ye=u(me,2);Re(ye,{children:(n,F)=>{Me(n,{children:(re,j)=>{var G=pt(),P=U(G);{var be=D=>{it(D,{})},Le=D=>{var oe=ut(),ie=c(oe),fe=c(ie),ke=c(fe,!0);o(fe),o(ie);var xe=u(ie,2);{var je=O=>{var J=dt(),N=U(J),de=c(N,!0);m(()=>p(de,t.device.desc.replaceAll("{{count}}",s($)))),o(N);var I=u(N,2);Ie(I,{name:"userCode",autocomplete:"off",get placeholder(){return t.device.userCode},get value(){return L.userCode},set value(d){L.userCode=d},get error(){return s(B).userCode},set error(d){s(B).userCode=d},$$events:{enter:i,input:ae},children:(d,A)=>{ee();var h=te();m(()=>p(h,t.device.userCode.toUpperCase())),a(d,h)},$$slots:{default:!0}});var T=u(I,2);le(T,{get isLoading(){return s(l)},set isLoading(d){e(l,v(d))},$$events:{click:()=>i("pending")},children:(d,A)=>{ee();var h=te();m(()=>p(h,t.device.submit)),a(d,h)},$$slots:{default:!0}}),a(O,J)},Pe=O=>{var J=he(),N=U(J);{var de=T=>{var d=ct(),A=c(d),h=c(A,!0);o(A);var K=u(A,2),k=c(K,!0);o(K),o(d),m(()=>{p(h,t.device.isAccepted),p(k,t.device.autoRedirectAccount)}),a(T,d)},I=T=>{var d=he(),A=U(d);{var h=k=>{var S=vt(),W=c(S),R=c(W,!0);o(W);var Q=u(W,2),M=c(Q,!0);o(Q),o(S),m(()=>{p(R,t.device.isDeclined),p(M,t.device.closeWindow)}),a(k,S)},K=k=>{var S=nt(),W=U(S),R=c(W),Q=u(R);Ue(Q,21,()=>s(b),Ve,(w,ce)=>{var C=lt(),ze=c(C,!0);o(C),m(()=>p(ze,s(ce))),a(w,C)}),o(Q),o(W);var M=u(W,2),ge=c(M);le(ge,{level:1,width:Y,get isLoading(){return s(l)},set isLoading(w){e(l,v(w))},$$events:{click:()=>i("accept")},children:(w,ce)=>{ee();var C=te();m(()=>p(C,t.device.accept)),a(w,C)},$$slots:{default:!0}});var We=u(ge,2);le(We,{level:3,width:Y,get isLoading(){return s(l)},set isLoading(w){e(l,v(w))},$$events:{click:()=>i("decline")},children:(w,ce)=>{ee();var C=te();m(()=>p(C,t.device.decline)),a(w,C)},$$slots:{default:!0}}),o(M),m(()=>p(R,`${t.device.descScopes??""} `)),a(k,S)};z(A,k=>{s(Z)?k(h):k(K,!1)},!0)}a(T,d)};z(N,T=>{s(E)?T(de):T(I,!1)},!0)}a(O,J)};z(xe,O=>{s(b)===void 0?O(je):O(Pe,!1)})}var $e=u(xe,2),Ae=c($e,!0);o($e),o(oe),m(()=>{p(ke,t.device.title),p(Ae,s(y))}),a(D,oe)};z(P,D=>{s(q)?D(Le,!1):D(be)})}var Te=u(P,2);Ye(Te,{absolute:!0}),a(re,G)},$$slots:{default:!0}})},$$slots:{default:!0}}),a(se,pe),Oe()}export{ft as component};
