import"../chunks/disclose-version.BDr9Qe-U.js";import{p as pr,a6 as ce,f as h,a as ur,y as e,z as s,t as b,aq as xe,s as o,A as u,c as f,ar as C,r as w,ab as oe}from"../chunks/index-client.Di99sPv0.js";import{s as v}from"../chunks/render.Cjc4CIr8.js";import{i as g}from"../chunks/if.DgeUjMU2.js";import{a as t,t as $,e as K,d as P}from"../chunks/template.BEKX6jgL.js";import{h as vr}from"../chunks/svelte-head.B7nS6fh6.js";import{t as Ee,s as Se}from"../chunks/index.BnJsthXQ.js";import{p as l}from"../chunks/proxy.BQ2dmY0t.js";import{A as mr,B as fr}from"../chunks/helpers.D3KrX4pz.js";import{B as M}from"../chunks/Button.D-14suAe.js";import{P as wr}from"../chunks/PasswordPolicy.DyPst8KB.js";import{I as gr}from"../chunks/Input.-lhBsjDF.js";import{W as hr}from"../chunks/WebauthnRequest.BW_iBuNs.js";import{L as $r}from"../chunks/LangSelector.BxiGX-yu.js";import{u as yr}from"../chunks/i18n.svelte.Bc6aINkd.js";import{M as _r}from"../chunks/Main.DKi4VjsM.js";import{C as Rr}from"../chunks/ContentCenter.BgFVBEpa.js";import{T as kr}from"../chunks/Template.DiUnptz0.js";import{u as br}from"../chunks/param.svelte.CXpV4U96.js";import{T as xr}from"../chunks/ThemeSwitch._9IF3ElF.js";import{I as Ve}from"../chunks/InputPassword.Bl28d8lQ.js";import{A as Ue}from"../chunks/A.ZMe8srAj.js";import{u as Lr}from"../chunks/is_dev.svelte.DF22tCPV.js";import{w as Tr}from"../chunks/registration.DWog0zj0.js";import{F as ze}from"../chunks/Form.C0Yvca1O.js";import{a as qr}from"../chunks/patterns.BDQXnG3O.js";var Ar=$('<!> <!> <!> <div class="generate svelte-1w50bpj"><!></div> <!>',1),Cr=$('<div class="dev svelte-1w50bpj"><p>This window shows up during local dev,<br> only to be able to switch modes easily.<br></p> <!> <!></div>'),Pr=$("<p> <br> <br> <br> <!></p>"),Nr=$("<div><!></div>"),jr=$("<!> <!>",1),Ir=$('<div class="success"><p> </p> <p> </p> <!></div>'),Wr=$("<div><!> <!></div>"),Dr=$('<h1> </h1> <p> </p> <p> <!></p> <div class="typeChoice svelte-1w50bpj"><!> <!></div> <!>',1),Fr=$("<h1>Password Reset</h1> <!>",1),Mr=$('<div class="err svelte-1w50bpj"> </div>'),Er=$('<div class="container"><!> <!></div>'),Sr=$("<!> <!> <!>",1),Vr=$("<!> <!> <!> <!>",1);function Ur(Be,Je){pr(Je,!0);const Le=r=>{var c=K(),p=h(c);{var j=m=>{ze(m,{action:"",onSubmit:Ge,children:(y,I)=>{var S=Ar(),G=h(S);wr(G,{get policy(){return e(n).password_policy},get password(){return e(N)},get accepted(){return e(me)},set accepted(i){s(me,l(i))}});var H=o(G,2),W=oe(()=>e(N).length>=e(n).password_policy.length_min);Ve(H,{autocomplete:"new-password",get label(){return a.account.passwordNew},get placeholder(){return a.account.passwordNew},get maxLength(){return e(n).password_policy.length_max},required:!0,get showCopy(){return e(W)},width:pe,get ref(){return e(ve)},set ref(i){s(ve,l(i))},get value(){return e(N)},set value(i){s(N,l(i))},get reportValidity(){return e(fe)},set reportValidity(i){s(fe,l(i))}});var d=o(H,2);Ve(d,{autocomplete:"new-password",get label(){return a.account.passwordConfirm},get placeholder(){return a.account.passwordConfirm},get maxLength(){return e(n).password_policy.length_max},required:!0,width:pe,get value(){return e(re)},set value(i){s(re,l(i))},get reportValidity(){return e(we)},set reportValidity(i){s(we,l(i))}});var _=o(d,2),F=f(_);M(F,{level:2,onclick:Oe,children:(i,V)=>{C();var T=P();b(()=>v(T,a.passwordReset.generate)),t(i,T)},$$slots:{default:!0}}),w(_);var D=o(_,2);M(D,{type:"submit",get isLoading(){return e(Z)},children:(i,V)=>{C();var T=P();b(()=>v(T,a.common.save)),t(i,T)},$$slots:{default:!0}}),t(y,S)},$$slots:{default:!0}})};g(p,m=>{e(n)&&m(j)})}t(r,c)},pe="20rem";let a=yr(),Ke=Lr().get(),n=u(void 0),ue=u(void 0),ve=u(void 0),Z=u(!1),x=u(""),O=br("type","password_reset"),E=u(""),ie=u(""),Q=u(!1),me=u(!1),Y=u(void 0),ee=u(""),N=u(""),re=u(""),fe=u(void 0),we=u(void 0);ce(()=>{e(E)&&ge()}),ce(()=>{var r;(r=e(ue))==null||r.focus()}),ce(()=>{var r;(r=e(ve))==null||r.focus()}),ce(()=>{e(Q)&&setTimeout(()=>{e(ie)?window.location.replace(e(ie)):Te()},5e3)});function Te(){window.location.replace("/auth/v1/account")}function Oe(){if(e(n)){let r=fr(e(n).password_policy);s(N,l(r)),s(re,l(r)),requestAnimationFrame(()=>{var c,p;(c=e(fe))==null||c(),(p=e(we))==null||p()})}}async function Qe(){if(!e(n)){console.error("template data is undefined");return}if(s(x,""),e(ee).length<1){s(x,l(a.mfa.passkeyNameErr));return}let r=await Tr(e(n).user_id,e(ee),a.authorize.invalidKeyUsed,a.authorize.requestExpired);r.error?s(x,`${a.mfa.errorReg} - ${r.error}`):(ge(),s(Q,!0))}async function Ge(){var r;if(s(x,""),!!e(me)){if(e(N)!==e(re)){s(x,l(a.passwordReset.passwordNoMatch));return}if(e(N).length>256){s(x,"max 256");return}(r=e(n))!=null&&r.needs_mfa?s(Y,"PasswordReset"):await qe()}}async function qe(r){var j;if(!e(n))return;s(Z,!0);const c={password:e(N),magic_link_id:e(n).magic_link_id,mfa_code:r};let p=await fetch(`/auth/v1/users/${e(n).user_id}/reset`,{method:"PUT",headers:{"content-type":"application/json","pwd-csrf-token":(j=e(n))==null?void 0:j.csrf_token},body:JSON.stringify(c)});if(p.ok)ge(),s(ie,l(p.headers.get("location")||"/auth/v1/account")),s(Q,!0);else{const m=await p.json();s(x,l(m.message))}s(Z,!1)}function He(r){s(x,l(r)),s(Y,void 0)}function Xe(r){s(Y,void 0),r&&"code"in r?qe(r.code):console.error("invalid webauthn response",r)}function ge(){s(x,""),s(ee,""),s(N,""),s(re,"")}var Ae=Vr();vr(r=>{var c=K(),p=h(c);{var j=y=>{var I=K(),S=h(I);{var G=W=>{b(()=>xe.title=a.passwordReset.newAccount)},H=W=>{var d=K(),_=h(d);{var F=D=>{b(()=>xe.title=a.passwordReset.passwordReset)};g(_,D=>{O.get()==="password_reset"&&D(F)},!0)}t(W,d)};g(S,W=>{var d;(d=O.get())!=null&&d.startsWith("new_user")?W(G):W(H,!1)})}t(y,I)},m=y=>{xe.title="Password"};g(p,y=>{a?y(j):y(m,!1)})}t(r,c)});var Ce=h(Ae);kr(Ce,{id:mr,get value(){return e(n)},set value(r){s(n,l(r))}});var Pe=o(Ce,2);{var Ze=r=>{var c=Cr(),p=o(f(c),2);M(p,{level:2,onclick:()=>O.set("new_user"),children:(m,y)=>{C();var I=P("new_user");t(m,I)},$$slots:{default:!0}});var j=o(p,2);M(j,{level:2,onclick:()=>O.set("password_reset"),children:(m,y)=>{C();var I=P("password_reset");t(m,I)},$$slots:{default:!0}}),w(c),t(r,c)};g(Pe,r=>{Ke&&r(Ze)})}var Ne=o(Pe,2);_r(Ne,{children:(r,c)=>{Rr(r,{children:(p,j)=>{var m=Sr(),y=h(m);{var I=d=>{hr(d,{get userId(){return e(n).user_id},get purpose(){return e(Y)},onSuccess:Xe,onError:He})};g(y,d=>{e(Y)&&e(n)&&d(I)})}var S=o(y,2);{var G=d=>{var _=Pr(),F=f(_),D=o(F,2),i=o(D,4),V=o(i),T=oe(()=>e(ie)||"/auth/v1/account");Ue(V,{get href(){return e(T)},children:(he,je)=>{C();var $e=P("Account");t(he,$e)},$$slots:{default:!0}}),w(_),b(()=>{v(F,`${a.passwordReset.success1??""} `),v(D,` ${a.passwordReset.success2??""} `),v(i,` ${a.passwordReset.success3??""} `)}),t(d,_)},H=d=>{var _=K(),F=h(_);{var D=i=>{var V=Er(),T=f(V);{var he=q=>{var R=Dr(),U=h(R),ye=f(U,!0);w(U);var z=o(U,2),B=f(z,!0);w(z);var se=o(z,2),Ie=f(se),rr=o(Ie);Ue(rr,{get href(){return a.passwordReset.fidoLink},target:"_blank",children:(k,A)=>{C();var L=P("FIDO Alliance");t(k,L)},$$slots:{default:!0}}),w(se);var _e=o(se,2),We=f(_e),sr=oe(()=>e(E)?3:1);M(We,{get level(){return e(sr)},onclick:()=>s(E,"passkey"),get isLoading(){return e(Z)},children:(k,A)=>{C();var L=P();b(()=>v(L,a.passwordReset.passwordless)),t(k,L)},$$slots:{default:!0}});var tr=o(We,2),ar=oe(()=>e(E)?3:2);M(tr,{get level(){return e(ar)},onclick:()=>s(E,"password"),get isLoading(){return e(Z)},children:(k,A)=>{C();var L=P();b(()=>v(L,a.passwordReset.password)),t(k,L)},$$slots:{default:!0}}),w(_e);var or=o(_e,2);{var ir=k=>{var A=Nr(),L=f(A);Le(L),w(A),Ee(3,A,()=>Se),t(k,A)},nr=k=>{var A=K(),L=h(A);{var dr=Re=>{var ne=Wr(),De=f(ne);ze(De,{action:"",onSubmit:Qe,children:(te,de)=>{var X=jr(),le=h(X);gr(le,{autocomplete:"off",get label(){return a.mfa.passkeyName},get placeholder(){return a.mfa.passkeyName},width:pe,maxLength:32,pattern:qr,required:!0,get ref(){return e(ue)},set ref(J){s(ue,l(J))},get value(){return e(ee)},set value(J){s(ee,l(J))}});var ae=o(le,2),ke=oe(()=>e(Q)?2:1);M(ae,{type:"submit",get level(){return e(ke)},children:(J,Fe)=>{C();var be=P();b(()=>v(be,a.mfa.register)),t(J,be)},$$slots:{default:!0}}),t(te,X)},$$slots:{default:!0}});var lr=o(De,2);{var cr=te=>{var de=Ir(),X=f(de),le=f(X,!0);w(X);var ae=o(X,2),ke=f(ae,!0);w(ae);var J=o(ae,2);M(J,{onclick:Te,children:(Fe,be)=>{C();var Me=P();b(()=>v(Me,a.passwordReset.accountLogin)),t(Fe,Me)},$$slots:{default:!0}}),w(de),b(()=>{v(le,a.passwordReset.successPasskey1),v(ke,a.passwordReset.successPasskey2)}),t(te,de)};g(lr,te=>{e(Q)&&te(cr)})}w(ne),Ee(3,ne,()=>Se),t(Re,ne)};g(L,Re=>{e(E)==="passkey"&&Re(dr)},!0)}t(k,A)};g(or,k=>{e(E)==="password"?k(ir):k(nr,!1)})}b(()=>{v(ye,a.passwordReset.newAccount),v(B,a.passwordReset.newAccDesc1),v(Ie,`${a.passwordReset.newAccDesc2??""} `)}),t(q,R)},je=q=>{var R=K(),U=h(R);{var ye=z=>{var B=Fr(),se=o(h(B),2);Le(se),t(z,B)};g(U,z=>{var B;(B=O.get())!=null&&B.startsWith("password_reset")&&z(ye)},!0)}t(q,R)};g(T,q=>{var R;(R=O.get())!=null&&R.startsWith("new_user")?q(he):q(je,!1)})}var $e=o(T,2);{var er=q=>{var R=Mr(),U=f(R,!0);w(R),b(()=>v(U,e(x))),t(q,R)};g($e,q=>{e(x)&&q(er)})}w(V),t(i,V)};g(F,i=>{e(n)&&i(D)},!0)}t(d,_)};g(S,d=>{e(Q)?d(G):d(H,!1)})}var W=o(S,2);xr(W,{absolute:!0}),t(p,m)},$$slots:{default:!0}})},$$slots:{default:!0}});var Ye=o(Ne,2);$r(Ye,{absolute:!0}),t(Be,Ae),ur()}export{Ur as component};
