import{e as Q,a as m,t as y,d as oe}from"../chunks/disclose-version.BP4T4xdV.js";import{a as U,l as S,aa as R,k as s,j as e,f as G,a7 as K,t as L,s as I,p as V,a9 as ee,c as N,r as P,a5 as ve}from"../chunks/index-client.hxMyB_b4.js";import{s as j}from"../chunks/render.yNX9q8-B.js";import{i as k}from"../chunks/if.BeBa1Kxb.js";import{e as pe}from"../chunks/each.BUp7aLCc.js";import{B as se,a as ue}from"../chunks/Button.BR1gOfNn.js";import{p as n}from"../chunks/proxy.DaVNR9vk.js";import{u as X}from"../chunks/i18n_admin.svelte.lt3dD7TQ.js";import{O as fe}from"../chunks/OrderSearchBar.wIdu7A5l.js";import{d as ge,c as he,b as $e,f as ne}from"../chunks/fetch.Bq59EV_b.js";import{C as be}from"../chunks/ContentAdmin.YSUtpxca.js";import{N as ye}from"../chunks/NavButtonTile.DRctQzgA.js";import{B as Se}from"../chunks/ButtonAddModal.DsDc6nUh.js";import{N as we}from"../chunks/NavSub.DILgx03i.js";import{u as Oe}from"../chunks/param.svelte.BbzO27-O.js";import{O as Y}from"../chunks/helpers.CchIKxjM.js";import{I as ie}from"../chunks/pow.BMnvYon0.js";import{I as _e}from"../chunks/IconCheck.C6tGCpWy.js";import{u as ae}from"../chunks/i18n.svelte.Ci9wvqOq.js";import{F as ce}from"../chunks/Form.BnvI_UPN.js";import{L as Ie}from"../chunks/LabeledValue.CxxfjE_4.js";import{S as le}from"../chunks/SelectList.FzYp0jWd.js";import{f as me}from"../chunks/patterns.BRCxk8by.js";import{T as Te}from"../chunks/Tabs.DUIpSMWU.js";var Me=y("<p> </p>"),Ce=y("<p> </p> <p> </p> <!> <!>",1),De=y('<div class="err"> </div>'),qe=y('<div class="flex gap-05"><!> <!></div> <!>',1),Ae=y("<!> <!> <!> <!>",1);function je(z,r){U(r,!0);let B=ae(),g=X(),p=S(""),f=S(!1),w=ee(()=>Y(r.scope.name)),v=S(n(r.scope.name)),u=S(void 0),T=S(void 0);R(()=>{r.scope.id&&s(v,n(r.scope.name))}),R(()=>{Y(r.scope.name)?(s(u,void 0),s(T,void 0)):(s(u,n(r.attrs.map(i=>{var t;return{name:i.name,selected:((t=r.scope.attr_include_access)==null?void 0:t.includes(i.name))||!1}}).toSorted((i,t)=>i.name.localeCompare(t.name)))),s(T,n(r.attrs.map(i=>{var t;return{name:i.name,selected:((t=r.scope.attr_include_id)==null?void 0:t.includes(i.name))||!1}}).toSorted((i,t)=>i.name.localeCompare(t.name)))))});async function d(i,t){if(s(p,""),Y(e(v))||r.scopes.find(O=>O.name===e(v))){s(p,n(g.common.nameExistsAlready));return}let h={scope:e(v)};if(e(u)){let O=e(u).filter(o=>o.selected).map(o=>o.name);O.length>0&&(h.attr_include_access=O)}if(e(T)){let O=e(T).filter(o=>o.selected).map(o=>o.name);O.length>0&&(h.attr_include_id=O)}let C=await ge(i.action,h);C.error?s(p,n(C.error.message)):(s(f,!0),r.onSave(),setTimeout(()=>{s(f,!1)},2e3))}var M=ee(()=>`/auth/v1/scopes/${r.scope.id}`);ce(z,{get action(){return e(M)},onSubmit:d,children:(i,t)=>{var h=Ae(),C=G(h);Ie(C,{label:"ID",mono:!0,children:(a,c)=>{K();var l=Q();L(()=>j(l,r.scope.id)),m(a,l)},$$slots:{default:!0}});var O=I(C,2);ie(O,{autocomplete:"off",get label(){return g.scopes.name},get placeholder(){return g.scopes.name},get disabled(){return e(w)},width:"14.5rem",required:!0,pattern:me,get value(){return e(v)},set value(a){s(v,n(a))}});var o=I(O,2);{var x=a=>{var c=Me(),l=N(c,!0);P(c),L(()=>j(l,g.scopes.defaultNoMod)),m(a,c)},A=a=>{var c=Ce(),l=G(c),_=N(l,!0);P(l);var b=I(l,2),E=N(b,!0);P(b);var q=I(b,2);{var W=D=>{le(D,{get items(){return e(u)},set items(J){s(u,n(J))},children:(J,re)=>{K();var H=Q("Access Token Mappings");m(J,H)},$$slots:{default:!0}})};k(q,D=>{e(u)&&D(W)})}var $=I(q,2);{var F=D=>{le(D,{get items(){return e(T)},set items(J){s(T,n(J))},children:(J,re)=>{K();var H=Q("Id Token Mappings");m(J,H)},$$slots:{default:!0}})};k($,D=>{e(T)&&D(F)})}L(()=>{j(_,g.scopes.mapping1),j(E,g.scopes.mapping2)}),m(a,c)};k(o,a=>{e(w)?a(x):a(A,!1)})}var Z=I(o,2);{var te=a=>{var c=qe(),l=G(c),_=N(l);se(_,{type:"submit",children:($,F)=>{K();var D=Q();L(()=>j(D,B.common.save)),m($,D)},$$slots:{default:!0}});var b=I(_,2);{var E=$=>{_e($,{})};k(b,$=>{e(f)&&$(E)})}P(l);var q=I(l,2);{var W=$=>{var F=De(),D=N(F,!0);P(F),L(()=>j(D,e(p))),m($,F)};k(q,$=>{e(p)&&$(W)})}m(a,c)};k(Z,a=>{e(w)||a(te)})}m(i,h)},$$slots:{default:!0}}),V()}var ke=y("<p> </p>"),xe=y('<div class="err"> </div>'),Ee=y("<p> </p> <!> <!>",1);function Fe(z,r){U(r,!0);let B=ae(),g=X(),p=S("");async function f(){s(p,"");let d=await he(`/auth/v1/scopes/${r.scope.id}`);d.error?s(p,n(d.error.message)):r.onSave()}var w=oe(),v=G(w);{var u=d=>{var M=ke(),i=N(M,!0);P(M),L(()=>j(i,g.scopes.deleteDefault)),m(d,M)},T=d=>{var M=Ee(),i=G(M),t=N(i,!0);P(i);var h=I(i,2);se(h,{level:-1,onclick:f,children:(o,x)=>{K();var A=Q();L(()=>j(A,B.common.delete)),m(o,A)},$$slots:{default:!0}});var C=I(h,2);{var O=o=>{var x=xe(),A=N(x,!0);P(x),L(()=>j(A,e(p))),m(o,x)};k(C,o=>{e(p)&&o(O)})}L(()=>j(t,g.scopes.delete1)),m(d,M)};k(v,d=>{Y(r.scope.name)?d(u):d(T,!1)})}m(z,w),V()}var Ge=y('<div class="flex"><!></div> <!>',1);function Le(z,r){U(r,!0);let B=ae(),g=X();const p=[g.nav.config,B.common.delete];let f=S(n(p[0])),w=S(void 0);R(()=>{r.scope.id&&requestAnimationFrame(()=>{var t;(t=e(w))==null||t()})});var v=Ge(),u=G(v),T=N(u);Te(T,{tabs:p,get selected(){return e(f)},set selected(t){s(f,n(t))},get focusFirst(){return e(w)},set focusFirst(t){s(w,n(t))}}),P(u);var d=I(u,2);{var M=t=>{je(t,{get attrs(){return r.attrs},get scope(){return r.scope},get scopes(){return r.scopes},get onSave(){return r.onSave}})},i=t=>{var h=oe(),C=G(h);{var O=o=>{Fe(o,{get scope(){return r.scope},get onSave(){return r.onSave}})};k(C,o=>{e(f)===B.common.delete&&o(O)},!0)}m(t,h)};k(d,t=>{e(f)===g.nav.config?t(M):t(i,!1)})}m(z,v),V()}var Ne=y('<div class="err"> </div>'),Pe=y("<!> <!> <!>",1),ze=y('<div class="container svelte-s1196z"><!></div>');function Be(z,r){U(r,!0);let B=ae(),g=X(),p=S(void 0),f=S(""),w=S("");R(()=>{requestAnimationFrame(()=>{var d;(d=e(p))==null||d.focus()})});async function v(d,M){var h;if(r.scopes.find(C=>C.name===e(w))){s(f,n(g.common.nameExistsAlready));return}s(f,"");let i={scope:e(w)},t=await $e(d.action,i);t.body?r.onSave(t.body.id):s(f,n(((h=t.error)==null?void 0:h.message)||"Error"))}var u=ze(),T=N(u);ce(T,{action:"/auth/v1/scopes",onSubmit:v,children:(d,M)=>{var i=Pe(),t=G(i);ie(t,{autocomplete:"off",get label(){return g.scopes.name},get placeholder(){return g.scopes.name},required:!0,pattern:me,get ref(){return e(p)},set ref(o){s(p,n(o))},get value(){return e(w)},set value(o){s(w,n(o))}});var h=I(t,2);se(h,{type:"submit",children:(o,x)=>{K();var A=Q();L(()=>j(A,B.common.save)),m(o,A)},$$slots:{default:!0}});var C=I(h,2);{var O=o=>{var x=Ne(),A=N(x,!0);P(x),L(()=>j(A,e(f))),m(o,x)};k(C,o=>{e(f)&&o(O)})}m(d,i)},$$slots:{default:!0}}),P(u),m(z,u),V()}var Je=y('<span class="default svelte-1bjjcss"><i>default</i></span>'),We=y(" <!>",1),He=y("<div></div> <!>",1),Ke=y("<!> <!>",1),Qe=y('<div class="err"> </div>'),Re=y('<!> <div id="scopes"><!></div>',1),Ue=y("<!> <!>",1);function Ve(z,r){U(r,!0);let B=X(),g=S(void 0),p=S(""),f=Oe("sid"),w=S(n([])),v=S(n([])),u=S(n([])),T=S(void 0);const d=[B.common.name,"ID"];let M=S(n(d[0])),i=S("");const t=[B.common.name,"ID"];ve(()=>{C(),h()}),R(()=>{s(T,n(e(v).find(a=>a.id===f.get())))}),R(()=>{let a=e(i).toLowerCase();a?e(M)===d[0]?s(u,n(e(v).filter(c=>{var l;return(l=c.name)==null?void 0:l.toLowerCase().includes(a)}))):e(M)===d[1]&&s(u,n(e(v).filter(c=>c.id.toLowerCase().includes(a)))):s(u,n(e(v)))});async function h(){var c;let a=await ne("/auth/v1/users/attr");a.body?s(w,n(a.body.values)):s(p,n(((c=a.error)==null?void 0:c.message)||"Error"))}async function C(){var c;let a=await ne("/auth/v1/scopes");a.body?s(v,n(a.body)):s(p,n(((c=a.error)==null?void 0:c.message)||"Error"))}function O(a,c){let l=c==="up";a===t[0]?e(v).sort((_,b)=>l?_.name.localeCompare(b.name):b.name.localeCompare(_.name)):a===t[1]&&e(v).sort((_,b)=>l?_.id.localeCompare(b.id):b.id.localeCompare(_.id))}function o(){C()}async function x(a){var c;(c=e(g))==null||c(),await C(),f.set(a)}var A=Ue(),Z=G(A);we(Z,{paddingTop:"2.1rem",buttonTilesAriaControls:"scopes",width:"min(20rem, 100dvw)",thresholdNavSub:700,buttonTiles:a=>{var c=He(),l=G(c);ue(l,"height",".5rem");var _=I(l,2);pe(_,17,()=>e(u),b=>b.id,(b,E)=>{var q=ee(()=>f.get()===e(E).id);ye(b,{onclick:()=>f.set(e(E).id),get selected(){return e(q)},children:(W,$)=>{K();var F=We(),D=G(F),J=I(D);{var re=H=>{var de=Je();m(H,de)};k(J,H=>{Y(e(E).name)&&H(re)})}L(()=>j(D,`${e(E).name??""} `)),m(W,F)},$$slots:{default:!0}})}),m(a,c)},children:(a,c)=>{var l=Ke(),_=G(l),b=ee(()=>e(v).length===0?1:2);Se(_,{get level(){return e(b)},alignRight:!0,get closeModal(){return e(g)},set closeModal(q){s(g,n(q))},children:(q,W)=>{Be(q,{onSave:x,get scopes(){return e(v)}})},$$slots:{default:!0}});var E=I(_,2);fe(E,{searchOptions:d,orderOptions:t,onChangeOrder:O,searchWidth:"min(19.5rem, 100dvw - .5rem)",get searchOption(){return e(M)},set searchOption(q){s(M,n(q))},get value(){return e(i)},set value(q){s(i,n(q))}}),m(a,l)},$$slots:{buttonTiles:!0,default:!0}});var te=I(Z,2);be(te,{children:(a,c)=>{var l=Re(),_=G(l);{var b=$=>{var F=Qe(),D=N(F,!0);P(F),L(()=>j(D,e(p))),m($,F)};k(_,$=>{e(p)&&$(b)})}var E=I(_,2),q=N(E);{var W=$=>{Le($,{get attrs(){return e(w)},get scope(){return e(T)},get scopes(){return e(v)},onSave:o})};k(q,$=>{e(T)&&$(W)})}P(E),m(a,l)},$$slots:{default:!0}}),m(z,A),V()}function Xe(z){Ve(z,{})}export{Xe as component};
