import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DtyiMpWz.js";import{p as V,ao as ee,s as g,c as n,g as t,r as v,t as Y,a as X,a9 as J,f as Z,i as _,aq as R,h as r}from"../chunks/index-client.DAoU_hDn.js";import{d as oe,e as te,s as B,k as fe}from"../chunks/render.mNhspeV3.js";import{i as P}from"../chunks/if.BANCODOf.js";import{e as ae,i as re}from"../chunks/each.DTG73tix.js";import{a as f,t as q,e as se,d as F}from"../chunks/template.DcxtE4ym.js";import{t as H,a as W,s as le}from"../chunks/index.DER1jHiU.js";import{p as b}from"../chunks/proxy.D3ASEzk3.js";import{O as he,P as xe}from"../chunks/Pagination.DF9sn7Vj.js";import{B as Q}from"../chunks/Button.CKHLXer8.js";import{F as ye,G as ge,H as we,I as be,J as $e}from"../chunks/dataFetchingAdmin.D7RWqeRL.js";import{p as U,r as Se}from"../chunks/props.VJ8UyA45.js";import{r as ie}from"../chunks/legacy-client.rYJ80fHr.js";import{c as Ie,a as Ke,I as ne}from"../chunks/Input.C04-Kl2S.js";import{a2 as Ee,B as ce,o as Ae,k as ke}from"../chunks/helpers.BV-akmwW.js";import{S as de,I as je,a as _e,b as ze,P as qe}from"../chunks/PasswordInput.JBBIMWuW.js";import{r as De,d as Me}from"../chunks/class.DWa3OhYO.js";import{a as Te,b as Ne}from"../chunks/input.CNTnF6Qx.js";import{E as Oe}from"../chunks/ExpandContainer.mM6ZiTQe.js";import{T as Pe}from"../chunks/OptionSelect.CBlj_bre.js";import{T as Ce}from"../chunks/TabBar.BqcS880p.js";var Ue=q('<div role="button" tabindex="0" class="cell pointer svelte-lgl56a"> </div>'),Ge=q('<div class="cell svelte-lgl56a"><input class="pointer svelte-lgl56a" type="checkbox"></div>'),Ye=q('<div class="mr svelte-lgl56a"><div role="button" tabindex="0" class="label pointer svelte-lgl56a"> </div> <!></div>'),Re=q('<div class="matrix svelte-lgl56a"><b>Access Rights</b> <div class="mr svelte-lgl56a"><div class="label svelte-lgl56a"></div> <!></div> <!></div>');function pe(O,p){V(p,!0);let u=U(p,"accessMatrix",15);U(p,"finalize",15)(o);const l=["Blacklist","Clients","Events","Generic","Groups","Roles","Secrets","Sessions","Scopes","UserAttributes","Users"],h=["create","read","update","delete"];let $=new Array(l.length).fill(!1),w=new Array(h.length).fill(!1);ee(()=>{var s;I(),(s=p.apiKey)!=null&&s.access&&M()});function I(){let s=new Array(l.length);for(let d=0;d<l.length;d++){s[d]={group:l[d]};for(let i of h)s[d][i]=!1}u(s)}function M(){for(let s of p.apiKey.access){let d=l.findIndex(i=>i===s.group);for(let i of s.access_rights){let x=h.findIndex(k=>k===i);u(u()[d][h[x]]=!0,!0)}}}function o(){let s=[];for(let d=0;d<l.length;d++){let i=[];for(let x of h)u()[d][x]&&i.push(x);i.length>0&&s.push({group:l[d],access_rights:i})}return s}function c(s){$[s]=!$[s];const d=$[s];let i=u()[s];for(let x=0;x<h.length;x++)for(let k of Object.keys(i))k!=="group"&&(i[k]=d);u(u()[s]=i,!0)}function A(s){w[s]=!w[s];const d=w[s];for(let i=0;i<l.length;i++)u(u()[i][h[s]]=d,!0)}var j=Re(),z=g(n(j),2),K=g(n(z),2);ae(K,17,()=>h,re,(s,d,i)=>{var x=Ue(),k=J(()=>A.bind(this,i));x.__click=function(...E){var e;(e=t(k))==null||e.apply(this,E)};var S=J(()=>A.bind(this,i)),N=n(x,!0);v(x),Y(()=>B(N,h[i])),te("keypress",x,function(...E){var e;(e=t(S))==null||e.apply(this,E)}),f(s,x)}),v(z);var D=g(z,2);{var m=s=>{var d=se(),i=Z(d);ae(i,17,()=>l,re,(x,k,S)=>{var N=Ye(),E=n(N),e=J(()=>c.bind(this,S));E.__click=function(...G){var C;(C=t(e))==null||C.apply(this,G)};var a=J(()=>c.bind(this,S)),y=n(E,!0);v(E);var T=g(E,2);ae(T,17,()=>h,re,(G,C)=>{var L=Ge(),ve=n(L);De(ve),v(L),Te(ve,()=>u()[S][t(C)],me=>u(u()[S][t(C)]=me,!0)),f(G,L)}),v(N),Y(()=>B(y,l[S])),te("keypress",E,function(...G){var C;(C=t(a))==null||C.apply(this,G)}),f(x,N)}),f(s,d)};P(D,s=>{u()&&s(m)})}return v(j),f(O,j),X({finalizeMatrix:o})}oe(["click"]);var Be=q("<div><!></div>"),He=q('<div class="container svelte-ubtepy"><!> <div class="switch svelte-ubtepy">Key Expires: <!></div> <!> <!> <div class="saveBtn svelte-ubtepy"><!></div> <div class="err svelte-ubtepy"> </div></div>');function We(O,p){V(p,!0);const u=new Date().toISOString().split(".")[0];let l=U(p,"apiKeys",19,()=>[]),h=U(p,"onSave",3,()=>{}),$=_(""),w=_(!1),I=_(void 0),M=_(void 0),o=b({name:"",exp:""}),c=_(b({}));const A=Ie().shape({name:Ke().required("Name is required").min(2).max(24).matches(Ee,"Format: [a-zA-Z0-9_/-]{2,24}")});ie(()=>{t(w)&&(o.exp=new Date().toISOString().split(".")[0])});async function j(){if(r($,""),!await z())return;let e={name:o.name,access:t(I)()};if(e.access.length===0){r($,"Grant the new API Key at least one permission");return}if(t(w)){let y=ce(o.exp);if(!y){r($,"Invalid Date Input: User Expires");return}e.exp=y}let a=await ye(e);if(a.ok)h()();else{let y=await a.json();r($,b(y.message))}}async function z(){try{await A.validate(o,{abortEarly:!1}),r(c,b({}))}catch(e){return r(c,b(Ae(e))),!1}for(let e of l())if(e.name===o.name)return t(c).name="Name already exists",!1;return!0}var K=He(),D=n(K);ne(D,{width:"18rem",autocomplete:"off",placeholder:"Name",get value(){return o.name},set value(e){o.name=e},get error(){return t(c).name},set error(e){t(c).name=e},children:(e,a)=>{R();var y=F("NAME");f(e,y)},$$slots:{default:!0}});var m=g(D,2),s=g(n(m));de(s,{get selected(){return t(w)},set selected(e){r(w,b(e))}}),v(m);var d=g(m,2);{var i=e=>{var a=Be(),y=n(a);ne(y,{type:"datetime-local",step:"60",width:"18rem",min:u,max:"2099-01-01T00:00",get value(){return o.exp},set value(T){o.exp=T},children:(T,G)=>{R();var C=F("EXPIRES");f(T,C)},$$slots:{default:!0}}),v(a),H(3,a,()=>W),f(e,a)};P(d,e=>{t(w)&&e(i)})}var x=g(d,2);pe(x,{get accessMatrix(){return t(M)},set accessMatrix(e){r(M,b(e))},get finalize(){return t(I)},set finalize(e){r(I,b(e))}});var k=g(x,2),S=n(k);Q(S,{level:1,$$events:{click:j},children:(e,a)=>{R();var y=F("SAVE");f(e,y)},$$slots:{default:!0}}),v(k);var N=g(k,2),E=n(N,!0);v(N),v(K),Y(()=>B(E,t($))),f(O,K),X()}var Fe=q("<div><!></div>"),Ve=q('<div class="success svelte-1a3jnb3">Success</div>'),Xe=q('<div class="mainErr err svelte-1a3jnb3"> </div>'),Le=q('<div class="container svelte-1a3jnb3"><div class="unit svelte-1a3jnb3"><div class="label svelte-1a3jnb3">Name</div> <div class="value svelte-1a3jnb3"> </div></div> <div class="switch svelte-1a3jnb3">Key Expires: <!></div> <!> <!> <!> <!> <!></div>');function Ze(O,p){V(p,!0);const u=new Date().toISOString().split(".")[0];let l=U(p,"apiKey",27,()=>b({})),h=_(""),$=_(!1),w=_(void 0),I=_(!!l().expires),M=_(void 0),o=_(void 0);ie(()=>{t($)&&r(w,b(setTimeout(()=>{r($,!1),p.onSave()},2e3)))}),ee(()=>()=>clearTimeout(t(w)));let c=b({exp:""});ie(()=>{t(I)&&(c.exp=new Date().toISOString().split(".")[0])});async function A(){r(h,"");let a={name:l().name,access:t(o)()};if(a.access.length===0){r(h,"Grant the API Key at least one permission");return}if(t(I)){let T=ce(c.exp);if(!T){r(h,"Invalid Date Input: User Expires");return}a.exp=T}let y=await ge(a);if(y.ok)p.onSave(),r($,!0);else{let T=await y.json();r(h,b(T.message))}}var j=Le(),z=n(j),K=g(n(z),2),D=n(K,!0);v(K),v(z);var m=g(z,2),s=g(n(m));de(s,{get selected(){return t(I)},set selected(a){r(I,b(a))}}),v(m);var d=g(m,2);{var i=a=>{var y=Fe(),T=n(y);ne(T,{type:"datetime-local",step:"60",width:"18rem",min:u,max:"2099-01-01T00:00",get value(){return c.exp},set value(G){c.exp=G},children:(G,C)=>{R();var L=F("EXPIRES");f(G,L)},$$slots:{default:!0}}),v(y),H(3,y,()=>W),f(a,y)};P(d,a=>{t(I)&&a(i)})}var x=g(d,2);pe(x,{get apiKey(){return l()},get accessMatrix(){return t(M)},set accessMatrix(a){r(M,b(a))},get finalize(){return t(o)},set finalize(a){r(o,b(a))}});var k=g(x,2);Q(k,{level:1,width:"4rem",$$events:{click:A},children:(a,y)=>{R();var T=F("SAVE");f(a,T)},$$slots:{default:!0}});var S=g(k,2);{var N=a=>{var y=Ve();f(a,y)};P(S,a=>{t($)&&a(N)})}var E=g(S,2);{var e=a=>{var y=Xe(),T=n(y,!0);v(y),Y(()=>B(T,t(h))),f(a,y)};P(E,a=>{t(h)&&a(e)})}v(j),Y(()=>B(D,l().name)),f(O,j),X()}var Je=q('<div class="err svelte-1jljqe9"> </div>'),Qe=q('<div class="container svelte-1jljqe9"><div class="label svelte-1jljqe9">Are you sure, you want to delete this ApiKey?</div> <!> <!></div>');function et(O,p){V(p,!0);let u=U(p,"apiKey",19,()=>({})),l=_("");async function h(){r(l,"");let o=await we(u().name);if(o.ok)p.onSave();else{let c=await o.json();r(l,b(c.message))}}var $=Qe(),w=g(n($),2);Q(w,{level:1,$$events:{click:h},children:(o,c)=>{R();var A=F("DELETE");f(o,A)},$$slots:{default:!0}});var I=g(w,2);{var M=o=>{var c=Je(),A=n(c,!0);v(c),Y(()=>B(A,t(l))),f(o,c)};P(I,o=>{t(l)&&o(M)})}v($),f(O,$),X()}var tt=q('<div><div class="iconsOuter svelte-s24qr4"><div class="iconsInner svelte-s24qr4"><div role="button" tabindex="0" class="show svelte-s24qr4"><!></div> <div role="button" tabindex="0"><!></div></div></div> <textarea></textarea></div>');function ue(O,p){V(p,!0);let u=U(p,"value",3,""),l=U(p,"rows",3,10),h=U(p,"cols",3,60),$=U(p,"name",3,"default"),w=U(p,"show",15,!1),I=U(p,"width",3,"40rem"),M=Se(p,["$$slots","$$events","$$legacy","value","rows","cols","name","show","width"]),o=_(""),c=_("");ie(()=>{w()?r(c,u()):r(c,b(t(o)))}),ee(()=>{for(let E=0;E<u().length;E++)r(o,t(o)+"*");r(c,b(t(o)))});function A(){navigator.clipboard.writeText(u())}function j(){w(!w())}var z=tt(),K=n(z),D=n(K),m=n(D);m.__click=j;var s=n(m);{var d=E=>{_e(E,{width:22})},i=E=>{ze(E,{width:22})};P(s,E=>{w()?E(d):E(i,!1)})}v(m);var x=g(m,2);x.__click=A;var k=n(x);je(k,{}),v(x),v(D),v(K);var S=g(K,2);fe(S);let N;v(z),Y(()=>{le(z,"width",`${I()}`),N=Me(S,N,{disabled:!0,name:$(),rows:l(),cols:h(),...M},"svelte-s24qr4"),le(S,"width",`${I()}`),le(S,"padding-right","2.75rem")}),te("keypress",m,j),te("keypress",x,A),Ne(S,()=>t(c),E=>r(c,E)),f(O,z),X()}oe(["click"]);var at=q(`<div class="secret font-mono svelte-1vixcxf"><!></div> <p class="svelte-1vixcxf">An API Key must be provided in the HTTP <span class="headerCodeSmall svelte-1vixcxf"><code>Authorization</code></span> header in the following format:</p> <p class="svelte-1vixcxf"><span class="headerCode svelte-1vixcxf"><b><code>API-Key YourSecretApiKeyHere</code></b></span></p> <p class="svelte-1vixcxf">You can use the following <code>curl</code> request to test your new Key:</p> <!> <p class="svelte-1vixcxf">If you don't have <code>jq</code> installed and the above fails:</p> <!>`,1),st=q(`<div class="container svelte-1vixcxf"><p class="svelte-1vixcxf">You Can generate a new secret for this API Key here.</p> <p class="svelte-1vixcxf">You will only see this secret once after the generation.
        When a new one has been generated, the old secret will be overridden permanently.
        This operation cannot be reverted!</p> <!> <!> <div class="err svelte-1vixcxf"> </div></div>`);function it(O,p){V(p,!0);let u=_(""),l=_(""),h=_(""),$=_("");async function w(){let K=await be(p.apiKey.name);if(K.ok)r(l,b(await K.text())),r(h,`curl -s -H 'Authorization: API-Key ${t(l)}' ${window.location.origin}/auth/v1/api_keys/${p.apiKey.name}/test`),r($,`${t(h)} | jq`);else{let D=await K.json();r(u,b(D.message))}}var I=st(),M=g(n(I),4),o=J(()=>t(l)?3:1);Q(M,{get level(){return t(o)},width:"130px",$$events:{click:w},children:(K,D)=>{R();var m=F("GENERATE NEW");f(K,m)},$$slots:{default:!0}});var c=g(M,2);{var A=K=>{var D=at(),m=Z(D),s=n(m);qe(s,{autocomplete:"off",disabled:!0,showCopy:!0,width:"inherit",maxWidth:"800px",get value(){return t(l)},set value(x){r(l,b(x))},children:(x,k)=>{R();var S=F("API KEY");f(x,S)},$$slots:{default:!0}}),v(m);var d=g(m,8);ue(d,{name:"id",rows:3,get value(){return t($)}});var i=g(d,4);ue(i,{name:"id",rows:3,get value(){return t(h)}}),H(3,m,()=>W),f(K,D)};P(c,K=>{t(l)&&K(A)})}var j=g(c,2),z=n(j,!0);v(j),v(I),Y(()=>B(z,t(u))),f(O,I),X()}var rt=q('<div class="data svelte-115hohv"> </div>'),lt=q('<div class="header svelte-115hohv"><div class="data svelte-115hohv"> </div> <!></div>'),nt=q("<div><!></div>"),vt=q("<div><!></div>"),ot=q("<div><!></div>"),ct=q("<div><!> <!></div>");function dt(O,p){V(p,!0);let u=U(p,"apiKey",31,()=>b({})),l=U(p,"onSave",11,()=>{}),h=_(void 0);const $=["Config","Secret","Delete"];let w=_(b($[0]));const I=200,M=I/2;function o(){r(h,!1),l()()}Oe(O,{get show(){return t(h)},set show(c){r(h,b(c))},header:c=>{var A=lt(),j=n(A),z=n(j,!0);v(j);var K=g(j,2);{var D=m=>{Pe(m,{text:"Expiry",children:(s,d)=>{var i=rt(),x=n(i,!0);Y(()=>B(x,ke(u().expires))),v(i),f(s,i)},$$slots:{default:!0}})};P(K,m=>{u().expires&&m(D)})}v(A),Y(()=>B(z,u().name)),f(c,A)},body:c=>{var A=ct(),j=n(A);Ce(j,{labels:$,get selected(){return t(w)},set selected(m){r(w,b(m))}});var z=g(j,2);{var K=m=>{var s=nt(),d=n(s);Ze(d,{get onSave(){return l()},get apiKey(){return u()},set apiKey(i){u(i)}}),v(s),H(1,s,()=>W,()=>({delay:M,duration:I})),H(2,s,()=>W,()=>({duration:I})),f(m,s)},D=m=>{var s=se(),d=Z(s);{var i=k=>{var S=vt(),N=n(S);it(N,{get apiKey(){return u()}}),v(S),H(1,S,()=>W,()=>({delay:M,duration:I})),H(2,S,()=>W,()=>({duration:I})),f(k,S)},x=k=>{var S=se(),N=Z(S);{var E=e=>{var a=ot(),y=n(a);et(y,{get apiKey(){return u()},onSave:o}),v(a),H(1,a,()=>W,()=>({delay:M,duration:I})),H(2,a,()=>W,()=>({duration:I})),f(e,a)};P(N,e=>{t(w)==="Delete"&&e(E)},!0)}f(k,S)};P(d,k=>{t(w)==="Secret"?k(i):k(x,!1)},!0)}f(m,s)};P(z,m=>{t(w)==="Config"?m(K):m(D,!1)})}v(A),f(c,A)},$$slots:{header:!0,body:!0}}),X()}var pt=q("<div><!></div>"),ut=q('<div class="svelte-1fzx60h">No Api Keys</div>'),mt=q(' <div class="content"><div class="top svelte-1fzx60h"><!> <div class="addNew svelte-1fzx60h"><!></div></div> <!> <div id="keys" class="svelte-1fzx60h"><!></div> <!> <div style="height: 20px"></div></div>',1);function ft(O,p){V(p,!0);let u=_(""),l=_(b([])),h=_(b([])),$=_(b([])),w=_(!1);const I=[{label:"Name",callback:(e,a)=>e.name.includes(a)}];let M=[{label:"Name",callback:(e,a)=>e.name.localeCompare(a.name)}];ee(()=>{o()});async function o(){let e=await $e(),a=await e.json();e.ok?(r(l,b(a.keys)),r(w,!1)):r(u,b(a.message))}R();var c=mt(),A=Z(c),j=g(A),z=n(j),K=n(z);he(K,{get items(){return t(l)},searchOptions:I,orderOptions:M,get resItems(){return t(h)},set resItems(e){r(h,b(e))}});var D=g(K,2),m=n(D);Q(m,{level:3,$$events:{click:()=>r(w,!t(w))},children:(e,a)=>{R();var y=F("NEW KEY");f(e,y)},$$slots:{default:!0}}),v(D),v(z);var s=g(z,2);{var d=e=>{var a=pt(),y=n(a);We(y,{onSave:o,get apiKeys(){return t(l)}}),v(a),H(3,a,()=>W),f(e,a)};P(s,e=>{t(w)&&e(d)})}var i=g(s,2),x=n(i);{var k=e=>{var a=ut();f(e,a)},S=e=>{var a=se(),y=Z(a);ae(y,19,()=>t($),T=>T.name,(T,G,C)=>{dt(T,{onSave:o,get apiKey(){return t($)[t(C)]},set apiKey(L){t($)[t(C)]=L}})}),f(e,a)};P(x,e=>{t(l).length===0?e(k):e(S,!1)})}v(i);var N=g(i,2);{var E=e=>{xe(e,{get items(){return t(h)},set items(a){r(h,b(a))},get resItems(){return t($)},set resItems(a){r($,b(a))}})};P(N,e=>{t(l).length>0&&e(E)})}R(2),v(j),Y(()=>B(A,`${t(u)??""} `)),f(O,c),X()}function ht(O){ft(O,{})}export{ht as component};
