import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.C93jtn63.js";import{p as K,i as m,ao as Z,a as X,g as a,h as t,c as E,aq as L,s as g,r as y,t as W,f as Y}from"../chunks/index-client.ijM6xFk7.js";import{s as G}from"../chunks/render.BjVgqyVR.js";import{e as ue}from"../chunks/each.K_FVK-xy.js";import{a as v,d as F,t as p,e as me}from"../chunks/template.DOyJZ41v.js";import{p as r}from"../chunks/proxy.DmesnD8z.js";import{q as pe,r as he,s as fe,f as ge,t as we}from"../chunks/dataFetchingAdmin.1Vn3g5PB.js";import{i as N}from"../chunks/if.BunKWniS.js";import{p as M}from"../chunks/props.YiozBtSG.js";import{r as ee}from"../chunks/legacy-client.YTFnMCQ3.js";import{E as te,T as se,a as be,P as $e}from"../chunks/Pagination.8F_y-ekl.js";import{c as re,a as oe,I as ie}from"../chunks/Input.QQtpeOHH.js";import{W as ne,q as ve,X as le}from"../chunks/helpers.DMpx17S8.js";import{B as ae}from"../chunks/Button.BgUaD8Uz.js";import{s as ce,t as R,a as U}from"../chunks/index.R935SZZb.js";import{T as ye}from"../chunks/TabBar.DtAcwHiX.js";import{I as de}from"../chunks/ItemTiles.84cWCQoV.js";var _e=p('<div class="header font-label svelte-r30xs6">ADD NEW SCOPE</div>'),Se=p('<div class="success svelte-r30xs6">Success</div>'),Ee=p('<div class="err svelte-r30xs6"> </div>'),Ce=p('<div class="container svelte-r30xs6"><!> <!> <!> <!></div>');function De(P,$){K($,!0);let j=M($,"idx",31,()=>-1),s=m(void 0),c=m(r({scope:""})),h=m(""),w=m(!1),_=m(void 0),S=m(r({}));const x=re().shape({scope:oe().trim().matches(ne,"Can only contain: 'a-z0-9-_/:*', length: 2-64")});ee(()=>{a(w)&&t(_,r(setTimeout(()=>{$.onSave(),t(w,!1),t(c,r({scope:""})),t(s,!1)},1500)))}),Z(()=>()=>clearTimeout(a(_)));async function C(){if(t(h,""),!await b()){t(h,"Invalid input");return}a(c).scope=a(c).scope.trim();let i=await pe(a(c));if(i.ok)t(w,!0);else{let d=await i.json();t(h,r(d.message))}}async function b(){try{return await x.validate(a(c),{abortEarly:!1}),t(S,r({})),!0}catch(i){return t(S,r(ve(i))),!1}}te(P,{get idx(){return j()},set idx(i){j(i)},get show(){return a(s)},set show(i){t(s,r(i))},header:i=>{var d=_e();v(i,d)},body:i=>{var d=Ce(),T=E(d);ie(T,{autocomplete:"off",placeholder:"Scope Name",get value(){return a(c).scope},set value(e){a(c).scope=e},get error(){return a(S).scope},set error(e){a(S).scope=e},$$events:{input:b},children:(e,l)=>{L();var I=F("SCOPE NAME");v(e,I)},$$slots:{default:!0}});var u=g(T,2);ae(u,{level:1,width:"4rem",$$events:{click:C},children:(e,l)=>{L();var I=F("SAVE");v(e,I)},$$slots:{default:!0}});var D=g(u,2);{var n=e=>{var l=Se();v(e,l)};N(D,e=>{a(w)&&e(n)})}var f=g(D,2);{var O=e=>{var l=Ee(),I=E(l,!0);y(l),W(()=>G(I,a(h))),v(e,l)};N(f,e=>{a(h)&&e(O)})}y(d),v(i,d)},$$slots:{header:!0,body:!0}}),X()}var Ie=p('<div class="desc svelte-guvobw"><p>Custom mappings cannot be done for OpenID default scopes and their names cannot be changed.</p></div>'),je=p('<div class="desc svelte-guvobw"><p>You can map custom scopes to attributes.<br> All additional attributes, that were configured, can have a custom value for each user.<br> When they are mapped to a scope, they can be included in the Access and / or ID Tokens.</p></div> <div class="unit svelte-guvobw"><div class="label svelte-guvobw">ACCESS TOKEN MAPPINGS</div> <!></div> <div class="unit svelte-guvobw"><div class="label svelte-guvobw">ID TOKEN MAPPINGS</div> <!></div>',1),Te=p('<div class="success svelte-guvobw">Success</div>'),ke=p('<div class="mainErr err svelte-guvobw"> </div>'),xe=p("<!> <!> <!>",1),Ae=p('<div class="container svelte-guvobw"><div class="unit svelte-guvobw"><div class="label font-label svelte-guvobw">ID</div> <div class="value font-mono svelte-guvobw"> </div></div> <!> <div class="separator"></div> <!> <!></div>');function Pe(P,$){K($,!0);let j=M($,"attrs",27,()=>r([])),s=M($,"scope",31,()=>r({})),c=m(""),h=m(!1),w=m(void 0),_=m(!1),S=m(r([]));ee(()=>{a(h)&&t(w,r(setTimeout(()=>{t(h,!1),$.onSave()},2e3)))}),ee(()=>{j()&&t(S,r(j().map(o=>o.name)))}),Z(()=>(t(_,r(le(s().name))),()=>clearTimeout(a(w))));let x=m(r({}));const C=re().shape({name:oe().trim().matches(ne,"Can only contain: 'a-z0-9-_/:*', length: 2-64")});async function b(){if(t(c,""),!await i()){t(c,"Invalid input");return}let o={scope:s().name.trim()};s().attr_include_access.length>0&&(o.attr_include_access=s().attr_include_access),s().attr_include_id.length>0&&(o.attr_include_id=s().attr_include_id);let A=await he(s().id,o);if(A.ok)t(h,!0);else{let k=await A.json();t(c,r(k.message))}}async function i(){try{return await C.validate(s(),{abortEarly:!1}),t(x,r({})),!0}catch(o){return t(x,r(ve(o))),!1}}var d=Ae(),T=E(d),u=g(E(T),2),D=E(u,!0);y(u),y(T);var n=g(T,2);ie(n,{autocomplete:"off",placeholder:"Scope Name",get disabled(){return a(_)},get value(){return s().name},set value(o){s(s().name=o,!0)},get error(){return a(x).name},set error(o){a(x).name=o},$$events:{input:i},children:(o,A)=>{L();var k=F("SCOPE NAME");v(o,k)},$$slots:{default:!0}});var f=g(n,4);{var O=o=>{var A=Ie();v(o,A)},e=o=>{var A=je(),k=g(Y(A),2);ce(k,"margin-top","-3px");var Q=g(E(k),2);de(Q,{get options(){return a(S)},searchThreshold:4,get items(){return s().attr_include_access},set items(B){s(s().attr_include_access=B,!0)}}),y(k);var V=g(k,2);ce(V,"margin-top","-3px");var H=g(E(V),2);de(H,{get options(){return a(S)},searchThreshold:4,get items(){return s().attr_include_id},set items(B){s(s().attr_include_id=B,!0)}}),y(V),v(o,A)};N(f,o=>{a(_)?o(O):o(e,!1)})}var l=g(f,2);{var I=o=>{var A=xe(),k=Y(A);ae(k,{level:1,width:"4rem",$$events:{click:b},children:(q,z)=>{L();var J=F("SAVE");v(q,J)},$$slots:{default:!0}});var Q=g(k,2);{var V=q=>{var z=Te();v(q,z)};N(Q,q=>{a(h)&&q(V)})}var H=g(Q,2);{var B=q=>{var z=ke(),J=E(z,!0);y(z),W(()=>G(J,a(c))),v(q,z)};N(H,q=>{a(c)&&q(B)})}v(o,A)};N(l,o=>{a(_)||o(I)})}y(d),W(()=>G(D,s().id)),v(P,d),X()}var Ne=p('<div class="label svelte-1jljqe9">OpenID default scopes cannot be deleted</div>'),Oe=p('<div class="err svelte-1jljqe9"> </div>'),qe=p('<div class="label svelte-1jljqe9">Are you sure, you want to delete this scope?</div> <!> <!>',1),Le=p('<div class="container svelte-1jljqe9"><!></div>');function We(P,$){K($,!0);let j=M($,"scope",19,()=>({})),s=m(!1),c=m("");async function h(){t(c,""),t(s,!0);let C=await fe(j().id);if(C.ok)$.onSave();else{let b=await C.json();t(c,r(b.message))}t(s,!1)}var w=Le(),_=E(w);{var S=C=>{var b=Ne();v(C,b)},x=C=>{var b=qe(),i=g(Y(b),2);ae(i,{level:1,get isLoading(){return a(s)},set isLoading(u){t(s,r(u))},$$events:{click:h},children:(u,D)=>{L();var n=F("DELETE");v(u,n)},$$slots:{default:!0}});var d=g(i,2);{var T=u=>{var D=Oe(),n=E(D,!0);y(D),W(()=>G(n,a(c))),v(u,D)};N(d,u=>{a(c)&&u(T)})}v(C,b)};N(_,C=>{le(j().name)?C(S):C(x,!1)})}y(w),v(P,w),X()}var Ge=p('<div class="data font-mono svelte-115hohv"> </div>'),Me=p('<div class="data svelte-115hohv"> </div>'),ze=p('<div class="header svelte-115hohv"><!> <!></div>'),Ve=p("<div><!></div>"),Be=p("<div><!></div>"),Ke=p("<div><!> <!></div>");function Xe(P,$){K($,!0);let j=M($,"attrs",15),s=M($,"scope",31,()=>r({})),c=M($,"onSave",15),h=m(void 0);const w=["Config","Delete"];let _=m(r(w[0]));const S=200,x=S/2;function C(){t(h,!1),c()()}te(P,{get show(){return a(h)},set show(b){t(h,r(b))},header:b=>{var i=ze(),d=E(i);se(d,{text:"Scope ID",children:(u,D)=>{var n=Ge(),f=E(n,!0);y(n),W(()=>G(f,s().id)),v(u,n)},$$slots:{default:!0}});var T=g(d,2);se(T,{text:"Scope Name",children:(u,D)=>{var n=Me(),f=E(n,!0);y(n),W(()=>G(f,s().name)),v(u,n)},$$slots:{default:!0}}),y(i),v(b,i)},body:b=>{var i=Ke(),d=E(i);ye(d,{labels:w,get selected(){return a(_)},set selected(n){t(_,r(n))}});var T=g(d,2);{var u=n=>{var f=Ve(),O=E(f);Pe(O,{get attrs(){return j()},set attrs(e){j(e)},get scope(){return s()},set scope(e){s(e)},get onSave(){return c()},set onSave(e){c(e)}}),y(f),R(5,f,()=>U,()=>({delay:x,duration:S})),R(6,f,()=>U,()=>({duration:S})),v(n,f)},D=n=>{var f=me(),O=Y(f);{var e=l=>{var I=Be(),o=E(I);We(o,{get scope(){return s()},onSave:C}),y(I),R(5,I,()=>U,()=>({delay:x,duration:S})),R(6,I,()=>U,()=>({duration:S})),v(l,I)};N(O,l=>{a(_)==="Delete"&&l(e)},!0)}v(n,f)};N(T,n=>{a(_)==="Config"?n(u):n(D,!1)})}y(i),v(b,i)},$$slots:{header:!0,body:!0}}),X()}var Ye=p('<div class="svelte-15sc49d"><!></div>'),Fe=p(' <div class="content"><!> <!> <div id="scopes" class="svelte-15sc49d"></div> <!> <div style="height: 20px"></div></div>',1);function Qe(P,$){K($,!0);let j=m(r([])),s=m(""),c=m(r([])),h=m(r([])),w=m(r([])),_=m(""),S=[{label:"Name",callback:(e,l)=>e.name.toLowerCase().includes(l.toLowerCase())},{label:"ID",callback:(e,l)=>e.id.toLowerCase().includes(l.toLowerCase())}],x=[{label:"Name",callback:(e,l)=>e.name.localeCompare(l.name)},{label:"ID",callback:(e,l)=>e.id.localeCompare(l.id)}];Z(()=>{b(),C(),t(_,"")});async function C(){let e=await ge();if(!e.ok)t(s,"Error fetching attributes: "+e.body.message);else{let l=await e.json();t(j,r([...l.values]))}}async function b(){let e=await we(),l=await e.json();e.ok?t(c,r([...l])):t(s,r(l.message))}function i(){b()}L();var d=Fe(),T=Y(d),u=g(T),D=E(u);be(D,{get items(){return a(c)},searchOptions:S,orderOptions:x,get resItems(){return a(h)},set resItems(e){t(h,r(e))},get search(){return a(_)},set search(e){t(_,r(e))}});var n=g(D,2);De(n,{onSave:i});var f=g(n,2);ue(f,23,()=>a(w),e=>e.id,(e,l,I)=>{var o=Ye(),A=E(o);Xe(A,{onSave:i,get attrs(){return a(j)},set attrs(k){t(j,r(k))},get scope(){return a(w)[a(I)]},set scope(k){a(w)[a(I)]=k}}),y(o),v(e,o)}),y(f);var O=g(f,2);$e(O,{get items(){return a(h)},set items(e){t(h,r(e))},get resItems(){return a(w)},set resItems(e){t(w,r(e))}}),L(2),y(u),W(()=>G(T,`${a(s)??""} `)),v(P,d),X()}function Re(P){Qe(P,{})}export{Re as component};
