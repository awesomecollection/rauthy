import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DJEB66nf.js";import{p as Q,A as y,a6 as H,z as s,y as e,f as L,ar as G,t as A,s as I,a as V,ab as ee,c as P,r as R,ap as ve}from"../chunks/index-client.Di99sPv0.js";import{s as O}from"../chunks/render.Cjc4CIr8.js";import{i as x}from"../chunks/if.DgeUjMU2.js";import{e as pe}from"../chunks/each.DxtmCefA.js";import{d as K,a as l,t as S,e as oe}from"../chunks/template.BEKX6jgL.js";import{a as ue}from"../chunks/index.BnJsthXQ.js";import{p as n}from"../chunks/proxy.BQ2dmY0t.js";import{u as X}from"../chunks/i18n_admin.svelte.DI6l2V4l.js";import{O as fe}from"../chunks/OrderSearchBar.CS_Hs5DC.js";import{d as ge,c as he,b as $e,f as ne}from"../chunks/fetch.DxJS_Pk_.js";import{C as be}from"../chunks/ContentAdmin.BWiTVMIY.js";import{N as ye}from"../chunks/NavButtonTile.BjzIPqLk.js";import{B as Se}from"../chunks/ButtonAddModal.DLvLHw-v.js";import{N as we}from"../chunks/NavSub.D01RyWn2.js";import{u as Ce}from"../chunks/param.svelte.CXpV4U96.js";import{U as Y}from"../chunks/helpers.D3KrX4pz.js";import{B as se}from"../chunks/Button.D-14suAe.js";import{I as ie}from"../chunks/Input.-lhBsjDF.js";import{I as _e}from"../chunks/IconCheck.K_67dytm.js";import{u as ae}from"../chunks/i18n.svelte.Bc6aINkd.js";import{F as ce}from"../chunks/Form.C0Yvca1O.js";import{L as Ie}from"../chunks/LabeledValue.D0BXhgF2.js";import{S as me}from"../chunks/SelectList.BcngFbY0.js";import{f as le}from"../chunks/patterns.BDQXnG3O.js";import{T as Te}from"../chunks/Tabs.CTmGp6-A.js";var Me=S("<p> </p>"),Ne=S("<p> </p> <p> </p> <!> <!>",1),qe=S('<div class="err"> </div>'),De=S('<div class="flex gap-05"><!> <!></div> <!>',1),ze=S("<!> <!> <!> <!>",1);function Oe(U,r){Q(r,!0);let B=ae(),g=X(),p=y(""),f=y(!1),w=ee(()=>Y(r.scope.name)),v=y(n(r.scope.name)),u=y(void 0),T=y(void 0);H(()=>{r.scope.id&&s(v,n(r.scope.name))}),H(()=>{Y(r.scope.name)?(s(u,void 0),s(T,void 0)):(s(u,n(r.attrs.map(i=>{var t;return{name:i.name,selected:((t=r.scope.attr_include_access)==null?void 0:t.includes(i.name))||!1}}).toSorted((i,t)=>i.name.localeCompare(t.name)))),s(T,n(r.attrs.map(i=>{var t;return{name:i.name,selected:((t=r.scope.attr_include_id)==null?void 0:t.includes(i.name))||!1}}).toSorted((i,t)=>i.name.localeCompare(t.name)))))});async function d(i,t){if(s(p,""),Y(e(v))||r.scopes.find(C=>C.name===e(v))){s(p,n(g.common.nameExistsAlready));return}let h={scope:e(v)};if(e(u)){let C=e(u).filter(o=>o.selected).map(o=>o.name);C.length>0&&(h.attr_include_access=C)}if(e(T)){let C=e(T).filter(o=>o.selected).map(o=>o.name);C.length>0&&(h.attr_include_id=C)}let N=await ge(i.action,h);N.error?s(p,n(N.error.message)):(s(f,!0),r.onSave(),setTimeout(()=>{s(f,!1)},2e3))}var M=ee(()=>`/auth/v1/scopes/${r.scope.id}`);ce(U,{get action(){return e(M)},onSubmit:d,children:(i,t)=>{var h=ze(),N=L(h);Ie(N,{label:"ID",mono:!0,children:(a,c)=>{G();var m=K();A(()=>O(m,r.scope.id)),l(a,m)},$$slots:{default:!0}});var C=I(N,2);ie(C,{autocomplete:"off",get label(){return g.scopes.name},get placeholder(){return g.scopes.name},get disabled(){return e(w)},width:"14.5rem",required:!0,pattern:le,get value(){return e(v)},set value(a){s(v,n(a))}});var o=I(C,2);{var E=a=>{var c=Me(),m=P(c,!0);R(c),A(()=>O(m,g.scopes.defaultNoMod)),l(a,c)},z=a=>{var c=Ne(),m=L(c),_=P(m,!0);R(m);var b=I(m,2),F=P(b,!0);R(b);var D=I(b,2);{var j=q=>{me(q,{get items(){return e(u)},set items(J){s(u,n(J))},children:(J,re)=>{G();var W=K("Access Token Mappings");l(J,W)},$$slots:{default:!0}})};x(D,q=>{e(u)&&q(j)})}var $=I(D,2);{var k=q=>{me(q,{get items(){return e(T)},set items(J){s(T,n(J))},children:(J,re)=>{G();var W=K("Id Token Mappings");l(J,W)},$$slots:{default:!0}})};x($,q=>{e(T)&&q(k)})}A(()=>{O(_,g.scopes.mapping1),O(F,g.scopes.mapping2)}),l(a,c)};x(o,a=>{e(w)?a(E):a(z,!1)})}var Z=I(o,2);{var te=a=>{var c=De(),m=L(c),_=P(m);se(_,{type:"submit",children:($,k)=>{G();var q=K();A(()=>O(q,B.common.save)),l($,q)},$$slots:{default:!0}});var b=I(_,2);{var F=$=>{_e($,{})};x(b,$=>{e(f)&&$(F)})}R(m);var D=I(m,2);{var j=$=>{var k=qe(),q=P(k,!0);R(k),A(()=>O(q,e(p))),l($,k)};x(D,$=>{e(p)&&$(j)})}l(a,c)};x(Z,a=>{e(w)||a(te)})}l(i,h)},$$slots:{default:!0}}),V()}var xe=S("<p> </p>"),Ee=S('<div class="err"> </div>'),Fe=S("<p> </p> <!> <!>",1);function ke(U,r){Q(r,!0);let B=ae(),g=X(),p=y("");async function f(){s(p,"");let d=await he(`/auth/v1/scopes/${r.scope.id}`);d.error?s(p,n(d.error.message)):r.onSave()}var w=oe(),v=L(w);{var u=d=>{var M=xe(),i=P(M,!0);R(M),A(()=>O(i,g.scopes.deleteDefault)),l(d,M)},T=d=>{var M=Fe(),i=L(M),t=P(i,!0);R(i);var h=I(i,2);se(h,{level:-1,onclick:f,children:(o,E)=>{G();var z=K();A(()=>O(z,B.common.delete)),l(o,z)},$$slots:{default:!0}});var N=I(h,2);{var C=o=>{var E=Ee(),z=P(E,!0);R(E),A(()=>O(z,e(p))),l(o,E)};x(N,o=>{e(p)&&o(C)})}A(()=>O(t,g.scopes.delete1)),l(d,M)};x(v,d=>{Y(r.scope.name)?d(u):d(T,!1)})}l(U,w),V()}var Le=S('<div class="flex"><!></div> <!>',1);function Ae(U,r){Q(r,!0);let B=ae(),g=X();const p=[g.nav.config,B.common.delete];let f=y(n(p[0])),w=y(void 0);H(()=>{r.scope.id&&requestAnimationFrame(()=>{var t;(t=e(w))==null||t()})});var v=Le(),u=L(v),T=P(u);Te(T,{tabs:p,get selected(){return e(f)},set selected(t){s(f,n(t))},get focusFirst(){return e(w)},set focusFirst(t){s(w,n(t))}}),R(u);var d=I(u,2);{var M=t=>{Oe(t,{get attrs(){return r.attrs},get scope(){return r.scope},get scopes(){return r.scopes},get onSave(){return r.onSave}})},i=t=>{var h=oe(),N=L(h);{var C=o=>{ke(o,{get scope(){return r.scope},get onSave(){return r.onSave}})};x(N,o=>{e(f)===B.common.delete&&o(C)},!0)}l(t,h)};x(d,t=>{e(f)===g.nav.config?t(M):t(i,!1)})}l(U,v),V()}var Pe=S('<div class="err"> </div>'),Re=S("<!> <!> <!>",1),Ue=S('<div class="container svelte-s1196z"><!></div>');function Be(U,r){Q(r,!0);let B=ae(),g=X(),p=y(void 0),f=y(""),w=y("");H(()=>{requestAnimationFrame(()=>{var d;(d=e(p))==null||d.focus()})});async function v(d,M){var h;if(r.scopes.find(N=>N.name===e(w))){s(f,n(g.common.nameExistsAlready));return}s(f,"");let i={scope:e(w)},t=await $e(d.action,i);t.body?r.onSave(t.body.id):s(f,n(((h=t.error)==null?void 0:h.message)||"Error"))}var u=Ue(),T=P(u);ce(T,{action:"/auth/v1/scopes",onSubmit:v,children:(d,M)=>{var i=Re(),t=L(i);ie(t,{autocomplete:"off",get label(){return g.scopes.name},get placeholder(){return g.scopes.name},required:!0,pattern:le,get ref(){return e(p)},set ref(o){s(p,n(o))},get value(){return e(w)},set value(o){s(w,n(o))}});var h=I(t,2);se(h,{type:"submit",children:(o,E)=>{G();var z=K();A(()=>O(z,B.common.save)),l(o,z)},$$slots:{default:!0}});var N=I(h,2);{var C=o=>{var E=Pe(),z=P(E,!0);R(E),A(()=>O(z,e(f))),l(o,E)};x(N,o=>{e(f)&&o(C)})}l(d,i)},$$slots:{default:!0}}),R(u),l(U,u),V()}var Je=S('<span class="default svelte-1bjjcss"><i>default</i></span>'),je=S(" <!>",1),We=S("<div></div> <!>",1),Ge=S("<!> <!>",1),He=S('<div class="err"> </div>'),Ke=S('<!> <div id="scopes"><!></div>',1),Qe=S("<!> <!>",1);function Ve(U,r){Q(r,!0);let B=X(),g=y(void 0),p=y(""),f=Ce("sid"),w=y(n([])),v=y(n([])),u=y(n([])),T=y(void 0);const d=[B.common.name,"ID"];let M=y(n(d[0])),i=y("");const t=[B.common.name,"ID"];ve(()=>{N(),h()}),H(()=>{s(T,n(e(v).find(a=>a.id===f.get())))}),H(()=>{let a=e(i).toLowerCase();a?e(M)===d[0]?s(u,n(e(v).filter(c=>{var m;return(m=c.name)==null?void 0:m.toLowerCase().includes(a)}))):e(M)===d[1]&&s(u,n(e(v).filter(c=>c.id.toLowerCase().includes(a)))):s(u,n(e(v)))});async function h(){var c;let a=await ne("/auth/v1/users/attr");a.body?s(w,n(a.body.values)):s(p,n(((c=a.error)==null?void 0:c.message)||"Error"))}async function N(){var c;let a=await ne("/auth/v1/scopes");a.body?s(v,n(a.body)):s(p,n(((c=a.error)==null?void 0:c.message)||"Error"))}function C(a,c){let m=c==="up";a===t[0]?e(v).sort((_,b)=>m?_.name.localeCompare(b.name):b.name.localeCompare(_.name)):a===t[1]&&e(v).sort((_,b)=>m?_.id.localeCompare(b.id):b.id.localeCompare(_.id))}function o(){N()}async function E(a){var c;(c=e(g))==null||c(),await N(),f.set(a)}var z=Qe(),Z=L(z);we(Z,{paddingTop:"2.1rem",buttonTilesAriaControls:"scopes",width:"min(20rem, 100dvw)",thresholdNavSub:700,buttonTiles:a=>{var c=We(),m=L(c);ue(m,"height",".5rem");var _=I(m,2);pe(_,17,()=>e(u),b=>b.id,(b,F)=>{var D=ee(()=>f.get()===e(F).id);ye(b,{onclick:()=>f.set(e(F).id),get selected(){return e(D)},children:(j,$)=>{G();var k=je(),q=L(k),J=I(q);{var re=W=>{var de=Je();l(W,de)};x(J,W=>{Y(e(F).name)&&W(re)})}A(()=>O(q,`${e(F).name??""} `)),l(j,k)},$$slots:{default:!0}})}),l(a,c)},children:(a,c)=>{var m=Ge(),_=L(m),b=ee(()=>e(v).length===0?1:2);Se(_,{get level(){return e(b)},alignRight:!0,get closeModal(){return e(g)},set closeModal(D){s(g,n(D))},children:(D,j)=>{Be(D,{onSave:E,get scopes(){return e(v)}})},$$slots:{default:!0}});var F=I(_,2);fe(F,{searchOptions:d,orderOptions:t,onChangeOrder:C,searchWidth:"min(19.5rem, 100dvw - .5rem)",get searchOption(){return e(M)},set searchOption(D){s(M,n(D))},get value(){return e(i)},set value(D){s(i,n(D))}}),l(a,m)},$$slots:{buttonTiles:!0,default:!0}});var te=I(Z,2);be(te,{children:(a,c)=>{var m=Ke(),_=L(m);{var b=$=>{var k=He(),q=P(k,!0);R(k),A(()=>O(q,e(p))),l($,k)};x(_,$=>{e(p)&&$(b)})}var F=I(_,2),D=P(F);{var j=$=>{Ae($,{get attrs(){return e(w)},get scope(){return e(T)},get scopes(){return e(v)},onSave:o})};x(D,$=>{e(T)&&$(j)})}R(F),l(a,m)},$$slots:{default:!0}}),l(U,z),V()}function Xe(U){Ve(U,{})}export{Xe as component};
