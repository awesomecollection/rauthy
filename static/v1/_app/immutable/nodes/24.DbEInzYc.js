import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.CWXZuyhS.js";import{a6 as w,p as wa,ad as o,ae as O,af as ja,a4 as G,a as _a,$ as ya,g as e,j as a,a5 as c,a7 as g,a9 as d,ag as L,a8 as re,aa as ba,ah as Se}from"../chunks/index-client.Cqn5bTAA.js";import{s as z,e as De}from"../chunks/render.BxZ_8nPF.js";import{i as j}from"../chunks/if.CfO-_epY.js";import{T as ka,e as xa}from"../chunks/ThemeSwitch.Nnphyg3I.js";import{a as i,n as Ma,t as f,b as se,c as He}from"../chunks/template.A7ni-K4i.js";import{h as za}from"../chunks/svelte-head.DTZb8QfM.js";import{s as N,c as Ca,e as La}from"../chunks/helpers.CZ9R9OcM.js";import{i as Ta}from"../chunks/lifecycle.CjkUctR7.js";import{I as Ua,J as Ia,K as Pa,o as Ba,M as Na,T as qa,n as Je,N as Ra,O as Va,_ as Aa,P as Fa,Q as Ka,S as Wa,U as Ge,d as Xe,V as Ea}from"../chunks/dataFetching.BTF7Y2Cd.js";import{I as Oa,c as Sa,a as Da,y as Ha}from"../chunks/Input.DikYy5qt.js";import{B as ce}from"../chunks/Button.Ch35LVs2.js";import{W as Ja}from"../chunks/WebauthnRequest.CQBdNqvu.js";import{P as Ga}from"../chunks/PasswordInput.PI3FNiBa.js";import{L as Xa}from"../chunks/LangSelector.BJ1Lurmb.js";import{p as xe}from"../chunks/props.YICxVAwD.js";import{M as Ya,C as Za}from"../chunks/ContentCenter.DAqX6TIP.js";import{u as Qa}from"../chunks/i18n.svelte.CZcZQkVy.js";import{T as X}from"../chunks/Template.DXDiqOj9.js";import{u as q}from"../chunks/param.svelte.BjpJyl57.js";var et=Ma('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>');function at(ne,Y){let n=xe(Y,"color",3,"var(--col-text)"),y=xe(Y,"opacity",3,.9),S=xe(Y,"width",3,24);var h=et();N(h,"stroke-width",2),w(()=>{N(h,"width",S()),N(h,"color",n()),N(h,"opacity",y())}),i(ne,h)}var tt=f('<img alt="No Logo Available">'),rt=f('<a class="home svelte-1ljcjf3"><!></a>'),st=f('<div role="button" tabindex="0" class="forgotten svelte-1ljcjf3"> </div>'),lt=f("<!> <!>",1),it=f('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),ot=f('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),ct=f("<!> <!> <!>",1),nt=f('<div class="flex-inline svelte-1ljcjf3"><img alt="" width="20" height="20"> <span class="providerName svelte-1ljcjf3"> </span></div>'),vt=f('<div class="providers flex-col svelte-1ljcjf3"></div>'),dt=f('<div class="errMsg errMsgApi svelte-1ljcjf3"> </div>'),ut=f('<div class="success svelte-1ljcjf3"> </div>'),mt=f('<a class="reg svelte-1ljcjf3" target="_blank"> </a>'),gt=f('<a class="reg svelte-1ljcjf3" href="/auth/v1/users/register" target="_blank"> </a>'),ft=f('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),ht=f('<div class="container svelte-1ljcjf3"><div class="head svelte-1ljcjf3"><div class="logo svelte-1ljcjf3"><!></div> <!></div> <div class="name svelte-1ljcjf3"><h2> </h2></div> <!> <!> <!> <!> <!> <!> <!></div> <!> <!>',1),pt=f("<!> <!> <!> <!> <!> <!> <!>",1);function $t(ne,Y){var qe;wa(Y,!1);let n=Qa(),y=q("client_id").get(),S=o(""),h=o(""),D=q("redirect_uri").get(),ve=q("nonce").get(),de=((qe=q("scopes").get())==null?void 0:qe.split(" "))||[],Z=o(),ue=q("state").get(),me=q("code_challenge").get(),ge=q("code_challenge_method").get(),fe=o(!1),H=o(),le=o([]),Q=o(),R=o(!1),b=o(""),V=o(""),ee=o(""),A=o(!1),F=o(!1),ie=o(!1),oe=o(!1),ae=o(!1),K=o(!1),Me="",he=o(!1),l=o({email:q("login_hint").get()||"",password:""}),k=o({}),pe=o({});function ze(){a(b,""),a(ie,!0),L(l,e(l).password="")}async function $e(){a(b,"");try{await e(pe).validate(e(l),{abortEarly:!1}),a(k,{})}catch(_){a(k,Je(_));return}const t={email:e(l).email,client_id:y,redirect_uri:D,state:ue,code_challenge:me,code_challenge_method:ge,nonce:ve,scopes:de};if(e(A)&&e(l).email!==e(H)){if(!e(l).password){L(k,e(k).password=n.passwordRequired);return}if(e(l).password.length>256){L(k,e(k).password="max 256");return}t.password=e(l).password}a(R,!0);let p=await Ra(t);await Ce(p)}async function Ce(t){if(t.status===202)window.location.replace(t.headers.get("location"));else if(t.status===200)a(b,""),a(Q,await t.json());else if(t.status===406)a(b,n.authorize.clientForceMfa),a(F,!0);else if(t.status===429){let p=Number.parseInt(t.headers.get("x-retry-not-before")),_=Va(p),T=p*1e3-new Date().getTime();a(K,!0),a(b,`${n.authorize.http429} ${_}`),L(l,e(l).email=""),L(l,e(l).password=""),a(A,!1),setTimeout(()=>{a(K,!1),a(b,"")},T)}else e(A)?(a(b,n.authorize.invalidCredentials),a(oe,!0)):(a(A,!0),Me=e(l).email);a(R,!1)}function Ye(){e(A)&&Me!==e(l).email&&(a(A,!1),L(l,e(l).password=""),a(b,""))}function Ze(t){Aa(64,(p,{challenge:_,verifier:T})=>{p||(localStorage.setItem(Fa,T),Qe(t,_))})}async function Qe(t,p){let _={email:e(l).email||null,client_id:y,redirect_uri:D,scopes:de,state:ue,nonce:ve,code_challenge:me,code_challenge_method:ge,provider_id:t,pkce_challenge:p},T=await Ka(_);if(T.ok){const J=await T.text();Wa(J),window.location.href=T.headers.get("location")}else{let J=await T.json();a(b,J.message)}}function ea(){a(Q,void 0)}function aa(t){t&&window.location.replace(t.loc)}async function ta(){try{await e(pe).validate(e(l),{abortEarly:!1}),a(k,{})}catch(_){a(k,Je(_));return}let t={email:e(l).email};e(h)&&(t.redirect_uri=encodeURI(e(h))),a(R,!0);let p=await Ea(t);if(p.ok)a(ae,!0);else{let _=await p.json();a(b,_.message)}a(R,!1)}O(()=>Ha,()=>{n&&a(pe,Sa().shape({email:Da().required(n.authorize.emailRequired).email(n.authorize.emailBadFormat)}))}),O(()=>e(V),()=>{var t;e(V)&&(e(V)==="Refresh"?a(fe,!0):(t=e(V))!=null&&t.startsWith("MfaLogin ")&&a(H,e(V).replace("MfaLogin ","")))}),O(()=>(e(fe),Ge),()=>{if(e(fe)&&(y==null?void 0:y.length)>0&&(D==null?void 0:D.length)>0){a(R,!0);const t={client_id:y,redirect_uri:D,state:ue,code_challenge:me,code_challenge_method:ge,nonce:ve,scopes:de};ba().then(()=>Ge(t).then(p=>Ce(p)))}}),O(()=>e(H),()=>{e(H)&&L(l,e(l).email=e(H))}),O(()=>e(ae),()=>{e(ae)&&setTimeout(()=>{a(ae,!1),a(ie,!1),a(oe,!1)},3e3)}),O(()=>e(Z),()=>{e(Z)&&e(Z).focus()}),O(()=>(e(ee),Xe),()=>{e(ee)&&Xe(e(ee))}),ja(),Ta();var Le=pt();za(t=>{w(()=>ya.title=`Login ${(e(S)||y)??""}`)});var Te=G(Le);X(Te,{id:Ua,get value(){return e(le)},set value(t){a(le,t)},$$legacy:!0});var Ue=c(Te,2);X(Ue,{id:Ia,get value(){return e(S)},set value(t){a(S,t)},$$legacy:!0});var Ie=c(Ue,2);X(Ie,{id:Pa,get value(){return e(h)},set value(t){a(h,t)},$$legacy:!0});var Pe=c(Ie,2);X(Pe,{id:Ba,get value(){return e(ee)},set value(t){a(ee,t)},$$legacy:!0});var Be=c(Pe,2);X(Be,{id:Na,get value(){return e(V)},set value(t){a(V,t)},$$legacy:!0});var Ne=c(Be,2);X(Ne,{id:qa,get value(){return e(he)},set value(t){a(he,t)},$$legacy:!0});var ra=c(Ne,2);Ya(ra,{children:(t,p)=>{Za(t,{children:(_,T)=>{var J=ht(),we=G(J),je=g(we),_e=g(je),sa=g(_e);{var la=r=>{var s=tt();N(s,"src",`/auth/v1/clients/${y}/logo`),i(r,s)};j(sa,r=>{y&&r(la)})}d(_e);var ia=c(_e,2);{var oa=r=>{var s=rt(),u=g(s);at(u,{opacity:.5}),d(s),w(()=>N(s,"href",e(h))),i(r,s)};j(ia,r=>{e(h)&&r(oa)})}d(je);var ye=c(je,2),Re=g(ye),ca=g(Re,!0);d(Re),d(ye);var Ve=c(ye,2);{var na=r=>{Ja(r,{t:n,onSuccess:aa,onError:ea,get data(){return e(Q)},set data(s){a(Q,s)},$$legacy:!0})};j(Ve,r=>{e(Q)&&r(na)})}var Ae=c(Ve,2);{var va=r=>{var s=ct(),u=G(s),U=Se(()=>e(K)||e(F));Oa(u,{type:"email",name:"rauthyEmail",autocomplete:"email",get placeholder(){return n.common.email},get disabled(){return e(U)},get value(){return e(l).email},set value(m){L(l,e(l).email=m)},get error(){return e(k).email},set error(m){L(k,e(k).email=m)},$$events:{enter:$e,input:Ye},children:(m,P)=>{re();var E=se();w(()=>z(E,n.common.email.toUpperCase())),i(m,E)},$$slots:{default:!0},$$legacy:!0});var W=c(u,2);{var x=m=>{var P=lt(),E=G(P),be=Se(()=>e(K)||e(F));Ga(E,{name:"rauthyPassword",get error(){return e(k).password},autocomplete:"current-password",get placeholder(){return n.common.password},get disabled(){return e(be)},get bindThis(){return e(Z)},set bindThis(v){a(Z,v)},get value(){return e(l).password},set value(v){L(l,e(l).password=v)},$$events:{enter:$e},children:(v,M)=>{re();var C=se();w(()=>z(C,n.common.password.toUpperCase())),i(v,C)},$$slots:{default:!0},$$legacy:!0});var ke=c(E,2);{var B=v=>{var M=st(),C=g(M,!0);d(M),w(()=>z(C,n.authorize.passwordForgotten)),Ca(7,M,()=>La),De("click",M,ze),De("keypress",M,ze),i(v,M)};j(ke,v=>{e(oe)&&!e(K)&&v(B)})}i(m,P)};j(W,m=>{e(A)&&e(H)!==e(l).email&&!e(ie)&&m(x)})}var $=c(W,2);{var I=m=>{var P=He(),E=G(P);{var be=B=>{var v=it(),M=g(v);ce(M,{$$events:{click:ta},children:(C,$a)=>{re();var te=se();w(()=>z(te,n.authorize.passwordRequest)),i(C,te)},$$slots:{default:!0}}),d(v),i(B,v)},ke=B=>{var v=ot(),M=g(v);ce(M,{get isLoading(){return e(R)},set isLoading(C){a(R,C)},$$events:{click:$e},children:(C,$a)=>{re();var te=se();w(()=>z(te,n.authorize.login)),i(C,te)},$$slots:{default:!0},$$legacy:!0}),d(v),i(B,v)};j(E,B=>{e(ie)?B(be):B(ke,!1)})}i(m,P)};j($,m=>{!e(K)&&!e(F)&&m(I)})}i(r,s)};j(Ae,r=>{e(F)||r(va)})}var Fe=c(Ae,2);{var da=r=>{var s=vt();xa(s,5,()=>e(le),u=>u.id,(u,U)=>{ce(u,{level:3,$$events:{click:()=>Ze(e(U).id)},children:(W,x)=>{var $=nt(),I=g($),m=c(I,2),P=g(m,!0);d(m),d($),w(()=>{N(I,"src",`/auth/v1/providers/${e(U).id}/img`),z(P,e(U).name)}),i(W,$)},$$slots:{default:!0}})}),d(s),i(r,s)};j(Fe,r=>{e(le)&&r(da)})}var Ke=c(Fe,2);{var ua=r=>{var s=dt(),u=g(s,!0);d(s),w(()=>z(u,e(b))),i(r,s)};j(Ke,r=>{e(b)&&r(ua)})}var We=c(Ke,2);{var ma=r=>{var s=ut(),u=g(s,!0);d(s),w(()=>z(u,n.authorize.emailSentMsg)),i(r,s)};j(We,r=>{e(ae)&&r(ma)})}var Ee=c(We,2);{var ga=r=>{var s=He(),u=G(s);{var U=x=>{var $=mt(),I=g($,!0);d($),w(()=>{N($,"href",`/auth/v1/users/register?redirect_uri=${e(h)??""}`),z(I,n.authorize.signUp)}),i(x,$)},W=x=>{var $=gt(),I=g($,!0);d($),w(()=>z(I,n.authorize.signUp)),i(x,$)};j(u,x=>{e(h)?x(U):x(W,!1)})}i(r,s)};j(Ee,r=>{e(he)&&!e(F)&&!e(oe)&&!e(K)&&r(ga)})}var fa=c(Ee,2);{var ha=r=>{var s=ft(),u=g(s);ce(u,{$$events:{click:()=>window.location.href="/auth/v1/account"},children:(U,W)=>{re();var x=se("ACCOUNT");i(U,x)},$$slots:{default:!0}}),d(s),i(r,s)};j(fa,r=>{e(F)&&r(ha)})}d(we);var Oe=c(we,2);ka(Oe,{absolute:!0});var pa=c(Oe,2);Xa(pa,{absolute:!0}),w(()=>z(ca,e(S)||y)),i(_,J)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(ne,Le),_a()}export{$t as component};
