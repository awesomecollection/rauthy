import"../chunks/disclose-version.BDr9Qe-U.js";import{f as j,p as Ee,c as r,r as a,s as v,g as e,t as y,a as qe,a9 as ke,aq as fe,i as E,h as n,ao as sa,a4 as Qe,ap as Ja}from"../chunks/index-client.CzvcfCLI.js";import{h as Xa}from"../chunks/svelte-head.DAqZ84H4.js";import{e as ge,a as i,t as I,d as we,n as ja}from"../chunks/template.CQASMEo4.js";import{i as k}from"../chunks/if.Dlf0zx3_.js";import{p as h}from"../chunks/proxy.CHyqegA9.js";import{s as l,d as Oa}from"../chunks/render.BJBkrb2f.js";import{b as Ya}from"../chunks/window.DLgRxVys.js";import{p as $e}from"../chunks/props.BRvF51YW.js";import{k as Ge,a0 as da,_ as Qa,P as Za,H as er,z as ar,a1 as rr,D as tr,r as sr}from"../chunks/helpers.kNqlWGzE.js";import{e as ka}from"../chunks/each.BtetwUOf.js";import{h as $a}from"../chunks/html.DAmxUMld.js";import{a as H,c as G,s as Ve,t as xa,r as vr}from"../chunks/class.DOSp4p8N.js";import{I as va}from"../chunks/IconCheck.kaTN2egQ.js";import{I as nr}from"../chunks/IconStop.CJzJMbxy.js";import{B as xe}from"../chunks/Button.CjBmYviZ.js";import{M as or,I as ir,T as _a}from"../chunks/Tabs.DVYpupb9.js";import{u as Ae}from"../chunks/i18n.svelte.BgTCv98Z.js";import{d as lr,b as Ia,c as Ca,f as Ze}from"../chunks/fetch.DVUNovhB.js";import{B as cr}from"../chunks/ButtonAuthProvider.BYQ8ulQR.js";import{t as Ue,f as Re,s as ua,a as dr}from"../chunks/index.CqGLefLa.js";import{I as Te}from"../chunks/Input.DG9-U8Na.js";import{F as ur}from"../chunks/Form.HTTUzO_J.js";import{a as pa,c as pr,d as Pa,e as mr}from"../chunks/patterns.BSnCcuba.js";import{I as fr}from"../chunks/InputDateTimeCombo.BCoAlO7z.js";import{w as gr,d as hr,e as wr}from"../chunks/dataFetching.CtZWuJFH.js";import{u as Ma}from"../chunks/session.svelte.CNTyBeAJ.js";import{w as yr}from"../chunks/registration.BBIffmz_.js";import{W as za}from"../chunks/WebauthnRequest.D1bUV3L-.js";import{T as br}from"../chunks/Tooltip.OH9H3eZp.js";import{P as kr}from"../chunks/PasswordPolicy.is5FGLX9.js";import{I as ma}from"../chunks/InputPassword.CLwZr0KC.js";import{C as $r}from"../chunks/CheckIcon.DLVsj7KZ.js";import{s as xr}from"../chunks/snippet.Cu-MpcXt.js";import{a as _r}from"../chunks/input.mmO6A0Hj.js";import{A as Ir}from"../chunks/A.C6x2nc-u.js";import"../chunks/legacy.DUFkTaXF.js";import{D as Na}from"../chunks/Devices.DBXSUquq.js";import{T as Cr}from"../chunks/Template.Cnk31pVm.js";import{u as Pr}from"../chunks/param.svelte.MG9klZHr.js";import{M as Mr}from"../chunks/Main.icgLvyRI.js";import{C as zr}from"../chunks/ContentCenter.BEC6assz.js";import{T as Nr,L as Er}from"../chunks/LangSelector.CG8Bx67-.js";function fa(ee,p){var s=ge(),t=j(s);{var q=C=>{va(C,{color:"hsl(var(--action))"})},o=C=>{nr(C,{color:"hsl(var(--error))"})};k(t,C=>{p.checked?C(q):C(o,!1)})}i(ee,s)}var qr=I('<div class="link-err value svelte-1tea8v4"> </div>'),Tr=I('<div class="fed-btn svelte-1tea8v4"><!> <!></div>'),Lr=I('<h3> </h3> <p> </p> <div class="providers svelte-1tea8v4"></div>',1),Dr=I("<!> <!>",1),Wr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Vr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Ar=I('<div><div>WebID:</div> <span class="value svelte-1tea8v4"><a target="_blank"><!></a></span></div>'),Br=I('<div><div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <div><div class="value svelte-1tea8v4"> </div> <!></div></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <!> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <!> <!></div>');function Ea(ee,p){Ee(p,!0);let s=$e(p,"user",15),t=Ae(),q=E(!1),o=E(!1),C=ke(()=>{var B;return(B=s().account_type)==null?void 0:B.startsWith("federated")}),$=ke(()=>{var B;return e(C)?`${s().account_type}: ${((B=p.authProvider)==null?void 0:B.name)||""}`:s().account_type}),d=ke(()=>p.viewModePhone?"rowPhone":"row"),w=ke(()=>p.viewModePhone?"labelPhone":"label");function u(B){Qa(64,(re,{challenge:ce,verifier:he})=>{re||(localStorage.setItem(Za,he),O(B,ce))})}async function O(B,re){let ce={email:s().email,client_id:"rauthy",redirect_uri:window.location.href,provider_id:B,pkce_challenge:re},he=await Ia(`/auth/v1/providers/${B}/link`,ce);if(he.text){er(he.text);let me=he.headers.get("location");me&&(window.location.href=me)}else console.error(he.error)}async function K(){let B=await lr("/auth/v1/providers/link");B.body?s(B.body):(console.error(B.error),n(q,!0))}var T=Br(),R=r(T),ae=r(R),ie=r(ae,!0);a(ae);var M=v(ae,2),z=r(M,!0);a(M),a(R);var U=v(R,2),Y=r(U),le=r(Y,!0);a(Y);var ve=v(Y,2),ne=r(ve,!0);a(ve),a(U);var Z=v(U,2),g=r(Z),m=r(g,!0);a(g);var P=v(g,2),c=r(P,!0);a(P),a(Z);var S=v(Z,2),te=r(S),ue=r(te);a(te);var f=v(te,2),D=r(f,!0);a(f),a(S);var W=v(S,2),L=r(W),A=r(L,!0);a(L);var Q=v(L,2),F=r(Q),de=r(F,!0);a(F);var se=v(F,2);{var ye=B=>{var re=Tr(),ce=r(re);xe(ce,{get ariaLabel(){return t.account.providerUnlink},level:3,onclick:K,children:(Ce,Be)=>{fe();var He=we();y(()=>l(He,t.account.providerUnlink)),i(Ce,He)},$$slots:{default:!0}});var he=v(ce,2);{var me=Ce=>{var Be=qr(),He=r(Be,!0);a(Be),y(()=>l(He,t.account.providerUnlinkDesc)),i(Ce,Be)};k(he,Ce=>{e(q)&&Ce(me)})}a(re),i(B,re)},V=B=>{var re=ge(),ce=j(re);{var he=me=>{var Ce=Dr(),Be=j(Ce);xe(Be,{level:2,onclick:()=>n(o,!0),children:(Oe,Ka)=>{fe();var Ye=we();y(()=>l(Ye,t.account.providerLink)),i(Oe,Ye)},$$slots:{default:!0}});var He=v(Be,2);or(He,{get showModal(){return e(o)},set showModal(Oe){n(o,h(Oe))},children:(Oe,Ka)=>{var Ye=Lr(),ia=j(Ye),Ha=r(ia,!0);a(ia);var la=v(ia,2),Ga=r(la,!0);a(la);var ya=v(la,2);ka(ya,21,()=>p.providers,ca=>ca.id,(ca,ba)=>{var Ra=ke(()=>`${t.account.providerLink}: ${e(ba).name}`);cr(ca,{get ariaLabel(){return e(Ra)},get provider(){return e(ba)},onclick:u})}),a(ya),y(()=>{l(Ha,t.account.providerLink),l(Ga,t.account.providerLinkDesc)}),i(Oe,Ye)},$$slots:{default:!0}}),i(me,Ce)};k(ce,me=>{p.providers.length>0&&me(he)},!0)}i(B,re)};k(se,B=>{e(C)?B(ye):B(V,!1)})}a(Q),a(W);var x=v(W,2),b=r(x),N=r(b,!0);a(b);var J=v(b,2),pe=r(J,!0);a(J),a(x);var _=v(x,2),X=r(_),oe=r(X,!0);a(X);var _e=v(X,2),Ie=r(_e,!0);a(_e),a(_);var be=v(_,2),Pe=r(be),Je=r(Pe,!0);a(Pe);var Se=v(Pe,2),ea=ke(()=>!!s().webauthn_user_id);fa(Se,{get checked(){return e(ea)}}),a(be);var Me=v(be,2),Le=r(Me),na=r(Le,!0);a(Le);var aa=v(Le,2);fa(aa,{get checked(){return s().enabled}}),a(Me);var Fe=v(Me,2),Ke=r(Fe),oa=r(Ke,!0);a(Ke);var Ne=v(Ke,2);fa(Ne,{get checked(){return s().email_verified}}),a(Fe);var De=v(Fe,2);{var Xe=B=>{var re=Wr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,Ge(s().last_login))),a(me),a(re),y(()=>{H(re,G(e(d)),"svelte-1tea8v4"),H(ce,G(e(w)),"svelte-1tea8v4"),l(he,t.account.lastLogin)}),i(B,re)};k(De,B=>{s().last_login&&B(Xe)})}var ze=v(De,2),We=r(ze),ga=r(We,!0);a(We);var je=v(We,2),Va=r(je,!0);y(()=>l(Va,s().password_expires&&Ge(s().password_expires)||t.common.never)),a(je),a(ze);var ra=v(ze,2),ta=r(ra),Aa=r(ta,!0);a(ta);var ha=v(ta,2),Ba=r(ha,!0);y(()=>l(Ba,Ge(s().created_at))),a(ha),a(ra);var wa=v(ra,2);{var Ua=B=>{var re=Vr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,Ge(s().user_expires))),a(me),a(re),y(()=>{H(re,G(e(d)),"svelte-1tea8v4"),H(ce,G(e(w)),"svelte-1tea8v4"),l(he,t.account.userExpiry)}),i(B,re)};k(wa,B=>{s().user_expires&&B(Ua)})}var Sa=v(wa,2);{var Fa=B=>{var re=Ar(),ce=r(re),he=v(ce,2),me=r(he);y(()=>Ve(me,"href",da(s().id)));var Ce=r(me);$a(Ce,()=>da(s().id).replace("/auth/","/auth/<wbr/>")),a(me),a(he),a(re),y(()=>{H(re,G(e(d)),"svelte-1tea8v4"),H(ce,G(e(w)),"svelte-1tea8v4")}),i(B,re)};k(Sa,B=>{p.webIdData&&B(Fa)})}a(T),y(()=>{H(R,G(e(d)),"svelte-1tea8v4"),H(ae,G(e(w)),"svelte-1tea8v4"),l(ie,t.common.email),l(z,s().email),H(U,G(e(d)),"svelte-1tea8v4"),H(Y,G(e(w)),"svelte-1tea8v4"),l(le,t.account.givenName),l(ne,s().given_name),H(Z,G(e(d)),"svelte-1tea8v4"),H(g,G(e(w)),"svelte-1tea8v4"),l(m,t.account.familyName),l(c,s().family_name),H(S,G(e(d)),"svelte-1tea8v4"),H(te,G(e(w)),"svelte-1tea8v4"),l(ue,`${t.account.user??""} ID`),l(D,s().id),H(W,G(e(d)),"svelte-1tea8v4"),H(L,G(e(w)),"svelte-1tea8v4"),l(A,t.account.accType),l(de,e($)||""),H(x,G(e(d)),"svelte-1tea8v4"),H(b,G(e(w)),"svelte-1tea8v4"),l(N,t.account.roles),l(pe,s().roles||"None"),H(_,G(e(d)),"svelte-1tea8v4"),H(X,G(e(w)),"svelte-1tea8v4"),l(oe,t.account.groups),l(Ie,s().groups||"None"),H(be,G(e(d)),"svelte-1tea8v4"),H(Pe,G(e(w)),"svelte-1tea8v4"),l(Je,t.account.mfaActivated),H(Me,G(e(d)),"svelte-1tea8v4"),H(Le,G(e(w)),"svelte-1tea8v4"),l(na,t.account.userEnabled),H(Fe,G(e(d)),"svelte-1tea8v4"),H(Ke,G(e(w)),"svelte-1tea8v4"),l(oa,t.account.emailVerified),H(ze,G(e(d)),"svelte-1tea8v4"),H(We,G(e(w)),"svelte-1tea8v4"),l(ga,t.account.passwordExpiry),H(ra,G(e(d)),"svelte-1tea8v4"),H(ta,G(e(w)),"svelte-1tea8v4"),l(Aa,t.account.userCreated)}),i(ee,T),qe()}var Ur=I('<div class="success svelte-4ogr3z"><!></div>'),Sr=I("<p> </p>"),Fr=I('<div class="err svelte-4ogr3z"> </div>'),Kr=I('<div class="formInner svelte-4ogr3z"><div><!> <!> <!> <!></div> <div><!> <!> <!> <!> <!></div></div> <div class="bottom svelte-4ogr3z"><div><!></div> <!></div> <!>',1),Hr=I('<div class="container svelte-4ogr3z"><!></div>');function qa(ee,p){var O;Ee(p,!0);let s=$e(p,"user",15);(O=s().user_values)!=null&&O.birthdate||s(s().user_values.birthdate="",!0);let t=Ae(),q=E(""),o=E(!1),C=E(!1);async function $(K,T){var m;const R=T.get("email"),ae=T.get("family_name")||void 0,ie=T.get("given_name")||void 0,M=T.get("birthdate")||void 0,z=((m=T.get("phone"))==null?void 0:m.replaceAll(" ",""))||void 0,U=T.get("street")||void 0,Y=T.get("zip")||void 0,le=Y?Number.parseInt(Y):void 0,ve=T.get("city")||void 0,ne=T.get("country")||void 0;let Z={email:R,family_name:ae,given_name:ie,user_values:{birthdate:M,phone:z,street:U,zip:le,city:ve,country:ne}},g=await Ca(`/auth/v1/users/${s().id}/self`,Z);if(g.body){n(o,!0),s(g.body);let P=3e3;g.status===202&&(n(C,!0),P=3e4),setTimeout(()=>{n(o,!1)},P)}else g.error&&(console.error(g.error),n(q,h(g.error.message)))}var d=Hr(),w=r(d),u=ke(()=>`/auth/v1/users/${s().id}/self`);ur(w,{get action(){return e(u)},onSubmit:$,children:(K,T)=>{var R=Kr(),ae=j(R),ie=r(ae),M=r(ie);Te(M,{typ:"email",name:"email",get label(){return t.common.email},get placeholder(){return t.common.email},get value(){return s().email},required:!0});var z=v(M,2);Te(z,{name:"given_name",autocomplete:"given-name",get label(){return t.account.givenName},get placeholder(){return t.account.givenName},get value(){return s().given_name},required:!0,maxLength:32,pattern:pa});var U=v(z,2);Te(U,{name:"family_name",autocomplete:"family-name",get label(){return t.account.familyName},get placeholder(){return t.account.familyName},get value(){return s().family_name},maxLength:32,pattern:pa});var Y=v(U,2);fr(Y,{name:"birthdate",get label(){return t.account.birthdate},withDelete:!0,get value(){return s().user_values.birthdate},set value(L){s(s().user_values.birthdate=L,!0)}}),a(ie);var le=v(ie,2),ve=r(le);Te(ve,{name:"street",autocomplete:"street-address",get label(){return t.account.street},get placeholder(){return t.account.street},get value(){return s().user_values.street},maxLength:48,pattern:pr});var ne=v(ve,2);Te(ne,{typ:"number",name:"zip",autocomplete:"postal-code",get label(){return t.account.zip},get placeholder(){return t.account.zip},get value(){return s().user_values.zip},min:"1000",max:"9999999"});var Z=v(ne,2);Te(Z,{name:"city",autocomplete:"address-level2",get label(){return t.account.city},get placeholder(){return t.account.city},get value(){return s().user_values.city},maxLength:48,pattern:Pa});var g=v(Z,2);Te(g,{name:"country",autocomplete:"country",get label(){return t.account.country},get placeholder(){return t.account.country},get value(){return s().user_values.country},maxLength:48,pattern:Pa});var m=v(g,2);Te(m,{name:"phone",autocomplete:"tel",get label(){return t.account.phone},get placeholder(){return t.account.phone},get value(){return s().user_values.phone},maxLength:32,pattern:mr}),a(le),a(ae);var P=v(ae,2),c=r(P),S=r(c);xe(S,{type:"submit",children:(L,A)=>{fe();var Q=we();y(()=>l(Q,t.common.save)),i(L,Q)},$$slots:{default:!0}}),a(c);var te=v(c,2);{var ue=L=>{var A=Ur(),Q=r(A);va(Q,{}),a(A),Ue(3,A,()=>Re),i(L,A)};k(te,L=>{e(o)&&L(ue)})}a(P);var f=v(P,2);{var D=L=>{var A=Sr(),Q=r(A,!0);a(A),y(()=>l(Q,t.account.emailUpdateConfirm)),i(L,A)},W=L=>{var A=ge(),Q=j(A);{var F=de=>{var se=Fr(),ye=r(se,!0);a(se),y(()=>l(ye,e(q))),Ue(3,se,()=>Re),i(de,se)};k(Q,de=>{e(q)&&de(F)},!0)}i(L,A)};k(f,L=>{e(C)?L(D):L(W,!1)})}i(K,R)},$$slots:{default:!0}}),a(d),i(ee,d),qe()}var Gr=ja('<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7.864 4.243A7.5 7.5 0 0119.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 004.5 10.5a7.464 7.464 0 01-1.15 3.993m1.989 3.559A11.209 11.209 0 008.25 10.5a3.75 3.75 0 117.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 01-3.6 9.75m6.633-4.596a18.666 18.666 0 01-2.485 5.33"></path></svg>');function Rr(ee,p){let s=$e(p,"opacity",3,.9),t=$e(p,"width",3,24),q=$e(p,"color",3,"currentColor");var o=Gr();Ve(o,"stroke-width",2),y(()=>{Ve(o,"stroke",q()),Ve(o,"width",t()),Ve(o,"opacity",s())}),i(ee,o)}var Jr=I('<div class="err svelte-qkgdvy"><b>Your browser does not support Webauthn credentials and must be updated.</b></div>'),Xr=I('<!> <div class="regBtns svelte-qkgdvy"><!> <!></div>',1),jr=I('<div class="regNewBtn svelte-qkgdvy"><!></div>'),Or=I('<div class="keysHeader svelte-qkgdvy"> </div>'),Yr=I("<div><!></div>"),Qr=I('<div class="row svelte-qkgdvy"><div></div> <div class="deleteBtn svelte-qkgdvy"><!></div></div>'),Zr=I('<div class="keyContainer svelte-qkgdvy"><div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <div class="nameUv svelte-qkgdvy"><b> </b> <!></div></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <!></div>'),et=I('<div class="button svelte-qkgdvy"><!></div>'),at=I('<!> <p class="svelte-qkgdvy"> <br><br> </p> <!> <!> <div class="keysContainer svelte-qkgdvy"></div> <!> <div class="svelte-qkgdvy"> </div>',1),rt=I('<div class="container svelte-qkgdvy"><!></div>');function Ta(ee,p){Ee(p,!0);const s="credentials"in navigator;let t=Ae(),q=Ma("account"),o=ke(()=>{var g;return(g=q.get())==null?void 0:g.user_id}),C=E(void 0),$=E(!1),d=E(""),w=E(!1),u=E(p.user.account_type==="password"),O=E(void 0),K=E(""),T=E(!1),R=E(h([]));sa(()=>{ie()}),Qe(()=>{e(R).length>0&&p.user.account_type==="passkey"&&n(u,e(R).length>1)}),Qe(()=>{var g;(g=e(C))==null||g.focus()});function ae(){n($,!1),n(d,"")}async function ie(){var m;let g=await Ze(`/auth/v1/users/${(m=q.get())==null?void 0:m.user_id}/webauthn`);g.body?n(R,h(g.body)):console.error(g.error)}async function M(){if(ae(),e(T)||!e(o))return;if(e(K).length<1){n($,!0),n(d,h(t.mfa.passkeyNameErr));return}let g=await yr(e(o),e(K),t.authorize.invalidKeyUsed,t.authorize.requestExpired);g.error?(n($,!0),n(d,`${t.mfa.errorReg} - ${g.error}`)):(n(w,!1),n(K,""),await ie())}async function z(g){let m=await gr(p.user.id,g);if(m.status===200)await ie();else{let P=await m.json();n($,!0),n(d,h(P.message))}}function U(g){n(O,void 0),n($,!0),n(d,h(g)),setTimeout(()=>{n($,!1),n(d,"")},5e3)}function Y(g){n(O,void 0),n(d,h(t.mfa.testSuccess)),setTimeout(()=>{n(d,"")},3e3)}var le=rt(),ve=r(le);{var ne=g=>{var m=Jr();i(g,m)},Z=g=>{var m=at(),P=j(m);{var c=V=>{za(V,{get userId(){return p.user.id},get purpose(){return e(O)},onSuccess:Y,onError:U})};k(P,V=>{e(O)&&V(c)})}var S=v(P,2),te=r(S),ue=v(te,3);a(S);var f=v(S,2);{var D=V=>{var x=Xr(),b=j(x);Te(b,{autocomplete:"off",get label(){return t.mfa.passkeyName},get placeholder(){return t.mfa.passkeyName},maxLength:32,pattern:pa,onEnter:M,get ref(){return e(C)},set ref(_){n(C,h(_))},get value(){return e(K)},set value(_){n(K,h(_))},get isError(){return e(T)},set isError(_){n(T,h(_))}});var N=v(b,2),J=r(N);xe(J,{onclick:M,children:(_,X)=>{fe();var oe=we();y(()=>l(oe,t.mfa.register)),i(_,oe)},$$slots:{default:!0}});var pe=v(J,2);xe(pe,{level:3,onclick:()=>n(w,!1),children:(_,X)=>{fe();var oe=we();y(()=>l(oe,t.common.cancel)),i(_,oe)},$$slots:{default:!0}}),a(N),i(V,x)},W=V=>{var x=jr(),b=r(x),N=ke(()=>e(R).length===0?1:2);xe(b,{get level(){return e(N)},onclick:()=>n(w,!0),children:(J,pe)=>{fe();var _=we();y(()=>l(_,t.mfa.registerNew)),i(J,_)},$$slots:{default:!0}}),a(x),i(V,x)};k(f,V=>{e(w)?V(D):V(W,!1)})}var L=v(f,2);{var A=V=>{var x=Or(),b=r(x,!0);a(x),y(()=>l(b,t.mfa.registerdKeys)),i(V,x)};k(L,V=>{e(R).length>0&&V(A)})}var Q=v(L,2);ka(Q,21,()=>e(R),V=>V.name,(V,x)=>{var b=Zr(),N=r(b),J=r(N),pe=r(J,!0);a(J);var _=v(J,2),X=r(_),oe=r(X,!0);a(X);var _e=v(X,2);{var Ie=Ne=>{br(Ne,{get text(){return t.account.userVerifiedTooltip},children:(De,Xe)=>{var ze=Yr();ua(ze,"margin-bottom","-.25rem");var We=r(ze);Rr(We,{width:18,color:"var(--col-acnt)"}),a(ze),i(De,ze)},$$slots:{default:!0}})};k(_e,Ne=>{e(x).user_verified&&Ne(Ie)})}a(_),a(N);var be=v(N,2),Pe=r(be),Je=r(Pe,!0);a(Pe);var Se=v(Pe,2),ea=r(Se,!0);y(()=>l(ea,Ge(e(x).registered))),a(Se),a(be);var Me=v(be,2),Le=r(Me),na=r(Le,!0);a(Le);var aa=v(Le,2),Fe=r(aa,!0);y(()=>l(Fe,Ge(e(x).last_used))),a(aa),a(Me);var Ke=v(Me,2);{var oa=Ne=>{var De=Qr(),Xe=v(r(De),2),ze=r(Xe);xe(ze,{level:-3,onclick:()=>z(e(x).name),children:(We,ga)=>{fe();var je=we();y(()=>l(je,t.common.delete)),i(We,je)},$$slots:{default:!0}}),a(Xe),a(De),i(Ne,De)};k(Ke,Ne=>{e(u)&&Ne(oa)})}a(b),y(()=>{l(pe,t.mfa.passkeyName),l(oe,e(x).name),l(Je,t.mfa.registerd),l(na,t.mfa.lastUsed)}),i(V,b)}),a(Q);var F=v(Q,2);{var de=V=>{var x=et(),b=r(x);xe(b,{onclick:()=>n(O,"Test"),children:(N,J)=>{fe();var pe=we();y(()=>l(pe,t.mfa.test)),i(N,pe)},$$slots:{default:!0}}),a(x),i(V,x)};k(F,V=>{e(R).length>0&&V(de)})}var se=v(F,2),ye=r(se,!0);a(se),y(()=>{l(te,`${t.mfa.p1??""} `),l(ue,` ${t.mfa.p2??""}`),xa(se,"success",!e($)),xa(se,"err",e($)),l(ye,e(d))}),i(g,m)};k(ve,g=>{s?g(Z,!1):g(ne)})}a(le),i(ee,le),qe()}var tt=I('<div class="container svelte-ue7bk2"><!> <!> <!> <!> <div class="btn svelte-ue7bk2"><!></div> <div class="err svelte-ue7bk2"> </div></div>');function st(ee,p){Ee(p,!0);let s=$e(p,"passwords",15),t=$e(p,"hideCurrentPassword",3,!1),q=$e(p,"isValid",15),o=Ae();q(K);let C=E(!1),$=E(""),d=E(void 0),w=ke(()=>{var M;return((M=s().new)==null?void 0:M.length)>6&&s().new===s().newConfirm}),u=E(void 0),O=E(void 0);sa(async()=>{let M=await Ze("/auth/v1/password_policy");M.body?n(d,h(M.body)):console.error(M.error)});function K(){return n($,""),!t()&&!s().current?(n($,h(o.account.passwordCurrReq)),!1):s().new?s().newConfirm?e(C)?s().new.length>256?(n($,"max 256"),!1):s().new!==s().newConfirm?(n($,h(o.account.passwordNoMatch)),!1):!0:(n($,h(o.account.passwordPolicyFollow)),!1):(n($,h(o.account.passwordNewReq)),!1):(n($,h(o.account.passwordNewReq)),!1)}function T(){if(n($,""),e(d)){let M=ar(e(d));s(s().new=M,!0),s(s().newConfirm=M,!0)}requestAnimationFrame(()=>{var M,z;(M=e(u))==null||M(),(z=e(O))==null||z()})}var R=ge(),ae=j(R);{var ie=M=>{var z=tt(),U=r(z);kr(U,{get policy(){return e(d)},get password(){return s().new},get accepted(){return e(C)},set accepted(c){n(C,h(c))}});var Y=v(U,2);{var le=c=>{ma(c,{autocomplete:"current-password",get label(){return o.account.passwordCurr},get placeholder(){return o.account.passwordCurr},onInput:K,get width(){return p.inputWidth},get value(){return s().current},set value(S){s(s().current=S,!0)}})};k(Y,c=>{t()||c(le)})}var ve=v(Y,2);ma(ve,{autocomplete:"new-password",get label(){return o.account.passwordNew},get placeholder(){return o.account.passwordNew},onInput:K,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().new},set value(c){s(s().new=c,!0)},get reportValidity(){return e(u)},set reportValidity(c){n(u,h(c))}});var ne=v(ve,2);ma(ne,{autocomplete:"new-password",get label(){return o.account.passwordConfirm},get placeholder(){return o.account.passwordConfirm},onInput:K,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().newConfirm},set value(c){s(s().newConfirm=c,!0)},get reportValidity(){return e(O)},set reportValidity(c){n(O,h(c))}});var Z=v(ne,2),g=r(Z);xe(g,{onclick:T,level:2,children:(c,S)=>{fe();var te=we();y(()=>l(te,o.account.generateRandom)),i(c,te)},$$slots:{default:!0}}),a(Z);var m=v(Z,2),P=r(m,!0);a(m),a(z),y(()=>l(P,e($))),i(M,z)};k(ae,M=>{e(d)&&M(ie)})}return i(ee,R),qe({isPwdValid:K})}var vt=I('<div class="m-05 svelte-1h4zvzu"><p> </p> <p><b> </b></p> <div></div> <p> </p> <!></div>'),nt=I("<p> </p> <p> </p> <p> </p> <div><!></div>",1),ot=I('<div class="success svelte-1h4zvzu"><!></div>'),it=I('<div class="err"> </div>'),lt=I('<div class="cancel"><!></div>'),ct=I('<div class="convertPasskey svelte-1h4zvzu"><h3> </h3> <p> </p> <!></div>'),dt=I('<div><!> <div class="save svelte-1h4zvzu"><!> <!></div></div> <!>',1),ut=I('<div class="container svelte-1h4zvzu"><!> <!> <!> <!></div>');function La(ee,p){Ee(p,!0);let s=$e(p,"user",15),t=Ae(),q=ke(()=>p.viewModePhone?"calc(100vw - 1.5rem)":"300px"),o=E(h(s().account_type)),C=E(h([])),$=E(void 0),d=E(!1),w=E(!1),u=E(""),O=E(!1),K=E(void 0),T=E(h({current:"",new:"",newConfirm:""})),R=ke(()=>e(C).filter(f=>f.user_verified).length>0);sa(()=>{ae()});async function ae(){let f=await Ze(`/auth/v1/users/${s().id}/webauthn`);f.body?n(C,h(f.body)):console.error("error fetching passkeys: "+f.error)}async function ie(){let f=await Ia(`/auth/v1/users/${s().id}/self/convert_passkey`);f.error?console.error("error fetching passkeys: "+f.error):window.location.reload()}async function M(){n(u,""),e(C).length>0?await z():await U()}async function z(){var f;if(!((f=e($))!=null&&f())){n(u,h(t.common.invalidInput));return}n(K,"PasswordNew")}async function U(f){var L,A;if(!((L=e($))!=null&&L())){n(u,h(t.common.invalidInput));return}n(w,!0);let D={password_new:e(T).new};f?D.mfa_code=f:D.password_current=e(T).current;let W=await Ca(`/auth/v1/users/${s().id}/self`,D);W.body?(n(O,!0),n(T,h({current:"",new:"",newConfirm:""})),s(W.body),n(o,h(W.body.account_type)),setTimeout(()=>{n(O,!1),n(d,!1)},3e3)):n(u,h(((A=W.error)==null?void 0:A.message)||"Error")),n(w,!1)}function Y(f){n(K,void 0),n(u,h(f)),setTimeout(()=>{n(u,"")},5e3)}function le(f){n(K,void 0),f&&"code"in f&&U(f.code)}async function ve(){let f=await hr({email:s().email});if(f.ok)n(O,!0);else{let D=await f.json();n(u,h(D.message))}}var ne=ut(),Z=r(ne);{var g=f=>{za(f,{get userId(){return s().id},get purpose(){return e(K)},onSuccess:le,onError:Y})};k(Z,f=>{e(K)&&f(g)})}var m=v(Z,2);{var P=f=>{var D=vt(),W=r(D),L=r(W,!0);a(W);var A=v(W,2),Q=r(A),F=r(Q,!0);a(Q),a(A);var de=v(A,2);ua(de,"height",".3rem");var se=v(de,2),ye=r(se,!0);a(se);var V=v(se,2);{var x=N=>{$r(N,{check:!0})},b=N=>{xe(N,{level:2,onclick:ve,children:(J,pe)=>{fe();var _=we();y(()=>l(_,t.account.passwordReset)),i(J,_)},$$slots:{default:!0}})};k(V,N=>{e(O)?N(x):N(b,!1)})}a(D),y(()=>{var N;l(L,t.account.federatedConvertPassword1),l(F,((N=p.authProvider)==null?void 0:N.name)||"UNKNOWN"),l(ye,t.account.federatedConvertPassword2)}),i(f,D)};k(m,f=>{e(o)==="federated"&&f(P)})}var c=v(m,2);{var S=f=>{var D=nt(),W=j(D),L=r(W,!0);a(W);var A=v(W,2),Q=r(A,!0);a(A);var F=v(A,2),de=r(F,!0);a(F);var se=v(F,2),ye=r(se);xe(ye,{level:2,onclick:()=>n(d,!0),children:(V,x)=>{fe();var b=we();y(()=>l(b,t.account.convertAccount)),i(V,b)},$$slots:{default:!0}}),a(se),y(()=>{l(L,t.account.accTypePasskeyText1),l(Q,t.account.accTypePasskeyText2),l(de,t.account.accTypePasskeyText3)}),i(f,D)};k(c,f=>{(e(o)==="passkey"||e(o)==="federated_passkey")&&!e(d)&&f(S)})}var te=v(c,2);{var ue=f=>{var D=dt(),W=j(D),L=r(W),A=ke(()=>!(e(o)==="password"&&e(C).length<1));st(L,{get inputWidth(){return e(q)},get hideCurrentPassword(){return e(A)},get passwords(){return e(T)},set passwords(b){n(T,h(b))},get isValid(){return e($)},set isValid(b){n($,h(b))}});var Q=v(L,2),F=r(Q);xe(F,{onclick:M,level:1,get isLoading(){return e(w)},children:(b,N)=>{fe();var J=we();y(()=>l(J,t.common.save)),i(b,J)},$$slots:{default:!0}});var de=v(F,2);{var se=b=>{var N=ot(),J=r(N);va(J,{}),a(N),Ue(3,N,()=>Re),i(b,N)},ye=b=>{var N=ge(),J=j(N);{var pe=X=>{var oe=it(),_e=r(oe,!0);a(oe),y(()=>l(_e,e(u))),Ue(3,oe,()=>Re),i(X,oe)},_=X=>{var oe=ge(),_e=j(oe);{var Ie=be=>{var Pe=lt(),Je=r(Pe);xe(Je,{level:3,onclick:()=>n(d,!1),children:(Se,ea)=>{fe();var Me=we();y(()=>l(Me,t.common.cancel)),i(Se,Me)},$$slots:{default:!0}}),a(Pe),i(be,Pe)};k(_e,be=>{e(d)&&!e(w)&&be(Ie)},!0)}i(X,oe)};k(J,X=>{e(u)?X(pe):X(_,!1)},!0)}i(b,N)};k(de,b=>{e(O)?b(se):b(ye,!1)})}a(Q),a(W);var V=v(W,2);{var x=b=>{var N=ct(),J=r(N),pe=r(J,!0);a(J);var _=v(J,2),X=r(_,!0);a(_);var oe=v(_,2);xe(oe,{level:2,onclick:ie,children:(_e,Ie)=>{fe();var be=we();y(()=>l(be,t.account.convertAccount)),i(_e,be)},$$slots:{default:!0}}),a(N),y(()=>{l(pe,t.account.convertAccount),l(X,t.account.convertAccountP1)}),i(b,N)};k(V,b=>{!e(d)&&e(R)&&b(x)})}i(f,D)};k(te,f=>{(e(o)==="password"||e(o)==="federated_password"||e(d))&&f(ue)})}a(ne),i(ee,ne),qe()}function pt(ee,p){ee.code==="Enter"&&p()}var mt=I('<div class="flex"><div class="label font-label noselect svelte-1xf5lr3"><!></div> <label class="switch svelte-1xf5lr3"><input type="checkbox" class="svelte-1xf5lr3"> <span class="slider slider-round svelte-1xf5lr3"></span></label></div>');function Da(ee,p){Ee(p,!0);let s=$e(p,"checked",15,!1),t=$e(p,"ariaLabel",3,""),q=$e(p,"name",3,"");function o(){s(!s())}var C=mt(),$=r(C),d=r($);xr(d,()=>p.children),a($);var w=v($,2),u=r(w);vr(u),u.__click=o,u.__keydown=[pt,o],fe(2),a(w),a(C),y(()=>{ua($,"width",p.labelWidth),Ve(u,"name",q()),u.disabled=p.disabled,Ve(u,"aria-checked",s()),Ve(u,"aria-label",t())}),_r(u,s),i(ee,C),qe()}Oa(["click","keydown"]);var ft=I("<div><p> </p> <!></div>"),gt=I('<div class="success svelte-5kivuv"><!></div>'),ht=I('<div class="err svelte-5kivuv"> </div>'),wt=I('<div class="container svelte-5kivuv"><p> </p> <p><!></p> <div class="switch svelte-5kivuv"><!></div> <div class="switch svelte-5kivuv"><!></div> <!> <div class="bottom svelte-5kivuv"><!> <!></div></div>');function Wa(ee,p){Ee(p,!0);let s=$e(p,"webIdData",15),t=Ae();const q="14rem";let o=E(""),C=E(!1),$=E(!!s().custom_triples),d=da(s().user_id);Qe(()=>{e(C)&&setTimeout(()=>{n(C,!1)},3e3)});async function w(){n(o,"");let m=await wr(s().user_id,s());if(m.ok)n(C,!0);else{let P=await m.json();n(o,h(P.message))}}var u=wt(),O=r(u),K=r(O,!0);a(O);var T=v(O,2),R=r(T);Ir(R,{href:d,target:"_blank",children:(m,P)=>{var c=ge(),S=j(c);$a(S,()=>d.replace("/auth/","/auth/<wbr/>")),i(m,c)},$$slots:{default:!0}}),a(T);var ae=v(T,2),ie=r(ae);Da(ie,{ariaLabel:"E-Mail",labelWidth:q,get checked(){return s().expose_email},set checked(m){s(s().expose_email=m,!0)},children:(m,P)=>{fe();var c=we("E-Mail");i(m,c)},$$slots:{default:!0}}),a(ae);var M=v(ae,2),z=r(M);Da(z,{get ariaLabel(){return t.account.webIdExpertMode},labelWidth:q,get checked(){return e($)},set checked(m){n($,h(m))},children:(m,P)=>{fe();var c=we();y(()=>l(c,t.account.webIdExpertMode)),i(m,c)},$$slots:{default:!0}}),a(M);var U=v(M,2);{var Y=m=>{var P=ft(),c=r(P),S=r(c,!0);a(c);var te=v(c,2);ir(te,{placeholder:"FOAF",rows:15,get value(){return s().custom_triples},set value(ue){s(s().custom_triples=ue,!0)}}),a(P),y(()=>l(S,t.account.webIdDescData)),Ue(3,P,()=>dr),i(m,P)};k(U,m=>{e($)&&m(Y)})}var le=v(U,2),ve=r(le);xe(ve,{onclick:w,children:(m,P)=>{fe();var c=we();y(()=>l(c,t.common.save)),i(m,c)},$$slots:{default:!0}});var ne=v(ve,2);{var Z=m=>{var P=gt(),c=r(P);va(c,{}),a(P),Ue(3,P,()=>Re),i(m,P)},g=m=>{var P=ge(),c=j(P);{var S=te=>{var ue=ht(),f=r(ue,!0);a(ue),y(()=>l(f,e(o))),Ue(3,ue,()=>Re),i(te,ue)};k(c,te=>{e(o)&&te(S)},!0)}i(m,P)};k(ne,m=>{e(C)?m(Z):m(g,!1)})}a(le),a(u),y(()=>l(K,t.account.webIdDesc)),i(ee,u),qe()}function yt(ee){Na(ee,{viewMode:"account"})}var bt=I("<h3> </h3>"),kt=I('<div class="headerPhone svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="innerPhone svelte-k6hxbm"><!></div></div>',1),$t=I('<div class="header svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="inner svelte-k6hxbm"><!></div></div>',1),xt=I('<!> <div class="wrapper svelte-k6hxbm"><!></div>',1);function _t(ee,p){Ee(p,!0);const s=z=>{var U=bt(),Y=r(U,!0);a(U),y(()=>l(Y,`${t().given_name} ${t().family_name||""}`)),i(z,U)};let t=$e(p,"user",15),q=$e(p,"webIdData",15),o=Ae(),C=E(void 0),$=E(h([])),d=ke(()=>{var z;if((z=t().account_type)!=null&&z.startsWith("federated"))return e($).filter(U=>U.id===t().auth_provider_id)[0]}),w=ke(()=>e(C)&&e(C)<500),u=E(h(o.account.navInfo)),O=h(q()?[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,"WebID",o.account.devices,o.account.navLogout]:[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,o.account.devices,o.account.navLogout]);sa(()=>{Pr("v").get()==="devices"&&n(u,h(o.account.devices))}),Qe(()=>{e(u)===o.account.navLogout&&rr()});var K=xt(),T=j(K);Cr(T,{id:tr,get value(){return e($)},set value(z){n($,h(z))}});var R=v(T,2),ae=r(R);{var ie=z=>{var U=kt(),Y=j(U),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);_a(ne,{get tabs(){return O},get selected(){return e(u)},set selected(c){n(u,h(c))}});var Z=v(ne,2),g=r(Z);{var m=c=>{Ea(c,{get providers(){return e($)},get authProvider(){return e(d)},viewModePhone:!0,get webIdData(){return q()},get user(){return t()},set user(S){t(S)}})},P=c=>{var S=ge(),te=j(S);{var ue=D=>{qa(D,{viewModePhone:!0,get user(){return t()},set user(W){t(W)}})},f=D=>{var W=ge(),L=j(W);{var A=F=>{La(F,{get user(){return t()},get authProvider(){return e(d)},viewModePhone:!0})},Q=F=>{var de=ge(),se=j(de);{var ye=x=>{Ta(x,{get user(){return t()}})},V=x=>{var b=ge(),N=j(b);{var J=_=>{Wa(_,{get webIdData(){return q()},set webIdData(X){q(X)}})},pe=_=>{var X=ge(),oe=j(X);{var _e=Ie=>{Na(Ie,{viewMode:"account"})};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,X)};k(N,_=>{e(u)==="WebID"?_(J):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(V,!1)},!0)}i(F,de)};k(L,F=>{e(u)===o.common.password?F(A):F(Q,!1)},!0)}i(D,W)};k(te,D=>{e(u)===o.account.navEdit?D(ue):D(f,!1)},!0)}i(c,S)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(Z),a(ve),i(z,U)},M=z=>{var U=$t(),Y=j(U),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);_a(ne,{get tabs(){return O},center:!0,get selected(){return e(u)},set selected(c){n(u,h(c))}});var Z=v(ne,2),g=r(Z);{var m=c=>{Ea(c,{get webIdData(){return q()},get providers(){return e($)},get authProvider(){return e(d)},get user(){return t()},set user(S){t(S)}})},P=c=>{var S=ge(),te=j(S);{var ue=D=>{qa(D,{get user(){return t()},set user(W){t(W)}})},f=D=>{var W=ge(),L=j(W);{var A=F=>{La(F,{get user(){return t()},get authProvider(){return e(d)}})},Q=F=>{var de=ge(),se=j(de);{var ye=x=>{Ta(x,{get user(){return t()}})},V=x=>{var b=ge(),N=j(b);{var J=_=>{Wa(_,{get webIdData(){return q()},set webIdData(X){q(X)}})},pe=_=>{var X=ge(),oe=j(X);{var _e=Ie=>{yt(Ie)};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,X)};k(N,_=>{e(u)==="WebID"?_(J):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(V,!1)},!0)}i(F,de)};k(L,F=>{e(u)===o.common.password?F(A):F(Q,!1)},!0)}i(D,W)};k(te,D=>{e(u)===o.account.navEdit?D(ue):D(f,!1)},!0)}i(c,S)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(Z),a(ve),i(z,U)};k(ae,z=>{e(w)?z(ie):z(M,!1)})}a(R),Ya("innerWidth",z=>n(C,h(z))),i(ee,K),qe()}var It=I("<!> <!> <!>",1);function Ct(ee,p){Ee(p,!0);let s=Ae(),t=Ma("account"),q=E(void 0),o=E(void 0),C=E(!1);Qe(()=>{let d=t.get();d&&$(d)});async function $(d){const w=d.user_id;if(w){let u=await Promise.all([Ze(`/auth/v1/users/${w}`),Ze(`/auth/v1/users/${w}/webid/data`)]);u[0].body?n(q,h(u[0].body)):sr("account"),u[1].body?n(o,h(u[1].body)):u[1].status===404&&n(o,h({user_id:w,expose_email:!1})),n(C,!0)}else console.error("no user_id in session")}Xa(d=>{y(()=>{var w;return Ja.title=`${((s==null?void 0:s.account.account)||"Account")??""} ${((w=e(q))==null?void 0:w.email)??""}`})}),Mr(ee,{children:(d,w)=>{zr(d,{children:(u,O)=>{var K=It(),T=j(K);{var R=M=>{_t(M,{get user(){return e(q)},set user(z){n(q,h(z))},get webIdData(){return e(o)},set webIdData(z){n(o,h(z))}})};k(T,M=>{e(C)&&t&&e(q)&&M(R)})}var ae=v(T,2);Nr(ae,{absolute:!0});var ie=v(ae,2);Er(ie,{absolute:!0}),i(u,K)},$$slots:{default:!0}})},$$slots:{default:!0}}),qe()}export{Ct as component};
