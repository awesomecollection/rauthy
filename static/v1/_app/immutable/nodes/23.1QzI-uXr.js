import{a as i,t as $,e as Q,d as ce}from"../chunks/disclose-version.BP4T4xdV.js";import{a5 as be,f as S,p as ye,a as Te,k as a,t as l,a6 as ke,j as e,s as o,l as f,c as t,r as s,a7 as X,a9 as le}from"../chunks/index-client.hxMyB_b4.js";import{h as Le,s as d}from"../chunks/render.yNX9q8-B.js";import{i as V}from"../chunks/if.BeBa1Kxb.js";import{e as Se,i as Ae}from"../chunks/each.BUp7aLCc.js";import{p as n}from"../chunks/proxy.DaVNR9vk.js";import{r as ne,m as Pe}from"../chunks/helpers.CchIKxjM.js";import{L as De}from"../chunks/LangSelector.Bl8L6Wq4.js";import{I as Ee,f as Ce}from"../chunks/pow.BMnvYon0.js";import{B as Y}from"../chunks/Button.BR1gOfNn.js";import{M as Re}from"../chunks/Main.Rc9oYaw1.js";import{C as je}from"../chunks/ContentCenter.lHeEkgTE.js";import{u as qe}from"../chunks/i18n.svelte.Ci9wvqOq.js";import{T as Be}from"../chunks/Template.Ih924_PB.js";import{u as Me}from"../chunks/param.svelte.BbzO27-O.js";import{T as Ne}from"../chunks/ThemeSwitch.DTJa252X.js";import{f as Oe,b as Ve}from"../chunks/fetch.Bq59EV_b.js";import{P as We}from"../chunks/patterns.BRCxk8by.js";var _e=$('<div class="desc svelte-hzde4x"> </div> <!> <div><!></div>',1),Fe=$('<div class="desc svelte-hzde4x"><p> </p> <p> </p></div>'),Ge=$('<div class="desc svelte-hzde4x"><p class="declined svelte-hzde4x"> </p> <p> </p></div>'),He=$('<li class="svelte-hzde4x"> </li>'),Ie=$('<div class="desc svelte-hzde4x"> <ul class="svelte-hzde4x"></ul></div> <div class="inline svelte-hzde4x"><!> <!></div>',1),Je=$('<div class="container svelte-hzde4x"><div class="name svelte-hzde4x"><h2> </h2></div> <!> <div class="err svelte-hzde4x"> </div></div>'),Ke=$("<!> <!> <!>",1),Ue=$("<!> <!>",1);function Qe(ue,me){Te(me,!0);let r=qe(),Z=f(void 0),w=f(""),W=f(!1),A=f(!1),b=f(8),_=f(void 0),ee=f(!1),re=f(!1),T=f("");be(async()=>{let v=Me("code").get()||"";a(T,n(v));let k=await Oe("/auth/v1/oidc/sessioninfo");k.body?a(Z,n(k.body)):v?ne(`device?code=${v}`):ne("device")});async function F(v){var P,D,B;if(a(w,""),e(W))return;if(e(T).length<e(b)){a(w,n(r.common.errTooShort));return}if(e(T).length>e(b)){a(w,n(r.common.errTooLong));return}a(A,!0);let k=await Ce();if(!k){a(w,"PoW error - please contact your administrator");return}let G={user_code:e(T),pow:k,device_accepted:v},h=await Ve("/auth/v1/oidc/device/verify",G);h.status===200?a(_,n(((D=(P=h.body)==null?void 0:P.scopes)==null?void 0:D.split(" "))||["openid"])):h.status===202?(a(ee,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3)):h.status===204?a(re,!0):h.status===404?a(w,n(r.device.wrongOrExpired)):(console.error(h),a(w,n((B=h.error)==null?void 0:B.message))),a(A,!1)}var ae=Ue();Le(v=>{l(()=>ke.title=(r==null?void 0:r.device.title)||"Device Authorization")});var se=S(ae);Be(se,{id:Pe,get value(){return e(b)},set value(v){a(b,n(v))}});var pe=o(se,2);Re(pe,{children:(v,k)=>{je(v,{children:(G,h)=>{var P=Ke(),D=S(P);{var B=H=>{var I=Je(),J=t(I),ie=t(J),he=t(ie,!0);s(ie),s(J);var oe=o(J,2);{var ge=L=>{var E=_e(),C=S(E),K=t(C,!0);l(()=>d(K,r.device.desc.replace("{{count}}",e(b).toString()))),s(C);var M=o(C,2),g=le(()=>e(b).toString()),x=le(()=>e(b).toString());Ee(M,{name:"userCode",autocomplete:"off",get label(){return r.device.userCode},get placeholder(){return r.device.userCode},required:!0,get min(){return e(g)},get max(){return e(x)},pattern:We,get value(){return e(T)},set value(c){a(T,n(c))},get isError(){return e(W)},set isError(c){a(W,n(c))}});var z=o(M,2),R=t(z);Y(R,{onclick:()=>F("pending"),get isLoading(){return e(A)},children:(c,u)=>{X();var m=Q();l(()=>d(m,r.device.submit)),i(c,m)},$$slots:{default:!0}}),s(z),i(L,E)},xe=L=>{var E=ce(),C=S(E);{var K=g=>{var x=Fe(),z=t(x),R=t(z,!0);s(z);var c=o(z,2),u=t(c,!0);s(c),s(x),l(()=>{d(R,r.device.isAccepted),d(u,r.device.autoRedirectAccount)}),i(g,x)},M=g=>{var x=ce(),z=S(x);{var R=u=>{var m=Ge(),y=t(m),N=t(y,!0);s(y);var j=o(y,2),O=t(j,!0);s(j),s(m),l(()=>{d(N,r.device.isDeclined),d(O,r.device.closeWindow)}),i(u,m)},c=u=>{var m=Ie(),y=S(m),N=t(y),j=o(N);Se(j,21,()=>e(_),Ae,(q,U)=>{var p=He(),we=t(p,!0);s(p),l(()=>d(we,e(U))),i(q,p)}),s(j),s(y);var O=o(y,2),ve=t(O);Y(ve,{onclick:()=>F("accept"),get isLoading(){return e(A)},children:(q,U)=>{X();var p=Q();l(()=>d(p,r.device.accept)),i(q,p)},$$slots:{default:!0}});var $e=o(ve,2);Y($e,{level:-1,onclick:()=>F("decline"),get isLoading(){return e(A)},children:(q,U)=>{X();var p=Q();l(()=>d(p,r.device.decline)),i(q,p)},$$slots:{default:!0}}),s(O),l(()=>d(N,`${r.device.descScopes??""} `)),i(u,m)};V(z,u=>{e(re)?u(R):u(c,!1)},!0)}i(g,x)};V(C,g=>{e(ee)?g(K):g(M,!1)},!0)}i(L,E)};V(oe,L=>{e(_)===void 0?L(ge):L(xe,!1)})}var de=o(oe,2),ze=t(de,!0);s(de),s(I),l(()=>{d(he,r.device.title),d(ze,e(w))}),i(H,I)};V(D,H=>{e(Z)&&H(B)})}var te=o(D,2);Ne(te,{absolute:!0});var fe=o(te,2);De(fe,{absolute:!0}),i(G,P)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(ue,ae),ye()}export{Qe as component};
