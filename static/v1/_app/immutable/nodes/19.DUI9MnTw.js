import"../chunks/disclose-version.BDr9Qe-U.js";import{p as be,f as k,a as ye,h as a,t as l,$ as Te,g as e,s as o,i as f,c as s,r as t,ap as Q,O as ce}from"../chunks/runtime.BsghBUX9.js";import{s as d}from"../chunks/render.CTp9lacC.js";import{i as R}from"../chunks/if.6Ov_EDLa.js";import{e as Le,i as Se}from"../chunks/each.URXtkKAp.js";import{a as i,t as z,d as X,e as le}from"../chunks/template.jENAUvUX.js";import{h as ke}from"../chunks/svelte-head.cS_wx7Ri.js";import{p as n}from"../chunks/proxy.YH42NwLs.js";import{o as Ae}from"../chunks/index-client.ClP8y9aT.js";import{r as ne,l as Pe}from"../chunks/helpers.CBl6QeM5.js";import{T as De,L as Ee}from"../chunks/LangSelector.TD0HCe5U.js";import{I as Oe}from"../chunks/Input.luLa8YQi.js";import{f as Ce,B as Y,b as _e}from"../chunks/fetch.BvIeF4JA.js";import{f as je}from"../chunks/pow.Dw4Nl_Mh.js";import{M as qe}from"../chunks/Main.DdVUe3_l.js";import{C as Be}from"../chunks/ContentCenter.1a7TMW4_.js";import{u as Me}from"../chunks/i18n.svelte.D8rR00qK.js";import{T as Ne}from"../chunks/Template.ZFmGCuZr.js";import{u as Re}from"../chunks/param.svelte.BhHpzHur.js";import{P as We}from"../chunks/patterns.BdncpE46.js";var Fe=z('<div class="desc svelte-hzde4x"> </div> <!> <div><!></div>',1),Ge=z('<div class="desc svelte-hzde4x"><p> </p> <p> </p></div>'),He=z('<div class="desc svelte-hzde4x"><p class="declined svelte-hzde4x"> </p> <p> </p></div>'),Ie=z('<li class="svelte-hzde4x"> </li>'),Je=z('<div class="desc svelte-hzde4x"> <ul class="svelte-hzde4x"></ul></div> <div class="inline svelte-hzde4x"><!> <!></div>',1),Ke=z('<div class="container svelte-hzde4x"><div class="name svelte-hzde4x"><h2> </h2></div> <!> <div class="err svelte-hzde4x"> </div></div>'),Ue=z("<!> <!> <!>",1),Ve=z("<!> <!>",1);function Qe(ue,me){be(me,!0);let r=Me(),Z=f(void 0),w=f(""),W=f(!1),A=f(!1),b=f(8),F=f(void 0),ee=f(!1),re=f(!1),T=f("");Ae(async()=>{let v=Re("code").get()||"";a(T,n(v));let L=await Ce("/auth/v1/oidc/sessioninfo");L.body?a(Z,n(L.body)):v?ne(`device?code=${v}`):ne("device")});async function G(v){var P,D,q;if(a(w,""),e(W))return;if(e(T).length<e(b)){a(w,n(r.common.errTooShort));return}if(e(T).length>e(b)){a(w,n(r.common.errTooLong));return}a(A,!0);let L=await je();if(!L){a(w,"PoW error - please contact your administrator");return}let H={user_code:e(T),pow:L,device_accepted:v},h=await _e("/auth/v1/oidc/device/verify",H);h.status===200?a(F,n(((D=(P=h.body)==null?void 0:P.scopes)==null?void 0:D.split(" "))||["openid"])):h.status===202?(a(ee,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3)):h.status===204?a(re,!0):h.status===404?a(w,n(r.device.wrongOrExpired)):(console.error(h),a(w,n((q=h.error)==null?void 0:q.message))),a(A,!1)}var ae=Ve();ke(v=>{l(()=>Te.title=(r==null?void 0:r.device.title)||"Device Authorization")});var te=k(ae);Ne(te,{id:Pe,get value(){return e(b)},set value(v){a(b,n(v))}});var pe=o(te,2);qe(pe,{children:(v,L)=>{Be(v,{children:(H,h)=>{var P=Ue(),D=k(P);{var q=I=>{var J=Ke(),K=s(J),ie=s(K),he=s(ie,!0);t(ie),t(K);var oe=o(K,2);{var ge=S=>{var E=Fe(),O=k(E),U=s(O,!0);l(()=>d(U,r.device.desc.replace("{{count}}",e(b).toString()))),t(O);var B=o(O,2),g=ce(()=>e(b).toString()),x=ce(()=>e(b).toString());Oe(B,{name:"userCode",autocomplete:"off",get label(){return r.device.userCode},get placeholder(){return r.device.userCode},required:!0,get min(){return e(g)},get max(){return e(x)},pattern:We,get value(){return e(T)},set value(c){a(T,n(c))},get isError(){return e(W)},set isError(c){a(W,n(c))}});var $=o(B,2),C=s($);Y(C,{onclick:()=>G("pending"),get isLoading(){return e(A)},children:(c,u)=>{Q();var m=X();l(()=>d(m,r.device.submit)),i(c,m)},$$slots:{default:!0}}),t($),i(S,E)},xe=S=>{var E=le(),O=k(E);{var U=g=>{var x=Ge(),$=s(x),C=s($,!0);t($);var c=o($,2),u=s(c,!0);t(c),t(x),l(()=>{d(C,r.device.isAccepted),d(u,r.device.autoRedirectAccount)}),i(g,x)},B=g=>{var x=le(),$=k(x);{var C=u=>{var m=He(),y=s(m),M=s(y,!0);t(y);var _=o(y,2),N=s(_,!0);t(_),t(m),l(()=>{d(M,r.device.isDeclined),d(N,r.device.closeWindow)}),i(u,m)},c=u=>{var m=Je(),y=k(m),M=s(y),_=o(M);Le(_,21,()=>e(F),Se,(j,V)=>{var p=Ie(),we=s(p,!0);t(p),l(()=>d(we,e(V))),i(j,p)}),t(_),t(y);var N=o(y,2),ve=s(N);Y(ve,{onclick:()=>G("accept"),get isLoading(){return e(A)},children:(j,V)=>{Q();var p=X();l(()=>d(p,r.device.accept)),i(j,p)},$$slots:{default:!0}});var ze=o(ve,2);Y(ze,{level:-1,onclick:()=>G("decline"),get isLoading(){return e(A)},children:(j,V)=>{Q();var p=X();l(()=>d(p,r.device.decline)),i(j,p)},$$slots:{default:!0}}),t(N),l(()=>d(M,`${r.device.descScopes??""} `)),i(u,m)};R($,u=>{e(re)?u(C):u(c,!1)},!0)}i(g,x)};R(O,g=>{e(ee)?g(U):g(B,!1)},!0)}i(S,E)};R(oe,S=>{e(F)===void 0?S(ge):S(xe,!1)})}var de=o(oe,2),$e=s(de,!0);t(de),t(J),l(()=>{d(he,r.device.title),d($e,e(w))}),i(I,J)};R(D,I=>{e(Z)&&I(q)})}var se=o(D,2);De(se,{absolute:!0});var fe=o(se,2);Ee(fe,{absolute:!0}),i(H,P)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(ue,ae),ye()}export{Qe as component};
