import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.Dmu0D13_.js";import{t as R,p as Q,c as V,r as T,s as k,z as o,y as e,f as G,ar as q,a as ee,A as M,ab as ae,a6 as re,ap as Se}from"../chunks/index-client.CVQra9Cu.js";import{s as j}from"../chunks/render.CkKFmY3E.js";import{i as F}from"../chunks/if._4yhN2kP.js";import{e as ce}from"../chunks/each.D7w_Y1pv.js";import{a as s,n as ke,d as H,t as A,e as de}from"../chunks/template.4ZWi6dE6.js";import{a as fe}from"../chunks/index.CkVfMYgG.js";import{p as n}from"../chunks/proxy.Dc6q2r8X.js";import{u as te}from"../chunks/i18n_admin.svelte.DBF4IRUg.js";import{O as Ae}from"../chunks/OrderSearchBar.BK-vyt5G.js";import{d as Ce,c as Te,b as Me,f as he}from"../chunks/fetch.BnpwKXAn.js";import{C as Ee}from"../chunks/ContentAdmin.p5jUo2m-.js";import{N as Le}from"../chunks/NavButtonTile.B87bIUim.js";import{B as xe}from"../chunks/ButtonAddModal.B1jk33x3.js";import{N as ze}from"../chunks/NavSub.CPeQMNZ5.js";import{u as De}from"../chunks/param.svelte.CAlaz0Tl.js";import{X as ie}from"../chunks/helpers.BweJi6s8.js";import{B as ne}from"../chunks/Button.B6DffihK.js";import{I as ge}from"../chunks/Input.E2qlCEoO.js";import{I as Ie}from"../chunks/IconCheck.jhQYM7vu.js";import{u as le}from"../chunks/i18n.svelte.DVZudxvm.js";import{F as $e}from"../chunks/Form.BiuDxuNH.js";import{L as Ne}from"../chunks/LabeledValue.DfaotEKr.js";import{s as be}from"../chunks/snippet.BBxd9sB6.js";import{b as Oe}from"../chunks/window.jqEf7WoA.js";import{p as ve}from"../chunks/props.BVYR8gU-.js";import{s as me}from"../chunks/class.BnbJV1WX.js";import{T as Re}from"../chunks/Tooltip.Q92keWA_.js";import{M as Ve}from"../chunks/Modal.BoPoPiDZ.js";import{I as ue}from"../chunks/InputCheckbox.DJbEwO1k.js";import{T as je}from"../chunks/Tabs.BGGYqHwk.js";import{d as Fe}from"../chunks/patterns.CpCrQ-Dx.js";var Je=ke(`<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6
            18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75
            21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg>`);function Ge(B,a){let W=ve(a,"opacity",3,.9),w=ve(a,"width",3,"1.5rem"),h=ve(a,"color",3,"currentColor");var d=Je();me(d,"stroke-width",2),R(()=>{me(d,"stroke",h()),me(d,"width",w()),me(d,"opacity",W())}),s(B,d)}var Be=A('<div class="compact svelte-vpfafb"></div>'),We=A('<div class="boxes svelte-vpfafb"><div class="svelte-vpfafb"></div> <div class="svelte-vpfafb"></div></div>'),Ye=A("<h3><!></h3> <!> <!>",1),Ze=A('<div class="container svelte-vpfafb"><div class="items svelte-vpfafb"><div class="joined svelte-vpfafb"> </div> <div class="edit svelte-vpfafb"><!></div> <!></div> <div class="label font-label svelte-vpfafb"><!></div></div>');function we(B,a){Q(a,!0);let W=ve(a,"maxWidth",3,"467pt"),w=le(),h=te(),d=M(void 0),C=M(!1),p=M(void 0),y=ae(()=>e(d)&&e(d)<800),N=ae(()=>a.items.filter(u=>u.selected).map(u=>u.name).join(", "));var v=Ze(),E=V(v),l=V(E),t=V(l,!0);T(l);var S=k(l,2),O=V(S);ne(O,{invisible:!0,onclick:()=>o(C,!0),children:(u,_)=>{Re(u,{get text(){return h.common.edit},children:(X,r)=>{Ge(X,{width:"1.2rem"})},$$slots:{default:!0}})},$$slots:{default:!0}}),T(S);var D=k(S,2);Ve(D,{get showModal(){return e(C)},set showModal(u){o(C,n(u))},get closeModal(){return e(p)},set closeModal(u){o(p,n(u))},children:(u,_)=>{var X=Ye(),r=G(X),c=V(r);be(c,()=>a.children),T(r);var m=k(r,2);{var I=f=>{var $=Be();ce($,21,()=>a.items,g=>g.name,(g,x,z)=>{ue(g,{get ariaLabel(){return e(x).name},get checked(){return e(x).selected},set checked(b){e(x).selected=b},children:(b,K)=>{q();var J=H();R(()=>j(J,e(x).name)),s(b,J)},$$slots:{default:!0}})}),T($),s(f,$)},L=f=>{var $=We(),g=V($);ce(g,21,()=>a.items,z=>z.name,(z,b,K)=>{var J=de(),se=G(J);{var pe=P=>{ue(P,{get ariaLabel(){return e(b).name},get checked(){return e(b).selected},set checked(U){e(b).selected=U},children:(U,ye)=>{q();var oe=H();R(()=>j(oe,e(b).name)),s(U,oe)},$$slots:{default:!0}})};F(se,P=>{e(b).selected||P(pe)})}s(z,J)}),T(g);var x=k(g,2);ce(x,21,()=>a.items,z=>z.name,(z,b,K)=>{var J=de(),se=G(J);{var pe=P=>{ue(P,{get ariaLabel(){return e(b).name},get checked(){return e(b).selected},set checked(U){e(b).selected=U},children:(U,ye)=>{q();var oe=H();R(()=>j(oe,e(b).name)),s(U,oe)},$$slots:{default:!0}})};F(se,P=>{e(b).selected&&P(pe)})}s(z,J)}),T(x),T($),s(f,$)};F(m,f=>{e(y)?f(I):f(L,!1)})}var Z=k(m,2);ne(Z,{onclick:()=>{var f;return(f=e(p))==null?void 0:f()},children:(f,$)=>{q();var g=H();R(()=>j(g,w.common.close)),s(f,g)},$$slots:{default:!0}}),s(u,X)},$$slots:{default:!0}}),T(E);var i=k(E,2),Y=V(i);be(Y,()=>a.children),T(i),T(v),R(()=>{fe(v,"max-width",W()),j(t,e(N))}),Oe("innerWidth",u=>o(d,n(u))),s(B,v),ee()}var qe=A("<p> </p>"),He=A("<p> </p> <p> </p> <!> <!>",1),Xe=A('<div class="err"> </div>'),Pe=A("<!> <!> <!>",1),Ue=A("<!> <!> <!> <!>",1);function _e(B,a){Q(a,!0);let W=le(),w=te(),h=M(""),d=M(!1),C=ae(()=>ie(a.scope.name)),p=M(n(a.scope.name)),y=M(void 0),N=M(void 0);re(()=>{a.scope.id&&o(p,n(a.scope.name))}),re(()=>{ie(a.scope.name)?(o(y,void 0),o(N,void 0)):(o(y,n(a.attrs.map(l=>{var t;return{name:l.name,selected:((t=a.scope.attr_include_access)==null?void 0:t.includes(l.name))||!1}}).toSorted((l,t)=>l.name.localeCompare(t.name)))),o(N,n(a.attrs.map(l=>{var t;return{name:l.name,selected:((t=a.scope.attr_include_id)==null?void 0:t.includes(l.name))||!1}}).toSorted((l,t)=>l.name.localeCompare(t.name)))))});async function v(l,t){if(o(h,""),ie(e(p))||a.scopes.find(D=>D.name===e(p))){o(h,n(w.common.nameExistsAlready));return}let S={scope:e(p)};if(e(y)){let D=e(y).filter(i=>i.selected).map(i=>i.name);D.length>0&&(S.attr_include_access=D)}if(e(N)){let D=e(N).filter(i=>i.selected).map(i=>i.name);D.length>0&&(S.attr_include_id=D)}let O=await Ce(l.action,S);O.error?o(h,n(O.error.message)):(o(d,!0),setTimeout(()=>{o(d,!1),a.onSave()},2e3))}var E=ae(()=>`/auth/v1/scopes/${a.scope.id}`);$e(B,{get action(){return e(E)},onSubmit:v,children:(l,t)=>{var S=Ue(),O=G(S);Ne(O,{label:"ID",mono:!0,children:(r,c)=>{q();var m=H();R(()=>j(m,a.scope.id)),s(r,m)},$$slots:{default:!0}});var D=k(O,2);ge(D,{autocomplete:"off",get label(){return w.scopes.name},get placeholder(){return w.scopes.name},get disabled(){return e(C)},width:"14.5rem",get value(){return e(p)},set value(r){o(p,n(r))}});var i=k(D,2);{var Y=r=>{var c=qe(),m=V(c,!0);T(c),R(()=>j(m,w.scopes.defaultNoMod)),s(r,c)},u=r=>{var c=He(),m=G(c),I=V(m,!0);T(m);var L=k(m,2),Z=V(L,!0);T(L);var f=k(L,2);{var $=z=>{we(z,{get items(){return e(y)},set items(b){o(y,n(b))},children:(b,K)=>{q();var J=H("Access Token Mappings");s(b,J)},$$slots:{default:!0}})};F(f,z=>{e(y)&&z($)})}var g=k(f,2);{var x=z=>{we(z,{get items(){return e(N)},set items(b){o(N,n(b))},children:(b,K)=>{q();var J=H("Id Token Mappings");s(b,J)},$$slots:{default:!0}})};F(g,z=>{e(N)&&z(x)})}R(()=>{j(I,w.scopes.mapping1),j(Z,w.scopes.mapping2)}),s(r,c)};F(i,r=>{e(C)?r(Y):r(u,!1)})}var _=k(i,2);{var X=r=>{var c=Pe(),m=G(c);ne(m,{type:"submit",children:($,g)=>{q();var x=H();R(()=>j(x,W.common.save)),s($,x)},$$slots:{default:!0}});var I=k(m,2);{var L=$=>{Ie($,{})};F(I,$=>{e(d)&&$(L)})}var Z=k(I,2);{var f=$=>{var g=Xe(),x=V(g,!0);T(g),R(()=>j(x,e(h))),s($,g)};F(Z,$=>{e(h)&&$(f)})}s(r,c)};F(_,r=>{e(C)||r(X)})}s(l,S)},$$slots:{default:!0}}),ee()}var Ke=A("<p> </p>"),Qe=A('<div class="err"> </div>'),ea=A("<p> </p> <!> <!>",1);function aa(B,a){Q(a,!0);let W=le(),w=te(),h=M("");async function d(){o(h,"");let v=await Te(`/auth/v1/scopes/${a.scope.id}`);v.error?o(h,n(v.error.message)):a.onSave()}var C=de(),p=G(C);{var y=v=>{var E=Ke(),l=V(E,!0);T(E),R(()=>j(l,w.scopes.deleteDefault)),s(v,E)},N=v=>{var E=ea(),l=G(E),t=V(l,!0);T(l);var S=k(l,2);ne(S,{level:-1,onclick:d,children:(i,Y)=>{q();var u=H();R(()=>j(u,W.common.delete)),s(i,u)},$$slots:{default:!0}});var O=k(S,2);{var D=i=>{var Y=Qe(),u=V(Y,!0);T(Y),R(()=>j(u,e(h))),s(i,Y)};F(O,i=>{e(h)&&i(D)})}R(()=>j(t,w.scopes.delete1)),s(v,E)};F(p,v=>{ie(a.scope.name)?v(y):v(N,!1)})}s(B,C),ee()}var ra=A('<div class="flex"><!></div> <!>',1);function ta(B,a){Q(a,!0);let W=le(),w=te();const h=[w.nav.config,W.common.delete];let d=M(n(h[0])),C=M(void 0);re(()=>{a.scope.id&&requestAnimationFrame(()=>{var t;(t=e(C))==null||t()})});var p=ra(),y=G(p),N=V(y);je(N,{tabs:h,get selected(){return e(d)},set selected(t){o(d,n(t))},get focusFirst(){return e(C)},set focusFirst(t){o(C,n(t))}}),T(y);var v=k(y,2);{var E=t=>{_e(t,{get attrs(){return a.attrs},get scope(){return a.scope},get scopes(){return a.scopes},get onSave(){return a.onSave}})},l=t=>{var S=de(),O=G(S);{var D=i=>{aa(i,{get scope(){return a.scope},get onSave(){return a.onSave}})};F(O,i=>{e(d)===W.common.delete&&i(D)},!0)}s(t,S)};F(v,t=>{e(d)===w.nav.config?t(E):t(l,!1)})}s(B,p),ee()}var sa=A('<div class="err"> </div>'),oa=A("<!> <!> <!>",1),ia=A('<div class="container svelte-s1196z"><!></div>');function na(B,a){Q(a,!0);let W=le(),w=te(),h=M(void 0),d=M(""),C=M("");re(()=>{requestAnimationFrame(()=>{var v;(v=e(h))==null||v.focus()})});async function p(v,E){var S;if(a.scopes.find(O=>O.name===e(C))){o(d,n(w.common.nameExistsAlready));return}o(d,"");let l={scope:e(C)},t=await Me(v.action,l);t.body?a.onSave(t.body.id):o(d,n(((S=t.error)==null?void 0:S.message)||"Error"))}var y=ia(),N=V(y);$e(N,{action:"/auth/v1/scopes",onSubmit:p,children:(v,E)=>{var l=oa(),t=G(l);ge(t,{autocomplete:"off",get label(){return w.scopes.name},get placeholder(){return w.scopes.name},required:!0,pattern:Fe,get ref(){return e(h)},set ref(i){o(h,n(i))},get value(){return e(C)},set value(i){o(C,n(i))}});var S=k(t,2);ne(S,{type:"submit",children:(i,Y)=>{q();var u=H();R(()=>j(u,W.common.save)),s(i,u)},$$slots:{default:!0}});var O=k(S,2);{var D=i=>{var Y=sa(),u=V(Y,!0);T(Y),R(()=>j(u,e(d))),s(i,Y)};F(O,i=>{e(d)&&i(D)})}s(v,l)},$$slots:{default:!0}}),T(y),s(B,y),ee()}var la=A('<span class="default svelte-1bjjcss"><i>default</i></span>'),ca=A(" <!>",1),da=A("<div></div> <!>",1),va=A("<!> <!>",1),ma=A('<div class="err"> </div>'),pa=A('<!> <div id="scopes"><!></div>',1),ua=A("<!> <!>",1);function fa(B,a){Q(a,!0);let W=te(),w=M(void 0),h=M(""),d=De("sid"),C=M(n([])),p=M(n([])),y=M(n([])),N=M(void 0);const v=[W.common.name,"ID"];let E=M(n(v[0])),l=M("");const t=[W.common.name,"ID"];Se(()=>{O(),S()}),re(()=>{o(N,n(e(p).find(r=>r.id===d.get())))}),re(()=>{let r=e(l).toLowerCase();r?e(E)===v[0]?o(y,n(e(p).filter(c=>{var m;return(m=c.name)==null?void 0:m.toLowerCase().includes(r)}))):e(E)===v[1]&&o(y,n(e(p).filter(c=>c.id.toLowerCase().includes(r)))):o(y,n(e(p)))});async function S(){var c;let r=await he("/auth/v1/users/attr");r.body?o(C,n(r.body.values)):o(h,n(((c=r.error)==null?void 0:c.message)||"Error"))}async function O(){var c;let r=await he("/auth/v1/scopes");r.body?o(p,n(r.body)):o(h,n(((c=r.error)==null?void 0:c.message)||"Error"))}function D(r,c){let m=c==="up";r===t[0]?e(p).sort((I,L)=>m?I.name.localeCompare(L.name):L.name.localeCompare(I.name)):r===t[1]&&e(p).sort((I,L)=>m?I.id.localeCompare(L.id):L.id.localeCompare(I.id))}function i(){O()}async function Y(r){var c;(c=e(w))==null||c(),await O(),d.set(r)}var u=ua(),_=G(u);ze(_,{paddingTop:"2.1rem",buttonTilesAriaControls:"scopes",width:"min(20rem, 100dvw)",thresholdNavSub:700,buttonTiles:r=>{var c=da(),m=G(c);fe(m,"height",".5rem");var I=k(m,2);ce(I,17,()=>e(y),L=>L.id,(L,Z)=>{var f=ae(()=>d.get()===e(Z).id);Le(L,{onclick:()=>d.set(e(Z).id),get selected(){return e(f)},children:($,g)=>{q();var x=ca(),z=G(x),b=k(z);{var K=J=>{var se=la();s(J,se)};F(b,J=>{ie(e(Z).name)&&J(K)})}R(()=>j(z,`${e(Z).name??""} `)),s($,x)},$$slots:{default:!0}})}),s(r,c)},children:(r,c)=>{var m=va(),I=G(m),L=ae(()=>e(p).length===0?1:2);xe(I,{get level(){return e(L)},alignRight:!0,get closeModal(){return e(w)},set closeModal(f){o(w,n(f))},children:(f,$)=>{na(f,{onSave:Y,get scopes(){return e(p)}})},$$slots:{default:!0}});var Z=k(I,2);Ae(Z,{searchOptions:v,orderOptions:t,onChangeOrder:D,searchWidth:"min(19.5rem, 100dvw - .5rem)",get searchOption(){return e(E)},set searchOption(f){o(E,n(f))},get value(){return e(l)},set value(f){o(l,n(f))}}),s(r,m)},$$slots:{buttonTiles:!0,default:!0}});var X=k(_,2);Ee(X,{children:(r,c)=>{var m=pa(),I=G(m);{var L=g=>{var x=ma(),z=V(x,!0);T(x),R(()=>j(z,e(h))),s(g,x)};F(I,g=>{e(h)&&g(L)})}var Z=k(I,2),f=V(Z);{var $=g=>{ta(g,{get attrs(){return e(C)},get scope(){return e(N)},get scopes(){return e(p)},onSave:i})};F(f,g=>{e(N)&&g($)})}T(Z),s(r,m)},$$slots:{default:!0}}),s(B,u),ee()}function ha(B){fa(B,{})}export{ha as component};
