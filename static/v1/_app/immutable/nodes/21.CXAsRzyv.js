import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.C93jtn63.js";import{p as J,c as r,r as l,t as P,a as K,s as v,i as $,ao as oe,h as t,g as a,aq as ve,f as Q}from"../chunks/index-client.ijM6xFk7.js";import{s as k}from"../chunks/render.BjVgqyVR.js";import{i as V}from"../chunks/if.BunKWniS.js";import{e as X}from"../chunks/each.K_FVK-xy.js";import{a as b,t as _,d as ne,e as Y}from"../chunks/template.DOyJZ41v.js";import{s as ce}from"../chunks/index.R935SZZb.js";import{p as d}from"../chunks/proxy.DmesnD8z.js";import{g as pe,d as me,a as Z}from"../chunks/dataFetchingAdmin.1Vn3g5PB.js";import{k as N,r as be}from"../chunks/helpers.DMpx17S8.js";import"../chunks/Loading.B7S3LDCT.js";import{E as ge,T as W,a as ue,P as fe}from"../chunks/Pagination.8F_y-ekl.js";import{B as he}from"../chunks/Button.BgUaD8Uz.js";import{P as we}from"../chunks/PaginationServer.CAboxPNU.js";import{t as xe}from"../chunks/class.p-n0nTxi.js";import{p as A}from"../chunks/props.YiozBtSG.js";import{C as Ie}from"../chunks/CheckIcon.BRA846gp.js";var $e=_('<div class="uid svelte-psgb3d"> </div>'),ke=_('<div class="ip svelte-psgb3d"> </div>'),Se=_('<div class="date svelte-psgb3d"> </div>'),_e=_('<div class="header svelte-psgb3d"><!> <div class="header svelte-psgb3d"><!> <!></div></div>'),Ce=_('<div class="details svelte-psgb3d"><div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">Session ID:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">User ID:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">Expires:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">Last Seen:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">State:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">IP:</div> </div> <div class="flex svelte-psgb3d"><div class="label svelte-psgb3d">MFA:</div> <!></div></div>'),Pe=_('<div class="container svelte-psgb3d"><!></div>');function ee(B,O){J(O,!0);let n=A(O,"session",27,()=>d({})),y=A(O,"now",11,0);var h=Pe(),D=r(h);ge(D,{header:w=>{var c=_e(),g=r(c);W(g,{text:"User ID",children:(u,F)=>{var o=$e(),S=r(o,!0);l(o),P(()=>k(S,n().user_id)),b(u,o)},$$slots:{default:!0}});var x=v(g,2),p=r(x);W(p,{text:"Peer IP",children:(u,F)=>{var o=ke(),S=r(o,!0);l(o),P(()=>k(S,n().remote_ip)),b(u,o)},$$slots:{default:!0}});var m=v(p,2);W(m,{text:"Last Seen",children:(u,F)=>{var o=Se(),S=r(o,!0);P(()=>k(S,N(n().last_seen))),l(o),b(u,o)},$$slots:{default:!0}}),l(x),l(c),b(w,c)},body:w=>{var c=Ce(),g=r(c),x=v(r(g));l(g);var p=v(g,2),m=v(r(p));l(p);var u=v(p,2),F=v(r(u));P(()=>k(F,` ${N(n().exp)??""}`)),l(u);var o=v(u,2),S=v(r(o));P(()=>k(S,` ${N(n().last_seen)??""}`)),l(o);var U=v(o,2),T=v(r(U));l(U);var L=v(U,2),q=v(r(L));l(L);var M=v(L,2),R=v(r(M),2);Ie(R,{get check(){return n().is_mfa}}),l(M),l(c),P(()=>{k(x,` ${n().id??""}`),k(m,` ${n().user_id??""}`),k(T,` ${n().state??""}`),k(q,` ${n().remote_ip??""}`)}),b(w,c)},$$slots:{header:!0,body:!0}}),l(h),P(()=>xe(h,"expired",n().exp<y())),b(B,h),K()}var ye=_('<div class="svelte-1rjd8yh"><!></div>'),De=_('<div class="svelte-1rjd8yh"><!></div>'),Le=_('<div class="content"><div class="row svelte-1rjd8yh"><!> <div class="button svelte-1rjd8yh"><!></div></div> <div id="sessions" class="svelte-1rjd8yh"><!></div> <!></div>');function je(B,O){J(O,!0);let n=$(""),y=$(d([])),h=$(d([])),D=$(d([])),w=$(Date.now()/1e3),c=$(""),g=$(!1),x=$(15),p=$(""),m=$(1),u=[{label:"User ID",callback:(e,s)=>{var i;return(i=e.user_id)==null?void 0:i.toLowerCase().includes(s.toLowerCase())}},{label:"Session ID",callback:(e,s)=>e.id.toLowerCase().includes(s.toLowerCase())},{label:"IP",callback:(e,s)=>{var i;return(i=e.remote_ip)==null?void 0:i.toLowerCase().includes(s.toLowerCase())}}],F=[{label:"Expires",callback:(e,s)=>e.exp-s.exp},{label:"Last Seen",callback:(e,s)=>e.last_seen-s.last_seen},{label:"Session ID",callback:(e,s)=>e.id.localeCompare(s.id)},{label:"User ID",callback:(e,s)=>{var i;return(i=e.user_id)==null?void 0:i.localeCompare(s.user_id)}},{label:"State",callback:(e,s)=>e.state.localeCompare(s.state)},{label:"IP",callback:(e,s)=>{var i;return(i=e.remote_ip)==null?void 0:i.localeCompare(s.remote_ip)}}];oe(()=>{o()});async function o(e,s,i,I){let f;if(e===!0?i&&a(m)===2?f=await Z(I||a(x),s,void 0,!1):f=await Z(I||a(x),s,a(p),i):f=await pe(),!f.ok)t(n,"Error fetching sessions: "+f.body.message);else{f.status===206?(t(x,d(Number.parseInt(f.headers.get("x-page-size"),10))),t(p,d(f.headers.get("x-continuation-token"))),t(c,"session")):t(c,"");let C=await f.json();t(y,d([...C])),t(h,d([...C])),t(w,Date.now()/1e3)}}async function S(e,s){await o(!0,e,s),s?t(m,a(m)-1):t(m,a(m)+1)}async function U(e){t(p,""),await o(!0,0,!1,e),t(m,1)}async function T(){let e=await me();if(e.ok)be();else{let s=await e.json();t(n,d(s.message))}t(w,d(new Date))}var L=Le(),q=r(L),M=r(q);ue(M,{get items(){return a(y)},searchOptions:u,orderOptions:F,firstDirReverse:!0,get resItems(){return a(h)},set resItems(e){t(h,d(e))},get useServerSideIdx(){return a(c)},set useServerSideIdx(e){t(c,d(e))},get isSearchFiltered(){return a(g)},set isSearchFiltered(e){t(g,d(e))}});var R=v(M,2);ce(R,"margin-top","-10px");var se=r(R);he(se,{level:3,$$events:{click:T},children:(e,s)=>{ve();var i=ne("Invalidate All Sessions");b(e,i)},$$slots:{default:!0}}),l(R),l(q);var H=v(q),z=v(H),ae=r(z);{var te=e=>{var s=Y(),i=Q(s);X(i,19,()=>a(y),I=>I.id,(I,f,C)=>{var j=ye(),G=r(j);ee(G,{get session(){return a(y)[a(C)]},set session(E){a(y)[a(C)]=E},get now(){return a(w)},set now(E){t(w,d(E))}}),l(j),b(I,j)}),b(e,s)},ie=e=>{var s=Y(),i=Q(s);X(i,19,()=>a(D),I=>I.id,(I,f,C)=>{var j=De(),G=r(j);ee(G,{get session(){return a(D)[a(C)]},set session(E){a(D)[a(C)]=E},get now(){return a(w)},set now(E){t(w,d(E))}}),l(j),b(I,j)}),b(e,s)};V(ae,e=>{a(c)&&!a(g)?e(te):e(ie,!1)})}l(z);var re=v(z,2);{var le=e=>{we(e,{fetchPageCallback:S,sspPageSizeChange:U,get sspPage(){return a(m)},set sspPage(s){t(m,d(s))},get sspPageSize(){return a(x)},set sspPageSize(s){t(x,d(s))},get sspContinuationToken(){return a(p)},set sspContinuationToken(s){t(p,d(s))}})},de=e=>{fe(e,{get items(){return a(h)},set items(s){t(h,d(s))},get resItems(){return a(D)},set resItems(s){t(D,d(s))}})};V(re,e=>{a(c)&&!a(g)?e(le):e(de,!1)})}l(L),P(()=>k(H,` ${a(n)??""} `)),b(B,L),K()}function Ee(B){je(B,{})}export{Ee as component};
