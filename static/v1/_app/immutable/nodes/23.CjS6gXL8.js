import"../chunks/disclose-version.BDr9Qe-U.js";import{p as we,ap as Le,f as T,a as ye,z as a,t as l,aq as Se,y as e,s as o,A as f,c as s,r as t,ar as U,ab as ce}from"../chunks/index-client.Di99sPv0.js";import{s as d}from"../chunks/render.Cjc4CIr8.js";import{i as O}from"../chunks/if.DgeUjMU2.js";import{e as Ae,i as Te}from"../chunks/each.DxtmCefA.js";import{a as i,t as $,d as X,e as le}from"../chunks/template.BEKX6jgL.js";import{h as ke}from"../chunks/svelte-head.B7nS6fh6.js";import{p as n}from"../chunks/proxy.BQ2dmY0t.js";import{r as ne,n as Ce}from"../chunks/helpers.D3KrX4pz.js";import{L as De}from"../chunks/LangSelector.CCDP_eNQ.js";import{I as Ee}from"../chunks/Input.-lhBsjDF.js";import{B as Y}from"../chunks/Button.D-14suAe.js";import{f as Pe}from"../chunks/pow.BIzAC1fj.js";import{M as qe}from"../chunks/Main.DKi4VjsM.js";import{C as Re}from"../chunks/ContentCenter.BgFVBEpa.js";import{u as We}from"../chunks/i18n.svelte.Bc6aINkd.js";import{T as je}from"../chunks/Template.DiUnptz0.js";import{u as Be}from"../chunks/param.svelte.B2CvjQ2c.js";import{T as Me}from"../chunks/ThemeSwitch._9IF3ElF.js";import{f as Ne,b as Oe}from"../chunks/fetch.DxJS_Pk_.js";import{P as _e}from"../chunks/patterns.BDQXnG3O.js";var Fe=$('<div class="desc svelte-hzde4x"> </div> <!> <div><!></div>',1),Ge=$('<div class="desc svelte-hzde4x"><p> </p> <p> </p></div>'),He=$('<div class="desc svelte-hzde4x"><p class="declined svelte-hzde4x"> </p> <p> </p></div>'),Ie=$('<li class="svelte-hzde4x"> </li>'),Je=$('<div class="desc svelte-hzde4x"> <ul class="svelte-hzde4x"></ul></div> <div class="inline svelte-hzde4x"><!> <!></div>',1),Ke=$('<div class="container svelte-hzde4x"><div class="name svelte-hzde4x"><h2> </h2></div> <!> <div class="err svelte-hzde4x"> </div></div>'),Ve=$("<!> <!> <!>",1),Qe=$("<!> <!>",1);function Ue(me,pe){we(pe,!0);let r=We(),Z=f(void 0),b=f(""),_=f(!1),k=f(!1),w=f(8),F=f(void 0),ee=f(!1),re=f(!1),y=f("");Le(async()=>{let v=Be("code").get()||"";a(y,n(v));let S=await Ne("/auth/v1/oidc/sessioninfo");S.body?a(Z,n(S.body)):v?ne(`device?code=${v}`):ne("device")});async function G(v){var C,D,j;if(a(b,""),e(_))return;if(e(y).length<e(w)){a(b,n(r.common.errTooShort));return}if(e(y).length>e(w)){a(b,n(r.common.errTooLong));return}a(k,!0);let S=await Pe();if(!S){a(b,"PoW error - please contact your administrator");return}let H={user_code:e(y),pow:S,device_accepted:v},h=await Oe("/auth/v1/oidc/device/verify",H);h.status===200?a(F,n(((D=(C=h.body)==null?void 0:C.scopes)==null?void 0:D.split(" "))||["openid"])):h.status===202?(a(ee,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3)):h.status===204?a(re,!0):h.status===404?a(b,n(r.device.wrongOrExpired)):(console.error(h),a(b,n((j=h.error)==null?void 0:j.message))),a(k,!1)}var ae=Qe();ke(v=>{l(()=>Se.title=(r==null?void 0:r.device.title)||"Device Authorization")});var te=T(ae);je(te,{id:Ce,get value(){return e(w)},set value(v){a(w,n(v))}});var ue=o(te,2);qe(ue,{children:(v,S)=>{Re(v,{children:(H,h)=>{var C=Ve(),D=T(C);{var j=I=>{var J=Ke(),K=s(J),ie=s(K),he=s(ie,!0);t(ie),t(K);var oe=o(K,2);{var ge=A=>{var E=Fe(),P=T(E),V=s(P,!0);l(()=>d(V,r.device.desc.replace("{{count}}",e(w).toString()))),t(P);var B=o(P,2),g=ce(()=>e(w).toString()),x=ce(()=>e(w).toString());Ee(B,{name:"userCode",autocomplete:"off",get label(){return r.device.userCode},get placeholder(){return r.device.userCode},required:!0,get min(){return e(g)},get max(){return e(x)},pattern:_e,get value(){return e(y)},set value(c){a(y,n(c))},get isError(){return e(_)},set isError(c){a(_,n(c))}});var z=o(B,2),q=s(z);Y(q,{onclick:()=>G("pending"),get isLoading(){return e(k)},children:(c,m)=>{U();var p=X();l(()=>d(p,r.device.submit)),i(c,p)},$$slots:{default:!0}}),t(z),i(A,E)},xe=A=>{var E=le(),P=T(E);{var V=g=>{var x=Ge(),z=s(x),q=s(z,!0);t(z);var c=o(z,2),m=s(c,!0);t(c),t(x),l(()=>{d(q,r.device.isAccepted),d(m,r.device.autoRedirectAccount)}),i(g,x)},B=g=>{var x=le(),z=T(x);{var q=m=>{var p=He(),L=s(p),M=s(L,!0);t(L);var R=o(L,2),N=s(R,!0);t(R),t(p),l(()=>{d(M,r.device.isDeclined),d(N,r.device.closeWindow)}),i(m,p)},c=m=>{var p=Je(),L=T(p),M=s(L),R=o(M);Ae(R,21,()=>e(F),Te,(W,Q)=>{var u=Ie(),be=s(u,!0);t(u),l(()=>d(be,e(Q))),i(W,u)}),t(R),t(L);var N=o(L,2),ve=s(N);Y(ve,{onclick:()=>G("accept"),get isLoading(){return e(k)},children:(W,Q)=>{U();var u=X();l(()=>d(u,r.device.accept)),i(W,u)},$$slots:{default:!0}});var $e=o(ve,2);Y($e,{level:-1,onclick:()=>G("decline"),get isLoading(){return e(k)},children:(W,Q)=>{U();var u=X();l(()=>d(u,r.device.decline)),i(W,u)},$$slots:{default:!0}}),t(N),l(()=>d(M,`${r.device.descScopes??""} `)),i(m,p)};O(z,m=>{e(re)?m(q):m(c,!1)},!0)}i(g,x)};O(P,g=>{e(ee)?g(V):g(B,!1)},!0)}i(A,E)};O(oe,A=>{e(F)===void 0?A(ge):A(xe,!1)})}var de=o(oe,2),ze=s(de,!0);t(de),t(J),l(()=>{d(he,r.device.title),d(ze,e(b))}),i(I,J)};O(D,I=>{e(Z)&&I(j)})}var se=o(D,2);Me(se,{absolute:!0});var fe=o(se,2);De(fe,{absolute:!0}),i(H,C)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(me,ae),ye()}export{Ue as component};
