import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DJEB66nf.js";import{p as ke,s as a,c as s,r as l,t as $,a as we,A as z,a6 as Fe,y as e,f as Q,ar as S,z as v,ab as ie,ap as It,a0 as Ot}from"../chunks/index-client.Di99sPv0.js";import{s as p}from"../chunks/render.Cjc4CIr8.js";import{i as q}from"../chunks/if.DgeUjMU2.js";import{e as Et}from"../chunks/each.DxtmCefA.js";import{a as n,t as I,d as D,e as Ze}from"../chunks/template.BEKX6jgL.js";import{s as Qe}from"../chunks/class.BCapn1bP.js";import{a as dt,t as He,s as Je}from"../chunks/index.BnJsthXQ.js";import{p as g}from"../chunks/proxy.BQ2dmY0t.js";import{d as Kt,f as Yt,c as Vt,b as vt}from"../chunks/fetch.DxJS_Pk_.js";import{C as Xt}from"../chunks/ContentAdmin.BWiTVMIY.js";import{N as Zt}from"../chunks/NavSub.D01RyWn2.js";import{u as Qt}from"../chunks/param.svelte.Bg3Frte-.js";import{N as Ht}from"../chunks/NavButtonTile.BjzIPqLk.js";import{B as Jt}from"../chunks/ButtonAddModal.DLvLHw-v.js";import{p as pt}from"../chunks/props.ClgLgKUv.js";import{k as Wt}from"../chunks/key.DB5VoPJt.js";import{h as Ce}from"../chunks/html.CddWxNhc.js";import{B as Ge}from"../chunks/Button.D-14suAe.js";import{I as L}from"../chunks/Input.-lhBsjDF.js";import{i as er}from"../chunks/lifecycle.Dyk2thb5.js";import{u as Ae}from"../chunks/i18n_admin.svelte.DI6l2V4l.js";import{g as tr}from"../chunks/helpers.mrWtKrwW.js";import{I as yt}from"../chunks/IconCheck.K_67dytm.js";import{I as ut}from"../chunks/InputArea.DX3kGdfA.js";import{I as Tt}from"../chunks/InputPassword.Bl28d8lQ.js";import{F as At}from"../chunks/Form.C0Yvca1O.js";import{u as _t}from"../chunks/i18n.svelte.Bc6aINkd.js";import{L as mt}from"../chunks/LabeledValue.D0BXhgF2.js";import{I as te}from"../chunks/InputCheckbox.BTJtACoe.js";import{g as F,h as Lt,c as Mt,i as ft}from"../chunks/patterns.BDQXnG3O.js";import{I as rr}from"../chunks/InputFile.D28REYhm.js";import{a as Pt}from"../chunks/helpers.D3KrX4pz.js";import{E as ar}from"../chunks/Expandable.BetfjEnN.js";import{T as ir}from"../chunks/Tabs.CTmGp6-A.js";import"../chunks/Switch.Dr6mVgDt.js";import{C as Nt}from"../chunks/CheckIcon.CxdBm3CC.js";import{O as or}from"../chunks/Options.DtWx0xTK.js";var sr=I('<div class="desc svelte-6fcb3i"><h4 class="svelte-6fcb3i">ID token claim mappings</h4> <p class="svelte-6fcb3i"> </p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p></div>');function qt(K,U){ke(U,!1);let t=Ae();er();var c=sr(),o=a(s(c),2),h=s(o,!0);l(o);var k=a(o,2),f=s(k);Ce(f,()=>t.providers.config.jsonPath.p2),l(k);var M=a(k,2),P=s(M);Ce(P,()=>t.providers.config.jsonPath.p3),l(M);var b=a(M,2),r=s(b);Ce(r,()=>t.providers.config.jsonPath.p4),l(b);var B=a(b,2),u=s(B);Ce(u,()=>t.providers.config.jsonPath.p5),l(B);var A=a(B,2),_=s(A);Ce(_,()=>t.providers.config.jsonPath.p6),l(A),l(c),$(()=>p(h,t.providers.config.jsonPath.p1)),n(K,c),we()}var lr=I('<img alt="No Logo Available">');function nr(K,U){ke(U,!0);var t=lr();$(()=>Qe(t,"src",`/auth/v1/providers/${U.providerId}/img?${tr(6)}`)),Qe(t,"width",20),Qe(t,"height",20),n(K,t),we()}var cr=I("<div><!></div>"),dr=I('<div class="checkbox svelte-iec8od"><!></div>'),vr=I('<div class="err"> </div>'),pr=I('<div class="svelte-iec8od"><!></div>'),ur=I('<span class="err"> </span>'),_r=I('<!> <div></div> <div class="checkbox svelte-iec8od"><!></div> <div class="checkbox svelte-iec8od"><!></div> <!> <!> <!> <!> <!> <div class="checkbox svelte-iec8od"><!></div> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p><!></p> <div class="checkbox svelte-iec8od"><!></div> <div class="checkbox svelte-iec8od"><!></div> <!> <!> <p class="desc svelte-iec8od"> </p> <!> <!> <p class="desc svelte-iec8od"> </p> <!> <!> <div class="logo svelte-iec8od"><!> <!></div> <div class="flex gap-05"><!> <!> <!></div>',1),mr=I('<div class="container svelte-iec8od"><!></div>');function fr(K,U){ke(U,!0);let t=pt(U,"provider",15),c=_t(),o=Ae();const h="min(calc(100dvw - .5rem), 30rem)";let k=!1,f=z(""),M=z(!1),P=z(!!t().root_pem),b=z(g(Pt()));Fe(()=>{t().id&&(t(t().client_secret=t().client_secret||"",!0),t(t().admin_claim_path=t().admin_claim_path||"",!0),t(t().admin_claim_value=t().admin_claim_value||"",!0),t(t().mfa_claim_path=t().mfa_claim_path||"",!0),t(t().mfa_claim_value=t().mfa_claim_value||"",!0),t(t().root_pem=t().root_pem||"",!0))}),Fe(()=>{t().scope&&t(t().scope=t().scope.replaceAll("+"," "),!0)});async function r(_,y){if(v(f,""),t().client_secret&&!(t().client_secret_basic||t().client_secret_post)){v(f,g(o.providers.config.errNoAuthMethod));return}if(!t().use_pkce&&!t().client_secret){v(f,g(o.providers.config.errConfidential));return}let E={name:t().name,typ:t().typ,enabled:t().enabled,issuer:t().issuer,authorization_endpoint:t().authorization_endpoint,token_endpoint:t().token_endpoint,userinfo_endpoint:t().userinfo_endpoint,danger_allow_insecure:e(P)&&t().root_pem?!1:t().danger_allow_insecure,use_pkce:t().use_pkce,client_secret_basic:t().client_secret_basic,client_secret_post:t().client_secret_post,client_id:t().client_id,client_secret:t().client_secret||void 0,scope:t().scope.trim(),root_pem:e(P)&&t().root_pem?t().root_pem.trim():void 0,admin_claim_path:t().admin_claim_path||void 0,admin_claim_value:t().admin_claim_value||void 0,mfa_claim_path:t().mfa_claim_path||void 0,mfa_claim_value:t().mfa_claim_value||void 0},N=await Kt(_.action,E);N.error?v(f,g(N.error.message)):(v(M,!0),U.onSave(),setTimeout(()=>{v(M,!1)},3e3))}var B=mr(),u=s(B),A=ie(()=>`/auth/v1/providers/${t().id}`);At(u,{get action(){return e(A)},onSubmit:r,children:(_,y)=>{var E=_r(),N=Q(E);mt(N,{label:"ID",mono:!0,children:(i,w)=>{S();var C=D();$(()=>p(C,t().id)),n(i,C)},$$slots:{default:!0}});var H=a(N,2);dt(H,"height",".15rem");var Y=a(H,2),V=s(Y);te(V,{get ariaLabel(){return o.common.enabled},get checked(){return t().enabled},set checked(i){t(t().enabled=i,!0)},children:(i,w)=>{S();var C=D();$(()=>p(C,o.common.enabled)),n(i,C)},$$slots:{default:!0}}),l(Y);var x=a(Y,2),oe=s(x);te(oe,{get ariaLabel(){return o.providers.config.custRootCa},get checked(){return e(P)},set checked(i){v(P,g(i))},children:(i,w)=>{S();var C=D();$(()=>p(C,o.providers.config.custRootCa)),n(i,C)},$$slots:{default:!0}}),l(x);var pe=a(x,2);{var de=i=>{var w=cr(),C=s(w);ut(C,{rows:15,name:"rootPem",get label(){return o.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
 -----END CERTIFICATE-----`,errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - .5rem))",fontMono:!0,pattern:ft,get value(){return t().root_pem},set value(ne){t(t().root_pem=ne,!0)}}),l(w),He(3,w,()=>Je,()=>({duration:150})),n(i,w)},$e=i=>{var w=dr(),C=s(w);te(C,{get ariaLabel(){return o.providers.config.allowInsecureTls},get checked(){return t().danger_allow_insecure},set checked(ne){t(t().danger_allow_insecure=ne,!0)},children:(ne,ht)=>{S();var Se=D();$(()=>p(Se,o.providers.config.allowInsecureTls)),n(ne,Se)},$$slots:{default:!0}}),l(w),n(i,w)};q(pe,i=>{e(P)?i(de):i($e,!1)})}var ue=a(pe,2);L(ue,{autocomplete:"off",label:"Issuer URL",placeholder:"Issuer URL",required:!0,pattern:F,width:h,get value(){return t().issuer},set value(i){t(t().issuer=i,!0)}});var O=a(ue,2);L(O,{typ:"url",autocomplete:"off",label:"Authorization Endpoint",placeholder:"Authorization Endpoint",required:!0,pattern:F,width:h,get value(){return t().authorization_endpoint},set value(i){t(t().authorization_endpoint=i,!0)}});var R=a(O,2);L(R,{typ:"url",autocomplete:"off",label:"Token Endpoint",placeholder:"Token Endpoint",required:!0,pattern:F,width:h,get value(){return t().token_endpoint},set value(i){t(t().token_endpoint=i,!0)}});var X=a(R,2);L(X,{typ:"url",autocomplete:"off",label:"Userinfo Endpoint",placeholder:"Userinfo Endpoint",required:!0,pattern:F,width:h,get value(){return t().userinfo_endpoint},set value(i){t(t().userinfo_endpoint=i,!0)}});var m=a(X,2),_e=s(m);te(_e,{ariaLabel:"PKCE",get checked(){return t().use_pkce},set checked(i){t(t().use_pkce=i,!0)},children:(i,w)=>{S();var C=D("PKCE");n(i,C)},$$slots:{default:!0}}),l(m);var le=a(m,2),me=s(le,!0);l(le);var fe=a(le,2);L(fe,{autocomplete:"off",label:"Scope",placeholder:"openid profile email",required:!0,pattern:Lt,width:h,get value(){return t().scope},set value(i){t(t().scope=i,!0)}});var he=a(fe,2),je=s(he,!0);l(he);var Le=a(he,2);L(Le,{autocomplete:"off",get label(){return o.providers.config.clientName},get placeholder(){return o.providers.config.clientName},required:!0,pattern:Mt,width:h,get value(){return t().name},set value(i){t(t().name=i,!0)}});var Ie=a(Le,2),We=s(Ie,!0);l(Ie);var Me=a(Ie,2);L(Me,{autocomplete:"off",label:"Client ID",placeholder:"Client ID",required:!0,pattern:F,width:h,get value(){return t().client_id},set value(i){t(t().client_id=i,!0)}});var Pe=a(Me,2),et=s(Pe,!0);l(Pe);var Be=a(Pe,2),T=ie(()=>!t().use_pkce);Tt(Be,{autocomplete:"off",label:"Client Secret",placeholder:"Client Secret",maxLength:256,get errMsg(){return o.providers.config.errConfidential},get required(){return e(T)},width:h,get value(){return t().client_secret},set value(i){t(t().client_secret=i,!0)}});var G=a(Be,2),J=s(G);Ce(J,()=>o.providers.config.descAuthMethod),l(G);var se=a(G,2),Ne=s(se);te(Ne,{ariaLabel:"client_secret_basic",get checked(){return t().client_secret_basic},set checked(i){t(t().client_secret_basic=i,!0)},children:(i,w)=>{S();var C=D("client_secret_basic");n(i,C)},$$slots:{default:!0}}),l(se);var re=a(se,2),ve=s(re);te(ve,{ariaLabel:"client_secret_post",get checked(){return t().client_secret_post},set checked(i){t(t().client_secret_post=i,!0)},children:(i,w)=>{S();var C=D("client_secret_post");n(i,C)},$$slots:{default:!0}}),l(re);var Z=a(re,2);{var W=i=>{var w=vr(),C=s(w,!0);l(w),$(()=>p(C,o.providers.config.errNoAuthMethod)),He(3,w,()=>Je,()=>({duration:150})),n(i,w)};q(Z,i=>{!t().use_pkce&&!t().client_secret_basic&&!t().client_secret_post&&i(W)})}var ee=a(Z,2);qt(ee,{});var ae=a(ee,2),qe=s(ae,!0);l(ae);var ge=a(ae,2);L(ge,{autocomplete:"off",get label(){return o.providers.config.pathAdminClaim},placeholder:"$.roles.*",pattern:F,width:h,get value(){return t().admin_claim_path},set value(i){t(t().admin_claim_path=i,!0)}});var Oe=a(ge,2);L(Oe,{autocomplete:"off",get label(){return o.providers.config.valueAdminClaim},placeholder:"rauthy_admin",pattern:F,width:h,get value(){return t().admin_claim_value},set value(i){t(t().admin_claim_value=i,!0)}});var Ee=a(Oe,2),Ke=s(Ee,!0);l(Ee);var Ue=a(Ee,2);L(Ue,{autocomplete:"off",get label(){return o.providers.config.pathMfaClaim},placeholder:"$.amr.*",pattern:F,width:h,get value(){return t().mfa_claim_path},set value(i){t(t().mfa_claim_path=i,!0)}});var Re=a(Ue,2);L(Re,{autocomplete:"off",get label(){return o.providers.config.valueMfaClaim},placeholder:"mfa",pattern:F,width:h,get value(){return t().mfa_claim_value},set value(i){t(t().mfa_claim_value=i,!0)}});var be=a(Re,2),Ye=s(be);Wt(Ye,()=>e(b),i=>{var w=pr(),C=s(w);nr(C,{get providerId(){return t().id}}),l(w),n(i,w)});var tt=a(Ye,2),rt=ie(()=>`/auth/v1/providers/${t().id}/img`);rr(tt,{method:"PUT",get url(){return e(rt)},fileName:"logo",onSuccess:()=>v(b,g(Pt()))}),l(be);var ye=a(be,2),Ve=s(ye);Ge(Ve,{type:"submit",get isLoading(){return k},children:(i,w)=>{S();var C=D();$(()=>p(C,c.common.save)),n(i,C)},$$slots:{default:!0}});var ze=a(Ve,2);{var xe=i=>{yt(i,{})};q(ze,i=>{e(M)&&i(xe)})}var at=a(ze,2);{var Xe=i=>{var w=ur(),C=s(w,!0);l(w),$(()=>p(C,e(f))),n(i,w)};q(at,i=>{e(f)&&i(Xe)})}l(ye),$(()=>{p(me,o.providers.config.descScope),p(je,o.providers.config.descClientName),p(We,o.providers.config.descClientId),p(et,o.providers.config.descClientSecret),p(qe,o.providers.config.mapUser),p(Ke,o.providers.config.mapMfa)}),n(_,E)},$$slots:{default:!0}}),l(B),n(K,B),we()}var hr=I('<div class="user svelte-1vu6qeb"> <span class="muted font-mono svelte-1vu6qeb"> </span></div>'),gr=I('<div class="forceDelete svelte-1vu6qeb"> </div>'),br=I('<p class="err"><b> </b></p> <p> </p> <!> <p> </p> <!> <!>',1),kr=I("<p> </p> <!>",1),wr=I('<div class="err"> </div>'),Cr=I('<div class="container svelte-1vu6qeb"><!> <!></div>');function $r(K,U){ke(U,!0);let t=_t(),c=Ae(),o=z(!0),h=z(""),k=z(!1),f=z(g([]));It(async()=>{let _=await Yt(`/auth/v1/providers/${U.provider.id}/delete_safe`);_.status===406&&_.error&&v(f,g(_.error)),v(o,!1)});async function M(){v(h,""),v(o,!0);let _=await Vt(`/auth/v1/providers/${U.provider.id}`);_.error?v(h,g(_.error.message)):U.onSave(),v(o,!1)}var P=Cr(),b=s(P);{var r=_=>{var y=br(),E=Q(y),N=s(E),H=s(N,!0);l(N),l(E);var Y=a(E,2),V=s(Y,!0);l(Y);var x=a(Y,2);ar(x,{summary:O=>{S();var R=D();$(()=>p(R,c.providers.delete.linkedUsers)),n(O,R)},details:O=>{var R=Ze(),X=Q(R);Et(X,17,()=>e(f),m=>m.id,(m,_e)=>{var le=hr(),me=s(le),fe=a(me),he=s(fe);l(fe),l(le),$(()=>{p(me,`${e(_e).email??""} `),p(he,`/ ${e(_e).id??""}`)}),n(m,le)}),n(O,R)},$$slots:{summary:!0,details:!0}});var oe=a(x,2),pe=s(oe,!0);l(oe);var de=a(oe,2);te(de,{get ariaLabel(){return c.providers.delete.forceDelete},get checked(){return e(k)},set checked(O){v(k,g(O))},children:(O,R)=>{var X=gr(),m=s(X,!0);l(X),$(()=>p(m,c.providers.delete.forceDelete)),n(O,X)},$$slots:{default:!0}});var $e=a(de,2);{var ue=O=>{Ge(O,{level:-1,onclick:M,get isLoading(){return e(o)},children:(R,X)=>{S();var m=D();$(()=>p(m,t.common.delete)),n(R,m)},$$slots:{default:!0}})};q($e,O=>{e(k)&&O(ue)})}$(()=>{p(H,c.providers.delete.isInUse1),p(V,c.providers.delete.isInUse2),p(pe,c.providers.delete.areYouSure)}),n(_,y)},B=_=>{var y=kr(),E=Q(y),N=s(E,!0);l(E);var H=a(E,2);Ge(H,{level:-1,onclick:M,get isLoading(){return e(o)},children:(Y,V)=>{S();var x=D();$(()=>p(x,t.common.delete)),n(Y,x)},$$slots:{default:!0}}),$(()=>p(N,c.providers.delete.areYouSure)),n(_,y)};q(b,_=>{e(f).length>0?_(r):_(B,!1)})}var u=a(b,2);{var A=_=>{var y=wr(),E=s(y,!0);l(y),$(()=>p(E,e(h))),n(_,y)};q(u,_=>{e(h)&&_(A)})}l(P),n(K,P),we()}var Ir=I('<div class="flex"><!></div> <!>',1);function Er(K,U){ke(U,!0);let t=pt(U,"provider",15),c=pt(U,"onSave",15),o=Ae();const h=[o.tabs.config,o.tabs.delete];let k=z(g(h[0]));var f=Ir(),M=Q(f),P=s(M);ir(P,{tabs:h,get selected(){return e(k)},set selected(u){v(k,g(u))}}),l(M);var b=a(M,2);{var r=u=>{fr(u,{get provider(){return t()},set provider(A){t(A)},get onSave(){return c()},set onSave(A){c(A)}})},B=u=>{var A=Ze(),_=Q(A);{var y=E=>{$r(E,{get provider(){return t()},get onSave(){return c()},set onSave(N){c(N)}})};q(_,E=>{e(k)===o.tabs.delete&&E(y)},!0)}n(u,A)};q(b,u=>{e(k)===o.tabs.config?u(r):u(B,!1)})}n(K,f),we()}var yr=I("<div><!></div>"),Tr=I('<div class="checkbox svelte-f8e9ia"><!></div>'),Ar=I('<div class="checkbox svelte-f8e9ia"><!></div> <!>',1),Lr=I('<div class="ml mb"><!></div>'),Mr=I('<div class="err"> </div>'),Pr=I('<!> <!> <!> <!> <!> <div class="checkbox svelte-f8e9ia"><!></div> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p><!></p> <div class="checkbox svelte-f8e9ia"><!></div> <div class="checkbox svelte-f8e9ia"><!></div> <!> <!> <p class="desc svelte-f8e9ia"> </p> <!> <!> <p class="desc svelte-f8e9ia"> </p> <!> <!>',1),Nr=I('<div class="err"> </div>'),qr=I('<!> <!> <div class="flex gap-05"><!> <!> <!> <!></div>',1),Ur=I('<div class="container svelte-f8e9ia"><!> <div></div> <!></div>');function Rr(K,U){ke(U,!0);let t=_t(),c=Ae();const o="min(calc(100dvw - 1.75rem), 30rem)";let h=z(!1),k=z(""),f=z(!1),M=z(!1),P=z(!1),b=z(g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),r=z(g({enabled:!0,typ:"oidc",issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",token_auth_method_basic:!1,userinfo_endpoint:"",use_pkce:!0,client_secret_basic:!0,client_secret_post:!1,name:"",client_id:"",client_secret:"",scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""})),B=["OIDC","Auto","Custom","Github","Google"],u=z(g(B[0])),A=ie(()=>e(u)==="Auto"),_=ie(()=>e(u)==="Custom"),y=ie(()=>e(u)==="OIDC"),E=ie(()=>!e(A)&&!e(_)&&!e(y)),N=ie(()=>!(e(E)||e(_)||e(f)));const H="/auth/v1/providers/lookup";let Y=ie(()=>e(N)?H:"/auth/v1/providers/create");Fe(()=>{if(e(u))switch(v(f,!1),v(b,g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),e(u)){case"Github":v(r,g({enabled:!0,issuer:"github.com",typ:"github",danger_allow_insecure:!1,authorization_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",client_secret_basic:!0,client_secret_post:!0,userinfo_endpoint:"https://api.github.com/user",use_pkce:!1,name:"Github",client_id:"",client_secret:"",scope:"user:email",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"$.two_factor_authentication",mfa_claim_value:"true"}));break;case"Google":v(b,g({issuer:"accounts.google.com",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),Ot(()=>{oe(H)});break;default:v(r,g({enabled:!0,issuer:"",typ:"oidc",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",client_secret_basic:!0,client_secret_post:!1,userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret:"",scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""}))}}),Fe(()=>{e(M)&&setTimeout(()=>{U.onSave(),pe()},1500)});async function V(R,X){e(N)?await oe(R.action):await x(R.action)}async function x(R){if(e(r).client_secret&&!(e(r).client_secret_basic||e(r).client_secret_post)){v(k,g(c.providers.config.errNoAuthMethod));return}if(!e(r).use_pkce&&!e(r).client_secret){v(k,g(c.providers.config.errConfidential));return}v(k,""),v(h,!0);let X={name:e(r).name,typ:e(A)?"custom":e(u).toLowerCase(),enabled:e(r).enabled,issuer:e(r).issuer,authorization_endpoint:e(r).authorization_endpoint,token_endpoint:e(r).token_endpoint,userinfo_endpoint:e(r).userinfo_endpoint,danger_allow_insecure:e(P)&&e(r).root_pem?!1:e(r).danger_allow_insecure,use_pkce:e(r).use_pkce,client_secret_basic:e(r).client_secret_basic,client_secret_post:e(r).client_secret_post,client_id:e(r).client_id,client_secret:e(r).client_secret,scope:e(r).scope.trim(),root_pem:e(P)&&e(r).root_pem?e(r).root_pem.trim():void 0,admin_claim_path:e(r).admin_claim_path||void 0,admin_claim_value:e(r).admin_claim_value||void 0,mfa_claim_path:e(r).mfa_claim_path||void 0,mfa_claim_value:e(r).mfa_claim_value||void 0},m=await vt(R,X);m.error?m.error.message.includes("InvalidCertificate")?v(k,"Insecure connection not allowed"):v(k,g(m.error.message)):v(M,!0),v(h,!1)}async function oe(R){if(!e(b).issuer&&!e(b).metadata_url){v(k,"Provide at least one of Issuer / Metadata URL");return}v(k,""),v(h,!0);let X={issuer:e(b).issuer||void 0,metadata_url:e(b).metadata_url||void 0,danger_allow_insecure:e(b).danger_allow_insecure,root_pem:e(b).root_pem||void 0},m=await vt(R,X);m.body?(e(r).issuer=m.body.issuer,e(r).authorization_endpoint=m.body.authorization_endpoint,e(r).danger_allow_insecure=m.body.danger_allow_insecure,e(r).token_endpoint=m.body.token_endpoint,e(r).userinfo_endpoint=m.body.userinfo_endpoint,e(r).client_secret_basic=m.body.client_secret_basic,e(r).client_secret_post=m.body.client_secret_post,e(r).use_pkce=m.body.use_pkce,e(r).client_secret_basic=m.body.client_secret_basic,e(r).client_secret_post=!m.body.client_secret_basic&&m.body.client_secret_post,e(r).scope=m.body.scope,e(r).root_pem=m.body.root_pem,v(f,!0)):m.error&&(m.error.message.includes("InvalidCertificate")?v(k,"Insecure connection not allowed"):v(k,g(m.error.message))),v(h,!1)}function pe(){v(b,g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),v(r,g({enabled:!0,issuer:"",typ:"oidc",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret_basic:!0,client_secret_post:!1,scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""})),v(M,!1),v(f,!1),v(P,!1)}var de=Ur(),$e=s(de);or($e,{ariaLabel:"Select Mode",options:B,get value(){return e(u)},set value(R){v(u,g(R))}});var ue=a($e,2);dt(ue,"height",".5rem");var O=a(ue,2);At(O,{get action(){return e(Y)},onSubmit:V,children:(R,X)=>{var m=qr(),_e=Q(m);{var le=T=>{var G=Ar(),J=Q(G),se=s(J);te(se,{get ariaLabel(){return c.providers.config.custRootCa},get checked(){return e(P)},set checked(Z){v(P,g(Z))},children:(Z,W)=>{S();var ee=D();$(()=>p(ee,c.providers.config.custRootCa)),n(Z,ee)},$$slots:{default:!0}}),l(J);var Ne=a(J,2);{var re=Z=>{var W=yr(),ee=s(W);ut(ee,{rows:15,name:"rootPem",get label(){return c.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - 1.75rem))",fontMono:!0,pattern:ft,get value(){return e(b).root_pem},set value(ae){e(b).root_pem=ae}}),l(W),He(3,W,()=>Je,()=>({duration:150})),n(Z,W)},ve=Z=>{var W=Tr(),ee=s(W);te(ee,{get ariaLabel(){return c.providers.config.allowInsecureTls},get checked(){return e(b).danger_allow_insecure},set checked(ae){e(b).danger_allow_insecure=ae},children:(ae,qe)=>{S();var ge=D();$(()=>p(ge,c.providers.config.allowInsecureTls)),n(ae,ge)},$$slots:{default:!0}}),l(W),n(Z,W)};q(Ne,Z=>{e(P)?Z(re):Z(ve,!1)})}n(T,G)};q(_e,T=>{e(f)||T(le)})}var me=a(_e,2);{var fe=T=>{L(T,{name:"issuer",label:"Issuer URL",placeholder:"Issuer URL",width:o,required:!0,pattern:F,get value(){return e(b).issuer},set value(G){e(b).issuer=G}})},he=T=>{var G=Ze(),J=Q(G);{var se=re=>{L(re,{typ:"url",name:"metadata",label:"Metadata URL",placeholder:".../.well-known/openid-configuration",width:o,required:!0,pattern:F,get value(){return e(b).metadata_url},set value(ve){e(b).metadata_url=ve}})},Ne=re=>{var ve=Ze(),Z=Q(ve);{var W=ee=>{var ae=Pr(),qe=Q(ae);{var ge=d=>{ut(d,{rows:17,name:"rootPem",get label(){return c.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,get disabled(){return e(f)},errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - 1.75rem))",fontMono:!0,pattern:ft,get value(){return e(r).root_pem},set value(j){e(r).root_pem=j}})},Oe=d=>{var j=Lr(),ce=s(j);{var ct=Te=>{mt(Te,{get label(){return c.providers.config.allowInsecureTls},children:(De,Bt)=>{Nt(De,{get check(){return e(r).danger_allow_insecure}})},$$slots:{default:!0}})},jt=Te=>{te(Te,{get ariaLabel(){return c.providers.config.allowInsecureTls},get checked(){return e(r).danger_allow_insecure},set checked(De){e(r).danger_allow_insecure=De},children:(De,Bt)=>{S();var $t=D();$(()=>p($t,c.providers.config.allowInsecureTls)),n(De,$t)},$$slots:{default:!0}})};q(ce,Te=>{e(f)?Te(ct):Te(jt,!1)})}l(j),n(d,j)};q(qe,d=>{e(P)?d(ge):d(Oe,!1)})}var Ee=a(qe,2);L(Ee,{name:"issuer",label:"Issuer URL",placeholder:"Issuer URL",width:o,get disabled(){return e(f)},required:!0,pattern:F,get value(){return e(r).issuer},set value(d){e(r).issuer=d}});var Ke=a(Ee,2);L(Ke,{typ:"url",name:"auth_endpoint",label:"Authorization Endpoint",placeholder:"Authorization Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:F,get value(){return e(r).authorization_endpoint},set value(d){e(r).authorization_endpoint=d}});var Ue=a(Ke,2);L(Ue,{typ:"url",name:"token_endpoint",label:"Token Endpoint",placeholder:"Token Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:F,get value(){return e(r).token_endpoint},set value(d){e(r).token_endpoint=d}});var Re=a(Ue,2);L(Re,{typ:"url",name:"userinfo_endpoint",label:"Userinfo Endpoint",placeholder:"Userinfo Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:F,get value(){return e(r).userinfo_endpoint},set value(d){e(r).userinfo_endpoint=d}});var be=a(Re,2),Ye=s(be);{var tt=d=>{mt(d,{label:"PKCE",children:(j,ce)=>{Nt(j,{get check(){return e(r).use_pkce}})},$$slots:{default:!0}})},rt=d=>{te(d,{ariaLabel:"PKCE",get checked(){return e(r).use_pkce},set checked(j){e(r).use_pkce=j},children:(j,ce)=>{S();var ct=D("PKCE");n(j,ct)},$$slots:{default:!0}})};q(Ye,d=>{e(f)?d(tt):d(rt,!1)})}l(be);var ye=a(be,2),Ve=s(ye,!0);l(ye);var ze=a(ye,2);L(ze,{name:"scope",label:"Scope",placeholder:"openid profile email",width:o,required:!0,pattern:Lt,get value(){return e(r).scope},set value(d){e(r).scope=d}});var xe=a(ze,2),at=s(xe,!0);l(xe);var Xe=a(xe,2);L(Xe,{name:"client_name",label:"Client Name",placeholder:"Client Name",width:o,required:!0,pattern:Mt,get value(){return e(r).name},set value(d){e(r).name=d}});var i=a(Xe,2),w=s(i,!0);l(i);var C=a(i,2);L(C,{name:"client_id",autocomplete:"off",label:"Client ID",placeholder:"Client ID",width:o,required:!0,pattern:F,get value(){return e(r).client_id},set value(d){e(r).client_id=d}});var ne=a(C,2),ht=s(ne,!0);l(ne);var Se=a(ne,2),Ut=ie(()=>!e(r).use_pkce);Tt(Se,{name:"client_secret",autocomplete:"off",label:"Client Secret",placeholder:"Client Secret",width:o,get errMsg(){return c.providers.config.errConfidential},maxLength:256,get required(){return e(Ut)},get value(){return e(r).client_secret},set value(d){e(r).client_secret=d}});var it=a(Se,2),Rt=s(it);Ce(Rt,()=>c.providers.config.descAuthMethod),l(it);var ot=a(it,2),zt=s(ot);te(zt,{ariaLabel:"client_secret_basic",get checked(){return e(r).client_secret_basic},set checked(d){e(r).client_secret_basic=d},children:(d,j)=>{S();var ce=D("client_secret_basic");n(d,ce)},$$slots:{default:!0}}),l(ot);var st=a(ot,2),xt=s(st);te(xt,{ariaLabel:"client_secret_post",get checked(){return e(r).client_secret_post},set checked(d){e(r).client_secret_post=d},children:(d,j)=>{S();var ce=D("client_secret_post");n(d,ce)},$$slots:{default:!0}}),l(st);var gt=a(st,2);{var St=d=>{var j=Mr(),ce=s(j,!0);l(j),$(()=>p(ce,c.providers.config.errNoAuthMethod)),He(3,j,()=>Je,()=>({duration:150})),n(d,j)};q(gt,d=>{!e(r).use_pkce&&!e(r).client_secret_basic&&!e(r).client_secret_post&&d(St)})}var bt=a(gt,2);qt(bt,{});var lt=a(bt,2),Dt=s(lt,!0);l(lt);var kt=a(lt,2);L(kt,{name:"admin_claim_path",get label(){return c.providers.config.pathAdminClaim},placeholder:"$.roles.*",width:o,pattern:F,get value(){return e(r).admin_claim_path},set value(d){e(r).admin_claim_path=d}});var wt=a(kt,2);L(wt,{name:"admin_claim_value",get label(){return c.providers.config.valueAdminClaim},placeholder:"rauthy_admin",width:o,pattern:F,get value(){return e(r).admin_claim_value},set value(d){e(r).admin_claim_value=d}});var nt=a(wt,2),Ft=s(nt,!0);l(nt);var Ct=a(nt,2);L(Ct,{name:"mfa_claim_path",get label(){return c.providers.config.pathMfaClaim},placeholder:"$.amr.*",width:o,pattern:F,get value(){return e(r).mfa_claim_path},set value(d){e(r).mfa_claim_path=d}});var Gt=a(Ct,2);L(Gt,{name:"mfa_claim_value",get label(){return c.providers.config.valueMfaClaim},placeholder:"mfa",width:o,pattern:F,get value(){return e(r).mfa_claim_value},set value(d){e(r).mfa_claim_value=d}}),$(()=>{p(Ve,c.providers.config.descScope),p(at,c.providers.config.descClientName),p(w,c.providers.config.descClientId),p(ht,c.providers.config.descClientId),p(Dt,c.providers.config.mapUser),p(Ft,c.providers.config.mapMfa)}),n(ee,ae)};q(Z,ee=>{(e(E)||e(_)||e(f))&&ee(W)},!0)}n(re,ve)};q(J,re=>{e(A)&&!e(f)?re(se):re(Ne,!1)},!0)}n(T,G)};q(me,T=>{e(y)&&!e(f)?T(fe):T(he,!1)})}var je=a(me,2),Le=s(je);Ge(Le,{type:"submit",get isLoading(){return e(h)},children:(T,G)=>{S();var J=D();$(()=>p(J,e(N)?c.providers.config.lookup:t.common.save)),n(T,J)},$$slots:{default:!0}});var Ie=a(Le,2);{var We=T=>{Ge(T,{level:3,onclick:pe,get isLoading(){return e(h)},children:(G,J)=>{S();var se=D();$(()=>p(se,c.common.reset)),n(G,se)},$$slots:{default:!0}})};q(Ie,T=>{e(N)||T(We)})}var Me=a(Ie,2);{var Pe=T=>{yt(T,{})};q(Me,T=>{e(M)&&T(Pe)})}var et=a(Me,2);{var Be=T=>{var G=Nr(),J=s(G,!0);l(G),$(()=>p(J,e(k))),n(T,G)};q(et,T=>{e(k)&&T(Be)})}l(je),n(R,m)},$$slots:{default:!0}}),l(de),n(K,de),we()}var zr=I("<div></div> <!>",1),xr=I('<div class="err"> </div>'),Sr=I('<div id="federation"><!></div> <!>',1),Dr=I("<!> <!>",1);function Fr(K,U){ke(U,!0);let t=Ae(),c=z(void 0),o=Qt("pid"),h=z(""),k=z(g([])),f=z(void 0);It(()=>{M()}),Fe(()=>{v(f,g(e(k).find(u=>u.id===o.get())))});async function M(){var A;let u=await vt("/auth/v1/providers");u.body?v(k,g(u.body)):v(h,g(((A=u.error)==null?void 0:A.message)||"Error"))}function P(){var u;o.set(void 0),(u=e(c))==null||u(),M()}var b=Dr(),r=Q(b);Zt(r,{width:"11rem",buttonTilesAriaControls:"federation",buttonTiles:u=>{var A=zr(),_=Q(A);dt(_,"height",".5rem");var y=a(_,2);Et(y,17,()=>e(k),E=>E.id,(E,N)=>{var H=ie(()=>o.get()===e(N).id);Ht(E,{onclick:()=>o.set(e(N).id),get selected(){return e(H)},children:(Y,V)=>{S();var x=D();$(()=>p(x,e(N).name)),n(Y,x)},$$slots:{default:!0}})}),n(u,A)},children:(u,A)=>{var _=ie(()=>e(k).length===0?1:2);Jt(u,{get level(){return e(_)},get closeModal(){return e(c)},set closeModal(y){v(c,g(y))},children:(y,E)=>{Rr(y,{onSave:P})},$$slots:{default:!0}})},$$slots:{buttonTiles:!0,default:!0}});var B=a(r,2);Xt(B,{children:(u,A)=>{var _=Sr(),y=Q(_),E=s(y);{var N=V=>{Er(V,{onSave:M,get provider(){return e(f)},set provider(x){v(f,g(x))}})};q(E,V=>{e(f)&&V(N)})}l(y);var H=a(y,2);{var Y=V=>{var x=xr(),oe=s(x,!0);l(x),$(()=>p(oe,e(h))),n(V,x)};q(H,V=>{e(h)&&V(Y)})}$(()=>Qe(y,"aria-label",t.common.details)),n(u,_)},$$slots:{default:!0}}),n(K,b),we()}function Gr(K){Fr(K,{})}export{Gr as component};
