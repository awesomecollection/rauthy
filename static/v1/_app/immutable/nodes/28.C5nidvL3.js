import"../chunks/disclose-version.BDr9Qe-U.js";import{p as oe,a3 as h,a4 as C,a as me,a6 as v,$ as le,g as t,j as s,a5 as m,aa as ne,a7 as y,a9 as k,a8 as E}from"../chunks/index-client.Bsb9hq-M.js";import{s as l}from"../chunks/render.Cl_nSOQQ.js";import{i as M}from"../chunks/if.Mw_hWmq0.js";import{a as n,t as b,b as _,c as ce}from"../chunks/template.D54H5ZkF.js";import{h as ve}from"../chunks/svelte-head.YbFS2hoE.js";import{p as c}from"../chunks/proxy.DclUEOHG.js";import{r as ue}from"../chunks/legacy-client.QbOhT8wP.js";import{I as A,c as de,a as F}from"../chunks/Input.BHI3aq7I.js";import{m as ge,k as pe,n as fe,o as $e}from"../chunks/helpers.Cfg4Q1a_.js";import{B as Ne}from"../chunks/Button.BbZR8hhL.js";import{r as he}from"../chunks/dataFetching.D_YOETHp.js";import{L as ye}from"../chunks/LangSelector.4aRmjdrU.js";import{f as ke}from"../chunks/pow.C5_7nj9T.js";import{M as we,C as be}from"../chunks/ContentCenter.Dpb8rCa1.js";import{u as Ue}from"../chunks/i18n.svelte.B0RF3bDg.js";import{T as xe}from"../chunks/Template.CCszvfWi.js";import{u as Ce}from"../chunks/param.svelte.CjFurolb.js";import{T as Ee}from"../chunks/ThemeSwitch.Zeh_8WtX.js";var _e=b(" <br> <code> </code>",1),Te=b('<div class="success svelte-1ks9oi1"> <br> </div>'),qe=b('<div class="err svelte-1ks9oi1"> </div>'),Ie=b('<div class="container svelte-1ks9oi1"><div class="domainTxt svelte-1ks9oi1"><h1> </h1> <!></div> <!> <!> <!> <!> <!></div> <!> <!>',1),Le=b("<!> <!>",1);function Re(V,X){oe(X,!0);let a=Ue(),f=h(""),P=Ce("redirect_uri"),U=h(!1),g=h(""),T=h(!1),o=c({email:"",givenName:"",familyName:""}),u=h(c({})),Q=h(c({}));ue(()=>{a&&s(Q,c(de().shape({email:F().required(a.common.required).email(a.register.emailBadFormat),givenName:F().required(a.common.required).matches(fe,a.register.regexName),familyName:F().matches($e,a.register.regexName)})))});function q(d){d.detail.code==="Enter"&&W()}async function W(){s(T,!1),s(g,"");try{await t(Q).validate(o,{abortEarly:!1}),s(u,c({}))}catch(p){s(u,c(pe(p)));return}if(t(f)&&!o.email.endsWith(t(f))){s(g,c(a.register.domainErr));return}s(U,!0),await ne();let d=await ke();const I={email:o.email,given_name:o.givenName,family_name:o.familyName.length>0?o.familyName:void 0,pow:d};let x=P.get();x&&(I.redirect_uri=x);const L=await he(I);if(L.ok)s(g,""),s(T,!0),setTimeout(()=>{window.location.replace(P.get()||"/auth/v1/account")},3e3);else{const p=await L.json();p.message.includes("UNIQUE constraint")?s(g,"E-Mail is already registered"):s(g,c(p.message))}s(U,!1)}var Y=Le();ve(d=>{v(()=>le.title=(a==null?void 0:a.register)||"Register")});var D=C(Y);xe(D,{id:ge,get value(){return t(f)},set value(d){s(f,c(d))}});var Z=m(D,2);we(Z,{children:(d,I)=>{be(d,{children:(x,L)=>{var p=Ie(),R=C(p),j=y(R),B=y(j),z=y(B,!0);k(B);var H=m(B,2);{var ee=e=>{var i=_e(),r=C(i,!0),$=m(r,2),N=m($),w=y(N);k(N),v(()=>{l(r,a.register.domainRestricted),l($,` ${a.register.domainAllowed??""} `),l(w,`@${t(f)??""}`)}),n(e,i)};M(H,e=>{t(f)&&e(ee)})}k(j);var G=m(j,2);A(G,{type:"email",autocomplete:"email",get placeholder(){return a.common.email},get value(){return o.email},set value(e){o.email=e},get error(){return t(u).email},set error(e){t(u).email=e},$$events:{keypress:q},children:(e,i)=>{E();var r=_();v(()=>l(r,a.common.email.toUpperCase())),n(e,r)},$$slots:{default:!0}});var J=m(G,2);A(J,{autocomplete:"given-name",get placeholder(){return a.account.givenName},get value(){return o.givenName},set value(e){o.givenName=e},get error(){return t(u).givenName},set error(e){t(u).givenName=e},$$events:{keypress:q},children:(e,i)=>{E();var r=_();v(()=>l(r,a.account.givenName.toUpperCase())),n(e,r)},$$slots:{default:!0}});var K=m(J,2);A(K,{autocomplete:"family-name",get placeholder(){return a.account.familyName},get value(){return o.familyName},set value(e){o.familyName=e},get error(){return t(u).familyName},set error(e){t(u).familyName=e},$$events:{keypress:q},children:(e,i)=>{E();var r=_();v(()=>l(r,a.account.familyName.toUpperCase())),n(e,r)},$$slots:{default:!0}});var O=m(K,2);Ne(O,{get isLoading(){return t(U)},set isLoading(e){s(U,c(e))},$$events:{click:W},children:(e,i)=>{E();var r=_();v(()=>l(r,a.register.register)),n(e,r)},$$slots:{default:!0}});var ae=m(O,2);{var re=e=>{var i=Te(),r=y(i,!0),$=m(r,2);k(i),v(()=>{l(r,a.register.success),l($,` ${a.register.emailCheck??""}`)}),n(e,i)},te=e=>{var i=ce(),r=C(i);{var $=N=>{var w=qe(),ie=y(w,!0);k(w),v(()=>l(ie,t(g))),n(N,w)};M(r,N=>{t(g)&&N($)},!0)}n(e,i)};M(ae,e=>{t(T)?e(re):e(te,!1)})}k(R);var S=m(R,2);Ee(S,{absolute:!0});var se=m(S,2);ye(se,{absolute:!0}),v(()=>l(z,a.register.userReg)),n(x,p)},$$slots:{default:!0}})},$$slots:{default:!0}}),n(V,Y),me()}export{Re as component};
