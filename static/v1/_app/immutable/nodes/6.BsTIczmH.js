import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.Dn68_YLB.js";import{p as V,s as g,c as n,g as t,r as v,t as Y,a as X,O as J,f as Z,i as j,ap as R,h as r}from"../chunks/runtime.BsghBUX9.js";import{d as oe,e as ee,s as H,k as fe}from"../chunks/render.CTp9lacC.js";import{i as P}from"../chunks/if.6Ov_EDLa.js";import{e as te,i as re}from"../chunks/each.URXtkKAp.js";import{a as f,t as T,e as ae,d as F}from"../chunks/template.jENAUvUX.js";import{d as he,b as W,c as B,a as le,i as xe}from"../chunks/index.G5lyZbma.js";import{p as b}from"../chunks/proxy.YH42NwLs.js";import{o as se}from"../chunks/index-client.ClP8y9aT.js";import{O as ye,P as ge}from"../chunks/Pagination.C52gIDzw.js";import{B as Q}from"../chunks/Button.CHwcFOJ-.js";import{F as we,G as be,H as $e,I as Se,J as Ie}from"../chunks/OptionSelect.Cn2sqgid.js";import{p as U,r as Ke}from"../chunks/props.CslUVmW_.js";import{r as ie}from"../chunks/legacy-client.DY3VEcT0.js";import{c as Ae,a as Ee,I as ne}from"../chunks/Input.B4ccwD4n.js";import{a1 as ke,A as ce,n as _e,j as je}from"../chunks/helpers.CBl6QeM5.js";import{S as de,I as ze,a as Te,b as De,P as Oe}from"../chunks/PasswordInput.CnOR-d9I.js";import{a as qe,b as Me}from"../chunks/input.D13BG9DA.js";import{E as Ne}from"../chunks/ExpandContainer.BAZSCBeT.js";import{T as Pe}from"../chunks/Tooltip.D8Tbt6Nb.js";import{T as Ce}from"../chunks/TabBar.g4Oe_bq5.js";var Ue=T('<div role="button" tabindex="0" class="cell pointer svelte-lgl56a"> </div>'),Ge=T('<div class="cell svelte-lgl56a"><input class="pointer svelte-lgl56a" type="checkbox"></div>'),Ye=T('<div class="mr svelte-lgl56a"><div role="button" tabindex="0" class="label pointer svelte-lgl56a"> </div> <!></div>'),Re=T('<div class="matrix svelte-lgl56a"><b>Access Rights</b> <div class="mr svelte-lgl56a"><div class="label svelte-lgl56a"></div> <!></div> <!></div>');function pe(N,p){V(p,!0);let u=U(p,"accessMatrix",15);U(p,"finalize",15)(o);const l=["Blacklist","Clients","Events","Generic","Groups","Roles","Secrets","Sessions","Scopes","UserAttributes","Users"],h=["create","read","update","delete"];let $=new Array(l.length).fill(!1),w=new Array(h.length).fill(!1);se(()=>{var s;I(),(s=p.apiKey)!=null&&s.access&&O()});function I(){let s=new Array(l.length);for(let d=0;d<l.length;d++){s[d]={group:l[d]};for(let i of h)s[d][i]=!1}u(s)}function O(){for(let s of p.apiKey.access){let d=l.findIndex(i=>i===s.group);for(let i of s.access_rights){let x=h.findIndex(k=>k===i);u(u()[d][h[x]]=!0,!0)}}}function o(){let s=[];for(let d=0;d<l.length;d++){let i=[];for(let x of h)u()[d][x]&&i.push(x);i.length>0&&s.push({group:l[d],access_rights:i})}return s}function c(s){$[s]=!$[s];const d=$[s];let i=u()[s];for(let x=0;x<h.length;x++)for(let k of Object.keys(i))k!=="group"&&(i[k]=d);u(u()[s]=i,!0)}function E(s){w[s]=!w[s];const d=w[s];for(let i=0;i<l.length;i++)u(u()[i][h[s]]=d,!0)}var _=Re(),z=g(n(_),2),K=g(n(z),2);te(K,17,()=>h,re,(s,d,i)=>{var x=Ue(),k=J(()=>E.bind(this,i));x.__click=function(...A){var e;(e=t(k))==null||e.apply(this,A)};var S=J(()=>E.bind(this,i)),M=n(x,!0);v(x),Y(()=>H(M,h[i])),ee("keypress",x,function(...A){var e;(e=t(S))==null||e.apply(this,A)}),f(s,x)}),v(z);var D=g(z,2);{var m=s=>{var d=ae(),i=Z(d);te(i,17,()=>l,re,(x,k,S)=>{var M=Ye(),A=n(M),e=J(()=>c.bind(this,S));A.__click=function(...G){var C;(C=t(e))==null||C.apply(this,G)};var a=J(()=>c.bind(this,S)),y=n(A,!0);v(A);var q=g(A,2);te(q,17,()=>h,re,(G,C)=>{var L=Ge(),ve=n(L);he(ve),v(L),qe(ve,()=>u()[S][t(C)],me=>u(u()[S][t(C)]=me,!0)),f(G,L)}),v(M),Y(()=>H(y,l[S])),ee("keypress",A,function(...G){var C;(C=t(a))==null||C.apply(this,G)}),f(x,M)}),f(s,d)};P(D,s=>{u()&&s(m)})}return v(_),f(N,_),X({finalizeMatrix:o})}oe(["click"]);var He=T("<div><!></div>"),We=T('<div class="container svelte-ubtepy"><!> <div class="switch svelte-ubtepy">Key Expires: <!></div> <!> <!> <div class="saveBtn svelte-ubtepy"><!></div> <div class="err svelte-ubtepy"> </div></div>');function Be(N,p){V(p,!0);const u=new Date().toISOString().split(".")[0];let l=U(p,"apiKeys",19,()=>[]),h=U(p,"onSave",3,()=>{}),$=j(""),w=j(!1),I=j(void 0),O=j(void 0),o=b({name:"",exp:""}),c=j(b({}));const E=Ae().shape({name:Ee().required("Name is required").min(2).max(24).matches(ke,"Format: [a-zA-Z0-9_/-]{2,24}")});ie(()=>{t(w)&&(o.exp=new Date().toISOString().split(".")[0])});async function _(){if(r($,""),!await z())return;let e={name:o.name,access:t(I)()};if(e.access.length===0){r($,"Grant the new API Key at least one permission");return}if(t(w)){let y=ce(o.exp);if(!y){r($,"Invalid Date Input: User Expires");return}e.exp=y}let a=await we(e);if(a.ok)h()();else{let y=await a.json();r($,b(y.message))}}async function z(){try{await E.validate(o,{abortEarly:!1}),r(c,b({}))}catch(e){return r(c,b(_e(e))),!1}for(let e of l())if(e.name===o.name)return t(c).name="Name already exists",!1;return!0}var K=We(),D=n(K);ne(D,{width:"18rem",autocomplete:"off",placeholder:"Name",get value(){return o.name},set value(e){o.name=e},get error(){return t(c).name},set error(e){t(c).name=e},children:(e,a)=>{R();var y=F("NAME");f(e,y)},$$slots:{default:!0}});var m=g(D,2),s=g(n(m));de(s,{get selected(){return t(w)},set selected(e){r(w,b(e))}}),v(m);var d=g(m,2);{var i=e=>{var a=He(),y=n(a);ne(y,{type:"datetime-local",step:"60",width:"18rem",min:u,max:"2099-01-01T00:00",get value(){return o.exp},set value(q){o.exp=q},children:(q,G)=>{R();var C=F("EXPIRES");f(q,C)},$$slots:{default:!0}}),v(a),W(3,a,()=>B),f(e,a)};P(d,e=>{t(w)&&e(i)})}var x=g(d,2);pe(x,{get accessMatrix(){return t(O)},set accessMatrix(e){r(O,b(e))},get finalize(){return t(I)},set finalize(e){r(I,b(e))}});var k=g(x,2),S=n(k);Q(S,{level:1,$$events:{click:_},children:(e,a)=>{R();var y=F("SAVE");f(e,y)},$$slots:{default:!0}}),v(k);var M=g(k,2),A=n(M,!0);v(M),v(K),Y(()=>H(A,t($))),f(N,K),X()}var Fe=T("<div><!></div>"),Ve=T('<div class="success svelte-1a3jnb3">Success</div>'),Xe=T('<div class="mainErr err svelte-1a3jnb3"> </div>'),Le=T('<div class="container svelte-1a3jnb3"><div class="unit svelte-1a3jnb3"><div class="label svelte-1a3jnb3">Name</div> <div class="value svelte-1a3jnb3"> </div></div> <div class="switch svelte-1a3jnb3">Key Expires: <!></div> <!> <!> <!> <!> <!></div>');function Ze(N,p){V(p,!0);const u=new Date().toISOString().split(".")[0];let l=U(p,"apiKey",27,()=>b({})),h=j(""),$=j(!1),w=j(void 0),I=j(!!l().expires),O=j(void 0),o=j(void 0);ie(()=>{t($)&&r(w,b(setTimeout(()=>{r($,!1),p.onSave()},2e3)))}),se(()=>()=>clearTimeout(t(w)));let c=b({exp:""});ie(()=>{t(I)&&(c.exp=new Date().toISOString().split(".")[0])});async function E(){r(h,"");let a={name:l().name,access:t(o)()};if(a.access.length===0){r(h,"Grant the API Key at least one permission");return}if(t(I)){let q=ce(c.exp);if(!q){r(h,"Invalid Date Input: User Expires");return}a.exp=q}let y=await be(a);if(y.ok)p.onSave(),r($,!0);else{let q=await y.json();r(h,b(q.message))}}var _=Le(),z=n(_),K=g(n(z),2),D=n(K,!0);v(K),v(z);var m=g(z,2),s=g(n(m));de(s,{get selected(){return t(I)},set selected(a){r(I,b(a))}}),v(m);var d=g(m,2);{var i=a=>{var y=Fe(),q=n(y);ne(q,{type:"datetime-local",step:"60",width:"18rem",min:u,max:"2099-01-01T00:00",get value(){return c.exp},set value(G){c.exp=G},children:(G,C)=>{R();var L=F("EXPIRES");f(G,L)},$$slots:{default:!0}}),v(y),W(3,y,()=>B),f(a,y)};P(d,a=>{t(I)&&a(i)})}var x=g(d,2);pe(x,{get apiKey(){return l()},get accessMatrix(){return t(O)},set accessMatrix(a){r(O,b(a))},get finalize(){return t(o)},set finalize(a){r(o,b(a))}});var k=g(x,2);Q(k,{level:1,width:"4rem",$$events:{click:E},children:(a,y)=>{R();var q=F("SAVE");f(a,q)},$$slots:{default:!0}});var S=g(k,2);{var M=a=>{var y=Ve();f(a,y)};P(S,a=>{t($)&&a(M)})}var A=g(S,2);{var e=a=>{var y=Xe(),q=n(y,!0);v(y),Y(()=>H(q,t(h))),f(a,y)};P(A,a=>{t(h)&&a(e)})}v(_),Y(()=>H(D,l().name)),f(N,_),X()}var Je=T('<div class="err svelte-1jljqe9"> </div>'),Qe=T('<div class="container svelte-1jljqe9"><div class="label svelte-1jljqe9">Are you sure, you want to delete this ApiKey?</div> <!> <!></div>');function et(N,p){V(p,!0);let u=U(p,"apiKey",19,()=>({})),l=j("");async function h(){r(l,"");let o=await $e(u().name);if(o.ok)p.onSave();else{let c=await o.json();r(l,b(c.message))}}var $=Qe(),w=g(n($),2);Q(w,{level:1,$$events:{click:h},children:(o,c)=>{R();var E=F("DELETE");f(o,E)},$$slots:{default:!0}});var I=g(w,2);{var O=o=>{var c=Je(),E=n(c,!0);v(c),Y(()=>H(E,t(l))),f(o,c)};P(I,o=>{t(l)&&o(O)})}v($),f(N,$),X()}var tt=T('<div><div class="iconsOuter svelte-s24qr4"><div class="iconsInner svelte-s24qr4"><div role="button" tabindex="0" class="show svelte-s24qr4"><!></div> <div role="button" tabindex="0"><!></div></div></div> <textarea></textarea></div>');function ue(N,p){V(p,!0);let u=U(p,"value",3,""),l=U(p,"rows",3,10),h=U(p,"cols",3,60),$=U(p,"name",3,"default"),w=U(p,"show",15,!1),I=U(p,"width",3,"40rem"),O=Ke(p,["$$slots","$$events","$$legacy","value","rows","cols","name","show","width"]),o=j(""),c=j("");ie(()=>{w()?r(c,u()):r(c,b(t(o)))}),se(()=>{for(let A=0;A<u().length;A++)r(o,t(o)+"*");r(c,b(t(o)))});function E(){navigator.clipboard.writeText(u())}function _(){w(!w())}var z=tt(),K=n(z),D=n(K),m=n(D);m.__click=_;var s=n(m);{var d=A=>{Te(A,{width:22})},i=A=>{De(A,{width:22})};P(s,A=>{w()?A(d):A(i,!1)})}v(m);var x=g(m,2);x.__click=E;var k=n(x);ze(k,{}),v(x),v(D),v(K);var S=g(K,2);fe(S);let M;v(z),Y(()=>{le(z,"width",`${I()}`),M=xe(S,M,{disabled:!0,name:$(),rows:l(),cols:h(),...O},"svelte-s24qr4"),le(S,"width",`${I()}`),le(S,"padding-right","2.75rem")}),ee("keypress",m,_),ee("keypress",x,E),Me(S,()=>t(c),A=>r(c,A)),f(N,z),X()}oe(["click"]);var at=T(`<div class="secret font-mono svelte-1vixcxf"><!></div> <p class="svelte-1vixcxf">An API Key must be provided in the HTTP <span class="headerCodeSmall svelte-1vixcxf"><code>Authorization</code></span> header in the following format:</p> <p class="svelte-1vixcxf"><span class="headerCode svelte-1vixcxf"><b><code>API-Key YourSecretApiKeyHere</code></b></span></p> <p class="svelte-1vixcxf">You can use the following <code>curl</code> request to test your new Key:</p> <!> <p class="svelte-1vixcxf">If you don't have <code>jq</code> installed and the above fails:</p> <!>`,1),st=T(`<div class="container svelte-1vixcxf"><p class="svelte-1vixcxf">You Can generate a new secret for this API Key here.</p> <p class="svelte-1vixcxf">You will only see this secret once after the generation.
        When a new one has been generated, the old secret will be overridden permanently.
        This operation cannot be reverted!</p> <!> <!> <div class="err svelte-1vixcxf"> </div></div>`);function it(N,p){V(p,!0);let u=j(""),l=j(""),h=j(""),$=j("");async function w(){let K=await Se(p.apiKey.name);if(K.ok)r(l,b(await K.text())),r(h,`curl -s -H 'Authorization: API-Key ${t(l)}' ${window.location.origin}/auth/v1/api_keys/${p.apiKey.name}/test`),r($,`${t(h)} | jq`);else{let D=await K.json();r(u,b(D.message))}}var I=st(),O=g(n(I),4),o=J(()=>t(l)?3:1);Q(O,{get level(){return t(o)},width:"130px",$$events:{click:w},children:(K,D)=>{R();var m=F("GENERATE NEW");f(K,m)},$$slots:{default:!0}});var c=g(O,2);{var E=K=>{var D=at(),m=Z(D),s=n(m);Oe(s,{autocomplete:"off",disabled:!0,showCopy:!0,width:"inherit",maxWidth:"800px",get value(){return t(l)},set value(x){r(l,b(x))},children:(x,k)=>{R();var S=F("API KEY");f(x,S)},$$slots:{default:!0}}),v(m);var d=g(m,8);ue(d,{name:"id",rows:3,get value(){return t($)}});var i=g(d,4);ue(i,{name:"id",rows:3,get value(){return t(h)}}),W(3,m,()=>B),f(K,D)};P(c,K=>{t(l)&&K(E)})}var _=g(c,2),z=n(_,!0);v(_),v(I),Y(()=>H(z,t(u))),f(N,I),X()}var rt=T('<div class="data svelte-115hohv"> </div>'),lt=T('<div class="header svelte-115hohv"><div class="data svelte-115hohv"> </div> <!></div>'),nt=T("<div><!></div>"),vt=T("<div><!></div>"),ot=T("<div><!></div>"),ct=T("<div><!> <!></div>");function dt(N,p){V(p,!0);let u=U(p,"apiKey",31,()=>b({})),l=U(p,"onSave",11,()=>{}),h=j(void 0);const $=["Config","Secret","Delete"];let w=j(b($[0]));const I=200,O=I/2;function o(){r(h,!1),l()()}Ne(N,{get show(){return t(h)},set show(c){r(h,b(c))},header:c=>{var E=lt(),_=n(E),z=n(_,!0);v(_);var K=g(_,2);{var D=m=>{Pe(m,{text:"Expiry",children:(s,d)=>{var i=rt(),x=n(i,!0);Y(()=>H(x,je(u().expires))),v(i),f(s,i)},$$slots:{default:!0}})};P(K,m=>{u().expires&&m(D)})}v(E),Y(()=>H(z,u().name)),f(c,E)},body:c=>{var E=ct(),_=n(E);Ce(_,{labels:$,get selected(){return t(w)},set selected(m){r(w,b(m))}});var z=g(_,2);{var K=m=>{var s=nt(),d=n(s);Ze(d,{get onSave(){return l()},get apiKey(){return u()},set apiKey(i){u(i)}}),v(s),W(1,s,()=>B,()=>({delay:O,duration:I})),W(2,s,()=>B,()=>({duration:I})),f(m,s)},D=m=>{var s=ae(),d=Z(s);{var i=k=>{var S=vt(),M=n(S);it(M,{get apiKey(){return u()}}),v(S),W(1,S,()=>B,()=>({delay:O,duration:I})),W(2,S,()=>B,()=>({duration:I})),f(k,S)},x=k=>{var S=ae(),M=Z(S);{var A=e=>{var a=ot(),y=n(a);et(y,{get apiKey(){return u()},onSave:o}),v(a),W(1,a,()=>B,()=>({delay:O,duration:I})),W(2,a,()=>B,()=>({duration:I})),f(e,a)};P(M,e=>{t(w)==="Delete"&&e(A)},!0)}f(k,S)};P(d,k=>{t(w)==="Secret"?k(i):k(x,!1)},!0)}f(m,s)};P(z,m=>{t(w)==="Config"?m(K):m(D,!1)})}v(E),f(c,E)},$$slots:{header:!0,body:!0}}),X()}var pt=T("<div><!></div>"),ut=T('<div class="svelte-1fzx60h">No Api Keys</div>'),mt=T(' <div class="content"><div class="top svelte-1fzx60h"><!> <div class="addNew svelte-1fzx60h"><!></div></div> <!> <div id="keys" class="svelte-1fzx60h"><!></div> <!> <div style="height: 20px"></div></div>',1);function ft(N,p){V(p,!0);let u=j(""),l=j(b([])),h=j(b([])),$=j(b([])),w=j(!1);const I=[{label:"Name",callback:(e,a)=>e.name.includes(a)}];let O=[{label:"Name",callback:(e,a)=>e.name.localeCompare(a.name)}];se(()=>{o()});async function o(){let e=await Ie(),a=await e.json();e.ok?(r(l,b(a.keys)),r(w,!1)):r(u,b(a.message))}R();var c=mt(),E=Z(c),_=g(E),z=n(_),K=n(z);ye(K,{get items(){return t(l)},searchOptions:I,orderOptions:O,get resItems(){return t(h)},set resItems(e){r(h,b(e))}});var D=g(K,2),m=n(D);Q(m,{level:3,$$events:{click:()=>r(w,!t(w))},children:(e,a)=>{R();var y=F("NEW KEY");f(e,y)},$$slots:{default:!0}}),v(D),v(z);var s=g(z,2);{var d=e=>{var a=pt(),y=n(a);Be(y,{onSave:o,get apiKeys(){return t(l)}}),v(a),W(3,a,()=>B),f(e,a)};P(s,e=>{t(w)&&e(d)})}var i=g(s,2),x=n(i);{var k=e=>{var a=ut();f(e,a)},S=e=>{var a=ae(),y=Z(a);te(y,19,()=>t($),q=>q.name,(q,G,C)=>{dt(q,{onSave:o,get apiKey(){return t($)[t(C)]},set apiKey(L){t($)[t(C)]=L}})}),f(e,a)};P(x,e=>{t(l).length===0?e(k):e(S,!1)})}v(i);var M=g(i,2);{var A=e=>{ge(e,{get items(){return t(h)},set items(a){r(h,b(a))},get resItems(){return t($)},set resItems(a){r($,b(a))}})};P(M,e=>{t(l).length>0&&e(A)})}R(2),v(_),Y(()=>H(E,`${t(u)??""} `)),f(N,c),X()}function ht(N){ft(N,{})}export{ht as component};
