import"../chunks/disclose-version.BDr9Qe-U.js";import{p as j,ap as q,f as k,a as D,m as a,aq as G,l as i,s as H,o as g,c as P,ar as I,r as W,t as J}from"../chunks/index-client.Ds4XgiuL.js";import{s as K}from"../chunks/render.Bq2-eTRf.js";import{i as T}from"../chunks/if.Du7BDhAX.js";import{a as c,t as _,e as F,d as N}from"../chunks/template.DXIK6jcH.js";import{h as O}from"../chunks/svelte-head.DUes13UE.js";import{p as u}from"../chunks/proxy.CB6KOiNf.js";import{v as Q,w as V}from"../chunks/helpers.BTvs6bnN.js";import{W as X}from"../chunks/WebauthnRequest.B53aO4he.js";import{L as Y}from"../chunks/LangSelector.BAs7X9bt.js";import{B as Z}from"../chunks/Button.nDjAKZm4.js";import{u as rr}from"../chunks/i18n.svelte.CgUwCKxn.js";import{u as h}from"../chunks/param.svelte.D0F_0zrI.js";import{T as or}from"../chunks/ThemeSwitch.DknOd3dX.js";import{b as ar}from"../chunks/fetch.DFmyLr06.js";import{u as er}from"../chunks/is_dev.svelte.Ca8K5o-2.js";var tr=_('<div class="btn flex-col svelte-17xvymb"><!></div>'),sr=_('<div class="err"> </div>'),ir=_("<!> <!> <!>",1);function nr(R,S){j(S,!0);let z=rr(),$=g(!1),t=g(""),b=g(void 0),p=g(void 0);q(async()=>{var s,n;let r=h("error").get();if(r){let e=h("error_description").get();a(t,`${r}: ${e}`);return}let l=h("state").get();if(!l){a(t,"'state' is missing in URL");return}let v=h("code").get();if(!v){a(t,"'code' is missing in URL");return}let w={state:l,code:v,pkce_verifier:Q(),xsrf_token:V()},d="/auth/v1/providers/callback";er().get()&&(d="/auth/v1/dev/providers_callback");let o=await ar(d,w);if(o.status===202)window.location.replace(o.headers.get("location")||"/auth/v1/account");else if(o.status===200){a(t,"");let e=o.body;e&&"user_id"in e&&"code"in e?(a(b,u(e.user_id)),a(p,u({Login:e.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else o.status===204?window.location.replace("/auth/v1/account"):o.status===403?a(t,u(((s=o.error)==null?void 0:s.message)||"HTTP 403 Forbidden")):o.status===406?(a(t,u(z.authorize.clientForceMfa)),a($,!0)):a(t,`HTTP ${o.status}: ${(n=o.error)==null?void 0:n.message}`)});function A(r){a(t,u(r)),a(p,void 0)}function B(r){console.log("onWebauthnSuccess",r),r&&"loc"in r&&window.location.replace(r.loc)}var L=ir();O(r=>{G.title="Callback"});var x=k(L);{var C=r=>{X(r,{get userId(){return i(b)},get purpose(){return i(p)},onSuccess:B,onError:A})},E=r=>{var l=F(),v=k(l);{var w=o=>{var s=tr(),n=P(s);Z(n,{onclick:()=>window.location.href="/auth/v1/account",children:(e,f)=>{I();var m=N("Account");c(e,m)},$$slots:{default:!0}}),W(s),c(o,s)},d=o=>{var s=F(),n=k(s);{var e=f=>{var m=sr(),U=P(m,!0);W(m),J(()=>K(U,i(t))),c(f,m)};T(n,f=>{i(t)&&f(e)},!0)}c(o,s)};T(v,o=>{i($)?o(w):o(d,!1)},!0)}c(r,l)};T(x,r=>{i(p)&&i(b)?r(C):r(E,!1)})}var y=H(x,2);or(y,{absolute:!0});var M=H(y,2);Y(M,{absolute:!0}),c(R,L),D()}export{nr as component};
