import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.Dmu0D13_.js";import{p as Y,a6 as j,y as e,f as M,z as n,s as q,t as R,a as G,A as y,c as E,ar as H,r as L,ab as J,ap as ae}from"../chunks/index-client.CVQra9Cu.js";import{s as x}from"../chunks/render.CkKFmY3E.js";import{i as B}from"../chunks/if._4yhN2kP.js";import{e as se}from"../chunks/each.D7w_Y1pv.js";import{d as K,a as m,t as w,e as X}from"../chunks/template.4ZWi6dE6.js";import{a as ne}from"../chunks/index.CkVfMYgG.js";import{p as i}from"../chunks/proxy.Dc6q2r8X.js";import{u as Q}from"../chunks/i18n_admin.svelte.CtFnAESg.js";import{B as ie}from"../chunks/ButtonAddModal.W1tXC5iJ.js";import{C as le}from"../chunks/ContentAdmin.p5jUo2m-.js";import{N as me}from"../chunks/NavButtonTile.B87bIUim.js";import{N as de}from"../chunks/NavSub.BqNuX9Je.js";import{O as ve}from"../chunks/OrderSearchBar.BAXBsyAw.js";import{b as ue,d as ce,c as fe,f as pe}from"../chunks/fetch.B_P4c8fm.js";import{u as ge}from"../chunks/param.svelte.CY-AzddN.js";import{B as V}from"../chunks/Button.B6DffihK.js";import{I as Z}from"../chunks/Input.kE1yFgI6.js";import{f as ee}from"../chunks/patterns.DpOwmcHv.js";import{F as re}from"../chunks/Form.9PZRDz5w.js";import{u as U}from"../chunks/i18n.svelte.DVZudxvm.js";import{T as he}from"../chunks/Tabs.BGGYqHwk.js";import{h as oe}from"../chunks/html.DBwFzVLh.js";import{I as be}from"../chunks/IconCheck.jhQYM7vu.js";import{L as $e}from"../chunks/LabeledValue.DfaotEKr.js";var ye=w('<div class="err"> </div>'),we=w("<!> <!> <!>",1),Ce=w('<div class="container svelte-s1196z"><!></div>');function Se(T,t){Y(t,!0);let z=U(),p=Q(),v=y(void 0),s=y(""),g=y("");j(()=>{requestAnimationFrame(()=>{var c;(c=e(v))==null||c.focus()})});async function h(c,f){var b;if(t.roles.find(O=>O.name===e(g))){n(s,i(p.common.nameExistsAlready));return}n(s,"");let d={role:e(g)},o=await ue(c.action,d);o.body?t.onSave(o.body.id):n(s,i(((b=o.error)==null?void 0:b.message)||"Error"))}var $=Ce(),A=E($);re(A,{action:"/auth/v1/roles",onSubmit:h,children:(c,f)=>{var d=we(),o=M(d);Z(o,{autocomplete:"off",get label(){return p.roles.name},get placeholder(){return p.roles.name},required:!0,pattern:ee,get ref(){return e(v)},set ref(u){n(v,i(u))},get value(){return e(g)},set value(u){n(g,i(u))}});var b=q(o,2);V(b,{type:"submit",children:(u,C)=>{H();var _=K();R(()=>x(_,z.common.save)),m(u,_)},$$slots:{default:!0}});var O=q(b,2);{var D=u=>{var C=ye(),_=E(C,!0);L(C),R(()=>x(_,e(s))),m(u,C)};B(O,u=>{e(s)&&u(D)})}m(c,d)},$$slots:{default:!0}}),L($),m(T,$),G()}var Ie=w("<p><!></p>"),Ne=w('<div class="flex gap-05"><!> <!></div>'),Oe=w('<div class="err"> </div>'),_e=w("<!> <!> <!> <!>",1);function qe(T,t){Y(t,!0);let z=U(),p=Q(),v=y(""),s=y(!1),g=J(()=>t.role.name==="rauthy_admin"),h=y(i(t.role.name));j(()=>{t.role.id&&n(h,i(t.role.name))});async function $(c,f){if(n(v,""),e(h)!==t.role.name&&t.roles.find(b=>b.name===e(h))){n(v,i(p.common.nameExistsAlready));return}let d={role:e(h)},o=await ce(c.action,d);o.error?n(v,i(o.error.message)):(n(s,!0),t.onSave(),setTimeout(()=>{n(s,!1)},2e3))}var A=J(()=>`/auth/v1/roles/${t.role.id}`);re(T,{get action(){return e(A)},onSubmit:$,children:(c,f)=>{var d=_e(),o=M(d);$e(o,{label:"ID",mono:!0,children:(r,a)=>{H();var l=K();R(()=>x(l,t.role.id)),m(r,l)},$$slots:{default:!0}});var b=q(o,2);Z(b,{autocomplete:"off",get label(){return p.scopes.name},get placeholder(){return p.scopes.name},get disabled(){return e(g)},width:"14.5rem",required:!0,pattern:ee,get value(){return e(h)},set value(r){n(h,i(r))}});var O=q(b,2);{var D=r=>{var a=Ie(),l=E(a);oe(l,()=>p.roles.adminNoMod),L(a),m(r,a)},u=r=>{var a=Ne(),l=E(a);V(l,{type:"submit",children:(N,F)=>{H();var P=K();R(()=>x(P,z.common.save)),m(N,P)},$$slots:{default:!0}});var S=q(l,2);{var I=N=>{be(N,{})};B(S,N=>{e(s)&&N(I)})}L(a),m(r,a)};B(O,r=>{e(g)?r(D):r(u,!1)})}var C=q(O,2);{var _=r=>{var a=Oe(),l=E(a,!0);L(a),R(()=>x(l,e(v))),m(r,a)};B(C,r=>{e(v)&&r(_)})}m(c,d)},$$slots:{default:!0}}),G()}var Ae=w("<p><!></p>"),Fe=w('<div class="err"> </div>'),Te=w("<p> </p> <!> <!>",1);function ze(T,t){Y(t,!0);let z=U(),p=Q(),v=y(""),s=J(()=>t.role.name==="rauthy_admin");async function g(){n(v,"");let f=await fe(`/auth/v1/roles/${t.role.id}`);f.error?n(v,i(f.error.message)):t.onSave()}var h=X(),$=M(h);{var A=f=>{var d=Ae(),o=E(d);oe(o,()=>p.roles.adminNoMod),L(d),m(f,d)},c=f=>{var d=Te(),o=M(d),b=E(o,!0);L(o);var O=q(o,2);V(O,{level:-1,onclick:g,children:(C,_)=>{H();var r=K();R(()=>x(r,z.common.delete)),m(C,r)},$$slots:{default:!0}});var D=q(O,2);{var u=C=>{var _=Fe(),r=E(_,!0);L(_),R(()=>x(r,e(v))),m(C,_)};B(D,C=>{e(v)&&C(u)})}R(()=>x(b,p.roles.delete1)),m(f,d)};B($,f=>{e(s)?f(A):f(c,!1)})}m(T,h),G()}var Ee=w('<div class="flex"><!></div> <!>',1);function Le(T,t){Y(t,!0);let z=U(),p=Q();const v=[p.nav.config,z.common.delete];let s=y(i(v[0])),g=y(void 0);j(()=>{t.role.id&&requestAnimationFrame(()=>{var o;(o=e(g))==null||o()})});var h=Ee(),$=M(h),A=E($);he(A,{tabs:v,get selected(){return e(s)},set selected(o){n(s,i(o))},get focusFirst(){return e(g)},set focusFirst(o){n(g,i(o))}}),L($);var c=q($,2);{var f=o=>{qe(o,{get role(){return t.role},get roles(){return t.roles},get onSave(){return t.onSave}})},d=o=>{var b=X(),O=M(b);{var D=u=>{ze(u,{get role(){return t.role},get onSave(){return t.onSave}})};B(O,u=>{e(s)===z.common.delete&&u(D)},!0)}m(o,b)};B(c,o=>{e(s)===p.nav.config?o(f):o(d,!1)})}m(T,h),G()}var Me=w("<div></div> <!>",1),Re=w("<!> <!>",1),xe=w('<div class="err"> </div>'),Be=w('<!> <div id="groups"><!></div>',1),De=w("<!> <!>",1);function ke(T,t){Y(t,!0);let z=Q(),p=y(void 0),v=y(""),s=y(i([])),g=y(i([])),h=y(void 0),$=ge("rid");const A=[z.common.name,"ID"];let c=y(i(A[0])),f=y("");const d=[z.common.name,"ID"];ae(()=>{o()}),j(()=>{n(h,i(e(s).find(r=>r.id===$.get())))}),j(()=>{let r=e(f).toLowerCase();r?e(c)===A[0]?n(g,i(e(s).filter(a=>{var l;return(l=a.name)==null?void 0:l.toLowerCase().includes(r)}))):e(c)===A[1]&&n(g,i(e(s).filter(a=>a.id.toLowerCase().includes(r)))):n(g,i(e(s)))});async function o(){var a;let r=await pe("/auth/v1/roles");r.body?n(s,i(r.body)):n(v,i(((a=r.error)==null?void 0:a.message)||"Error"))}function b(r,a){let l=a==="up";r===d[0]?e(s).sort((S,I)=>l?S.name.localeCompare(I.name):I.name.localeCompare(S.name)):r===d[1]&&e(s).sort((S,I)=>l?S.id.localeCompare(I.id):I.id.localeCompare(S.id))}function O(){o()}async function D(r){var a;(a=e(p))==null||a(),await o(),$.set(r)}var u=De(),C=M(u);de(C,{paddingTop:"2.1rem",buttonTilesAriaControls:"groups",width:"min(20rem, 100dvw)",thresholdNavSub:700,buttonTiles:r=>{var a=Me(),l=M(a);ne(l,"height",".5rem");var S=q(l,2);se(S,17,()=>e(g),I=>I.id,(I,N)=>{var F=J(()=>$.get()===e(N).id);me(I,{onclick:()=>$.set(e(N).id),get selected(){return e(F)},children:(P,k)=>{H();var W=K();R(()=>x(W,e(N).name)),m(P,W)},$$slots:{default:!0}})}),m(r,a)},children:(r,a)=>{var l=Re(),S=M(l),I=J(()=>e(s).length===0?1:2);ie(S,{get level(){return e(I)},alignRight:!0,get closeModal(){return e(p)},set closeModal(F){n(p,i(F))},children:(F,P)=>{Se(F,{onSave:D,get roles(){return e(s)}})},$$slots:{default:!0}});var N=q(S,2);ve(N,{searchOptions:A,orderOptions:d,onChangeOrder:b,searchWidth:"min(19.5rem, 100dvw - .5rem)",get searchOption(){return e(c)},set searchOption(F){n(c,i(F))},get value(){return e(f)},set value(F){n(f,i(F))}}),m(r,l)},$$slots:{buttonTiles:!0,default:!0}});var _=q(C,2);le(_,{children:(r,a)=>{var l=Be(),S=M(l);{var I=k=>{var W=xe(),te=E(W,!0);L(W),R(()=>x(te,e(v))),m(k,W)};B(S,k=>{e(v)&&k(I)})}var N=q(S,2),F=E(N);{var P=k=>{Le(k,{get role(){return e(h)},get roles(){return e(s)},onSave:O})};B(F,k=>{e(h)&&k(P)})}L(N),m(r,l)},$$slots:{default:!0}}),m(T,u),G()}function Pe(T){ke(T,{})}export{Pe as component};
