import{a as o,n as fa,b as g,t as oe,c as Pe}from"../chunks/disclose-version.C0dpEWi_.js";import"../chunks/legacy.6NChWQ7B.js";import{a1 as $,p as pa,o as $a,a7 as S,a8 as wa,_ as K,a as ja,j as a,a9 as C,g as e,$ as _a,a0 as n,aa as i,a2 as h,a4 as d,a3 as ce,a5 as ya,ab as Se}from"../chunks/index-client.LkyNpeLM.js";import{h as ba,s as L,e as De}from"../chunks/render.D21ACvZ4.js";import{i as _}from"../chunks/if.BQqAvi9S.js";import{e as ka}from"../chunks/OptionSelect.CHnFxA-i.js";import{s as V,t as xa,b as Ma}from"../chunks/Loading.CZYfBo5y.js";import{i as za}from"../chunks/lifecycle.DMuwUPzm.js";import{g as Ca,G as La,H as Ra,I as Ia,J as Ta,K as Ua,M as Na,n as Ee,N as Va,O as qa,_ as Aa,P as Ba,Q as Fa,S as Ga,U as He,e as We,V as Oa}from"../chunks/dataFetching.C4rEqQY1.js";import{I as Pa,c as Sa,a as Da,y as Ea}from"../chunks/Input.BWHohn37.js";import{B as ue}from"../chunks/Button.BDI_bIrm.js";import{W as Ha}from"../chunks/WebauthnRequest.CDgCRlgS.js";import{P as Wa}from"../chunks/PasswordInput.j52NsKBe.js";import{L as Ka}from"../chunks/LangSelector.PrFnGVsI.js";import{p as ke}from"../chunks/props.BDzDHVdA.js";import{M as Qa,C as Xa}from"../chunks/ContentCenter.BsVUI9il.js";import{u as Ya}from"../chunks/i18n.svelte.DPkpATkG.js";import{T as Q}from"../chunks/Template.CTK3kKGi.js";var Za=fa('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>');function Ja(me,X){let c=ke(X,"color",3,"var(--col-text)"),y=ke(X,"opacity",3,.9),D=ke(X,"width",3,24);var w=Za();V(w,"stroke-width",2),$(()=>{V(w,"width",D()),V(w,"color",c()),V(w,"opacity",y())}),o(me,w)}var et=g('<img alt="No Logo Available">'),at=g('<a class="home svelte-1ljcjf3"><!></a>'),tt=g('<div role="button" tabindex="0" class="forgotten svelte-1ljcjf3"> </div>'),rt=g("<!> <!>",1),st=g('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),lt=g('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),it=g("<!> <!> <!>",1),ot=g('<div class="flex-inline svelte-1ljcjf3"><img alt="" width="20" height="20"> <span class="providerName svelte-1ljcjf3"> </span></div>'),ct=g('<div class="providers flex-col svelte-1ljcjf3"></div>'),nt=g('<div class="errMsg errMsgApi svelte-1ljcjf3"> </div>'),vt=g('<div class="success svelte-1ljcjf3"> </div>'),dt=g('<a class="reg svelte-1ljcjf3" target="_blank"> </a>'),ut=g('<a class="reg svelte-1ljcjf3" href="/auth/v1/users/register" target="_blank"> </a>'),mt=g('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),gt=g('<div class="container svelte-1ljcjf3"><div class="head svelte-1ljcjf3"><div class="logo svelte-1ljcjf3"><!></div> <!></div> <div class="name svelte-1ljcjf3"><h2> </h2></div> <!> <!> <!> <!> <!> <!> <!></div> <!>',1),ht=g("<!> <!> <!> <!> <!> <!> <!>",1);function ft(me,X){pa(X,!1);let c=Ya(),y=i(),D=i(""),w=i(""),E=i(""),Y=i(""),Z=i([]),J=i(),ee=i(),ae=i(),te=i(),ge=i(!1),H=i(),ne=i([]),re=i(),q=i(!1),b=i(""),A=i(""),se=i(""),B=i(!1),F=i(!1),ve=i(!1),de=i(!1),le=i(!1),G=i(!1),xe="",he=i(!1),l=i({email:"",password:""}),k=i({}),fe=i({});$a(async()=>{const t=Ca();a(y,t.client_id),a(E,t.redirect_uri),a(Y,t.nonce),a(Z,t.scope.split(" ")),a(ee,t.state),a(ae,t.code_challenge),a(te,t.code_challenge_method),t.login_hint&&C(l,e(l).email=t.login_hint)});function Me(){a(b,""),a(ve,!0),C(l,e(l).password="")}async function pe(){a(b,"");try{await e(fe).validate(e(l),{abortEarly:!1}),a(k,{})}catch(p){a(k,Ee(p));return}const t={email:e(l).email,client_id:e(y),redirect_uri:e(E),state:e(ee),code_challenge:e(ae),code_challenge_method:e(te),nonce:e(Y),scopes:e(Z)};if(e(B)&&e(l).email!==e(H)){if(!e(l).password){C(k,e(k).password=c.passwordRequired);return}if(e(l).password.length>256){C(k,e(k).password="max 256");return}t.password=e(l).password}a(q,!0);let f=await Va(t);await ze(f)}async function ze(t){if(t.status===202)window.location.replace(t.headers.get("location"));else if(t.status===200)a(b,""),a(re,await t.json());else if(t.status===406)a(b,c.authorize.clientForceMfa),a(F,!0);else if(t.status===429){let f=Number.parseInt(t.headers.get("x-retry-not-before")),p=qa(f),x=f*1e3-new Date().getTime();a(G,!0),a(b,`${c.authorize.http429} ${p}`),C(l,e(l).email=""),C(l,e(l).password=""),a(B,!1),setTimeout(()=>{a(G,!1),a(b,"")},x)}else e(B)?(a(b,c.authorize.invalidCredentials),a(de,!0)):(a(B,!0),xe=e(l).email);a(q,!1)}function Ke(){e(B)&&xe!==e(l).email&&(a(B,!1),C(l,e(l).password=""),a(b,""))}function Qe(t){Aa(64,(f,{challenge:p,verifier:x})=>{f||(localStorage.setItem(Ba,x),Xe(t,p))})}async function Xe(t,f){let p={email:e(l).email||null,client_id:e(y),redirect_uri:e(E),scopes:e(Z),state:e(ee),nonce:e(Y),code_challenge:e(ae),code_challenge_method:e(te),provider_id:t,pkce_challenge:f},x=await Fa(p);if(x.ok){const W=await x.text();Ga(W),window.location.href=x.headers.get("location")}else{let W=await x.json();a(b,W.message)}}function Ye(){a(re,void 0)}function Ze(t){t&&window.location.replace(t.loc)}async function Je(){try{await e(fe).validate(e(l),{abortEarly:!1}),a(k,{})}catch(p){a(k,Ee(p));return}let t={email:e(l).email};e(w)&&(t.redirect_uri=encodeURI(e(w))),a(q,!0);let f=await Oa(t);if(f.ok)a(le,!0);else{let p=await f.json();a(b,p.message)}a(q,!1)}S(()=>Ea,()=>{c&&a(fe,Sa().shape({email:Da().required(c.authorize.emailRequired).email(c.authorize.emailBadFormat)}))}),S(()=>e(A),()=>{var t;e(A)&&(e(A)==="Refresh"?a(ge,!0):(t=e(A))!=null&&t.startsWith("MfaLogin ")&&a(H,e(A).replace("MfaLogin ","")))}),S(()=>(e(ge),e(y),e(E),e(ee),e(ae),e(te),e(Y),e(Z),He),()=>{var t,f;if(e(ge)&&((t=e(y))==null?void 0:t.length)>0&&((f=e(E))==null?void 0:f.length)>0){a(q,!0);const p={client_id:e(y),redirect_uri:e(E),state:e(ee),code_challenge:e(ae),code_challenge_method:e(te),nonce:e(Y),scopes:e(Z)};ya().then(()=>He(p).then(x=>ze(x)))}}),S(()=>e(H),()=>{e(H)&&C(l,e(l).email=e(H))}),S(()=>e(le),()=>{e(le)&&setTimeout(()=>{a(le,!1),a(ve,!1),a(de,!1)},3e3)}),S(()=>e(J),()=>{e(J)&&e(J).focus()}),S(()=>(e(se),We),()=>{e(se)&&We(e(se))}),wa(),za();var Ce=ht();ba(t=>{$(()=>_a.title=`Login ${(e(D)||e(y))??""}`)});var Le=K(Ce);Q(Le,{id:La,get value(){return e(ne)},set value(t){a(ne,t)},$$legacy:!0});var Re=n(Le,2);Q(Re,{id:Ra,get value(){return e(D)},set value(t){a(D,t)},$$legacy:!0});var Ie=n(Re,2);Q(Ie,{id:Ia,get value(){return e(w)},set value(t){a(w,t)},$$legacy:!0});var Te=n(Ie,2);Q(Te,{id:Ta,get value(){return e(se)},set value(t){a(se,t)},$$legacy:!0});var Ue=n(Te,2);Q(Ue,{id:Ua,get value(){return e(A)},set value(t){a(A,t)},$$legacy:!0});var Ne=n(Ue,2);Q(Ne,{id:Na,get value(){return e(he)},set value(t){a(he,t)},$$legacy:!0});var ea=n(Ne,2);Qa(ea,{children:(t,f)=>{Xa(t,{children:(p,x)=>{var W=gt(),$e=K(W),we=h($e),je=h(we),aa=h(je);{var ta=r=>{var s=et();$(()=>V(s,"src",`/auth/v1/clients/${e(y)}/logo`)),o(r,s)};_(aa,r=>{e(y)&&r(ta)})}d(je);var ra=n(je,2);{var sa=r=>{var s=at(),u=h(s);Ja(u,{opacity:.5}),d(s),$(()=>V(s,"href",e(w))),o(r,s)};_(ra,r=>{e(w)&&r(sa)})}d(we);var _e=n(we,2),Ve=h(_e),la=h(Ve,!0);d(Ve),d(_e);var qe=n(_e,2);{var ia=r=>{Ha(r,{t:c,onSuccess:Ze,onError:Ye,get data(){return e(re)},set data(s){a(re,s)},$$legacy:!0})};_(qe,r=>{e(re)&&r(ia)})}var Ae=n(qe,2);{var oa=r=>{var s=it(),u=K(s),I=Se(()=>e(G)||e(F));Pa(u,{type:"email",name:"rauthyEmail",autocomplete:"email",get placeholder(){return c.common.email},get disabled(){return e(I)},get value(){return e(l).email},set value(m){C(l,e(l).email=m)},get error(){return e(k).email},set error(m){C(k,e(k).email=m)},$$events:{enter:pe,input:Ke},children:(m,U)=>{ce();var P=oe();$(()=>L(P,c.common.email.toUpperCase())),o(m,P)},$$slots:{default:!0},$$legacy:!0});var O=n(u,2);{var M=m=>{var U=rt(),P=K(U),ye=Se(()=>e(G)||e(F));Wa(P,{name:"rauthyPassword",get error(){return e(k).password},autocomplete:"current-password",get placeholder(){return c.common.password},get disabled(){return e(ye)},get bindThis(){return e(J)},set bindThis(v){a(J,v)},get value(){return e(l).password},set value(v){C(l,e(l).password=v)},$$events:{enter:pe},children:(v,z)=>{ce();var R=oe();$(()=>L(R,c.common.password.toUpperCase())),o(v,R)},$$slots:{default:!0},$$legacy:!0});var be=n(P,2);{var N=v=>{var z=tt(),R=h(z,!0);d(z),$(()=>L(R,c.authorize.passwordForgotten)),xa(7,z,()=>Ma),De("click",z,Me),De("keypress",z,Me),o(v,z)};_(be,v=>{e(de)&&!e(G)&&v(N)})}o(m,U)};_(O,m=>{e(B)&&e(H)!==e(l).email&&!e(ve)&&m(M)})}var j=n(O,2);{var T=m=>{var U=Pe(),P=K(U);{var ye=N=>{var v=st(),z=h(v);ue(z,{$$events:{click:Je},children:(R,ha)=>{ce();var ie=oe();$(()=>L(ie,c.authorize.passwordRequest)),o(R,ie)},$$slots:{default:!0}}),d(v),o(N,v)},be=N=>{var v=lt(),z=h(v);ue(z,{get isLoading(){return e(q)},set isLoading(R){a(q,R)},$$events:{click:pe},children:(R,ha)=>{ce();var ie=oe();$(()=>L(ie,c.authorize.login)),o(R,ie)},$$slots:{default:!0},$$legacy:!0}),d(v),o(N,v)};_(P,N=>{e(ve)?N(ye):N(be,!1)})}o(m,U)};_(j,m=>{!e(G)&&!e(F)&&m(T)})}o(r,s)};_(Ae,r=>{e(F)||r(oa)})}var Be=n(Ae,2);{var ca=r=>{var s=ct();ka(s,5,()=>e(ne),u=>u.id,(u,I)=>{ue(u,{level:3,$$events:{click:()=>Qe(e(I).id)},children:(O,M)=>{var j=ot(),T=h(j),m=n(T,2),U=h(m,!0);d(m),d(j),$(()=>{V(T,"src",`/auth/v1/providers/${e(I).id}/img`),L(U,e(I).name)}),o(O,j)},$$slots:{default:!0}})}),d(s),o(r,s)};_(Be,r=>{e(ne)&&r(ca)})}var Fe=n(Be,2);{var na=r=>{var s=nt(),u=h(s,!0);d(s),$(()=>L(u,e(b))),o(r,s)};_(Fe,r=>{e(b)&&r(na)})}var Ge=n(Fe,2);{var va=r=>{var s=vt(),u=h(s,!0);d(s),$(()=>L(u,c.authorize.emailSentMsg)),o(r,s)};_(Ge,r=>{e(le)&&r(va)})}var Oe=n(Ge,2);{var da=r=>{var s=Pe(),u=K(s);{var I=M=>{var j=dt(),T=h(j,!0);d(j),$(()=>{V(j,"href",`/auth/v1/users/register?redirect_uri=${e(w)??""}`),L(T,c.authorize.signUp)}),o(M,j)},O=M=>{var j=ut(),T=h(j,!0);d(j),$(()=>L(T,c.authorize.signUp)),o(M,j)};_(u,M=>{e(w)?M(I):M(O,!1)})}o(r,s)};_(Oe,r=>{e(he)&&!e(F)&&!e(de)&&!e(G)&&r(da)})}var ua=n(Oe,2);{var ma=r=>{var s=mt(),u=h(s);ue(u,{$$events:{click:()=>window.location.href="/auth/v1/account"},children:(I,O)=>{ce();var M=oe("ACCOUNT");o(I,M)},$$slots:{default:!0}}),d(s),o(r,s)};_(ua,r=>{e(F)&&r(ma)})}d($e);var ga=n($e,2);Ka(ga,{absolute:!0}),$(()=>L(la,e(D)||e(y))),o(p,W)},$$slots:{default:!0}})},$$slots:{default:!0}}),o(me,Ce),ja()}export{ft as component};
