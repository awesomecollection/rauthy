import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.pqhLE6I2.js";import{p as H,a4 as Y,s as f,c as m,a as W,u as e,aq as U,t as D,r as p,F as fe,a9 as F,w as S,v as n,f as R,ao as ke}from"../chunks/index-client.ChFmlJin.js";import{s as E,r as Se}from"../chunks/render.D821es-0.js";import{i as B}from"../chunks/if.DhkeN2Rc.js";import{e as ge,i as Ce}from"../chunks/each.QTCItWz3.js";import{a as h,t as A,d as M,e as ue}from"../chunks/template.DOaMAhd6.js";import{s as oe,d as Te}from"../chunks/class.CSTj5U-k.js";import{t as ee,s as ae,a as ne}from"../chunks/index.BCW953sO.js";import{p as k}from"../chunks/proxy.DVTQVrWW.js";import{d as he,c as Pe,b as Ge,f as Ae}from"../chunks/fetch.BnpwKXAn.js";import{C as Oe}from"../chunks/ContentAdmin.DzfHDjJm.js";import{I as re,k as ye,N as Ne}from"../chunks/InputCheckbox.-113LWu-.js";import{N as De}from"../chunks/NavSub.DIqUhf-7.js";import{B as Ee}from"../chunks/ButtonAddModal.B27JWl2h.js";import{u as Ve}from"../chunks/param.svelte.DWGi01YI.js";import{u as te}from"../chunks/i18n_admin.svelte.DaAJojhX.js";import{O as je}from"../chunks/OrderSearchBar.B1t7qsWa.js";import{p as J,r as qe}from"../chunks/props.B17NqqFW.js";import{A as be}from"../chunks/helpers.BweJi6s8.js";import{B as Q}from"../chunks/Button.DAsYf-wl.js";import{I as Ke}from"../chunks/IconCheck.D6Zcehxl.js";import{L as Ue}from"../chunks/LabeledValue.CC-TygYe.js";import{I as we}from"../chunks/InputDateTimeCombo.D5LtiRAE.js";import{u as se}from"../chunks/i18n.svelte.CKzx-KOG.js";import{f as ie,a as me}from"../chunks/form.DekAF1-C.js";import{h as pe}from"../chunks/html.Wle1g9_X.js";import{I as Re,a as Be,b as Fe}from"../chunks/PasswordInput.BLD_vrrz.js";import{b as Me}from"../chunks/input.DBuVJGyE.js";import{I as Xe}from"../chunks/InputPassword.tlRElBzV.js";import{T as He}from"../chunks/Tabs.CrvTH8nn.js";import{I as We}from"../chunks/Input.1-DRzlwb.js";import{d as Je}from"../chunks/patterns.C8SwZZE-.js";import{F as Qe}from"../chunks/Form.CETj1VzV.js";var Ye=A('<div class="center svelte-opxw4z"><!></div>'),Ze=A("<div><!></div>"),ea=A('<div class="row svelte-opxw4z"><!> <div class="center svelte-opxw4z"><!></div> <div class="center svelte-opxw4z"><!></div> <div class="center svelte-opxw4z"><!></div> <div class="center svelte-opxw4z"><!></div></div>'),aa=A('<div class="matrix svelte-opxw4z"><div class="row svelte-opxw4z"><div></div> <!> <!> <!> <!></div> <!></div>');function $e(V,i){H(i,!0),J(i,"finalize",15)(I);let y=k([["Blacklist",!1,!1,!1,!1],["Clients",!1,!1,!1,!1],["Events",!1,!1,!1,!1],["Generic",!1,!1,!1,!1],["Groups",!1,!1,!1,!1],["Roles",!1,!1,!1,!1],["Secrets",!1,!1,!1,!1],["Sessions",!1,!1,!1,!1],["Scopes",!1,!1,!1,!1],["UserAttributes",!1,!1,!1,!1],["Users",!1,!1,!1,!1]]);Y(()=>{if(C(),i.key)for(let s of i.key.access){let a;switch(s.group){case"Blacklist":a=0;break;case"Clients":a=1;break;case"Events":a=2;break;case"Generic":a=3;break;case"Groups":a=4;break;case"Roles":a=5;break;case"Secrets":a=6;break;case"Sessions":a=7;break;case"Scopes":a=8;break;case"UserAttributes":a=9;break;case"Users":a=10;break}if(a===void 0){console.error("invalid idx during access key buildup");return}s.access_rights.includes("create")&&(y[a][1]=!0),s.access_rights.includes("read")&&(y[a][2]=!0),s.access_rights.includes("update")&&(y[a][3]=!0),s.access_rights.includes("delete")&&(y[a][4]=!0)}});function I(){let s=[];for(let a of y){let $=[];a[1]&&$.push("create"),a[2]&&$.push("read"),a[3]&&$.push("update"),a[4]&&$.push("delete"),$.length>0&&s.push({group:a[0],access_rights:$})}return s}function C(){for(let s of y)s[1]=!1,s[2]=!1,s[3]=!1,s[4]=!1}function d(s){for(let a of y)if(a[0]===s){a[1]&&a[2]&&a[3]&&a[4]?(a[1]=!1,a[2]=!1,a[3]=!1,a[4]=!1):(a[1]=!0,a[2]=!0,a[3]=!0,a[4]=!0);break}}function x(s){let a;switch(s){case"create":a=1;break;case"read":a=2;break;case"update":a=3;break;case"delete":a=4;break}if(!a){console.error("logic error in toggleRight, idx is undefined");return}let $=!0;for(let l of y)if(!l[a]){$=!1;break}for(let l of y)l[a]=!$}var b=aa();{const s=($,l=fe)=>{var w=Ye(),P=m(w),o=F(()=>`Toggle: ${l()}`);Q(P,{get ariaLabel(){return e(o)},invisible:!0,onclick:()=>x(l()),children:(c,u)=>{U();var _=M();D(()=>E(_,l())),h(c,_)},$$slots:{default:!0}}),p(w),h($,w)},a=($,l=fe)=>{var w=Ze(),P=m(w),o=F(()=>`Toggle: ${l()}`);Q(P,{get ariaLabel(){return e(o)},invisible:!0,onclick:()=>d(l()),children:(c,u)=>{U();var _=M();D(()=>E(_,l())),h(c,_)},$$slots:{default:!0}}),p(w),h($,w)};var T=m(b),z=f(m(T),2);s(z,()=>"create");var L=f(z,2);s(L,()=>"read");var O=f(L,2);s(O,()=>"update");var g=f(O,2);s(g,()=>"delete"),p(T);var G=f(T,2);ge(G,17,()=>y,Ce,($,l,w)=>{var P=ea(),o=m(P);a(o,()=>e(l)[0]);var c=f(o,2),u=m(c),_=F(()=>`${e(l)[0]}: create`);re(u,{get ariaLabel(){return e(_)},get checked(){return y[w][1]},set checked(K){y[w][1]=K}}),p(c);var r=f(c,2),t=m(r),v=F(()=>`${e(l)[0]}: read`);re(t,{get ariaLabel(){return e(v)},get checked(){return y[w][2]},set checked(K){y[w][2]=K}}),p(r);var N=f(r,2),q=m(N),j=F(()=>`${e(l)[0]}: update`);re(q,{get ariaLabel(){return e(j)},get checked(){return y[w][3]},set checked(K){y[w][3]=K}}),p(N);var X=f(N,2),le=m(X),Z=F(()=>`${e(l)[0]}: delete`);re(le,{get ariaLabel(){return e(Z)},get checked(){return y[w][4]},set checked(K){y[w][4]=K}}),p(X),p(P),h($,P)}),p(b)}h(V,b),W()}var ra=A("<div><!></div>"),ta=A('<div class="err"> </div>'),sa=A('<!> <!> <!> <!> <div class="btn svelte-1j50zcx"><!> <!> <!></div>',1);function ia(V,i){H(i,!0);let y=se(),I=te();const C=ie();let d=S(""),x=S(!1),b=S(!!i.key.expires),T=S(k(ie())),z=S(k(me())),L=S(void 0);Y(()=>{i.key.name&&n(b,!!i.key.expires)}),Y(()=>{if(e(b)){let r;i.key.expires?r=new Date(i.key.expires*1e3):r=new Date,n(T,k(ie(r))),n(z,k(me(r)))}});async function O(){if(n(d,""),!e(L)){console.error("finalizeMatrix is undefined");return}let r={name:i.key.name,access:e(L)()};if(r.access.length===0){n(d,"Grant the API Key at least one permission");return}if(e(b)){let v=be(e(T),e(z));if(!v){n(d,"Invalid Date Input: User Expires");return}r.exp=v}let t=await he(`/auth/v1/api_keys/${i.key.name}`,r);t.error?n(d,k(t.error.message)):(i.onSave(),n(x,!0),setTimeout(()=>{n(x,!1),i.onSave()},2e3))}var g=sa(),G=R(g);Ue(G,{get label(){return I.api_key.keyName},children:(r,t)=>{U();var v=M();D(()=>E(v,i.key.name)),h(r,v)},$$slots:{default:!0}});var s=f(G,2);re(s,{get ariaLabel(){return I.api_key.limitedValidity},get checked(){return e(b)},set checked(r){n(b,k(r))},children:(r,t)=>{U();var v=M();D(()=>E(v,I.api_key.limitedValidity)),h(r,v)},$$slots:{default:!0}});var a=f(s,2);{var $=r=>{var t=ra(),v=m(t);we(v,{get label(){return I.api_key.expires},withTime:!0,min:C,required:!0,get value(){return e(T)},set value(N){n(T,k(N))},get timeValue(){return e(z)},set timeValue(N){n(z,k(N))}}),p(t),ee(3,t,()=>ae),h(r,t)};B(a,r=>{e(b)&&r($)})}var l=f(a,2);$e(l,{get key(){return i.key},get finalize(){return e(L)},set finalize(r){n(L,k(r))}});var w=f(l,2),P=m(w);Q(P,{onclick:O,children:(r,t)=>{U();var v=M();D(()=>E(v,y.common.save)),h(r,v)},$$slots:{default:!0}});var o=f(P,2);{var c=r=>{Ke(r,{})};B(o,r=>{e(x)&&r(c)})}var u=f(o,2);{var _=r=>{var t=ta(),v=m(t,!0);p(t),D(()=>E(v,e(d))),h(r,t)};B(u,r=>{e(d)&&r(_)})}p(w),h(V,g),W()}var oa=A("<div><!></div>"),na=A("<div><!></div>"),la=A("<div><!></div>"),ca=A('<div><div class="iconsOuter svelte-1pc4fk7"><div class="iconsInner svelte-1pc4fk7"><!> <!></div></div> <textarea></textarea></div>');function xe(V,i){H(i,!0);let y=J(i,"ariaLabel",3,""),I=J(i,"value",3,""),C=J(i,"rows",3,10),d=J(i,"cols",3,60),x=J(i,"show",15,!1),b=J(i,"width",3,"min(25rem, calc(100dvw - .5rem))"),T=qe(i,["$$slots","$$events","$$legacy","ariaLabel","value","rows","cols","show","width"]),z=se(),L=S(""),O=S("");Y(()=>{x()?n(O,I()):n(O,k(e(L)))}),ke(()=>{for(let u=0;u<I().length;u++)n(L,e(L)+"*");n(O,k(e(L))),x(!1)});function g(){navigator.clipboard.writeText(I())}function G(){x(!x())}var s=ca(),a=m(s),$=m(a),l=m($),w=F(()=>x()?z.common.hide:z.common.show);Q(l,{get ariaLabel(){return e(w)},invisible:!0,onclick:G,children:(u,_)=>{var r=ue(),t=R(r);{var v=q=>{var j=oa(),X=m(j);Be(X,{width:22}),p(j),D(()=>oe(j,"title",z.common.hide)),h(q,j)},N=q=>{var j=na(),X=m(j);Fe(X,{width:22}),p(j),D(()=>oe(j,"title",z.common.show)),h(q,j)};B(t,q=>{x()?q(v):q(N,!1)})}h(u,r)},$$slots:{default:!0}});var P=f(l,2);Q(P,{get ariaLabel(){return z.common.copyToClip},invisible:!0,onclick:g,children:(u,_)=>{var r=la(),t=m(r);Re(t,{}),p(r),D(()=>oe(r,"title",z.common.copyToClip)),h(u,r)},$$slots:{default:!0}}),p($),p(a);var o=f(a,2);Se(o);let c;p(s),D(()=>{ne(s,"width",`${b()}`),c=Te(o,c,{"aria-label":y(),disabled:!0,rows:C(),cols:d(),...T},"svelte-1pc4fk7"),ne(o,"width",b()),ne(o,"padding-right","2.75rem")}),Me(o,()=>e(O),u=>n(O,u)),h(V,s),W()}var va=A('<div class="secret font-mono svelte-1ii2aob"><!></div> <div><p><!></p> <p><span class="headerCode"><b><code></code></b></span></p></div> <div><p><!></p> <!></div> <div><p><!></p> <!></div>',1),da=A('<p> </p> <p> </p> <div class="btn svelte-1ii2aob"><!></div> <!> <div class="err"> </div>',1);function ua(V,i){H(i,!0);let y=se(),I=te(),C=S(""),d=S(""),x=S(""),b=S("");Y(()=>{i.key.name&&n(d,"")});async function T(){var u;let c=await he(`/auth/v1/api_keys/${i.key.name}/secret`);c.text?(n(d,k(c.text)),n(x,`curl -s -H 'Authorization: API-Key ${c.text}' ${window.location.origin}/auth/v1/api_keys/${i.key.name}/test`),n(b,`${e(x)} | jq`)):n(C,k(((u=c.error)==null?void 0:u.message)||"Error"))}var z=da(),L=R(z),O=m(L,!0);p(L);var g=f(L,2),G=m(g,!0);p(g);var s=f(g,2),a=m(s),$=F(()=>e(d)?3:1);Q(a,{get level(){return e($)},onclick:T,children:(c,u)=>{U();var _=M();D(()=>E(_,y.passwordReset.generate)),h(c,_)},$$slots:{default:!0}}),p(s);var l=f(s,2);{var w=c=>{var u=va(),_=R(u),r=m(_);Xe(r,{autocomplete:"off",get value(){return e(d)},label:"API Key",placeholder:"API Key",disabled:!0,showCopy:!0,width:"min(25rem, calc(100dvw - .5rem))"}),p(_);var t=f(_,2),v=m(t),N=m(v);pe(N,()=>I.api_key.generate3),p(v);var q=f(v,2),j=m(q),X=m(j),le=m(X);le.textContent="API-Key <api_key>",p(X),p(j),p(q),p(t);var Z=f(t,2),K=m(Z),_e=m(K);pe(_e,()=>I.api_key.generate4),p(K);var ze=f(K,2);ye(ze,()=>e(b),de=>{xe(de,{ariaLabel:"curl text command with jq",rows:5,get value(){return e(b)}})}),p(Z);var ce=f(Z,2),ve=m(ce),Ie=m(ve);pe(Ie,()=>I.api_key.generate5),p(ve);var Le=f(ve,2);ye(Le,()=>e(b),de=>{xe(de,{ariaLabel:"curl text command simple",rows:5,get value(){return e(x)}})}),p(ce),ee(3,_,()=>ae,()=>({duration:150})),ee(3,t,()=>ae,()=>({duration:150})),ee(3,Z,()=>ae,()=>({duration:150})),ee(3,ce,()=>ae,()=>({duration:150})),h(c,u)};B(l,c=>{e(d)&&c(w)})}var P=f(l,2),o=m(P,!0);p(P),D(()=>{E(O,I.api_key.generate1),E(G,I.api_key.generate2),E(o,e(C))}),h(V,z),W()}var ma=A('<div class="err"> </div>'),pa=A("<p> </p> <!> <!>",1);function fa(V,i){H(i,!0);let y=se(),I=te(),C=S("");async function d(){n(C,"");let g=await Pe(`/auth/v1/api_keys/${i.key.name}`);g.error?n(C,k(g.error.message)):i.onSave()}var x=pa(),b=R(x),T=m(b,!0);p(b);var z=f(b,2);Q(z,{level:-1,onclick:d,children:(g,G)=>{U();var s=M();D(()=>E(s,y.common.delete)),h(g,s)},$$slots:{default:!0}});var L=f(z,2);{var O=g=>{var G=ma(),s=m(G,!0);p(G),D(()=>E(s,e(C))),h(g,G)};B(L,g=>{e(C)&&g(O)})}D(()=>E(T,I.api_key.delete1)),h(V,x),W()}var ka=A('<div><div class="flex"><!></div> <!></div>');function ga(V,i){H(i,!0);let y=J(i,"key",15),I=te();const C=[I.tabs.config,"Secret",I.tabs.delete];let d=S(k(C[0]));var x=ka(),b=m(x),T=m(b);He(T,{tabs:C,get selected(){return e(d)},set selected(g){n(d,k(g))}}),p(b);var z=f(b,2);{var L=g=>{ia(g,{get onSave(){return i.onSave},get key(){return y()},set key(G){y(G)}})},O=g=>{var G=ue(),s=R(G);{var a=l=>{ua(l,{get key(){return y()}})},$=l=>{var w=ue(),P=R(w);{var o=c=>{fa(c,{get key(){return y()},get onSave(){return i.onSave}})};B(P,c=>{e(d)===I.tabs.delete&&c(o)},!0)}h(l,w)};B(s,l=>{e(d)==="Secret"?l(a):l($,!1)},!0)}h(g,G)};B(z,g=>{e(d)===I.tabs.config?g(L):g(O,!1)})}p(x),h(V,x),W()}var ha=A("<div><!></div>"),ya=A('<!> <!> <!> <!> <!> <div class="err"> </div>',1),ba=A('<div class="container svelte-1dweyfr"><!></div>');function wa(V,i){H(i,!0);const y=ie();let I=se(),C=te(),d=S(""),x=S(!1),b=S(void 0),T=S(""),z=S(k(ie())),L=S(k(me()));async function O(s,a){var P;n(d,"");for(let o of i.keys)if(o.name===e(T)){n(d,"Name already exists");return}let $=(P=e(b))==null?void 0:P();if(!$){console.error("access rights is undefined");return}let l={name:e(T),access:$};if(l.access.length===0){n(d,"Grant the new API Key at least one permission");return}if(e(x)){if(console.log(),!e(z)||!e(L)){n(d,"Disable expiry or provide an valid date and time");return}let o=be(e(z),e(L));if(!o){n(d,"Invalid Date Input: User Expires");return}l.exp=o}let w=await Ge(s.action,l);w.error?n(d,k(w.error.message)):i.onSave()}var g=ba(),G=m(g);Qe(G,{action:"/auth/v1/api_keys",onSubmit:O,children:(s,a)=>{var $=ya(),l=R($);We(l,{get label(){return C.api_key.keyName},get placeholder(){return C.api_key.keyName},autocomplete:"off",required:!0,min:"2",max:"24",pattern:Je,get value(){return e(T)},set value(t){n(T,k(t))}});var w=f(l,2);re(w,{get ariaLabel(){return C.api_key.limitedValidity},get checked(){return e(x)},set checked(t){n(x,k(t))},children:(t,v)=>{U();var N=M();D(()=>E(N,C.api_key.limitedValidity)),h(t,N)},$$slots:{default:!0}});var P=f(w,2);{var o=t=>{var v=ha(),N=m(v);we(N,{get label(){return C.api_key.expires},withTime:!0,min:y,required:!0,get value(){return e(z)},set value(q){n(z,k(q))},get timeValue(){return e(L)},set timeValue(q){n(L,k(q))}}),p(v),ee(3,v,()=>ae),h(t,v)};B(P,t=>{e(x)&&t(o)})}var c=f(P,2);$e(c,{get finalize(){return e(b)},set finalize(t){n(b,k(t))}});var u=f(c,2);Q(u,{type:"submit",children:(t,v)=>{U();var N=M();D(()=>E(N,I.common.save)),h(t,N)},$$slots:{default:!0}});var _=f(u,2),r=m(_,!0);p(_),D(()=>E(r,e(d))),h(s,$)},$$slots:{default:!0}}),p(g),h(V,g),W()}var $a=A("<div></div> <!>",1),xa=A("<!> <!>",1),_a=A('<div id="keys"><!></div>'),za=A(" <!> <!>",1);function Ia(V,i){H(i,!0);let y=te(),I=S(void 0),C=S(""),d=S(k([])),x=S(k([])),b=S(void 0),T=Ve("kn");const z=["Name"],L=["Name"];let O=S(k(L[0])),g=S("");ke(()=>{G()}),Y(()=>{n(b,k(e(d).find(o=>o.name===T.get())))}),Y(()=>{let o=e(g).toLowerCase();o?e(O)===L[0]&&n(x,k(e(d).filter(c=>{var u;return(u=c.name)==null?void 0:u.includes(o)}))):n(x,k(e(d)))});async function G(){var c;let o=await Ae("/auth/v1/api_keys");o.body?n(d,k(o.body.keys)):n(C,k(((c=o.error)==null?void 0:c.message)||"Error"))}function s(o,c){let u=c==="up";o===z[0]&&e(d).sort((_,r)=>u?_.name.localeCompare(r.name):r.name.localeCompare(_.name))}function a(){var o;(o=e(I))==null||o(),G()}U();var $=za(),l=R($),w=f(l);De(w,{paddingTop:"2.1rem",buttonTilesAriaControls:"keys",width:"min(20rem, 100dvw)",thresholdNavSub:700,buttonTiles:o=>{var c=$a(),u=R(c);ne(u,"height",".5rem");var _=f(u,2);ge(_,17,()=>e(x),r=>r.name,(r,t)=>{var v=F(()=>T.get()===e(t).name);Ne(r,{onclick:()=>T.set(e(t).name),get selected(){return e(v)},children:(N,q)=>{U();var j=M();D(()=>E(j,e(t).name)),h(N,j)},$$slots:{default:!0}})}),h(o,c)},children:(o,c)=>{var u=xa(),_=R(u),r=F(()=>e(d).length===0?1:2);Ee(_,{get level(){return e(r)},alignRight:!0,get closeModal(){return e(I)},set closeModal(v){n(I,k(v))},children:(v,N)=>{wa(v,{get keys(){return e(d)},onSave:a})},$$slots:{default:!0}});var t=f(_,2);je(t,{searchOptions:L,orderOptions:z,onChangeOrder:s,searchWidth:"min(19.5rem, 100dvw - .5rem)",get searchOption(){return e(O)},set searchOption(v){n(O,k(v))},get value(){return e(g)},set value(v){n(g,k(v))}}),h(o,u)},$$slots:{buttonTiles:!0,default:!0}});var P=f(w,2);Oe(P,{children:(o,c)=>{var u=_a(),_=m(u);{var r=t=>{ga(t,{onSave:G,get key(){return e(b)},set key(v){n(b,k(v))}})};B(_,t=>{e(b)&&t(r)})}p(u),D(()=>oe(u,"aria-label",y.common.details)),h(o,u)},$$slots:{default:!0}}),D(()=>E(l,`${e(C)??""} `)),h(V,$),W()}function La(V){Ia(V,{})}export{La as component};
