import"../chunks/disclose-version.BDr9Qe-U.js";import{j as e,U as c,g as t,R as u,W as o,T as m,P as f,p as Be,o as De,Q as U,a as Oe,$ as Se,V as ee}from"../chunks/index-client.CzqVbBUo.js";import{e as V,s as p}from"../chunks/render.DOFZNw8l.js";import{i as z,p as v}from"../chunks/if.BnegfJmL.js";import{e as Ue,i as Ve}from"../chunks/OptionSelect.CIygkAfc.js";import{a as s,b as x,t as ae,c as he}from"../chunks/template.C3U8HW1x.js";import{h as _e}from"../chunks/svelte-head.BSz900xL.js";import{r as Ee}from"../chunks/legacy-client.DtCljIS0.js";import{g as Fe,a0 as Ge,a1 as we,a2 as Ke,l as Ne,a3 as Qe,n as Xe}from"../chunks/dataFetching.BAMt2mQp.js";import{t as Y,s as Ye,b as ve,f as Ce,B as le}from"../chunks/Button.65naIT6w.js";import{t as ne}from"../chunks/helpers.BvaXa0cv.js";import{p as ue}from"../chunks/props.C_MHtC74.js";import{L as qe}from"../chunks/LangSelector.Co2kZP41.js";import{c as He,a as Ie,I as Je}from"../chunks/Input.BRe7i--g.js";import{f as Re}from"../chunks/pow.Dzo3VwU2.js";import{M as Ze,C as Me}from"../chunks/ContentCenter.D3vmDIv7.js";import{u as ea}from"../chunks/i18n.svelte.C_qSL0ZA.js";import{T as aa}from"../chunks/Template.CJON1Uel.js";var ta=x('<div class="circle svelte-10pff2x"></div>'),sa=x('<div class="circle svelte-10pff2x"></div>'),ra=x('<div class="circle svelte-10pff2x"></div>'),oa=x('<div class="container svelte-10pff2x"><div class="inner svelte-10pff2x"><!> <!> <!></div></div>');function ia(te,_){let q=ue(_,"offset",3,0),a=ue(_,"background",3,!0),E=ue(_,"local",3,!1),y=f(!0),$=f(!1),l=f(!1);setTimeout(()=>{e($,!0)},300),setTimeout(()=>{e(l,!0)},600);var g=oa(),b=c(g),F=c(b);{var H=i=>{var r=ta();V("introend",r,()=>e(y,!1)),V("outroend",r,()=>e(y,!0)),Y(7,r,()=>ve,()=>({delay:600,duration:1e3})),s(i,r)};z(F,i=>{t(y)&&i(H)})}var L=u(F,2);{var B=i=>{var r=sa();V("introend",r,()=>e($,!1)),V("outroend",r,()=>e($,!0)),Y(7,r,()=>ve,()=>({delay:600,duration:1e3})),s(i,r)};z(L,i=>{t($)&&i(B)})}var I=u(L,2);{var se=i=>{var r=ra();V("introend",r,()=>e(l,!1)),V("outroend",r,()=>e(l,!0)),Y(7,r,()=>ve,()=>({delay:600,duration:1e3})),s(i,r)};z(I,i=>{t(l)&&i(se)})}o(b),o(g),m(()=>{ne(g,"global",!E()),ne(g,"local",E()),ne(g,"background",a()),Ye(b,"style",`margin-top: ${`${q()}px`??""}`)}),Y(3,b,()=>Ce,()=>({duration:100})),Y(7,g,()=>Ce,()=>({duration:100})),s(te,g)}var da=x('<div class="desc svelte-19xxeot"> </div> <!> <!>',1),ca=x('<div class="desc svelte-19xxeot"><p> </p> <p> </p></div>'),va=x('<div class="desc svelte-19xxeot"><p class="declined svelte-19xxeot"> </p> <p> </p></div>'),la=x("<li> </li>"),na=x('<div class="desc svelte-19xxeot"> <ul></ul></div> <div class="inline svelte-19xxeot"><!> <!></div>',1),ua=x('<div class="container svelte-19xxeot"><div class="name svelte-19xxeot"><h2> </h2></div> <!> <div class="err svelte-19xxeot"> </div></div>'),pa=x("<!> <!>",1),ma=x("<!> <!>",1);function fa(te,_){Be(_,!0);const q="8rem";let a=ea(),E=f(void 0),y=f(""),$=f(8),l=f(!1),g=!1,b=f(void 0),F=f(!1),H=f(!1),L=v({userCode:""}),B=f(v({userCode:""})),I=f(v({}));Ee(()=>{a&&t($)&&e(I,v(He().shape({userCode:Ie().trim().min(t($),a.common.errTooShort).max(t($),a.common.errTooLong).matches(Ne,a.common.invalidInput)})))}),De(async()=>{const n=Fe();n.code&&(L.userCode=n.code);let G=await Ge();G.ok?e(E,v(await G.json())):n.code?we(`device?code=${n.code}`):we("device")});function se(){g&&r()}async function i(n){var K;if(e(y,""),g=!0,!await r())return;e(l,!0);let G=await Re(),re={user_code:L.userCode,pow:G,device_accepted:n};const j=await Qe(re);if(j.status===200){const P=await j.json();console.log(P),e(b,v(((K=P.scopes)==null?void 0:K.split(" "))||["openid"]))}else if(j.status===202)e(F,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3);else if(j.status===204)e(H,!0);else if(j.status===404)e(y,v(a.device.wrongOrExpired));else{const P=await j.json();e(y,v(P.message))}e(l,!1)}async function r(){try{return await t(I).validate(L,{abortEarly:!1}),e(B,v({userCode:""})),!0}catch(n){return e(B,v(Xe(n))),!1}}var pe=ma();_e(n=>{m(()=>Se.title=(a==null?void 0:a.device.title)||"Device Authorization")});var me=U(pe);aa(me,{id:Ke,get value(){return t($)},set value(n){e($,v(n))}});var ye=u(me,2);Ze(ye,{children:(n,G)=>{Me(n,{children:(re,j)=>{var K=pa(),P=U(K);{var be=D=>{ia(D,{})},Le=D=>{var oe=ua(),ie=c(oe),fe=c(ie),ke=c(fe,!0);o(fe),o(ie);var xe=u(ie,2);{var je=O=>{var N=da(),Q=U(N),de=c(Q,!0);m(()=>p(de,a.device.desc.replaceAll("{{count}}",t($)))),o(Q);var J=u(Q,2);Je(J,{name:"userCode",autocomplete:"off",get placeholder(){return a.device.userCode},get value(){return L.userCode},set value(d){L.userCode=d},get error(){return t(B).userCode},set error(d){t(B).userCode=d},$$events:{enter:i,input:se},children:(d,A)=>{ee();var h=ae();m(()=>p(h,a.device.userCode.toUpperCase())),s(d,h)},$$slots:{default:!0}});var T=u(J,2);le(T,{get isLoading(){return t(l)},set isLoading(d){e(l,v(d))},$$events:{click:()=>i("pending")},children:(d,A)=>{ee();var h=ae();m(()=>p(h,a.device.submit)),s(d,h)},$$slots:{default:!0}}),s(O,N)},Pe=O=>{var N=he(),Q=U(N);{var de=T=>{var d=ca(),A=c(d),h=c(A,!0);o(A);var R=u(A,2),k=c(R,!0);o(R),o(d),m(()=>{p(h,a.device.isAccepted),p(k,a.device.autoRedirectAccount)}),s(T,d)},J=T=>{var d=he(),A=U(d);{var h=k=>{var S=va(),W=c(S),Z=c(W,!0);o(W);var X=u(W,2),M=c(X,!0);o(X),o(S),m(()=>{p(Z,a.device.isDeclined),p(M,a.device.closeWindow)}),s(k,S)},R=k=>{var S=na(),W=U(S),Z=c(W),X=u(Z);Ue(X,21,()=>t(b),Ve,(w,ce)=>{var C=la(),ze=c(C,!0);o(C),m(()=>p(ze,t(ce))),s(w,C)}),o(X),o(W);var M=u(W,2),ge=c(M);le(ge,{level:1,width:q,get isLoading(){return t(l)},set isLoading(w){e(l,v(w))},$$events:{click:()=>i("accept")},children:(w,ce)=>{ee();var C=ae();m(()=>p(C,a.device.accept)),s(w,C)},$$slots:{default:!0}});var We=u(ge,2);le(We,{level:3,width:q,get isLoading(){return t(l)},set isLoading(w){e(l,v(w))},$$events:{click:()=>i("decline")},children:(w,ce)=>{ee();var C=ae();m(()=>p(C,a.device.decline)),s(w,C)},$$slots:{default:!0}}),o(M),m(()=>p(Z,`${a.device.descScopes??""} `)),s(k,S)};z(A,k=>{t(H)?k(h):k(R,!1)},!0)}s(T,d)};z(Q,T=>{t(F)?T(de):T(J,!1)},!0)}s(O,N)};z(xe,O=>{t(b)===void 0?O(je):O(Pe,!1)})}var $e=u(xe,2),Ae=c($e,!0);o($e),o(oe),m(()=>{p(ke,a.device.title),p(Ae,t(y))}),s(D,oe)};z(P,D=>{t(E)?D(Le,!1):D(be)})}var Te=u(P,2);qe(Te,{absolute:!0}),s(re,K)},$$slots:{default:!0}})},$$slots:{default:!0}}),s(te,pe),Oe()}export{fa as component};
