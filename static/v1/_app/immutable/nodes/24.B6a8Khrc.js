import"../chunks/disclose-version.BDr9Qe-U.js";import{p as ne,w as g,f as R,a as ce,v as c,s as r,c as s,u as t,r as a,ap as h,t as de}from"../chunks/runtime.BONl2e88.js";import{s as z}from"../chunks/render.AqJWcVDb.js";import{i as _}from"../chunks/if.DS90EFHs.js";import{a as l,t as w,d as y}from"../chunks/template.B7ldVCvc.js";import{p as m}from"../chunks/proxy.0BECmVET.js";import{o as ve}from"../chunks/index-client.Bjp_k6xO.js";import{g as fe}from"../chunks/helpers.mrWtKrwW.js";import{B as A}from"../chunks/Button.JPJkNEUa.js";import{I as K}from"../chunks/Input.KbCPDMgh.js";import{c as ue,a as Q}from"../chunks/index.esm.B2KJ0uBO.js";import{k as S,l as pe}from"../chunks/helpers.CQGRRstl.js";import{C as V}from"../chunks/CheckIcon.CqUmlXj7.js";import{c as ge}from"../chunks/dataFetching.CUoxx_U8.js";import{M as me}from"../chunks/Main.DMwa1Kwf.js";import{C as $e}from"../chunks/ContentCenter.BNNwHQjF.js";var he=w("<br>-> enable idp registration:<br> <code>chrome://flags/#fedcm-idp-registration</code>",1),we=w('<p><!></p> <p><!> <!> <!></p> <div class="row svelte-wuqbvo"><b>Logged In:</b> <div class="check svelte-wuqbvo"><!></div></div>',1),Ie=w('<div class="flex-col"><h1>FedCM Testing</h1> <div class="row svelte-wuqbvo"><div><b>FedCM supported:</b></div> <div class="check svelte-wuqbvo"><!></div></div> <!> <!></div>'),be=w('<div class="row svelte-wuqbvo"><b>Credential Type:</b> <span> </span></div> <div class="token svelte-wuqbvo"> </div>',1),Ce=w("<!> <!>",1);function ye(W,X){ne(X,!0);let T=g(""),I=g(!1),U=g(!1),k=g(""),x=g(""),n=m({clientId:"fedcm",configUrl:"any"}),f=g(m({}));const Y=ue().shape({clientId:Q().required("Client ID is required").trim().matches(S,"Must be URL safe"),configUrl:Q().nullable().trim().matches(S,"Must be URL safe")});ve(async()=>{if(c(T,`${window.location.origin}/auth/v1/fed_cm/config`),n.clientId=`${window.location.origin}/auth/v1/fed_cm/client_config`,(await ge()).ok?(console.log("FedCM status is: logged-in"),c(U,!0)):console.log("FedCM status is: logged-out"),window.IdentityProvider&&IdentityProvider.register!=null)console.log("FedCM is supported"),c(I,!0);else{console.error("FedCM is not supported");return}});async function Z(){if(!await M())return;let i=n.configUrl||void 0,u=n.clientId;console.log("using credentials get values: configUrl: "+i+" / clientId: "+u);try{let o=await navigator.credentials.get({identity:{mode:"button",providers:[{configURL:i,clientId:u,nonce:fe(48)}]}});console.log(o),c(x,m(o.type)),c(k,m(o.token)),c(U,!0)}catch(o){console.error("FedCM credentials error: "+o)}}function H(){IdentityProvider.register(t(T))}async function M(){try{return await Y.validate(n,{abortEarly:!1}),c(f,m({})),!0}catch(i){return c(f,m(pe(i))),!1}}var D=Ce(),E=R(D);me(E,{children:(i,u)=>{$e(i,{children:(o,q)=>{var $=Ie(),p=r(s($),2),b=r(s(p),2),re=s(b);V(re,{get check(){return t(I)}}),a(b),a(p);var G=r(p,2);{var te=d=>{var C=he();h(4),l(d,C)};_(G,d=>{t(I)||d(te)})}var oe=r(G,2);{var ie=d=>{var C=we(),F=R(C),se=s(F);A(se,{level:3,$$events:{click:H},children:(e,P)=>{h();var v=y("Register IdP");l(e,v)},$$slots:{default:!0}}),a(F);var L=r(F,2),N=s(L);K(N,{autocomplete:"off",placeholder:"Client Id",get value(){return n.clientId},set value(e){n.clientId=e},get error(){return t(f).clientId},set error(e){t(f).clientId=e},$$events:{input:M},children:(e,P)=>{h();var v=y("CLIENT ID");l(e,v)},$$slots:{default:!0}});var B=r(N,2);K(B,{autocomplete:"off",placeholder:"Config URL",get value(){return n.configUrl},set value(e){n.configUrl=e},get error(){return t(f).configUrl},set error(e){t(f).configUrl=e},$$events:{input:M},children:(e,P)=>{h();var v=y("CONFIG URL");l(e,v)},$$slots:{default:!0}});var ae=r(B,2);A(ae,{$$events:{click:Z},children:(e,P)=>{h();var v=y("Login");l(e,v)},$$slots:{default:!0}}),a(L);var O=r(L,2),j=r(s(O),2),le=s(j);V(le,{get check(){return t(U)}}),a(j),a(O),l(d,C)};_(oe,d=>{t(I)&&d(ie)})}a($),l(o,$)},$$slots:{default:!0}})},$$slots:{default:!0}});var J=r(E,2);{var ee=i=>{var u=be(),o=R(u),q=r(s(o),2),$=s(q,!0);a(q),a(o);var p=r(o,2),b=s(p,!0);a(p),de(()=>{z($,t(x)),z(b,t(k))}),l(i,u)};_(J,i=>{t(k)&&i(ee)})}l(W,D),ce()}export{ye as component};
