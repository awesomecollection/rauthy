import"../chunks/disclose-version.BDr9Qe-U.js";import{p as ne,f as E,a as ce,t as c,ap as ue,g as i,h as s,s as r,i as C,a9 as ve,c as u,r as v,aq as de}from"../chunks/index-client.CzvcfCLI.js";import{s as m}from"../chunks/render.BJBkrb2f.js";import{i as I}from"../chunks/if.Dlf0zx3_.js";import{a as o,t as d,d as ge,e as pe}from"../chunks/template.CQASMEo4.js";import{h as fe}from"../chunks/svelte-head.DAqZ84H4.js";import{r as he,b as be}from"../chunks/class.DOSp4p8N.js";import{p as B}from"../chunks/proxy.CHyqegA9.js";import{B as _e}from"../chunks/Button.CjBmYviZ.js";import{v as $e}from"../chunks/helpers.kNqlWGzE.js";import{I as D}from"../chunks/Input.DG9-U8Na.js";import{T as we,L as ye}from"../chunks/LangSelector.CG8Bx67-.js";import{M as Ne}from"../chunks/Main.icgLvyRI.js";import{C as Te}from"../chunks/ContentCenter.BEC6assz.js";import{u as Ee}from"../chunks/i18n.svelte.BgTCv98Z.js";import{T as qe}from"../chunks/Template.Cnk31pVm.js";import{u as xe}from"../chunks/param.svelte.MG9klZHr.js";import{F as Ce}from"../chunks/Form.HTTUzO_J.js";import{u as Ie}from"../chunks/is_dev.svelte.DAJ7VTzF.js";import{a as K}from"../chunks/patterns.BSnCcuba.js";import{b as Me}from"../chunks/fetch.DVUNovhB.js";var Re=d(" <br> <code> </code>",1),Ae=d('<input type="hidden" name="redirect_uri">'),Le=d('<div class="success svelte-cul8ah"> <br> </div>'),Pe=d('<div class="err svelte-cul8ah"> </div>'),Se=d('<!> <!> <!> <!> <div class="submit svelte-cul8ah"><!></div> <!>',1),Ue=d('<div class="container svelte-cul8ah"><div class="domainTxt svelte-cul8ah"><h1> </h1> <!></div> <!></div> <!> <!>',1),ke=d("<!> <!>",1);function Be(O,V){ne(V,!0);let e=Ee(),X=Ie(),g=C(""),F=xe("redirect_uri"),M=C(!1),l=C(""),R=C(!1),Y=ve(()=>X.get()?"/auth/v1/dev/register":"/auth/v1/users/register");async function Z(p,f){s(R,!1),s(l,"");let $=f.get("email"),A=f.get("given_name"),w=f.get("pow");if(!$||!A||!w){console.error("email, given_name, pow missing");return}if(i(g)&&!$.endsWith(i(g))){s(l,B(e.register.domainErr));return}let h={email:$,given_name:A,family_name:f.get("family_name")||void 0,pow:w,redirect_uri:f.get("redirect_uri")||void 0};s(M,!0);const b=await Me(p.action,h);if(b.error){let _=b.error.message||"Error";_.includes("UNIQUE constraint")?s(l,"E-Mail is already registered"):s(l,B(_))}else s(l,""),s(R,!0),setTimeout(()=>{window.location.replace(h.redirect_uri||"/auth/v1/account")},3e3);s(M,!1)}var Q=ke();fe(p=>{c(()=>ue.title=(e==null?void 0:e.register)||"Register")});var W=E(Q);qe(W,{id:$e,get value(){return i(g)},set value(p){s(g,B(p))}});var H=r(W,2);Ne(H,{children:(p,f)=>{Te(p,{children:($,A)=>{var w=Ue(),h=E(w),b=u(h),_=u(b),J=u(_,!0);v(_);var ee=r(_,2);{var re=y=>{var L=Re(),N=E(L,!0),T=r(N,2),q=r(T),x=u(q);v(q),c(()=>{m(N,e.register.domainRestricted),m(T,` ${e.register.domainAllowed??""} `),m(x,`@${i(g)??""}`)}),o(y,L)};I(ee,y=>{i(g)&&y(re)})}v(b);var ae=r(b,2);Ce(ae,{get action(){return i(Y)},onSubmit:Z,withPowAs:"pow",children:(y,L)=>{var N=Se(),T=E(N);{var q=a=>{var t=Ae();he(t),c(()=>be(t,F.get())),o(a,t)};I(T,a=>{F.get()&&a(q)})}var x=r(T,2);D(x,{typ:"email",name:"email",autocomplete:"email",get label(){return e.common.email},get placeholder(){return e.common.email},required:!0});var z=r(x,2);D(z,{name:"given_name",autocomplete:"given-name",get label(){return e.account.givenName},get placeholder(){return e.account.givenName},pattern:K,required:!0});var G=r(z,2);D(G,{name:"family_name",autocomplete:"family-name",get label(){return e.account.familyName},get placeholder(){return e.account.familyName},pattern:K});var P=r(G,2),ie=u(P);_e(ie,{type:"submit",get isLoading(){return i(M)},children:(a,t)=>{de();var n=ge();c(()=>m(n,e.register.register)),o(a,n)},$$slots:{default:!0}}),v(P);var se=r(P,2);{var oe=a=>{var t=Le(),n=u(t,!0),S=r(n,2);v(t),c(()=>{m(n,e.register.success),m(S,` ${e.register.emailCheck??""}`)}),o(a,t)},me=a=>{var t=pe(),n=E(t);{var S=U=>{var k=Pe(),le=u(k,!0);v(k),c(()=>m(le,i(l))),o(U,k)};I(n,U=>{i(l)&&U(S)},!0)}o(a,t)};I(se,a=>{i(R)?a(oe):a(me,!1)})}o(y,N)},$$slots:{default:!0}}),v(h);var j=r(h,2);we(j,{absolute:!0});var te=r(j,2);ye(te,{absolute:!0}),c(()=>m(J,e.register.userReg)),o($,w)},$$slots:{default:!0}})},$$slots:{default:!0}}),o(O,Q),ce()}export{Be as component};
