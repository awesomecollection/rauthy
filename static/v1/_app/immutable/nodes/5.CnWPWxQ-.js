import{a as o,t as L,e as we,d as me}from"../chunks/disclose-version.BP4T4xdV.js";import{a as Pe,c as t,r,s as v,j as e,t as k,p as Le,a9 as be,a7 as ge,f as Q,l as M,k as n,a5 as Qe,aa as Xe,a6 as Xr}from"../chunks/index-client.hxMyB_b4.js";import{s as l,d as Zr,h as Kr}from"../chunks/render.yNX9q8-B.js";import{i as y}from"../chunks/if.BeBa1Kxb.js";import{p as w}from"../chunks/proxy.DaVNR9vk.js";import{b as Or}from"../chunks/window.VkMEdvit.js";import{p as Ie}from"../chunks/props.DNAkfByl.js";import{k as Ze,Q as tr,_ as Yr,P as Gr,N as ea,A as ra,S as aa,I as ta,r as sa}from"../chunks/helpers.CchIKxjM.js";import{e as fr}from"../chunks/each.BUp7aLCc.js";import{h as wr}from"../chunks/html.704f8A94.js";import{a as H,c as j,s as Ke,t as br,r as va}from"../chunks/class.CF2J4YCf.js";import{C as Oe}from"../chunks/CheckIcon.7gB29NsI.js";import{B as ke,t as Ae,f as We,a as yr,s as na}from"../chunks/Button.BR1gOfNn.js";import{M as oa}from"../chunks/Modal.BdwIDN9n.js";import{u as De}from"../chunks/i18n.svelte.Ci9wvqOq.js";import{c as _r,b as sr,d as vr,f as qe}from"../chunks/fetch.Bq59EV_b.js";import{B as ia}from"../chunks/ButtonAuthProvider.Dl19OW4p.js";import{I as Me}from"../chunks/pow.BMnvYon0.js";import{F as ca}from"../chunks/Form.BnvI_UPN.js";import{b as nr,k as la,l as kr,m as ua}from"../chunks/patterns.BRCxk8by.js";import{I as or}from"../chunks/IconCheck.C6tGCpWy.js";import{I as da}from"../chunks/InputDateTimeCombo.VZN-6SG8.js";import{u as ir}from"../chunks/session.svelte.DPKHoBg2.js";import{w as pa}from"../chunks/registration.DIsXT3LM.js";import{W as $r}from"../chunks/WebauthnRequest.DmvtxDuu.js";import{U as ma,D as xr}from"../chunks/Devices.QPDgdEH8.js";import{P as ha}from"../chunks/PasswordPolicy.D0N2k_FZ.js";import{I as cr}from"../chunks/InputPassword.DvK4K3vC.js";import{s as ga}from"../chunks/language.svelte.DowwhO9_.js";import{a as fa}from"../chunks/input.BqbgywMu.js";import{A as wa}from"../chunks/A.Dq2NLtXl.js";import{I as ba}from"../chunks/InputArea.DJ93M0Cm.js";import{T as ya}from"../chunks/Template.Ih924_PB.js";import{u as _a}from"../chunks/param.svelte.BbzO27-O.js";import{T as Ir}from"../chunks/Tabs.DUIpSMWU.js";import{M as ka}from"../chunks/Main.Rc9oYaw1.js";import{C as $a}from"../chunks/ContentCenter.lHeEkgTE.js";import{T as xa}from"../chunks/ThemeSwitch.DTJa252X.js";import{L as Ia}from"../chunks/LangSelector.Bl8L6Wq4.js";var Na=L('<div class="link-err value svelte-1tea8v4"> </div>'),Pa=L('<div class="fed-btn svelte-1tea8v4"><!> <!></div>'),La=L('<h3> </h3> <p> </p> <div class="providers svelte-1tea8v4"></div>',1),Ma=L("<!> <!>",1),Ca=L('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Da=L('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),za=L('<div><div>WebID:</div> <span class="value svelte-1tea8v4"><a target="_blank"><!></a></span></div>'),Ta=L('<div><div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <div><div class="value svelte-1tea8v4"> </div> <!></div></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <!> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <!> <!></div>');function Nr(oe,h){Pe(h,!0);let s=Ie(h,"user",15),a=De(),T=M(!1),i=M(!1),A=be(()=>{var S;return(S=s().account_type)==null?void 0:S.startsWith("federated")}),g=be(()=>{var S;return e(A)?`${s().account_type}: ${((S=h.authProvider)==null?void 0:S.name)||""}`:s().account_type}),u=be(()=>h.viewModePhone?"rowPhone":"row"),b=be(()=>h.viewModePhone?"labelPhone":"label");function d(S){Yr(64,(re,{challenge:le,verifier:he})=>{re||(localStorage.setItem(Gr,he),X(S,le))})}async function X(S,re){let le={email:s().email,client_id:"rauthy",redirect_uri:window.location.href,provider_id:S,pkce_challenge:re},he=await sr(`/auth/v1/providers/${S}/link`,le);if(he.text){ea(he.text);let pe=he.headers.get("location");pe&&(window.location.href=pe)}else console.error(he.error)}async function R(){let S=await _r("/auth/v1/providers/link");S.body?s(S.body):(console.error(S.error),n(T,!0))}var C=Ta(),J=t(C),Y=t(J),ie=t(Y,!0);r(Y);var $=v(Y,2),x=t($,!0);r($),r(J);var V=v(J,2),Z=t(V),ne=t(Z,!0);r(Z);var ae=v(Z,2),te=t(ae,!0);r(ae),r(V);var K=v(V,2),f=t(K),p=t(f,!0);r(f);var I=v(f,2),c=t(I,!0);r(I),r(K);var B=v(K,2),se=t(B),de=t(se);r(se);var m=v(se,2),D=t(m,!0);r(m),r(B);var E=v(B,2),z=t(E),q=t(z,!0);r(z);var O=v(z,2),F=t(O),ue=t(F,!0);r(F);var ve=v(F,2);{var ye=S=>{var re=Pa(),le=t(re);ke(le,{get ariaLabel(){return a.account.providerUnlink},level:3,onclick:R,children:(_e,Te)=>{ge();var Ee=we();k(()=>l(Ee,a.account.providerUnlink)),o(_e,Ee)},$$slots:{default:!0}});var he=v(le,2);{var pe=_e=>{var Te=Na(),Ee=t(Te,!0);r(Te),k(()=>l(Ee,a.account.providerUnlinkDesc)),o(_e,Te)};y(he,_e=>{e(T)&&_e(pe)})}r(re),o(S,re)},U=S=>{var re=me(),le=Q(re);{var he=pe=>{var _e=Ma(),Te=Q(_e);ke(Te,{level:2,onclick:()=>n(i,!0),children:(Ue,Hr)=>{ge();var Ve=we();k(()=>l(Ve,a.account.providerLink)),o(Ue,Ve)},$$slots:{default:!0}});var Ee=v(Te,2);oa(Ee,{get showModal(){return e(i)},set showModal(Ue){n(i,w(Ue))},children:(Ue,Hr)=>{var Ve=La(),er=Q(Ve),jr=t(er,!0);r(er);var rr=v(er,2),Jr=t(rr,!0);r(rr);var hr=v(rr,2);fr(hr,21,()=>h.providers,ar=>ar.id,(ar,gr)=>{var Qr=be(()=>`${a.account.providerLink}: ${e(gr).name}`);ia(ar,{get ariaLabel(){return e(Qr)},get provider(){return e(gr)},onclick:d})}),r(hr),k(()=>{l(jr,a.account.providerLink),l(Jr,a.account.providerLinkDesc)}),o(Ue,Ve)},$$slots:{default:!0}}),o(pe,_e)};y(le,pe=>{h.providers.length>0&&pe(he)},!0)}o(S,re)};y(ve,S=>{e(A)?S(ye):S(U,!1)})}r(O),r(E);var N=v(E,2),_=t(N),W=t(_,!0);r(_);var G=v(_,2),fe=t(G,!0);r(G),r(N);var P=v(N,2),ee=t(P),ce=t(ee,!0);r(ee);var $e=v(ee,2),xe=t($e,!0);r($e),r(P);var Ne=v(P,2),Ce=t(Ne),Ye=t(Ce,!0);r(Ce);var Ge=v(Ce,2),lr=be(()=>!!s().webauthn_user_id);Oe(Ge,{get checked(){return e(lr)}}),r(Ne);var ze=v(Ne,2),Se=t(ze),zr=t(Se,!0);r(Se);var Tr=v(Se,2);Oe(Tr,{get checked(){return s().enabled}}),r(ze);var Be=v(ze,2),Fe=t(Be),Ar=t(Fe,!0);r(Fe);var Er=v(Fe,2);Oe(Er,{get checked(){return s().email_verified}}),r(Be);var ur=v(Be,2);{var Wr=S=>{var re=Ca(),le=t(re),he=t(le,!0);r(le);var pe=v(le,2),_e=t(pe,!0);k(()=>l(_e,Ze(s().last_login))),r(pe),r(re),k(()=>{H(re,j(e(u)),"svelte-1tea8v4"),H(le,j(e(b)),"svelte-1tea8v4"),l(he,a.account.lastLogin)}),o(S,re)};y(ur,S=>{s().last_login&&S(Wr)})}var Re=v(ur,2),He=t(Re),Ur=t(He,!0);r(He);var dr=v(He,2),Vr=t(dr,!0);k(()=>l(Vr,s().password_expires&&Ze(s().password_expires)||a.common.never)),r(dr),r(Re);var je=v(Re,2),Je=t(je),qr=t(Je,!0);r(Je);var pr=v(Je,2),Sr=t(pr,!0);k(()=>l(Sr,Ze(s().created_at))),r(pr),r(je);var mr=v(je,2);{var Br=S=>{var re=Da(),le=t(re),he=t(le,!0);r(le);var pe=v(le,2),_e=t(pe,!0);k(()=>l(_e,Ze(s().user_expires))),r(pe),r(re),k(()=>{H(re,j(e(u)),"svelte-1tea8v4"),H(le,j(e(b)),"svelte-1tea8v4"),l(he,a.account.userExpiry)}),o(S,re)};y(mr,S=>{s().user_expires&&S(Br)})}var Fr=v(mr,2);{var Rr=S=>{var re=za(),le=t(re),he=v(le,2),pe=t(he);k(()=>Ke(pe,"href",tr(s().id)));var _e=t(pe);wr(_e,()=>tr(s().id).replace("/auth/","/auth/<wbr/>")),r(pe),r(he),r(re),k(()=>{H(re,j(e(u)),"svelte-1tea8v4"),H(le,j(e(b)),"svelte-1tea8v4")}),o(S,re)};y(Fr,S=>{h.webIdData&&S(Rr)})}r(C),k(()=>{H(J,j(e(u)),"svelte-1tea8v4"),H(Y,j(e(b)),"svelte-1tea8v4"),l(ie,a.common.email),l(x,s().email),H(V,j(e(u)),"svelte-1tea8v4"),H(Z,j(e(b)),"svelte-1tea8v4"),l(ne,a.account.givenName),l(te,s().given_name),H(K,j(e(u)),"svelte-1tea8v4"),H(f,j(e(b)),"svelte-1tea8v4"),l(p,a.account.familyName),l(c,s().family_name),H(B,j(e(u)),"svelte-1tea8v4"),H(se,j(e(b)),"svelte-1tea8v4"),l(de,`${a.account.user??""} ID`),l(D,s().id),H(E,j(e(u)),"svelte-1tea8v4"),H(z,j(e(b)),"svelte-1tea8v4"),l(q,a.account.accType),l(ue,e(g)||""),H(N,j(e(u)),"svelte-1tea8v4"),H(_,j(e(b)),"svelte-1tea8v4"),l(W,a.account.roles),l(fe,s().roles||"None"),H(P,j(e(u)),"svelte-1tea8v4"),H(ee,j(e(b)),"svelte-1tea8v4"),l(ce,a.account.groups),l(xe,s().groups||"None"),H(Ne,j(e(u)),"svelte-1tea8v4"),H(Ce,j(e(b)),"svelte-1tea8v4"),l(Ye,a.account.mfaActivated),H(ze,j(e(u)),"svelte-1tea8v4"),H(Se,j(e(b)),"svelte-1tea8v4"),l(zr,a.account.userEnabled),H(Be,j(e(u)),"svelte-1tea8v4"),H(Fe,j(e(b)),"svelte-1tea8v4"),l(Ar,a.account.emailVerified),H(Re,j(e(u)),"svelte-1tea8v4"),H(He,j(e(b)),"svelte-1tea8v4"),l(Ur,a.account.passwordExpiry),H(je,j(e(u)),"svelte-1tea8v4"),H(Je,j(e(b)),"svelte-1tea8v4"),l(qr,a.account.userCreated)}),o(oe,C),Le()}var Aa=L('<div class="success svelte-4ogr3z"><!></div>'),Ea=L("<p> </p>"),Wa=L('<div class="err svelte-4ogr3z"> </div>'),Ua=L('<div class="formInner svelte-4ogr3z"><div><!> <!> <!> <!></div> <div><!> <!> <!> <!> <!></div></div> <div class="bottom svelte-4ogr3z"><div><!></div> <!></div> <!>',1),Va=L('<div class="container svelte-4ogr3z"><!></div>');function Pr(oe,h){var X;Pe(h,!0);let s=Ie(h,"user",15);(X=s().user_values)!=null&&X.birthdate||s(s().user_values.birthdate="",!0);let a=De(),T=M(""),i=M(!1),A=M(!1);async function g(R,C){var p;const J=C.get("email"),Y=C.get("family_name")||void 0,ie=C.get("given_name")||void 0,$=C.get("birthdate")||void 0,x=((p=C.get("phone"))==null?void 0:p.replaceAll(" ",""))||void 0,V=C.get("street")||void 0,Z=C.get("zip")||void 0,ne=Z?Number.parseInt(Z):void 0,ae=C.get("city")||void 0,te=C.get("country")||void 0;let K={email:J,family_name:Y,given_name:ie};($||x||V||ne||ae||te)&&(K.user_values={birthdate:$,phone:x,street:V,zip:ne,city:ae,country:te});let f=await vr(`/auth/v1/users/${s().id}/self`,K);if(f.body){n(i,!0),s(f.body);let I=3e3;f.status===202&&(n(A,!0),I=3e4),setTimeout(()=>{n(i,!1)},I)}else f.error&&(console.error(f.error),n(T,w(f.error.message)))}var u=Va(),b=t(u),d=be(()=>`/auth/v1/users/${s().id}/self`);ca(b,{get action(){return e(d)},onSubmit:g,children:(R,C)=>{var J=Ua(),Y=Q(J),ie=t(Y),$=t(ie);Me($,{typ:"email",name:"email",get label(){return a.common.email},get placeholder(){return a.common.email},get value(){return s().email},required:!0});var x=v($,2);Me(x,{name:"given_name",autocomplete:"given-name",get label(){return a.account.givenName},get placeholder(){return a.account.givenName},get value(){return s().given_name},required:!0,maxLength:32,pattern:nr});var V=v(x,2);Me(V,{name:"family_name",autocomplete:"family-name",get label(){return a.account.familyName},get placeholder(){return a.account.familyName},get value(){return s().family_name},maxLength:32,pattern:nr});var Z=v(V,2);da(Z,{name:"birthdate",get label(){return a.account.birthdate},withDelete:!0,get value(){return s().user_values.birthdate},set value(z){s(s().user_values.birthdate=z,!0)}}),r(ie);var ne=v(ie,2),ae=t(ne);Me(ae,{name:"street",autocomplete:"street-address",get label(){return a.account.street},get placeholder(){return a.account.street},get value(){return s().user_values.street},maxLength:48,pattern:la});var te=v(ae,2);Me(te,{typ:"number",name:"zip",autocomplete:"postal-code",get label(){return a.account.zip},get placeholder(){return a.account.zip},get value(){return s().user_values.zip},min:"1000",max:"9999999"});var K=v(te,2);Me(K,{name:"city",autocomplete:"address-level2",get label(){return a.account.city},get placeholder(){return a.account.city},get value(){return s().user_values.city},maxLength:48,pattern:kr});var f=v(K,2);Me(f,{name:"country",autocomplete:"country",get label(){return a.account.country},get placeholder(){return a.account.country},get value(){return s().user_values.country},maxLength:48,pattern:kr});var p=v(f,2);Me(p,{name:"phone",autocomplete:"tel",get label(){return a.account.phone},get placeholder(){return a.account.phone},get value(){return s().user_values.phone},maxLength:32,pattern:ua}),r(ne),r(Y);var I=v(Y,2),c=t(I),B=t(c);ke(B,{type:"submit",children:(z,q)=>{ge();var O=we();k(()=>l(O,a.common.save)),o(z,O)},$$slots:{default:!0}}),r(c);var se=v(c,2);{var de=z=>{var q=Aa(),O=t(q);or(O,{}),r(q),Ae(3,q,()=>We),o(z,q)};y(se,z=>{e(i)&&z(de)})}r(I);var m=v(I,2);{var D=z=>{var q=Ea(),O=t(q,!0);r(q),k(()=>l(O,a.account.emailUpdateConfirm)),o(z,q)},E=z=>{var q=me(),O=Q(q);{var F=ue=>{var ve=Wa(),ye=t(ve,!0);r(ve),k(()=>l(ye,e(T))),Ae(3,ve,()=>We),o(ue,ve)};y(O,ue=>{e(T)&&ue(F)},!0)}o(z,q)};y(m,z=>{e(A)?z(D):z(E,!1)})}o(R,J)},$$slots:{default:!0}}),r(u),o(oe,u),Le()}var qa=L('<div class="err svelte-16mlupu"><b>Your browser does not support Webauthn credentials and must be updated.</b></div>'),Sa=L('<!> <div class="regBtns svelte-16mlupu"><!> <!></div>',1),Ba=L('<div class="regNewBtn svelte-16mlupu"><!></div>'),Fa=L('<div class="keysHeader svelte-16mlupu"> </div>'),Ra=L('<div class="button svelte-16mlupu"><!></div>'),Ha=L('<!> <p class="svelte-16mlupu"> <br><br> </p> <!> <!> <div class="keysContainer svelte-16mlupu"></div> <!> <div class="svelte-16mlupu"> </div>',1),ja=L('<div class="container svelte-16mlupu"><!></div>');function Lr(oe,h){Pe(h,!0);const s="credentials"in navigator;let a=De(),T=ir("account"),i=be(()=>{var f;return(f=T.get())==null?void 0:f.user_id}),A=M(void 0),g=M(!1),u=M(""),b=M(!1),d=M(h.user.account_type==="password"),X=M(void 0),R=M(""),C=M(!1),J=M(w([]));Qe(()=>{ie()}),Xe(()=>{e(J).length>0&&h.user.account_type==="passkey"&&n(d,e(J).length>1)}),Xe(()=>{var f;(f=e(A))==null||f.focus()});function Y(){n(g,!1),n(u,"")}async function ie(){var p;let f=await qe(`/auth/v1/users/${(p=T.get())==null?void 0:p.user_id}/webauthn`);f.body?n(J,w(f.body)):console.error(f.error)}async function $(){if(Y(),e(C)||!e(i))return;if(e(R).length<1){n(g,!0),n(u,w(a.mfa.passkeyNameErr));return}let f=await pa(e(i),e(R),a.authorize.invalidKeyUsed,a.authorize.requestExpired);f.error?(n(g,!0),n(u,`${a.mfa.errorReg} - ${f.error}`)):(n(b,!1),n(R,""),await ie())}async function x(f){var I;let p=await _r(`/auth/v1/users/${h.user.id}/webauthn/delete/${f}`);p.status===200?await ie():n(u,w(((I=p.error)==null?void 0:I.message)||"Error"))}function V(f){n(X,void 0),n(g,!0),n(u,w(f)),setTimeout(()=>{n(g,!1),n(u,"")},5e3)}function Z(f){n(X,void 0),n(u,w(a.mfa.testSuccess)),setTimeout(()=>{n(u,"")},3e3)}var ne=ja(),ae=t(ne);{var te=f=>{var p=qa();o(f,p)},K=f=>{var p=Ha(),I=Q(p);{var c=U=>{$r(U,{get userId(){return h.user.id},get purpose(){return e(X)},onSuccess:Z,onError:V})};y(I,U=>{e(X)&&U(c)})}var B=v(I,2),se=t(B),de=v(se,3);r(B);var m=v(B,2);{var D=U=>{var N=Sa(),_=Q(N);Me(_,{autocomplete:"off",get label(){return a.mfa.passkeyName},get placeholder(){return a.mfa.passkeyName},maxLength:32,pattern:nr,onEnter:$,get ref(){return e(A)},set ref(P){n(A,w(P))},get value(){return e(R)},set value(P){n(R,w(P))},get isError(){return e(C)},set isError(P){n(C,w(P))}});var W=v(_,2),G=t(W);ke(G,{onclick:$,children:(P,ee)=>{ge();var ce=we();k(()=>l(ce,a.mfa.register)),o(P,ce)},$$slots:{default:!0}});var fe=v(G,2);ke(fe,{level:3,onclick:()=>n(b,!1),children:(P,ee)=>{ge();var ce=we();k(()=>l(ce,a.common.cancel)),o(P,ce)},$$slots:{default:!0}}),r(W),o(U,N)},E=U=>{var N=Ba(),_=t(N),W=be(()=>e(J).length===0?1:2);ke(_,{get level(){return e(W)},onclick:()=>n(b,!0),children:(G,fe)=>{ge();var P=we();k(()=>l(P,a.mfa.registerNew)),o(G,P)},$$slots:{default:!0}}),r(N),o(U,N)};y(m,U=>{e(b)?U(D):U(E,!1)})}var z=v(m,2);{var q=U=>{var N=Fa(),_=t(N,!0);r(N),k(()=>l(_,a.mfa.registerdKeys)),o(U,N)};y(z,U=>{e(J).length>0&&U(q)})}var O=v(z,2);fr(O,21,()=>e(J),U=>U.name,(U,N)=>{ma(U,{get passkey(){return e(N)},get showDelete(){return e(d)},onDelete:x})}),r(O);var F=v(O,2);{var ue=U=>{var N=Ra(),_=t(N);ke(_,{onclick:()=>n(X,"Test"),children:(W,G)=>{ge();var fe=we();k(()=>l(fe,a.mfa.test)),o(W,fe)},$$slots:{default:!0}}),r(N),o(U,N)};y(F,U=>{e(J).length>0&&U(ue)})}var ve=v(F,2),ye=t(ve,!0);r(ve),k(()=>{l(se,`${a.mfa.p1??""} `),l(de,` ${a.mfa.p2??""}`),br(ve,"success",!e(g)),br(ve,"err",e(g)),l(ye,e(u))}),o(f,p)};y(ae,f=>{s?f(K,!1):f(te)})}r(ne),o(oe,ne),Le()}var Ja=L('<div class="container svelte-ue7bk2"><!> <!> <!> <!> <div class="btn svelte-ue7bk2"><!></div> <div class="err svelte-ue7bk2"> </div></div>');function Qa(oe,h){Pe(h,!0);let s=Ie(h,"passwords",15),a=Ie(h,"hideCurrentPassword",3,!1),T=Ie(h,"isValid",15),i=De();T(R);let A=M(!1),g=M(""),u=M(void 0),b=be(()=>{var $;return(($=s().new)==null?void 0:$.length)>6&&s().new===s().newConfirm}),d=M(void 0),X=M(void 0);Qe(async()=>{let $=await qe("/auth/v1/password_policy");$.body?n(u,w($.body)):console.error($.error)});function R(){return n(g,""),!a()&&!s().current?(n(g,w(i.account.passwordCurrReq)),!1):s().new?s().newConfirm?e(A)?s().new.length>256?(n(g,"max 256"),!1):s().new!==s().newConfirm?(n(g,w(i.account.passwordNoMatch)),!1):!0:(n(g,w(i.account.passwordPolicyFollow)),!1):(n(g,w(i.account.passwordNewReq)),!1):(n(g,w(i.account.passwordNewReq)),!1)}function C(){if(n(g,""),e(u)){let $=ra(e(u));s(s().new=$,!0),s(s().newConfirm=$,!0)}requestAnimationFrame(()=>{var $,x;($=e(d))==null||$(),(x=e(X))==null||x()})}var J=me(),Y=Q(J);{var ie=$=>{var x=Ja(),V=t(x);ha(V,{get policy(){return e(u)},get password(){return s().new},get accepted(){return e(A)},set accepted(c){n(A,w(c))}});var Z=v(V,2);{var ne=c=>{cr(c,{autocomplete:"current-password",get label(){return i.account.passwordCurr},get placeholder(){return i.account.passwordCurr},onInput:R,get width(){return h.inputWidth},get value(){return s().current},set value(B){s(s().current=B,!0)}})};y(Z,c=>{a()||c(ne)})}var ae=v(Z,2);cr(ae,{autocomplete:"new-password",get label(){return i.account.passwordNew},get placeholder(){return i.account.passwordNew},onInput:R,get showCopy(){return e(b)},get width(){return h.inputWidth},get value(){return s().new},set value(c){s(s().new=c,!0)},get reportValidity(){return e(d)},set reportValidity(c){n(d,w(c))}});var te=v(ae,2);cr(te,{autocomplete:"new-password",get label(){return i.account.passwordConfirm},get placeholder(){return i.account.passwordConfirm},onInput:R,get showCopy(){return e(b)},get width(){return h.inputWidth},get value(){return s().newConfirm},set value(c){s(s().newConfirm=c,!0)},get reportValidity(){return e(X)},set reportValidity(c){n(X,w(c))}});var K=v(te,2),f=t(K);ke(f,{onclick:C,level:2,children:(c,B)=>{ge();var se=we();k(()=>l(se,i.account.generateRandom)),o(c,se)},$$slots:{default:!0}}),r(K);var p=v(K,2),I=t(p,!0);r(p),r(x),k(()=>l(I,e(g))),o($,x)};y(Y,$=>{e(u)&&$(ie)})}return o(oe,J),Le({isPwdValid:R})}var Xa=L('<div class="m-05 svelte-1h4zvzu"><p> </p> <p><b> </b></p> <div></div> <p> </p> <!></div>'),Za=L("<p> </p> <p> </p> <p> </p> <div><!></div>",1),Ka=L('<div class="success svelte-1h4zvzu"><!></div>'),Oa=L('<div class="err"> </div>'),Ya=L('<div class="cancel"><!></div>'),Ga=L('<div class="convertPasskey svelte-1h4zvzu"><h3> </h3> <p> </p> <!></div>'),et=L('<div><!> <div class="save svelte-1h4zvzu"><!> <!></div></div> <!>',1),rt=L('<div class="container svelte-1h4zvzu"><!> <!> <!> <!></div>');function Mr(oe,h){Pe(h,!0);let s=Ie(h,"user",15),a=De(),T=be(()=>h.viewModePhone?"calc(100vw - 1.5rem)":"300px"),i=M(w(s().account_type)),A=M(w([])),g=M(void 0),u=M(!1),b=M(!1),d=M(""),X=M(!1),R=M(void 0),C=M(w({current:"",new:"",newConfirm:""})),J=be(()=>e(A).filter(m=>m.user_verified).length>0);Qe(()=>{Y()});async function Y(){let m=await qe(`/auth/v1/users/${s().id}/webauthn`);m.body?n(A,w(m.body)):console.error("error fetching passkeys: "+m.error)}async function ie(){let m=await sr(`/auth/v1/users/${s().id}/self/convert_passkey`);m.error?console.error("error fetching passkeys: "+m.error):window.location.reload()}async function $(){n(d,""),e(A).length>0?await x():await V()}async function x(){var m;if(!((m=e(g))!=null&&m())){n(d,w(a.common.invalidInput));return}n(R,"PasswordNew")}async function V(m){var z,q;if(!((z=e(g))!=null&&z())){n(d,w(a.common.invalidInput));return}n(b,!0);let D={password_new:e(C).new};m?D.mfa_code=m:D.password_current=e(C).current;let E=await vr(`/auth/v1/users/${s().id}/self`,D);E.body?(n(X,!0),n(C,w({current:"",new:"",newConfirm:""})),s(E.body),n(i,w(E.body.account_type)),setTimeout(()=>{n(X,!1),n(u,!1)},3e3)):n(d,w(((q=E.error)==null?void 0:q.message)||"Error")),n(b,!1)}function Z(m){n(R,void 0),n(d,w(m)),setTimeout(()=>{n(d,"")},5e3)}function ne(m){n(R,void 0),m&&"code"in m&&V(m.code)}async function ae(){let m={email:s().email},D=await sr("/auth/v1/users/request_reset",m);D.error?n(d,w(D.error.message)):n(X,!0)}var te=rt(),K=t(te);{var f=m=>{$r(m,{get userId(){return s().id},get purpose(){return e(R)},onSuccess:ne,onError:Z})};y(K,m=>{e(R)&&m(f)})}var p=v(K,2);{var I=m=>{var D=Xa(),E=t(D),z=t(E,!0);r(E);var q=v(E,2),O=t(q),F=t(O,!0);r(O),r(q);var ue=v(q,2);yr(ue,"height",".3rem");var ve=v(ue,2),ye=t(ve,!0);r(ve);var U=v(ve,2);{var N=W=>{Oe(W,{check:!0})},_=W=>{ke(W,{level:2,onclick:ae,children:(G,fe)=>{ge();var P=we();k(()=>l(P,a.account.passwordReset)),o(G,P)},$$slots:{default:!0}})};y(U,W=>{e(X)?W(N):W(_,!1)})}r(D),k(()=>{var W;l(z,a.account.federatedConvertPassword1),l(F,((W=h.authProvider)==null?void 0:W.name)||"UNKNOWN"),l(ye,a.account.federatedConvertPassword2)}),o(m,D)};y(p,m=>{e(i)==="federated"&&m(I)})}var c=v(p,2);{var B=m=>{var D=Za(),E=Q(D),z=t(E,!0);r(E);var q=v(E,2),O=t(q,!0);r(q);var F=v(q,2),ue=t(F,!0);r(F);var ve=v(F,2),ye=t(ve);ke(ye,{level:2,onclick:()=>n(u,!0),children:(U,N)=>{ge();var _=we();k(()=>l(_,a.account.convertAccount)),o(U,_)},$$slots:{default:!0}}),r(ve),k(()=>{l(z,a.account.accTypePasskeyText1),l(O,a.account.accTypePasskeyText2),l(ue,a.account.accTypePasskeyText3)}),o(m,D)};y(c,m=>{(e(i)==="passkey"||e(i)==="federated_passkey")&&!e(u)&&m(B)})}var se=v(c,2);{var de=m=>{var D=et(),E=Q(D),z=t(E),q=be(()=>!(e(i)==="password"&&e(A).length<1));Qa(z,{get inputWidth(){return e(T)},get hideCurrentPassword(){return e(q)},get passwords(){return e(C)},set passwords(_){n(C,w(_))},get isValid(){return e(g)},set isValid(_){n(g,w(_))}});var O=v(z,2),F=t(O);ke(F,{onclick:$,level:1,get isLoading(){return e(b)},children:(_,W)=>{ge();var G=we();k(()=>l(G,a.common.save)),o(_,G)},$$slots:{default:!0}});var ue=v(F,2);{var ve=_=>{var W=Ka(),G=t(W);or(G,{}),r(W),Ae(3,W,()=>We),o(_,W)},ye=_=>{var W=me(),G=Q(W);{var fe=ee=>{var ce=Oa(),$e=t(ce,!0);r(ce),k(()=>l($e,e(d))),Ae(3,ce,()=>We),o(ee,ce)},P=ee=>{var ce=me(),$e=Q(ce);{var xe=Ne=>{var Ce=Ya(),Ye=t(Ce);ke(Ye,{level:3,onclick:()=>n(u,!1),children:(Ge,lr)=>{ge();var ze=we();k(()=>l(ze,a.common.cancel)),o(Ge,ze)},$$slots:{default:!0}}),r(Ce),o(Ne,Ce)};y($e,Ne=>{e(u)&&!e(b)&&Ne(xe)},!0)}o(ee,ce)};y(G,ee=>{e(d)?ee(fe):ee(P,!1)},!0)}o(_,W)};y(ue,_=>{e(X)?_(ve):_(ye,!1)})}r(O),r(E);var U=v(E,2);{var N=_=>{var W=Ga(),G=t(W),fe=t(G,!0);r(G);var P=v(G,2),ee=t(P,!0);r(P);var ce=v(P,2);ke(ce,{level:2,onclick:ie,children:($e,xe)=>{ge();var Ne=we();k(()=>l(Ne,a.account.convertAccount)),o($e,Ne)},$$slots:{default:!0}}),r(W),k(()=>{l(fe,a.account.convertAccount),l(ee,a.account.convertAccountP1)}),o(_,W)};y(U,_=>{!e(u)&&e(J)&&_(N)})}o(m,D)};y(se,m=>{(e(i)==="password"||e(i)==="federated_password"||e(u))&&m(de)})}r(te),o(oe,te),Le()}function at(oe,h){oe.code==="Enter"&&h()}var tt=L('<div class="flex"><div class="label font-label noselect svelte-1xf5lr3"><!></div> <label class="switch svelte-1xf5lr3"><input type="checkbox" class="svelte-1xf5lr3"> <span class="slider slider-round svelte-1xf5lr3"></span></label></div>');function Cr(oe,h){Pe(h,!0);let s=Ie(h,"checked",15,!1),a=Ie(h,"ariaLabel",3,""),T=Ie(h,"name",3,"");function i(){s(!s())}var A=tt(),g=t(A),u=t(g);ga(u,()=>h.children),r(g);var b=v(g,2),d=t(b);va(d),d.__click=i,d.__keydown=[at,i],ge(2),r(b),r(A),k(()=>{yr(g,"width",h.labelWidth),Ke(d,"name",T()),d.disabled=h.disabled,Ke(d,"aria-checked",s()),Ke(d,"aria-label",a())}),fa(d,s),o(oe,A),Le()}Zr(["click","keydown"]);var st=L("<div><p> </p> <!></div>"),vt=L('<div class="success svelte-5kivuv"><!></div>'),nt=L('<div class="err svelte-5kivuv"> </div>'),ot=L('<div class="container svelte-5kivuv"><p> </p> <p><!></p> <div class="switch svelte-5kivuv"><!></div> <div class="switch svelte-5kivuv"><!></div> <!> <div class="bottom svelte-5kivuv"><!> <!></div></div>');function Dr(oe,h){Pe(h,!0);let s=Ie(h,"webIdData",15),a=De();const T="14rem";let i=M(""),A=M(!1),g=M(!!s().custom_triples),u=tr(s().user_id);async function b(){n(i,"");let p=await vr(`/auth/v1/users/${s().user_id}/webid/data`,s());p.error?n(i,w(p.error.message)):(n(A,!0),setTimeout(()=>{n(A,!1)},3e3))}var d=ot(),X=t(d),R=t(X,!0);r(X);var C=v(X,2),J=t(C);wa(J,{href:u,target:"_blank",children:(p,I)=>{var c=me(),B=Q(c);wr(B,()=>u.replace("/auth/","/auth/<wbr/>")),o(p,c)},$$slots:{default:!0}}),r(C);var Y=v(C,2),ie=t(Y);Cr(ie,{ariaLabel:"E-Mail",labelWidth:T,get checked(){return s().expose_email},set checked(p){s(s().expose_email=p,!0)},children:(p,I)=>{ge();var c=we("E-Mail");o(p,c)},$$slots:{default:!0}}),r(Y);var $=v(Y,2),x=t($);Cr(x,{get ariaLabel(){return a.account.webIdExpertMode},labelWidth:T,get checked(){return e(g)},set checked(p){n(g,w(p))},children:(p,I)=>{ge();var c=we();k(()=>l(c,a.account.webIdExpertMode)),o(p,c)},$$slots:{default:!0}}),r($);var V=v($,2);{var Z=p=>{var I=st(),c=t(I),B=t(c,!0);r(c);var se=v(c,2);ba(se,{placeholder:"FOAF",rows:15,get value(){return s().custom_triples},set value(de){s(s().custom_triples=de,!0)}}),r(I),k(()=>l(B,a.account.webIdDescData)),Ae(3,I,()=>na),o(p,I)};y(V,p=>{e(g)&&p(Z)})}var ne=v(V,2),ae=t(ne);ke(ae,{onclick:b,children:(p,I)=>{ge();var c=we();k(()=>l(c,a.common.save)),o(p,c)},$$slots:{default:!0}});var te=v(ae,2);{var K=p=>{var I=vt(),c=t(I);or(c,{}),r(I),Ae(3,I,()=>We),o(p,I)},f=p=>{var I=me(),c=Q(I);{var B=se=>{var de=nt(),m=t(de,!0);r(de),k(()=>l(m,e(i))),Ae(3,de,()=>We),o(se,de)};y(c,se=>{e(i)&&se(B)},!0)}o(p,I)};y(te,p=>{e(A)?p(K):p(f,!1)})}r(ne),r(d),k(()=>l(R,a.account.webIdDesc)),o(oe,d),Le()}function it(oe,h){Pe(h,!0);let s=ir("account"),a=be(()=>{var g;return(g=s.get())==null?void 0:g.user_id});var T=me(),i=Q(T);{var A=g=>{xr(g,{viewMode:"account",get userId(){return e(a)}})};y(i,g=>{e(a)&&g(A)})}o(oe,T),Le()}var ct=L("<h3> </h3>"),lt=L('<div class="headerPhone svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="innerPhone svelte-k6hxbm"><!></div></div>',1),ut=L('<div class="header svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="inner svelte-k6hxbm"><!></div></div>',1),dt=L('<!> <div class="wrapper svelte-k6hxbm"><!></div>',1);function pt(oe,h){Pe(h,!0);const s=x=>{var V=ct(),Z=t(V,!0);r(V),k(()=>l(Z,`${a().given_name} ${a().family_name||""}`)),o(x,V)};let a=Ie(h,"user",15),T=Ie(h,"webIdData",15),i=De(),A=M(void 0),g=M(w([])),u=be(()=>{var x;if((x=a().account_type)!=null&&x.startsWith("federated"))return e(g).filter(V=>V.id===a().auth_provider_id)[0]}),b=be(()=>e(A)&&e(A)<500),d=M(w(i.account.navInfo)),X=w(T()?[i.account.navInfo,i.account.navEdit,i.common.password,i.account.navMfa,"WebID",i.account.devices,i.account.navLogout]:[i.account.navInfo,i.account.navEdit,i.common.password,i.account.navMfa,i.account.devices,i.account.navLogout]);Qe(()=>{_a("v").get()==="devices"&&n(d,w(i.account.devices))}),Xe(()=>{e(d)===i.account.navLogout&&aa()});var R=dt(),C=Q(R);ya(C,{id:ta,get value(){return e(g)},set value(x){n(g,w(x))}});var J=v(C,2),Y=t(J);{var ie=x=>{var V=lt(),Z=Q(V),ne=t(Z);s(ne),r(Z);var ae=v(Z,2),te=t(ae);Ir(te,{get tabs(){return X},get selected(){return e(d)},set selected(c){n(d,w(c))}});var K=v(te,2),f=t(K);{var p=c=>{Nr(c,{get providers(){return e(g)},get authProvider(){return e(u)},viewModePhone:!0,get webIdData(){return T()},get user(){return a()},set user(B){a(B)}})},I=c=>{var B=me(),se=Q(B);{var de=D=>{Pr(D,{viewModePhone:!0,get user(){return a()},set user(E){a(E)}})},m=D=>{var E=me(),z=Q(E);{var q=F=>{Mr(F,{get user(){return a()},get authProvider(){return e(u)},viewModePhone:!0})},O=F=>{var ue=me(),ve=Q(ue);{var ye=N=>{Lr(N,{get user(){return a()}})},U=N=>{var _=me(),W=Q(_);{var G=P=>{Dr(P,{get webIdData(){return T()},set webIdData(ee){T(ee)}})},fe=P=>{var ee=me(),ce=Q(ee);{var $e=xe=>{xr(xe,{viewMode:"account"})};y(ce,xe=>{e(d)===i.account.devices&&xe($e)},!0)}o(P,ee)};y(W,P=>{e(d)==="WebID"?P(G):P(fe,!1)},!0)}o(N,_)};y(ve,N=>{e(d)===i.account.navMfa?N(ye):N(U,!1)},!0)}o(F,ue)};y(z,F=>{e(d)===i.common.password?F(q):F(O,!1)},!0)}o(D,E)};y(se,D=>{e(d)===i.account.navEdit?D(de):D(m,!1)},!0)}o(c,B)};y(f,c=>{e(d)===i.account.navInfo?c(p):c(I,!1)})}r(K),r(ae),o(x,V)},$=x=>{var V=ut(),Z=Q(V),ne=t(Z);s(ne),r(Z);var ae=v(Z,2),te=t(ae);Ir(te,{get tabs(){return X},center:!0,get selected(){return e(d)},set selected(c){n(d,w(c))}});var K=v(te,2),f=t(K);{var p=c=>{Nr(c,{get webIdData(){return T()},get providers(){return e(g)},get authProvider(){return e(u)},get user(){return a()},set user(B){a(B)}})},I=c=>{var B=me(),se=Q(B);{var de=D=>{Pr(D,{get user(){return a()},set user(E){a(E)}})},m=D=>{var E=me(),z=Q(E);{var q=F=>{Mr(F,{get user(){return a()},get authProvider(){return e(u)}})},O=F=>{var ue=me(),ve=Q(ue);{var ye=N=>{Lr(N,{get user(){return a()}})},U=N=>{var _=me(),W=Q(_);{var G=P=>{Dr(P,{get webIdData(){return T()},set webIdData(ee){T(ee)}})},fe=P=>{var ee=me(),ce=Q(ee);{var $e=xe=>{it(xe,{})};y(ce,xe=>{e(d)===i.account.devices&&xe($e)},!0)}o(P,ee)};y(W,P=>{e(d)==="WebID"?P(G):P(fe,!1)},!0)}o(N,_)};y(ve,N=>{e(d)===i.account.navMfa?N(ye):N(U,!1)},!0)}o(F,ue)};y(z,F=>{e(d)===i.common.password?F(q):F(O,!1)},!0)}o(D,E)};y(se,D=>{e(d)===i.account.navEdit?D(de):D(m,!1)},!0)}o(c,B)};y(f,c=>{e(d)===i.account.navInfo?c(p):c(I,!1)})}r(K),r(ae),o(x,V)};y(Y,x=>{e(b)?x(ie):x($,!1)})}r(J),Or("innerWidth",x=>n(A,w(x))),o(oe,R),Le()}var mt=L("<!> <!> <!>",1);function ht(oe,h){Pe(h,!0);let s=De(),a=ir("account"),T=M(void 0),i=M(void 0),A=M(!1);Xe(()=>{let u=a.get();u&&g(u)});async function g(u){const b=u.user_id;if(b){let d=await Promise.all([qe(`/auth/v1/users/${b}`),qe(`/auth/v1/users/${b}/webid/data`)]);d[0].body?n(T,w(d[0].body)):sa("account"),d[1].body?n(i,w(d[1].body)):d[1].status===404&&n(i,w({user_id:b,expose_email:!1})),n(A,!0)}else console.error("no user_id in session")}Kr(u=>{k(()=>{var b;return Xr.title=`${((s==null?void 0:s.account.account)||"Account")??""} ${((b=e(T))==null?void 0:b.email)??""}`})}),ka(oe,{children:(u,b)=>{$a(u,{children:(d,X)=>{var R=mt(),C=Q(R);{var J=$=>{pt($,{get user(){return e(T)},set user(x){n(T,w(x))},get webIdData(){return e(i)},set webIdData(x){n(i,w(x))}})};y(C,$=>{e(A)&&a&&e(T)&&$(J)})}var Y=v(C,2);xa(Y,{absolute:!0});var ie=v(Y,2);Ia(ie,{absolute:!0}),o(d,R)},$$slots:{default:!0}})},$$slots:{default:!0}}),Le()}export{ht as component};
