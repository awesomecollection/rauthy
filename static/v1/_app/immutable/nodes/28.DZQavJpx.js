import"../chunks/disclose-version.BDr9Qe-U.js";import{p as le,w as p,ao as ce,f as P,a as de,v as c,s as r,c as a,u as t,r as s,aq as h,t as ve}from"../chunks/index-client.ChFmlJin.js";import{s as j}from"../chunks/render.D821es-0.js";import{i as _}from"../chunks/if.DhkeN2Rc.js";import{a as n,t as w,d as q}from"../chunks/template.DOaMAhd6.js";import{p as m}from"../chunks/proxy.DVTQVrWW.js";import{g as ue}from"../chunks/helpers.mrWtKrwW.js";import{c as fe,a as z,B as A,I as K}from"../chunks/Input.mueckHaA.js";import{o as Q,q as ge}from"../chunks/helpers.BweJi6s8.js";import{C as S}from"../chunks/CheckIcon.5zmdx63h.js";import{c as pe}from"../chunks/dataFetching.DHlo1LT-.js";import{M as me}from"../chunks/Main.CZkA2qJN.js";import{C as $e}from"../chunks/ContentCenter.Cb3YBr_D.js";var he=w("<br>-> enable idp registration:<br> <code>chrome://flags/#fedcm-idp-registration</code>",1),we=w('<p><!></p> <p><!> <!> <!></p> <div class="row svelte-wuqbvo"><b>Logged In:</b> <div class="check svelte-wuqbvo"><!></div></div>',1),Ie=w('<div class="flex-col"><h1>FedCM Testing</h1> <div class="row svelte-wuqbvo"><div><b>FedCM supported:</b></div> <div class="check svelte-wuqbvo"><!></div></div> <!> <!></div>'),be=w('<div class="row svelte-wuqbvo"><b>Credential Type:</b> <span> </span></div> <div class="token svelte-wuqbvo"> </div>',1),Ce=w("<!> <!>",1);function qe(W,X){le(X,!0);let T=p(""),I=p(!1),y=p(!1),U=p(""),x=p(""),l=m({clientId:"fedcm",configUrl:"any"}),u=p(m({}));const Y=fe().shape({clientId:z().required("Client ID is required").trim().matches(Q,"Must be URL safe"),configUrl:z().nullable().trim().matches(Q,"Must be URL safe")});ce(async()=>{if(c(T,`${window.location.origin}/auth/v1/fed_cm/config`),l.clientId=`${window.location.origin}/auth/v1/fed_cm/client_config`,(await pe()).ok?(console.log("FedCM status is: logged-in"),c(y,!0)):console.log("FedCM status is: logged-out"),window.IdentityProvider&&IdentityProvider.register!=null)console.log("FedCM is supported"),c(I,!0);else{console.error("FedCM is not supported");return}});async function Z(){if(!await M())return;let i=l.configUrl||void 0,f=l.clientId;console.log("using credentials get values: configUrl: "+i+" / clientId: "+f);try{let o=await navigator.credentials.get({identity:{mode:"button",providers:[{configURL:i,clientId:f,nonce:ue(48)}]}});console.log(o),c(x,m(o.type)),c(U,m(o.token)),c(y,!0)}catch(o){console.error("FedCM credentials error: "+o)}}function H(){IdentityProvider.register(t(T))}async function M(){try{return await Y.validate(l,{abortEarly:!1}),c(u,m({})),!0}catch(i){return c(u,m(ge(i))),!1}}var D=Ce(),E=P(D);me(E,{children:(i,f)=>{$e(i,{children:(o,k)=>{var $=Ie(),g=r(a($),2),b=r(a(g),2),re=a(b);S(re,{get check(){return t(I)}}),s(b),s(g);var N=r(g,2);{var te=d=>{var C=he();h(4),n(d,C)};_(N,d=>{t(I)||d(te)})}var oe=r(N,2);{var ie=d=>{var C=we(),F=P(C),ae=a(F);A(ae,{level:3,$$events:{click:H},children:(e,R)=>{h();var v=q("Register IdP");n(e,v)},$$slots:{default:!0}}),s(F);var L=r(F,2),B=a(L);K(B,{autocomplete:"off",placeholder:"Client Id",get value(){return l.clientId},set value(e){l.clientId=e},get error(){return t(u).clientId},set error(e){t(u).clientId=e},$$events:{input:M},children:(e,R)=>{h();var v=q("CLIENT ID");n(e,v)},$$slots:{default:!0}});var G=r(B,2);K(G,{autocomplete:"off",placeholder:"Config URL",get value(){return l.configUrl},set value(e){l.configUrl=e},get error(){return t(u).configUrl},set error(e){t(u).configUrl=e},$$events:{input:M},children:(e,R)=>{h();var v=q("CONFIG URL");n(e,v)},$$slots:{default:!0}});var se=r(G,2);A(se,{$$events:{click:Z},children:(e,R)=>{h();var v=q("Login");n(e,v)},$$slots:{default:!0}}),s(L);var O=r(L,2),V=r(a(O),2),ne=a(V);S(ne,{get check(){return t(y)}}),s(V),s(O),n(d,C)};_(oe,d=>{t(I)&&d(ie)})}s($),n(o,$)},$$slots:{default:!0}})},$$slots:{default:!0}});var J=r(E,2);{var ee=i=>{var f=be(),o=P(f),k=r(a(o),2),$=a(k,!0);s(k),s(o);var g=r(o,2),b=a(g,!0);s(g),ve(()=>{j($,t(x)),j(b,t(U))}),n(i,f)};_(J,i=>{t(U)&&i(ee)})}n(W,D),de()}export{qe as component};
