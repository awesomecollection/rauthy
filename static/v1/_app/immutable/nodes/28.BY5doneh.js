import{t as b,a as v,b as q,c as re}from"../chunks/disclose-version.C0dpEWi_.js";import{p as te,Z as $,o as ie,a as se,j as i,a1 as d,$ as me,_ as M,a0 as l,g as t,a5 as oe,a2 as N,a4 as y,a3 as C}from"../chunks/index-client.LkyNpeLM.js";import{h as le,s as o}from"../chunks/render.D21ACvZ4.js";import{i as T}from"../chunks/if.BQqAvi9S.js";import{p as n}from"../chunks/proxy.bVSoDcUp.js";import{r as ne}from"../chunks/legacy-client.yBTdRgtG.js";import{I as A,c as ce,a as F}from"../chunks/Input.BWHohn37.js";import{g as ve,n as de,r as ue,q as ge,t as fe}from"../chunks/dataFetching.C4rEqQY1.js";import{B as pe}from"../chunks/Button.BDI_bIrm.js";import{L as $e}from"../chunks/LangSelector.PrFnGVsI.js";import{f as Ne}from"../chunks/pow.BFZLHVvv.js";import{M as ye,C as he}from"../chunks/ContentCenter.BsVUI9il.js";import"../chunks/is_dev.svelte.DMhPcyij.js";import{u as we}from"../chunks/i18n.svelte.DPkpATkG.js";var ke=q(" <br> <code> </code>",1),Ee=q('<div class="success svelte-1ks9oi1"> <br> </div>'),xe=q('<div class="err svelte-1ks9oi1"> </div>'),_e=q('<div class="container svelte-1ks9oi1"><div class="domainTxt svelte-1ks9oi1"><h1> </h1> <!></div> <!> <!> <!> <!> <!></div> <!>',1);function be(P,S){te(S,!0);let a=we(),h=$(void 0),w,x=$(!1),g=$(""),U=$(!1),m=n({email:"",givenName:"",familyName:""}),u=$(n({})),G=$(n({}));ne(()=>{a&&i(G,n(ce().shape({email:F().required(a.common.required).email(a.register.emailBadFormat),givenName:F().required(a.common.required).matches(ge,a.register.regexName),familyName:F().matches(fe,a.register.regexName)})))}),ie(()=>{const c=window.document.getElementsByName("rauthy-data")[0].id;c!=="{{ data }}"&&i(h,n(c)),w=ve().redirect_uri});function B(c){c.detail.code==="Enter"&&Q()}async function Q(){i(U,!1),i(g,"");try{await t(G).validate(m,{abortEarly:!1}),i(u,n({}))}catch(k){i(u,n(de(k)));return}if(t(h)&&!m.email.endsWith(t(h))){i(g,n(a.register.domainErr));return}i(x,!0),await oe();let c=await Ne();const L={email:m.email,given_name:m.givenName,family_name:m.familyName.length>0?m.familyName:void 0,pow:c};w&&(L.redirect_uri=w);const _=await ue(L);if(_.ok)i(g,""),i(U,!0),w&&setTimeout(()=>{window.location.replace(w)},3e3);else{const k=await _.json();k.message.includes("UNIQUE constraint")?i(g,"E-Mail is already registered"):i(g,n(k.message))}i(x,!1)}le(c=>{d(()=>me.title=(a==null?void 0:a.register)||"Register")}),ye(P,{children:(c,L)=>{he(c,{children:(_,k)=>{var Z=_e(),R=M(Z),j=N(R),I=N(j),W=N(I,!0);y(I);var X=l(I,2);{var H=e=>{var s=ke(),r=M(s,!0),f=l(r,2),p=l(f),E=N(p);y(p),d(()=>{o(r,a.register.domainRestricted),o(f,` ${a.register.domainAllowed??""} `),o(E,`@${t(h)??""}`)}),v(e,s)};T(X,e=>{t(h)&&e(H)})}y(j);var z=l(j,2);A(z,{type:"email",autocomplete:"email",get placeholder(){return a.common.email},get value(){return m.email},set value(e){m.email=e},get error(){return t(u).email},set error(e){t(u).email=e},$$events:{keypress:B},children:(e,s)=>{C();var r=b();d(()=>o(r,a.common.email.toUpperCase())),v(e,r)},$$slots:{default:!0}});var D=l(z,2);A(D,{autocomplete:"given-name",get placeholder(){return a.account.givenName},get value(){return m.givenName},set value(e){m.givenName=e},get error(){return t(u).givenName},set error(e){t(u).givenName=e},$$events:{keypress:B},children:(e,s)=>{C();var r=b();d(()=>o(r,a.account.givenName.toUpperCase())),v(e,r)},$$slots:{default:!0}});var J=l(D,2);A(J,{autocomplete:"family-name",get placeholder(){return a.account.familyName},get value(){return m.familyName},set value(e){m.familyName=e},get error(){return t(u).familyName},set error(e){t(u).familyName=e},$$events:{keypress:B},children:(e,s)=>{C();var r=b();d(()=>o(r,a.account.familyName.toUpperCase())),v(e,r)},$$slots:{default:!0}});var K=l(J,2);pe(K,{get isLoading(){return t(x)},set isLoading(e){i(x,n(e))},$$events:{click:Q},children:(e,s)=>{C();var r=b();d(()=>o(r,a.register.register)),v(e,r)},$$slots:{default:!0}});var O=l(K,2);{var V=e=>{var s=Ee(),r=N(s,!0),f=l(r,2);y(s),d(()=>{o(r,a.register.success),o(f,` ${a.register.emailCheck??""}`)}),v(e,s)},Y=e=>{var s=re(),r=M(s);{var f=p=>{var E=xe(),ae=N(E,!0);y(E),d(()=>o(ae,t(g))),v(p,E)};T(r,p=>{t(g)&&p(f)},!0)}v(e,s)};T(O,e=>{t(U)?e(V):e(Y,!1)})}y(R);var ee=l(R,2);$e(ee,{absolute:!0}),d(()=>o(W,a.register.userReg)),v(_,Z)},$$slots:{default:!0}})},$$slots:{default:!0}}),se()}export{be as component};
