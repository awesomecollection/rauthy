import"../chunks/disclose-version.BDr9Qe-U.js";import{p as z,s as S,f as m,a as A,h as r,g as c,i as p,Q as G,$ as J,c as B,ap as K,r as E,t as N}from"../chunks/runtime.BsghBUX9.js";import{s as V}from"../chunks/render.CTp9lacC.js";import{i as _}from"../chunks/if.6Ov_EDLa.js";import{a as i,t as x,e as C,d as X}from"../chunks/template.jENAUvUX.js";import{h as Z}from"../chunks/svelte-head.cS_wx7Ri.js";import{p as f}from"../chunks/proxy.YH42NwLs.js";import{o as M}from"../chunks/index-client.ClP8y9aT.js";import{H as D,I as O}from"../chunks/helpers.CBl6QeM5.js";import{W as ee}from"../chunks/WebauthnRequest.M9ddrbaa.js";import{s as oe}from"../chunks/snippet.C6jUNrz1.js";import{T as ae,L as re}from"../chunks/LangSelector.TD0HCe5U.js";import{b as te,B as se}from"../chunks/fetch.BvIeF4JA.js";import{u as ie}from"../chunks/i18n.svelte.D8rR00qK.js";import{u as I}from"../chunks/param.svelte.BhHpzHur.js";import{u as ne}from"../chunks/is_dev.svelte.BUWsjuLN.js";var ce=x("<div><h2>Cookies disabled</h2> <p>You need to enable Cookies.<br> Without them, a safe login cannot be executed.</p></div>"),le=x("<noscript></noscript> <!>",1);function ue(P,L){z(L,!0);let T=p(!1),g=p(!1);M(()=>{r(g,f(navigator.cookieEnabled)),r(T,!0)});var t=le(),h=S(m(t),2);{var u=b=>{var W=C(),e=m(W);{var k=s=>{var n=C(),o=m(n);oe(o,()=>L.children??G),i(s,n)},l=s=>{var n=ce();i(s,n)};_(e,s=>{c(g)?s(k):s(l,!1)})}i(b,W)};_(h,b=>{c(T)&&b(u)})}i(P,t),A()}var ve=x('<div class="btn flex-col svelte-17xvymb"><!></div>'),de=x('<div class="err"> </div>'),me=x("<!> <!> <!>",1);function pe(P,L){z(L,!0);let T=ie(),g=p(!1),t=p(""),h=p(void 0),u=p(void 0);M(async()=>{var w,H;let e=I("error").get();if(e){let a=I("error_description").get();r(t,`${e}: ${a}`);return}let k=I("state").get();if(!k){r(t,"'state' is missing in URL");return}let l=I("code").get();if(!l){r(t,"'code' is missing in URL");return}let s={state:k,code:l,pkce_verifier:D(),xsrf_token:O()},n="/auth/v1/providers/callback";ne().get()&&(n="/auth/v1/dev/providers_callback");let o=await te(n,s);if(o.status===202)window.location.replace(o.headers.get("location")||"/auth/v1/account");else if(o.status===200){r(t,"");let a=o.body;a&&"user_id"in a&&"code"in a?(r(h,f(a.user_id)),r(u,f({Login:a.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else o.status===204?window.location.replace("/auth/v1/account"):o.status===403?r(t,f(((w=o.error)==null?void 0:w.message)||"HTTP 403 Forbidden")):o.status===406?(r(t,f(T.authorize.clientForceMfa)),r(g,!0)):r(t,`HTTP ${o.status}: ${(H=o.error)==null?void 0:H.message}`)});function b(e){r(t,f(e)),r(u,void 0)}function W(e){console.log("onWebauthnSuccess",e),e&&"loc"in e&&window.location.replace(e.loc)}Z(e=>{J.title="Callback"}),ue(P,{children:(e,k)=>{var l=me(),s=m(l);{var n=a=>{ee(a,{get userId(){return c(h)},get purpose(){return c(u)},onSuccess:W,onError:b})},o=a=>{var U=C(),Q=m(U);{var Y=v=>{var d=ve(),R=B(d);se(R,{onclick:()=>window.location.href="/auth/v1/account",children:(F,y)=>{K();var $=X("Account");i(F,$)},$$slots:{default:!0}}),E(d),i(v,d)},j=v=>{var d=C(),R=m(d);{var F=y=>{var $=de(),q=B($,!0);E($),N(()=>V(q,c(t))),i(y,$)};_(R,y=>{c(t)&&y(F)},!0)}i(v,d)};_(Q,v=>{c(g)?v(Y):v(j,!1)},!0)}i(a,U)};_(s,a=>{c(u)&&c(h)?a(n):a(o,!1)})}var w=S(s,2);ae(w,{absolute:!0});var H=S(w,2);re(H,{absolute:!0}),i(e,l)},$$slots:{default:!0}}),A()}export{pe as component};
