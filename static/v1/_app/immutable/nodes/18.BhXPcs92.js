import{a as t,b as m,t as ee,c as he}from"../chunks/disclose-version.C0dpEWi_.js";import{j as e,a2 as c,g as s,a0 as u,a4 as o,a1 as f,Z as x,p as Be,o as Oe,_ as W,a as Re,$ as Se,a3 as ae}from"../chunks/index-client.LkyNpeLM.js";import{e as z,h as We,s as p}from"../chunks/render.D21ACvZ4.js";import{i as A}from"../chunks/if.BQqAvi9S.js";import{e as ze,i as Ee}from"../chunks/OptionSelect.CHnFxA-i.js";import{p as v}from"../chunks/proxy.bVSoDcUp.js";import{r as Fe}from"../chunks/legacy-client.yBTdRgtG.js";import{x as ve,g as Ge,a0 as He,a1 as we,a2 as Je,l as Ke,a3 as Me,n as Qe}from"../chunks/dataFetching.C4rEqQY1.js";import{t as X,b as le,s as Xe,f as Ce}from"../chunks/Loading.CZYfBo5y.js";import{p as ne}from"../chunks/props.BDzDHVdA.js";import{L as Ze}from"../chunks/LangSelector.PrFnGVsI.js";import{c as qe,a as Ie,I as Ne}from"../chunks/Input.BWHohn37.js";import{B as ue}from"../chunks/Button.BDI_bIrm.js";import{f as Ve}from"../chunks/pow.BFZLHVvv.js";import{M as Ye,C as Ue}from"../chunks/ContentCenter.BsVUI9il.js";import{u as ea}from"../chunks/i18n.svelte.DPkpATkG.js";import{T as aa}from"../chunks/Template.CTK3kKGi.js";var sa=m('<div class="circle svelte-10pff2x"></div>'),ta=m('<div class="circle svelte-10pff2x"></div>'),ra=m('<div class="circle svelte-10pff2x"></div>'),oa=m('<div class="container svelte-10pff2x"><div class="inner svelte-10pff2x"><!> <!> <!></div></div>');function ia(se,E){let Z=ne(E,"offset",3,0),a=ne(E,"background",3,!0),F=ne(E,"local",3,!1),y=x(!0),$=x(!1),l=x(!1);setTimeout(()=>{e($,!0)},300),setTimeout(()=>{e(l,!0)},600);var g=oa(),b=c(g),G=c(b);{var q=i=>{var r=sa();z("introend",r,()=>e(y,!1)),z("outroend",r,()=>e(y,!0)),X(7,r,()=>le,()=>({delay:600,duration:1e3})),t(i,r)};A(G,i=>{s(y)&&i(q)})}var L=u(G,2);{var B=i=>{var r=ta();z("introend",r,()=>e($,!1)),z("outroend",r,()=>e($,!0)),X(7,r,()=>le,()=>({delay:600,duration:1e3})),t(i,r)};A(L,i=>{s($)&&i(B)})}var I=u(L,2);{var te=i=>{var r=ra();z("introend",r,()=>e(l,!1)),z("outroend",r,()=>e(l,!0)),X(7,r,()=>le,()=>({delay:600,duration:1e3})),t(i,r)};A(I,i=>{s(l)&&i(te)})}o(b),o(g),f(()=>{ve(g,"global",!F()),ve(g,"local",F()),ve(g,"background",a()),Xe(b,"style",`margin-top: ${`${Z()}px`??""}`)}),X(3,b,()=>Ce,()=>({duration:100})),X(7,g,()=>Ce,()=>({duration:100})),t(se,g)}var da=m('<div class="desc svelte-19xxeot"> </div> <!> <!>',1),ca=m('<div class="desc svelte-19xxeot"><p> </p> <p> </p></div>'),va=m('<div class="desc svelte-19xxeot"><p class="declined svelte-19xxeot"> </p> <p> </p></div>'),la=m("<li> </li>"),na=m('<div class="desc svelte-19xxeot"> <ul></ul></div> <div class="inline svelte-19xxeot"><!> <!></div>',1),ua=m('<div class="container svelte-19xxeot"><div class="name svelte-19xxeot"><h2> </h2></div> <!> <div class="err svelte-19xxeot"> </div></div>'),pa=m("<!> <!>",1),ma=m("<!> <!>",1);function fa(se,E){Be(E,!0);const Z="8rem";let a=ea(),F=x(void 0),y=x(""),$=x(8),l=x(!1),g=!1,b=x(void 0),G=x(!1),q=x(!1),L=v({userCode:""}),B=x(v({userCode:""})),I=x(v({}));Fe(()=>{a&&s($)&&e(I,v(qe().shape({userCode:Ie().trim().min(s($),a.common.errTooShort).max(s($),a.common.errTooLong).matches(Ke,a.common.invalidInput)})))}),Oe(async()=>{const n=Ge();n.code&&(L.userCode=n.code);let H=await He();H.ok?e(F,v(await H.json())):n.code?we(`device?code=${n.code}`):we("device")});function te(){g&&r()}async function i(n){var J;if(e(y,""),g=!0,!await r())return;e(l,!0);let H=await Ve(),re={user_code:L.userCode,pow:H,device_accepted:n};const D=await Me(re);if(D.status===200){const P=await D.json();console.log(P),e(b,v(((J=P.scopes)==null?void 0:J.split(" "))||["openid"]))}else if(D.status===202)e(G,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3);else if(D.status===204)e(q,!0);else if(D.status===404)e(y,v(a.device.wrongOrExpired));else{const P=await D.json();e(y,v(P.message))}e(l,!1)}async function r(){try{return await s(I).validate(L,{abortEarly:!1}),e(B,v({userCode:""})),!0}catch(n){return e(B,v(Qe(n))),!1}}var pe=ma();We(n=>{f(()=>Se.title=(a==null?void 0:a.device.title)||"Device Authorization")});var me=W(pe);aa(me,{id:Je,get value(){return s($)},set value(n){e($,v(n))}});var ye=u(me,2);Ye(ye,{children:(n,H)=>{Ue(n,{children:(re,D)=>{var J=pa(),P=W(J);{var be=O=>{ia(O,{})},Le=O=>{var oe=ua(),ie=c(oe),fe=c(ie),Te=c(fe,!0);o(fe),o(ie);var xe=u(ie,2);{var De=R=>{var K=da(),M=W(K),de=c(M,!0);f(()=>p(de,a.device.desc.replaceAll("{{count}}",s($)))),o(M);var N=u(M,2);Ne(N,{name:"userCode",autocomplete:"off",get placeholder(){return a.device.userCode},get value(){return L.userCode},set value(d){L.userCode=d},get error(){return s(B).userCode},set error(d){s(B).userCode=d},$$events:{enter:i,input:te},children:(d,_)=>{ae();var h=ee();f(()=>p(h,a.device.userCode.toUpperCase())),t(d,h)},$$slots:{default:!0}});var k=u(N,2);ue(k,{get isLoading(){return s(l)},set isLoading(d){e(l,v(d))},$$events:{click:()=>i("pending")},children:(d,_)=>{ae();var h=ee();f(()=>p(h,a.device.submit)),t(d,h)},$$slots:{default:!0}}),t(R,K)},Pe=R=>{var K=he(),M=W(K);{var de=k=>{var d=ca(),_=c(d),h=c(_,!0);o(_);var V=u(_,2),T=c(V,!0);o(V),o(d),f(()=>{p(h,a.device.isAccepted),p(T,a.device.autoRedirectAccount)}),t(k,d)},N=k=>{var d=he(),_=W(d);{var h=T=>{var S=va(),j=c(S),Y=c(j,!0);o(j);var Q=u(j,2),U=c(Q,!0);o(Q),o(S),f(()=>{p(Y,a.device.isDeclined),p(U,a.device.closeWindow)}),t(T,S)},V=T=>{var S=na(),j=W(S),Y=c(j),Q=u(Y);ze(Q,21,()=>s(b),Ee,(w,ce)=>{var C=la(),Ae=c(C,!0);o(C),f(()=>p(Ae,s(ce))),t(w,C)}),o(Q),o(j);var U=u(j,2),ge=c(U);ue(ge,{level:1,width:Z,get isLoading(){return s(l)},set isLoading(w){e(l,v(w))},$$events:{click:()=>i("accept")},children:(w,ce)=>{ae();var C=ee();f(()=>p(C,a.device.accept)),t(w,C)},$$slots:{default:!0}});var je=u(ge,2);ue(je,{level:3,width:Z,get isLoading(){return s(l)},set isLoading(w){e(l,v(w))},$$events:{click:()=>i("decline")},children:(w,ce)=>{ae();var C=ee();f(()=>p(C,a.device.decline)),t(w,C)},$$slots:{default:!0}}),o(U),f(()=>p(Y,`${a.device.descScopes??""} `)),t(T,S)};A(_,T=>{s(q)?T(h):T(V,!1)},!0)}t(k,d)};A(M,k=>{s(G)?k(de):k(N,!1)},!0)}t(R,K)};A(xe,R=>{s(b)===void 0?R(De):R(Pe,!1)})}var $e=u(xe,2),_e=c($e,!0);o($e),o(oe),f(()=>{p(Te,a.device.title),p(_e,s(y))}),t(O,oe)};A(P,O=>{s(F)?O(Le,!1):O(be)})}var ke=u(P,2);Ze(ke,{absolute:!0}),t(re,J)},$$slots:{default:!0}})},$$slots:{default:!0}}),t(se,pe),Re()}export{fa as component};
