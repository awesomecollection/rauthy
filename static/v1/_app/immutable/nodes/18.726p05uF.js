import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DvmPJwhI.js";import{p as ke,s as a,c as s,r as l,t as C,a as we,o as x,a6 as Ge,l as e,f as Q,ar as D,m as v,ab as ie,ap as It,$ as Ot}from"../chunks/index-client.Ds4XgiuL.js";import{s as p,d as Kt}from"../chunks/render.Bq2-eTRf.js";import{i as z}from"../chunks/if.Du7BDhAX.js";import{e as Et}from"../chunks/each.MnMr4iw5.js";import{a as n,t as I,d as S,e as Ze}from"../chunks/template.DXIK6jcH.js";import{s as Qe}from"../chunks/class.Ik0ma2JO.js";import{a as dt,t as He,s as Je}from"../chunks/index.L0FyJ7Re.js";import{p as g}from"../chunks/proxy.CB6KOiNf.js";import{d as Yt,f as Vt,c as Xt,b as vt}from"../chunks/fetch.DFmyLr06.js";import{C as Zt}from"../chunks/ContentAdmin.COLOikfe.js";import{N as Qt}from"../chunks/NavSub.9PtxGldh.js";import{u as Ht}from"../chunks/param.svelte.D0F_0zrI.js";import{N as Jt}from"../chunks/NavButtonTile.ClPY4kTr.js";import{B as Wt}from"../chunks/ButtonAddModal.mDcrP-vd.js";import{p as pt}from"../chunks/props.CvXd4vKV.js";import{k as er}from"../chunks/key.Aw0aEB78.js";import{h as $e}from"../chunks/html.CbFxqVHf.js";import{B as Fe}from"../chunks/Button.nDjAKZm4.js";import{I as L}from"../chunks/pow.C3ENfqN0.js";import{i as tr}from"../chunks/lifecycle.Bhf52L3V.js";import{u as Ae}from"../chunks/i18n_admin.svelte.B9VY-ZfA.js";import{g as rr}from"../chunks/helpers.mrWtKrwW.js";import{I as yt}from"../chunks/IconCheck.CzEyprnz.js";import{I as ut}from"../chunks/InputArea.b1xJeKQY.js";import{I as Tt}from"../chunks/InputPassword.DstTXUmk.js";import{F as At}from"../chunks/Form.JHjwURkX.js";import{u as _t}from"../chunks/i18n.svelte.CgUwCKxn.js";import{L as mt}from"../chunks/LabeledValue.CfdJ335t.js";import{I as te}from"../chunks/InputCheckbox.wovkCxqv.js";import{g as G,h as Lt,f as Mt,i as ft}from"../chunks/patterns.D9HtGhEC.js";import{I as ar}from"../chunks/InputFile.jIZ8_9EF.js";import{g as Pt}from"../chunks/helpers.BTvs6bnN.js";import{E as ir}from"../chunks/Expandable.CX2wPjIu.js";import{T as or}from"../chunks/Tabs.Cqg7xZCh.js";import{C as Nt}from"../chunks/CheckIcon.D9rG40ob.js";import{O as sr}from"../chunks/Options.Bth8pjCB.js";var lr=I('<div class="desc svelte-6fcb3i"><h4 class="svelte-6fcb3i">ID token claim mappings</h4> <p class="svelte-6fcb3i"> </p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p></div>');function zt(K,q){ke(q,!1);let t=Ae();tr();var c=lr(),o=a(s(c),2),h=s(o,!0);l(o);var k=a(o,2),f=s(k);$e(f,()=>t.providers.config.jsonPath.p2),l(k);var M=a(k,2),P=s(M);$e(P,()=>t.providers.config.jsonPath.p3),l(M);var b=a(M,2),r=s(b);$e(r,()=>t.providers.config.jsonPath.p4),l(b);var B=a(b,2),u=s(B);$e(u,()=>t.providers.config.jsonPath.p5),l(B);var A=a(B,2),_=s(A);$e(_,()=>t.providers.config.jsonPath.p6),l(A),l(c),C(()=>p(h,t.providers.config.jsonPath.p1)),n(K,c),we()}var nr=I('<img alt="No Logo Available">');function cr(K,q){ke(q,!0);var t=nr();C(()=>Qe(t,"src",`/auth/v1/providers/${q.providerId}/img?${rr(6)}`)),Qe(t,"width",20),Qe(t,"height",20),n(K,t),we()}var dr=I("<div><!></div>"),vr=I('<div class="checkbox svelte-iec8od"><!></div>'),pr=I('<div class="err"> </div>'),ur=I('<div class="svelte-iec8od"><!></div>'),_r=I('<span class="err"> </span>'),mr=I('<!> <div></div> <div class="checkbox svelte-iec8od"><!></div> <div class="checkbox svelte-iec8od"><!></div> <!> <!> <!> <!> <!> <div class="checkbox svelte-iec8od"><!></div> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p><!></p> <div class="checkbox svelte-iec8od"><!></div> <div class="checkbox svelte-iec8od"><!></div> <!> <!> <p class="desc svelte-iec8od"> </p> <!> <!> <p class="desc svelte-iec8od"> </p> <!> <!> <div class="logo svelte-iec8od"><!> <!></div> <div class="flex gap-05"><!> <!> <!></div>',1),fr=I('<div class="container svelte-iec8od"><!></div>');function hr(K,q){ke(q,!0);let t=pt(q,"provider",15),c=_t(),o=Ae();const h="min(calc(100dvw - .5rem), 30rem)";let k=!1,f=x(""),M=x(!1),P=x(!!t().root_pem),b=x(g(Pt()));Ge(()=>{t().id&&(t(t().client_secret=t().client_secret||"",!0),t(t().admin_claim_path=t().admin_claim_path||"",!0),t(t().admin_claim_value=t().admin_claim_value||"",!0),t(t().mfa_claim_path=t().mfa_claim_path||"",!0),t(t().mfa_claim_value=t().mfa_claim_value||"",!0),t(t().root_pem=t().root_pem||"",!0))}),Ge(()=>{t().scope&&t(t().scope=t().scope.replaceAll("+"," "),!0)});async function r(_,y){if(v(f,""),t().client_secret&&!(t().client_secret_basic||t().client_secret_post)){v(f,g(o.providers.config.errNoAuthMethod));return}if(!t().use_pkce&&!t().client_secret){v(f,g(o.providers.config.errConfidential));return}let E={name:t().name,typ:t().typ,enabled:t().enabled,issuer:t().issuer,authorization_endpoint:t().authorization_endpoint,token_endpoint:t().token_endpoint,userinfo_endpoint:t().userinfo_endpoint,danger_allow_insecure:e(P)&&t().root_pem?!1:t().danger_allow_insecure,use_pkce:t().use_pkce,client_secret_basic:t().client_secret_basic,client_secret_post:t().client_secret_post,client_id:t().client_id,client_secret:t().client_secret||void 0,scope:t().scope.trim(),root_pem:e(P)&&t().root_pem?t().root_pem.trim():void 0,admin_claim_path:t().admin_claim_path||void 0,admin_claim_value:t().admin_claim_value||void 0,mfa_claim_path:t().mfa_claim_path||void 0,mfa_claim_value:t().mfa_claim_value||void 0},N=await Yt(_.action,E);N.error?v(f,g(N.error.message)):(v(M,!0),q.onSave(),setTimeout(()=>{v(M,!1)},3e3))}var B=fr(),u=s(B),A=ie(()=>`/auth/v1/providers/${t().id}`);At(u,{get action(){return e(A)},onSubmit:r,children:(_,y)=>{var E=mr(),N=Q(E);mt(N,{label:"ID",mono:!0,children:(i,w)=>{D();var $=S();C(()=>p($,t().id)),n(i,$)},$$slots:{default:!0}});var H=a(N,2);dt(H,"height",".15rem");var Y=a(H,2),V=s(Y);te(V,{get ariaLabel(){return o.common.enabled},get checked(){return t().enabled},set checked(i){t(t().enabled=i,!0)},children:(i,w)=>{D();var $=S();C(()=>p($,o.common.enabled)),n(i,$)},$$slots:{default:!0}}),l(Y);var U=a(Y,2),oe=s(U);te(oe,{get ariaLabel(){return o.providers.config.custRootCa},get checked(){return e(P)},set checked(i){v(P,g(i))},children:(i,w)=>{D();var $=S();C(()=>p($,o.providers.config.custRootCa)),n(i,$)},$$slots:{default:!0}}),l(U);var pe=a(U,2);{var de=i=>{var w=dr(),$=s(w);ut($,{rows:15,name:"rootPem",get label(){return o.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
 -----END CERTIFICATE-----`,errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - .5rem))",fontMono:!0,pattern:ft,get value(){return t().root_pem},set value(ne){t(t().root_pem=ne,!0)}}),l(w),He(3,w,()=>Je,()=>({duration:150})),n(i,w)},Ce=i=>{var w=vr(),$=s(w);te($,{get ariaLabel(){return o.providers.config.allowInsecureTls},get checked(){return t().danger_allow_insecure},set checked(ne){t(t().danger_allow_insecure=ne,!0)},children:(ne,ht)=>{D();var De=S();C(()=>p(De,o.providers.config.allowInsecureTls)),n(ne,De)},$$slots:{default:!0}}),l(w),n(i,w)};z(pe,i=>{e(P)?i(de):i(Ce,!1)})}var ue=a(pe,2);L(ue,{autocomplete:"off",label:"Issuer URL",placeholder:"Issuer URL",required:!0,pattern:G,width:h,get value(){return t().issuer},set value(i){t(t().issuer=i,!0)}});var O=a(ue,2);L(O,{typ:"url",autocomplete:"off",label:"Authorization Endpoint",placeholder:"Authorization Endpoint",required:!0,pattern:G,width:h,get value(){return t().authorization_endpoint},set value(i){t(t().authorization_endpoint=i,!0)}});var R=a(O,2);L(R,{typ:"url",autocomplete:"off",label:"Token Endpoint",placeholder:"Token Endpoint",required:!0,pattern:G,width:h,get value(){return t().token_endpoint},set value(i){t(t().token_endpoint=i,!0)}});var X=a(R,2);L(X,{typ:"url",autocomplete:"off",label:"Userinfo Endpoint",placeholder:"Userinfo Endpoint",required:!0,pattern:G,width:h,get value(){return t().userinfo_endpoint},set value(i){t(t().userinfo_endpoint=i,!0)}});var m=a(X,2),_e=s(m);te(_e,{ariaLabel:"PKCE",get checked(){return t().use_pkce},set checked(i){t(t().use_pkce=i,!0)},children:(i,w)=>{D();var $=S("PKCE");n(i,$)},$$slots:{default:!0}}),l(m);var le=a(m,2),me=s(le,!0);l(le);var fe=a(le,2);L(fe,{autocomplete:"off",label:"Scope",placeholder:"openid profile email",required:!0,pattern:Lt,width:h,get value(){return t().scope},set value(i){t(t().scope=i,!0)}});var he=a(fe,2),je=s(he,!0);l(he);var Le=a(he,2);L(Le,{autocomplete:"off",get label(){return o.providers.config.clientName},get placeholder(){return o.providers.config.clientName},required:!0,pattern:Mt,width:h,get value(){return t().name},set value(i){t(t().name=i,!0)}});var Ie=a(Le,2),We=s(Ie,!0);l(Ie);var Me=a(Ie,2);L(Me,{autocomplete:"off",label:"Client ID",placeholder:"Client ID",required:!0,pattern:G,width:h,get value(){return t().client_id},set value(i){t(t().client_id=i,!0)}});var Pe=a(Me,2),et=s(Pe,!0);l(Pe);var Be=a(Pe,2),T=ie(()=>!t().use_pkce);Tt(Be,{autocomplete:"off",label:"Client Secret",placeholder:"Client Secret",maxLength:256,get errMsg(){return o.providers.config.errConfidential},get required(){return e(T)},width:h,get value(){return t().client_secret},set value(i){t(t().client_secret=i,!0)}});var F=a(Be,2),J=s(F);$e(J,()=>o.providers.config.descAuthMethod),l(F);var se=a(F,2),Ne=s(se);te(Ne,{ariaLabel:"client_secret_basic",get checked(){return t().client_secret_basic},set checked(i){t(t().client_secret_basic=i,!0)},children:(i,w)=>{D();var $=S("client_secret_basic");n(i,$)},$$slots:{default:!0}}),l(se);var re=a(se,2),ve=s(re);te(ve,{ariaLabel:"client_secret_post",get checked(){return t().client_secret_post},set checked(i){t(t().client_secret_post=i,!0)},children:(i,w)=>{D();var $=S("client_secret_post");n(i,$)},$$slots:{default:!0}}),l(re);var Z=a(re,2);{var W=i=>{var w=pr(),$=s(w,!0);l(w),C(()=>p($,o.providers.config.errNoAuthMethod)),He(3,w,()=>Je,()=>({duration:150})),n(i,w)};z(Z,i=>{!t().use_pkce&&!t().client_secret_basic&&!t().client_secret_post&&i(W)})}var ee=a(Z,2);zt(ee,{});var ae=a(ee,2),ze=s(ae,!0);l(ae);var ge=a(ae,2);L(ge,{autocomplete:"off",get label(){return o.providers.config.pathAdminClaim},placeholder:"$.roles.*",pattern:G,width:h,get value(){return t().admin_claim_path},set value(i){t(t().admin_claim_path=i,!0)}});var Oe=a(ge,2);L(Oe,{autocomplete:"off",get label(){return o.providers.config.valueAdminClaim},placeholder:"rauthy_admin",pattern:G,width:h,get value(){return t().admin_claim_value},set value(i){t(t().admin_claim_value=i,!0)}});var Ee=a(Oe,2),Ke=s(Ee,!0);l(Ee);var qe=a(Ee,2);L(qe,{autocomplete:"off",get label(){return o.providers.config.pathMfaClaim},placeholder:"$.amr.*",pattern:G,width:h,get value(){return t().mfa_claim_path},set value(i){t(t().mfa_claim_path=i,!0)}});var Re=a(qe,2);L(Re,{autocomplete:"off",get label(){return o.providers.config.valueMfaClaim},placeholder:"mfa",pattern:G,width:h,get value(){return t().mfa_claim_value},set value(i){t(t().mfa_claim_value=i,!0)}});var be=a(Re,2),Ye=s(be);er(Ye,()=>e(b),i=>{var w=ur(),$=s(w);cr($,{get providerId(){return t().id}}),l(w),n(i,w)});var tt=a(Ye,2),rt=ie(()=>`/auth/v1/providers/${t().id}/img`);ar(tt,{method:"PUT",get url(){return e(rt)},fileName:"logo",onSuccess:()=>v(b,g(Pt()))}),l(be);var ye=a(be,2),Ve=s(ye);Fe(Ve,{type:"submit",get isLoading(){return k},children:(i,w)=>{D();var $=S();C(()=>p($,c.common.save)),n(i,$)},$$slots:{default:!0}});var xe=a(Ve,2);{var Ue=i=>{yt(i,{})};z(xe,i=>{e(M)&&i(Ue)})}var at=a(xe,2);{var Xe=i=>{var w=_r(),$=s(w,!0);l(w),C(()=>p($,e(f))),n(i,w)};z(at,i=>{e(f)&&i(Xe)})}l(ye),C(()=>{p(me,o.providers.config.descScope),p(je,o.providers.config.descClientName),p(We,o.providers.config.descClientId),p(et,o.providers.config.descClientSecret),p(ze,o.providers.config.mapUser),p(Ke,o.providers.config.mapMfa)}),n(_,E)},$$slots:{default:!0}}),l(B),n(K,B),we()}var gr=I('<div class="user svelte-1vu6qeb"> <span class="muted font-mono svelte-1vu6qeb"> </span></div>'),br=I('<div class="forceDelete svelte-1vu6qeb"> </div>'),kr=I('<p class="err"><b> </b></p> <p> </p> <!> <p> </p> <!> <!>',1),wr=I("<p> </p> <!>",1),$r=I('<div class="err"> </div>'),Cr=I('<div class="container svelte-1vu6qeb"><!> <!></div>');function Ir(K,q){ke(q,!0);let t=_t(),c=Ae(),o=x(!0),h=x(""),k=x(!1),f=x(g([]));It(async()=>{let _=await Vt(`/auth/v1/providers/${q.provider.id}/delete_safe`);_.status===406&&_.error&&v(f,g(_.error)),v(o,!1)});async function M(){v(h,""),v(o,!0);let _=await Xt(`/auth/v1/providers/${q.provider.id}`);_.error?v(h,g(_.error.message)):q.onSave(),v(o,!1)}var P=Cr(),b=s(P);{var r=_=>{var y=kr(),E=Q(y),N=s(E),H=s(N,!0);l(N),l(E);var Y=a(E,2),V=s(Y,!0);l(Y);var U=a(Y,2);ir(U,{summary:O=>{D();var R=S();C(()=>p(R,c.providers.delete.linkedUsers)),n(O,R)},details:O=>{var R=Ze(),X=Q(R);Et(X,17,()=>e(f),m=>m.id,(m,_e)=>{var le=gr(),me=s(le),fe=a(me),he=s(fe);l(fe),l(le),C(()=>{p(me,`${e(_e).email??""} `),p(he,`/ ${e(_e).id??""}`)}),n(m,le)}),n(O,R)},$$slots:{summary:!0,details:!0}});var oe=a(U,2),pe=s(oe,!0);l(oe);var de=a(oe,2);te(de,{get ariaLabel(){return c.providers.delete.forceDelete},get checked(){return e(k)},set checked(O){v(k,g(O))},children:(O,R)=>{var X=br(),m=s(X,!0);l(X),C(()=>p(m,c.providers.delete.forceDelete)),n(O,X)},$$slots:{default:!0}});var Ce=a(de,2);{var ue=O=>{Fe(O,{level:-1,onclick:M,get isLoading(){return e(o)},children:(R,X)=>{D();var m=S();C(()=>p(m,t.common.delete)),n(R,m)},$$slots:{default:!0}})};z(Ce,O=>{e(k)&&O(ue)})}C(()=>{p(H,c.providers.delete.isInUse1),p(V,c.providers.delete.isInUse2),p(pe,c.providers.delete.areYouSure)}),n(_,y)},B=_=>{var y=wr(),E=Q(y),N=s(E,!0);l(E);var H=a(E,2);Fe(H,{level:-1,onclick:M,get isLoading(){return e(o)},children:(Y,V)=>{D();var U=S();C(()=>p(U,t.common.delete)),n(Y,U)},$$slots:{default:!0}}),C(()=>p(N,c.providers.delete.areYouSure)),n(_,y)};z(b,_=>{e(f).length>0?_(r):_(B,!1)})}var u=a(b,2);{var A=_=>{var y=$r(),E=s(y,!0);l(y),C(()=>p(E,e(h))),n(_,y)};z(u,_=>{e(h)&&_(A)})}l(P),n(K,P),we()}var Er=I('<div class="flex"><!></div> <!>',1);function yr(K,q){ke(q,!0);let t=pt(q,"provider",15),c=pt(q,"onSave",15),o=Ae();const h=[o.tabs.config,o.tabs.delete];let k=x(g(h[0]));var f=Er(),M=Q(f),P=s(M);or(P,{tabs:h,get selected(){return e(k)},set selected(u){v(k,g(u))}}),l(M);var b=a(M,2);{var r=u=>{hr(u,{get provider(){return t()},set provider(A){t(A)},get onSave(){return c()},set onSave(A){c(A)}})},B=u=>{var A=Ze(),_=Q(A);{var y=E=>{Ir(E,{get provider(){return t()},get onSave(){return c()},set onSave(N){c(N)}})};z(_,E=>{e(k)===o.tabs.delete&&E(y)},!0)}n(u,A)};z(b,u=>{e(k)===o.tabs.config?u(r):u(B,!1)})}n(K,f),we()}Kt(["click"]);var Tr=I("<div><!></div>"),Ar=I('<div class="checkbox svelte-f8e9ia"><!></div>'),Lr=I('<div class="checkbox svelte-f8e9ia"><!></div> <!>',1),Mr=I('<div class="ml mb"><!></div>'),Pr=I('<div class="err"> </div>'),Nr=I('<!> <!> <!> <!> <!> <div class="checkbox svelte-f8e9ia"><!></div> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p><!></p> <div class="checkbox svelte-f8e9ia"><!></div> <div class="checkbox svelte-f8e9ia"><!></div> <!> <!> <p class="desc svelte-f8e9ia"> </p> <!> <!> <p class="desc svelte-f8e9ia"> </p> <!> <!>',1),zr=I('<div class="err"> </div>'),qr=I('<!> <!> <div class="flex gap-05"><!> <!> <!> <!></div>',1),Rr=I('<div class="container svelte-f8e9ia"><!> <div></div> <!></div>');function xr(K,q){ke(q,!0);let t=_t(),c=Ae();const o="min(calc(100dvw - 1.75rem), 30rem)";let h=x(!1),k=x(""),f=x(!1),M=x(!1),P=x(!1),b=x(g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),r=x(g({enabled:!0,typ:"oidc",issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",token_auth_method_basic:!1,userinfo_endpoint:"",use_pkce:!0,client_secret_basic:!0,client_secret_post:!1,name:"",client_id:"",client_secret:"",scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""})),B=["OIDC","Auto","Custom","Github","Google"],u=x(g(B[0])),A=ie(()=>e(u)==="Auto"),_=ie(()=>e(u)==="Custom"),y=ie(()=>e(u)==="OIDC"),E=ie(()=>!e(A)&&!e(_)&&!e(y)),N=ie(()=>!(e(E)||e(_)||e(f)));const H="/auth/v1/providers/lookup";let Y=ie(()=>e(N)?H:"/auth/v1/providers/create");Ge(()=>{if(e(u))switch(v(f,!1),v(b,g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),e(u)){case"Github":v(r,g({enabled:!0,issuer:"github.com",typ:"github",danger_allow_insecure:!1,authorization_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",client_secret_basic:!0,client_secret_post:!0,userinfo_endpoint:"https://api.github.com/user",use_pkce:!1,name:"Github",client_id:"",client_secret:"",scope:"user:email",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"$.two_factor_authentication",mfa_claim_value:"true"}));break;case"Google":v(b,g({issuer:"accounts.google.com",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),Ot(()=>{oe(H)});break;default:v(r,g({enabled:!0,issuer:"",typ:"oidc",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",client_secret_basic:!0,client_secret_post:!1,userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret:"",scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""}))}}),Ge(()=>{e(M)&&setTimeout(()=>{q.onSave(),pe()},1500)});async function V(R,X){e(N)?await oe(R.action):await U(R.action)}async function U(R){if(e(r).client_secret&&!(e(r).client_secret_basic||e(r).client_secret_post)){v(k,g(c.providers.config.errNoAuthMethod));return}if(!e(r).use_pkce&&!e(r).client_secret){v(k,g(c.providers.config.errConfidential));return}v(k,""),v(h,!0);let X={name:e(r).name,typ:e(A)?"custom":e(u).toLowerCase(),enabled:e(r).enabled,issuer:e(r).issuer,authorization_endpoint:e(r).authorization_endpoint,token_endpoint:e(r).token_endpoint,userinfo_endpoint:e(r).userinfo_endpoint,danger_allow_insecure:e(P)&&e(r).root_pem?!1:e(r).danger_allow_insecure,use_pkce:e(r).use_pkce,client_secret_basic:e(r).client_secret_basic,client_secret_post:e(r).client_secret_post,client_id:e(r).client_id,client_secret:e(r).client_secret,scope:e(r).scope.trim(),root_pem:e(P)&&e(r).root_pem?e(r).root_pem.trim():void 0,admin_claim_path:e(r).admin_claim_path||void 0,admin_claim_value:e(r).admin_claim_value||void 0,mfa_claim_path:e(r).mfa_claim_path||void 0,mfa_claim_value:e(r).mfa_claim_value||void 0},m=await vt(R,X);m.error?m.error.message.includes("InvalidCertificate")?v(k,"Insecure connection not allowed"):v(k,g(m.error.message)):v(M,!0),v(h,!1)}async function oe(R){if(!e(b).issuer&&!e(b).metadata_url){v(k,"Provide at least one of Issuer / Metadata URL");return}v(k,""),v(h,!0);let X={issuer:e(b).issuer||void 0,metadata_url:e(b).metadata_url||void 0,danger_allow_insecure:e(b).danger_allow_insecure,root_pem:e(b).root_pem||void 0},m=await vt(R,X);m.body?(e(r).issuer=m.body.issuer,e(r).authorization_endpoint=m.body.authorization_endpoint,e(r).danger_allow_insecure=m.body.danger_allow_insecure,e(r).token_endpoint=m.body.token_endpoint,e(r).userinfo_endpoint=m.body.userinfo_endpoint,e(r).client_secret_basic=m.body.client_secret_basic,e(r).client_secret_post=m.body.client_secret_post,e(r).use_pkce=m.body.use_pkce,e(r).client_secret_basic=m.body.client_secret_basic,e(r).client_secret_post=!m.body.client_secret_basic&&m.body.client_secret_post,e(r).scope=m.body.scope,e(r).root_pem=m.body.root_pem,v(f,!0)):m.error&&(m.error.message.includes("InvalidCertificate")?v(k,"Insecure connection not allowed"):v(k,g(m.error.message))),v(h,!1)}function pe(){v(b,g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),v(r,g({enabled:!0,issuer:"",typ:"oidc",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret_basic:!0,client_secret_post:!1,scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""})),v(M,!1),v(f,!1),v(P,!1)}var de=Rr(),Ce=s(de);sr(Ce,{ariaLabel:"Select Mode",options:B,get value(){return e(u)},set value(R){v(u,g(R))}});var ue=a(Ce,2);dt(ue,"height",".5rem");var O=a(ue,2);At(O,{get action(){return e(Y)},onSubmit:V,children:(R,X)=>{var m=qr(),_e=Q(m);{var le=T=>{var F=Lr(),J=Q(F),se=s(J);te(se,{get ariaLabel(){return c.providers.config.custRootCa},get checked(){return e(P)},set checked(Z){v(P,g(Z))},children:(Z,W)=>{D();var ee=S();C(()=>p(ee,c.providers.config.custRootCa)),n(Z,ee)},$$slots:{default:!0}}),l(J);var Ne=a(J,2);{var re=Z=>{var W=Tr(),ee=s(W);ut(ee,{rows:15,name:"rootPem",get label(){return c.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - 1.75rem))",fontMono:!0,pattern:ft,get value(){return e(b).root_pem},set value(ae){e(b).root_pem=ae}}),l(W),He(3,W,()=>Je,()=>({duration:150})),n(Z,W)},ve=Z=>{var W=Ar(),ee=s(W);te(ee,{get ariaLabel(){return c.providers.config.allowInsecureTls},get checked(){return e(b).danger_allow_insecure},set checked(ae){e(b).danger_allow_insecure=ae},children:(ae,ze)=>{D();var ge=S();C(()=>p(ge,c.providers.config.allowInsecureTls)),n(ae,ge)},$$slots:{default:!0}}),l(W),n(Z,W)};z(Ne,Z=>{e(P)?Z(re):Z(ve,!1)})}n(T,F)};z(_e,T=>{e(f)||T(le)})}var me=a(_e,2);{var fe=T=>{L(T,{name:"issuer",label:"Issuer URL",placeholder:"Issuer URL",width:o,required:!0,pattern:G,get value(){return e(b).issuer},set value(F){e(b).issuer=F}})},he=T=>{var F=Ze(),J=Q(F);{var se=re=>{L(re,{typ:"url",name:"metadata",label:"Metadata URL",placeholder:".../.well-known/openid-configuration",width:o,required:!0,pattern:G,get value(){return e(b).metadata_url},set value(ve){e(b).metadata_url=ve}})},Ne=re=>{var ve=Ze(),Z=Q(ve);{var W=ee=>{var ae=Nr(),ze=Q(ae);{var ge=d=>{ut(d,{rows:17,name:"rootPem",get label(){return c.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,get disabled(){return e(f)},errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - 1.75rem))",fontMono:!0,pattern:ft,get value(){return e(r).root_pem},set value(j){e(r).root_pem=j}})},Oe=d=>{var j=Mr(),ce=s(j);{var ct=Te=>{mt(Te,{get label(){return c.providers.config.allowInsecureTls},children:(Se,Bt)=>{Nt(Se,{get check(){return e(r).danger_allow_insecure}})},$$slots:{default:!0}})},jt=Te=>{te(Te,{get ariaLabel(){return c.providers.config.allowInsecureTls},get checked(){return e(r).danger_allow_insecure},set checked(Se){e(r).danger_allow_insecure=Se},children:(Se,Bt)=>{D();var Ct=S();C(()=>p(Ct,c.providers.config.allowInsecureTls)),n(Se,Ct)},$$slots:{default:!0}})};z(ce,Te=>{e(f)?Te(ct):Te(jt,!1)})}l(j),n(d,j)};z(ze,d=>{e(P)?d(ge):d(Oe,!1)})}var Ee=a(ze,2);L(Ee,{name:"issuer",label:"Issuer URL",placeholder:"Issuer URL",width:o,get disabled(){return e(f)},required:!0,pattern:G,get value(){return e(r).issuer},set value(d){e(r).issuer=d}});var Ke=a(Ee,2);L(Ke,{typ:"url",name:"auth_endpoint",label:"Authorization Endpoint",placeholder:"Authorization Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:G,get value(){return e(r).authorization_endpoint},set value(d){e(r).authorization_endpoint=d}});var qe=a(Ke,2);L(qe,{typ:"url",name:"token_endpoint",label:"Token Endpoint",placeholder:"Token Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:G,get value(){return e(r).token_endpoint},set value(d){e(r).token_endpoint=d}});var Re=a(qe,2);L(Re,{typ:"url",name:"userinfo_endpoint",label:"Userinfo Endpoint",placeholder:"Userinfo Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:G,get value(){return e(r).userinfo_endpoint},set value(d){e(r).userinfo_endpoint=d}});var be=a(Re,2),Ye=s(be);{var tt=d=>{mt(d,{label:"PKCE",children:(j,ce)=>{Nt(j,{get check(){return e(r).use_pkce}})},$$slots:{default:!0}})},rt=d=>{te(d,{ariaLabel:"PKCE",get checked(){return e(r).use_pkce},set checked(j){e(r).use_pkce=j},children:(j,ce)=>{D();var ct=S("PKCE");n(j,ct)},$$slots:{default:!0}})};z(Ye,d=>{e(f)?d(tt):d(rt,!1)})}l(be);var ye=a(be,2),Ve=s(ye,!0);l(ye);var xe=a(ye,2);L(xe,{name:"scope",label:"Scope",placeholder:"openid profile email",width:o,required:!0,pattern:Lt,get value(){return e(r).scope},set value(d){e(r).scope=d}});var Ue=a(xe,2),at=s(Ue,!0);l(Ue);var Xe=a(Ue,2);L(Xe,{name:"client_name",label:"Client Name",placeholder:"Client Name",width:o,required:!0,pattern:Mt,get value(){return e(r).name},set value(d){e(r).name=d}});var i=a(Xe,2),w=s(i,!0);l(i);var $=a(i,2);L($,{name:"client_id",autocomplete:"off",label:"Client ID",placeholder:"Client ID",width:o,required:!0,pattern:G,get value(){return e(r).client_id},set value(d){e(r).client_id=d}});var ne=a($,2),ht=s(ne,!0);l(ne);var De=a(ne,2),qt=ie(()=>!e(r).use_pkce);Tt(De,{name:"client_secret",autocomplete:"off",label:"Client Secret",placeholder:"Client Secret",width:o,get errMsg(){return c.providers.config.errConfidential},maxLength:256,get required(){return e(qt)},get value(){return e(r).client_secret},set value(d){e(r).client_secret=d}});var it=a(De,2),Rt=s(it);$e(Rt,()=>c.providers.config.descAuthMethod),l(it);var ot=a(it,2),xt=s(ot);te(xt,{ariaLabel:"client_secret_basic",get checked(){return e(r).client_secret_basic},set checked(d){e(r).client_secret_basic=d},children:(d,j)=>{D();var ce=S("client_secret_basic");n(d,ce)},$$slots:{default:!0}}),l(ot);var st=a(ot,2),Ut=s(st);te(Ut,{ariaLabel:"client_secret_post",get checked(){return e(r).client_secret_post},set checked(d){e(r).client_secret_post=d},children:(d,j)=>{D();var ce=S("client_secret_post");n(d,ce)},$$slots:{default:!0}}),l(st);var gt=a(st,2);{var Dt=d=>{var j=Pr(),ce=s(j,!0);l(j),C(()=>p(ce,c.providers.config.errNoAuthMethod)),He(3,j,()=>Je,()=>({duration:150})),n(d,j)};z(gt,d=>{!e(r).use_pkce&&!e(r).client_secret_basic&&!e(r).client_secret_post&&d(Dt)})}var bt=a(gt,2);zt(bt,{});var lt=a(bt,2),St=s(lt,!0);l(lt);var kt=a(lt,2);L(kt,{name:"admin_claim_path",get label(){return c.providers.config.pathAdminClaim},placeholder:"$.roles.*",width:o,pattern:G,get value(){return e(r).admin_claim_path},set value(d){e(r).admin_claim_path=d}});var wt=a(kt,2);L(wt,{name:"admin_claim_value",get label(){return c.providers.config.valueAdminClaim},placeholder:"rauthy_admin",width:o,pattern:G,get value(){return e(r).admin_claim_value},set value(d){e(r).admin_claim_value=d}});var nt=a(wt,2),Gt=s(nt,!0);l(nt);var $t=a(nt,2);L($t,{name:"mfa_claim_path",get label(){return c.providers.config.pathMfaClaim},placeholder:"$.amr.*",width:o,pattern:G,get value(){return e(r).mfa_claim_path},set value(d){e(r).mfa_claim_path=d}});var Ft=a($t,2);L(Ft,{name:"mfa_claim_value",get label(){return c.providers.config.valueMfaClaim},placeholder:"mfa",width:o,pattern:G,get value(){return e(r).mfa_claim_value},set value(d){e(r).mfa_claim_value=d}}),C(()=>{p(Ve,c.providers.config.descScope),p(at,c.providers.config.descClientName),p(w,c.providers.config.descClientId),p(ht,c.providers.config.descClientId),p(St,c.providers.config.mapUser),p(Gt,c.providers.config.mapMfa)}),n(ee,ae)};z(Z,ee=>{(e(E)||e(_)||e(f))&&ee(W)},!0)}n(re,ve)};z(J,re=>{e(A)&&!e(f)?re(se):re(Ne,!1)},!0)}n(T,F)};z(me,T=>{e(y)&&!e(f)?T(fe):T(he,!1)})}var je=a(me,2),Le=s(je);Fe(Le,{type:"submit",get isLoading(){return e(h)},children:(T,F)=>{D();var J=S();C(()=>p(J,e(N)?c.providers.config.lookup:t.common.save)),n(T,J)},$$slots:{default:!0}});var Ie=a(Le,2);{var We=T=>{Fe(T,{level:3,onclick:pe,get isLoading(){return e(h)},children:(F,J)=>{D();var se=S();C(()=>p(se,c.common.reset)),n(F,se)},$$slots:{default:!0}})};z(Ie,T=>{e(N)||T(We)})}var Me=a(Ie,2);{var Pe=T=>{yt(T,{})};z(Me,T=>{e(M)&&T(Pe)})}var et=a(Me,2);{var Be=T=>{var F=zr(),J=s(F,!0);l(F),C(()=>p(J,e(k))),n(T,F)};z(et,T=>{e(k)&&T(Be)})}l(je),n(R,m)},$$slots:{default:!0}}),l(de),n(K,de),we()}var Ur=I("<div></div> <!>",1),Dr=I('<div class="err"> </div>'),Sr=I('<div id="federation"><!></div> <!>',1),Gr=I("<!> <!>",1);function Fr(K,q){ke(q,!0);let t=Ae(),c=x(void 0),o=Ht("pid"),h=x(""),k=x(g([])),f=x(void 0);It(()=>{M()}),Ge(()=>{v(f,g(e(k).find(u=>u.id===o.get())))});async function M(){var A;let u=await vt("/auth/v1/providers");u.body?v(k,g(u.body)):v(h,g(((A=u.error)==null?void 0:A.message)||"Error"))}function P(){var u;o.set(void 0),(u=e(c))==null||u(),M()}var b=Gr(),r=Q(b);Qt(r,{width:"11rem",buttonTilesAriaControls:"federation",buttonTiles:u=>{var A=Ur(),_=Q(A);dt(_,"height",".5rem");var y=a(_,2);Et(y,17,()=>e(k),E=>E.id,(E,N)=>{var H=ie(()=>o.get()===e(N).id);Jt(E,{onclick:()=>o.set(e(N).id),get selected(){return e(H)},children:(Y,V)=>{D();var U=S();C(()=>p(U,e(N).name)),n(Y,U)},$$slots:{default:!0}})}),n(u,A)},children:(u,A)=>{var _=ie(()=>e(k).length===0?1:2);Wt(u,{get level(){return e(_)},get closeModal(){return e(c)},set closeModal(y){v(c,g(y))},children:(y,E)=>{xr(y,{onSave:P})},$$slots:{default:!0}})},$$slots:{buttonTiles:!0,default:!0}});var B=a(r,2);Zt(B,{children:(u,A)=>{var _=Sr(),y=Q(_),E=s(y);{var N=V=>{yr(V,{onSave:M,get provider(){return e(f)},set provider(U){v(f,g(U))}})};z(E,V=>{e(f)&&V(N)})}l(y);var H=a(y,2);{var Y=V=>{var U=Dr(),oe=s(U,!0);l(U),C(()=>p(oe,e(h))),n(V,U)};z(H,V=>{e(h)&&V(Y)})}C(()=>Qe(y,"aria-label",t.common.details)),n(u,_)},$$slots:{default:!0}}),n(K,b),we()}function jr(K){Fr(K,{})}export{jr as component};
