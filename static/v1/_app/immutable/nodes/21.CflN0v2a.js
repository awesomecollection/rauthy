import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DvmPJwhI.js";import{t as u,p as Y,o as I,c as b,r as D,a as Z,s as f,l as t,f as M,ar as O,m as c,ab as pe,ap as ve,a6 as ue}from"../chunks/index-client.Ds4XgiuL.js";import{s as x}from"../chunks/render.Bq2-eTRf.js";import{i as N}from"../chunks/if.Du7BDhAX.js";import{e as J}from"../chunks/each.MnMr4iw5.js";import{a as d,n as fe,t as L,d as S,e as ee}from"../chunks/template.DXIK6jcH.js";import{p as m}from"../chunks/proxy.Bsf9UJbk.js";import{l as Q,r as he}from"../chunks/helpers.BTvs6bnN.js";import{B as z}from"../chunks/Button.C_IpvWJY.js";import{P as ge}from"../chunks/Pagination.BQ2iTIIn.js";import{s as R,t as $e}from"../chunks/class.Ik0ma2JO.js";import{a as _e}from"../chunks/index.L0FyJ7Re.js";import{C as we}from"../chunks/CheckIcon.DHJwv_kD.js";import{E as xe}from"../chunks/Expandable.B-1X1J1g.js";import{T as W}from"../chunks/Tooltip.Dz7xpDMg.js";import{u as Ce}from"../chunks/i18n.svelte.CB3BpIrt.js";import{u as se}from"../chunks/i18n_admin.svelte.B_OuiPaR.js";import{L as E}from"../chunks/LabeledValue.CfdJ335t.js";import{p as V}from"../chunks/props.CpDInb2-.js";import{c as re,f as be}from"../chunks/fetch.DFmyLr06.js";import{C as De}from"../chunks/ContentAdmin.COLOikfe.js";import{O as ye}from"../chunks/OrderSearchBar.B8p4xeqT.js";import{u as Ie}from"../chunks/session.svelte.QNLyPX7s.js";import{P as Le,a as ke}from"../chunks/PaginationServerSide.Be-mzXD4.js";var Pe=fe(`<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25
            2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0
            0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5
            0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5
            0a48.667 48.667 0 0 0-7.5 0"></path></svg>`);function Te(U,a){let C=V(a,"opacity",3,.9),g=V(a,"width",3,"1.5rem"),n=V(a,"color",3,"hsl(var(--error))");var p=Pe();R(p,"stroke-width",2),u(()=>{R(p,"stroke",n()),R(p,"width",g()),R(p,"opacity",C())}),d(U,p)}var Oe=L('<div class="uid font-mono svelte-79owtg"> </div>'),Se=L('<div class="date svelte-79owtg"> </div>'),Ue=L('<div class="ip font-mono svelte-79owtg"> </div>'),Be=L('<div class="trash svelte-79owtg"><!></div>'),qe=L('<div class="header svelte-79owtg"><!> <div class="headerRight svelte-79owtg"><!> <!> <!></div></div>'),Ae=L("<!> <!> <!> <!> <!> <!> <!> <!>",1),je=L('<div class="container svelte-79owtg"><!></div>');function te(U,a){Y(a,!0);let C=Ce(),g=se(),n=I(m(C.common.copyToClip));function p(){a.session.remote_ip&&(navigator.clipboard.writeText(a.session.remote_ip),c(n,m(g.common.copiedToClip)),setTimeout(()=>{c(n,m(C.common.copyToClip))},3e3))}async function F(){let $=await re(`/auth/v1/sessions/id/${a.session.id}`);$.error?console.error($.error):a.onDeleted(a.session.id)}var k=je(),B=b(k);xe(B,{summary:$=>{var _=qe(),y=b(_);W(y,{text:"User ID",children:(w,o)=>{var i=Oe(),e=b(i,!0);D(i),u(()=>{_e(i,"margin-left",a.session.user_id?"":".5rem"),x(e,a.session.user_id)}),d(w,i)},$$slots:{default:!0}});var h=f(y,2),P=b(h);W(P,{get text(){return g.options.lastSeen},children:(w,o)=>{var i=Se(),e=b(i,!0);u(()=>x(e,Q(a.session.last_seen))),D(i),d(w,i)},$$slots:{default:!0}});var q=f(P,2);z(q,{invisible:!0,onclick:p,children:(w,o)=>{var i=pe(()=>`IP - ${t(n)}`);W(w,{get text(){return t(i)},children:(e,r)=>{var s=Ue(),H=b(s,!0);D(s),u(()=>x(H,a.session.remote_ip)),d(e,s)},$$slots:{default:!0}})},$$slots:{default:!0}});var A=f(q,2);z(A,{invisible:!0,onclick:F,children:(w,o)=>{W(w,{get text(){return C.common.delete},children:(i,e)=>{var r=Be(),s=b(r);Te(s,{width:"1.2rem"}),D(r),d(i,r)},$$slots:{default:!0}})},$$slots:{default:!0}}),D(h),D(_),d($,_)},details:$=>{var _=Ae(),y=M(_);E(y,{label:"Session ID",children:(e,r)=>{O();var s=S();u(()=>x(s,a.session.id)),d(e,s)},$$slots:{default:!0}});var h=f(y,2);E(h,{label:"User ID",children:(e,r)=>{O();var s=S();u(()=>x(s,a.session.user_id)),d(e,s)},$$slots:{default:!0}});var P=f(h,2);E(P,{get label(){return g.options.expires},children:(e,r)=>{O();var s=S();u(()=>x(s,Q(a.session.exp))),d(e,s)},$$slots:{default:!0}});var q=f(P,2);E(q,{get label(){return g.options.lastSeen},children:(e,r)=>{O();var s=S();u(()=>x(s,Q(a.session.last_seen))),d(e,s)},$$slots:{default:!0}});var A=f(q,2);E(A,{get label(){return g.options.state},children:(e,r)=>{O();var s=S();u(()=>x(s,a.session.state)),d(e,s)},$$slots:{default:!0}});var w=f(A,2);E(w,{label:"IP",children:(e,r)=>{O();var s=S();u(()=>x(s,a.session.remote_ip)),d(e,s)},$$slots:{default:!0}});var o=f(w,2);E(o,{label:"MFA",children:(e,r)=>{we(e,{get check(){return a.session.is_mfa}})},$$slots:{default:!0}});var i=f(o,2);z(i,{level:-1,onclick:F,children:(e,r)=>{O();var s=S();u(()=>x(s,C.common.delete)),d(e,s)},$$slots:{default:!0}}),d($,_)},$$slots:{summary:!0,details:!0}}),D(k),u(()=>$e(k,"expired",a.session.exp<a.now)),d(U,k),Z()}var Ee=L('<div class="err"> </div>'),Fe=L('<div class="top svelte-1sljqh8"><!> <div class="btn svelte-1sljqh8"><!></div></div> <!> <div id="sessions"><!></div> <!>',1);function He(U,a){Y(a,!0);let C=se(),g=I(""),n=I(m([])),p=I(m([])),F=I(m([])),k=I(Date.now()/1e3),B=I(void 0),$=["User ID","Session ID","IP"],_=I(m($[0])),y=I(""),h=[C.options.expires,C.options.lastSeen,"Session ID","User ID",C.options.state,"IP"];ve(()=>{P("page_size="+ke)}),ue(()=>{let o=t(y).toLowerCase();o?t(_)===$[0]?c(p,m(t(n).filter(i=>{var e;return(e=i.user_id)==null?void 0:e.toLowerCase().includes(o)}))):t(_)===$[1]?c(p,m(t(n).filter(i=>i.id.toLowerCase().includes(o)))):t(_)===$[2]&&c(p,m(t(n).filter(i=>{var e;return(e=i.remote_ip)==null?void 0:e.toLowerCase().includes(o)}))):c(p,m(t(n)))});async function P(o){let i="/auth/v1/sessions";o&&(i+=`?${o}`);let e=await be(i);return e.error?c(g,"Error fetching sessions: "+e.error.message):e.body&&(e.status===206?c(B,m(e.headers)):c(B,void 0),c(n,m(e.body)),c(k,Date.now()/1e3)),[e.status,e.headers]}function q(o,i){let e=i==="up";o===h[0]?t(n).sort((r,s)=>e?r.exp-s.exp:s.exp-r.exp):o===h[1]?t(n).sort((r,s)=>e?r.last_seen-s.last_seen:s.last_seen-r.last_seen):o===h[2]?t(n).sort((r,s)=>e?r.id.localeCompare(s.id):s.id.localeCompare(r.id)):o===h[3]?t(n).sort((r,s)=>r.user_id&&s.user_id?e?r.user_id.localeCompare(s.user_id):s.user_id.localeCompare(r.user_id):r.user_id?e?-1:1:e?1:-1):o===h[4]?t(n).sort((r,s)=>e?r.state.localeCompare(s.state):s.state.localeCompare(r.state)):o===h[5]&&t(n).sort((r,s)=>r.remote_ip&&s.remote_ip?e?r.remote_ip.localeCompare(s.remote_ip):s.remote_ip.localeCompare(r.remote_ip):r.remote_ip?e?-1:1:e?1:-1)}function A(o){var i;c(n,m(t(n).filter(e=>e.id!==o))),((i=Ie("admin").get())==null?void 0:i.id)===o&&window.location.reload()}async function w(){let o=await re("/auth/v1/sessions");o.error?c(g,m(o.error.message)):he()}De(U,{children:(o,i)=>{var e=Fe(),r=M(e),s=b(r);ye(s,{searchOptions:$,orderOptions:h,onChangeOrder:q,searchWidth:"min(25rem, calc(100dvw - 1rem))",get value(){return t(y)},set value(l){c(y,m(l))},get searchOption(){return t(_)},set searchOption(l){c(_,m(l))}});var H=f(s,2),oe=b(H);z(oe,{level:-1,onclick:w,children:(l,v)=>{O();var T=S();u(()=>x(T,C.sessions.invalidateAll)),d(l,T)},$$slots:{default:!0}}),D(H),D(r);var X=f(r,2);{var ie=l=>{var v=Ee(),T=b(v,!0);D(v),u(()=>x(T,t(g))),d(l,v)};N(X,l=>{t(g)&&l(ie)})}var G=f(X,2),ae=b(G);{var le=l=>{var v=ee(),T=M(v);J(T,17,()=>t(n),j=>j.id,(j,K)=>{te(j,{get session(){return t(K)},get now(){return t(k)},onDeleted:A})}),d(l,v)},ne=l=>{var v=ee(),T=M(v);J(T,17,()=>t(F),j=>j.id,(j,K)=>{te(j,{get session(){return t(K)},get now(){return t(k)},onDeleted:A})}),d(l,v)};N(ae,l=>{t(B)?l(le):l(ne,!1)})}D(G);var de=f(G,2);{var me=l=>{Le(l,{sspFetch:P,get itemsLength(){return t(n).length},get firstFetchHeaders(){return t(B)}})},ce=l=>{ge(l,{get items(){return t(p)},set items(v){c(p,m(v))},get itemsPaginated(){return t(F)},set itemsPaginated(v){c(F,m(v))}})};N(de,l=>{t(B)?l(me):l(ce,!1)})}d(o,e)},$$slots:{default:!0}}),Z()}function Me(U){He(U,{})}export{Me as component};
