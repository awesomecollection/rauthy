import"../chunks/disclose-version.BDr9Qe-U.js";import{f as Q,p as Ee,c as r,r as a,s as v,g as e,t as y,a as qe,a9 as ke,aq as fe,i as E,h as n,ao as sa,a4 as Je,ap as Za}from"../chunks/index-client.ijM6xFk7.js";import{h as ja}from"../chunks/svelte-head.JypCq_Qi.js";import{e as ge,a as i,t as I,d as we,n as Qa}from"../chunks/template.DOyJZ41v.js";import{i as k}from"../chunks/if.BunKWniS.js";import{p as h}from"../chunks/proxy.DmesnD8z.js";import{s as l,d as Oa}from"../chunks/render.BjVgqyVR.js";import{b as Ya}from"../chunks/window.BWnoqjse.js";import{p as $e}from"../chunks/props.YiozBtSG.js";import{k as He,Z as da,_ as Ja,P as Xa,I as er,z as ar,$ as rr,D as tr,r as sr}from"../chunks/helpers.DMpx17S8.js";import{e as ka}from"../chunks/each.K_FVK-xy.js";import{h as $a}from"../chunks/html.CrPHmmJP.js";import{a as G,c as H,s as Ve,t as xa,r as vr}from"../chunks/class.p-n0nTxi.js";import{I as va}from"../chunks/IconCheck.BI1pKadQ.js";import{I as nr}from"../chunks/IconStop.Dx0ylcy1.js";import{B as xe}from"../chunks/Button.BiyjpsYY.js";import{M as or}from"../chunks/Modal.D1p_xBN2.js";import{u as Ae}from"../chunks/i18n.svelte.BPV29n6k.js";import{c as ir,b as _a,d as Ia,f as Xe}from"../chunks/fetch.1g3fgaWW.js";import{B as lr}from"../chunks/ButtonAuthProvider.CGdust6d.js";import{t as Ue,f as Re,s as ua,a as cr}from"../chunks/index.R935SZZb.js";import{I as Le}from"../chunks/Input.CkQq4XIG.js";import{F as dr}from"../chunks/Form.CYrY4weL.js";import{a as pa,h as ur,i as Ca,j as pr}from"../chunks/patterns.C8SwZZE-.js";import{I as mr}from"../chunks/InputDateTimeCombo.D1xfODfa.js";import{w as fr,d as gr,e as hr}from"../chunks/dataFetching.B_dCHvwF.js";import{u as Pa}from"../chunks/session.svelte.3XRA2_Ct.js";import{w as wr}from"../chunks/registration.CZUCE6BN.js";import{W as Ma}from"../chunks/WebauthnRequest.C6Qz_dUA.js";import{T as yr}from"../chunks/Tooltip.Cn4hj8_1.js";import{P as br}from"../chunks/PasswordPolicy.BevixuvF.js";import{I as ma}from"../chunks/InputPassword.DmHgsauh.js";import{C as kr}from"../chunks/CheckIcon.BRA846gp.js";import{s as $r}from"../chunks/snippet.BqUd1njP.js";import{a as xr}from"../chunks/input.DCSqBrTM.js";import{A as _r}from"../chunks/A.mNzPpA_B.js";import{I as Ir}from"../chunks/InputArea.CFwSKLnL.js";import"../chunks/legacy.C93jtn63.js";import{D as za}from"../chunks/Devices.BTzgPIaD.js";import{T as Cr}from"../chunks/Template.DFOZZG5i.js";import{u as Pr}from"../chunks/param.svelte.BZ3eYfLX.js";import{T as Na}from"../chunks/Tabs._ujYIinS.js";import{M as Mr}from"../chunks/Main.qpSW1A3A.js";import{C as zr}from"../chunks/ContentCenter.DoTRNCaK.js";import{T as Nr,L as Er}from"../chunks/LangSelector.BQ-Umcpk.js";function fa(ee,p){var s=ge(),t=Q(s);{var q=C=>{va(C,{color:"hsl(var(--action))"})},o=C=>{nr(C,{color:"hsl(var(--error))"})};k(t,C=>{p.checked?C(q):C(o,!1)})}i(ee,s)}var qr=I('<div class="link-err value svelte-1tea8v4"> </div>'),Lr=I('<div class="fed-btn svelte-1tea8v4"><!> <!></div>'),Dr=I('<h3> </h3> <p> </p> <div class="providers svelte-1tea8v4"></div>',1),Wr=I("<!> <!>",1),Tr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Vr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Ar=I('<div><div>WebID:</div> <span class="value svelte-1tea8v4"><a target="_blank"><!></a></span></div>'),Br=I('<div><div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <div><div class="value svelte-1tea8v4"> </div> <!></div></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <!> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <!> <!></div>');function Ea(ee,p){Ee(p,!0);let s=$e(p,"user",15),t=Ae(),q=E(!1),o=E(!1),C=ke(()=>{var B;return(B=s().account_type)==null?void 0:B.startsWith("federated")}),$=ke(()=>{var B;return e(C)?`${s().account_type}: ${((B=p.authProvider)==null?void 0:B.name)||""}`:s().account_type}),d=ke(()=>p.viewModePhone?"rowPhone":"row"),w=ke(()=>p.viewModePhone?"labelPhone":"label");function u(B){Ja(64,(re,{challenge:ce,verifier:he})=>{re||(localStorage.setItem(Xa,he),O(B,ce))})}async function O(B,re){let ce={email:s().email,client_id:"rauthy",redirect_uri:window.location.href,provider_id:B,pkce_challenge:re},he=await _a(`/auth/v1/providers/${B}/link`,ce);if(he.text){er(he.text);let me=he.headers.get("location");me&&(window.location.href=me)}else console.error(he.error)}async function K(){let B=await ir("/auth/v1/providers/link");B.body?s(B.body):(console.error(B.error),n(q,!0))}var L=Br(),R=r(L),ae=r(R),ie=r(ae,!0);a(ae);var M=v(ae,2),z=r(M,!0);a(M),a(R);var U=v(R,2),Y=r(U),le=r(Y,!0);a(Y);var ve=v(Y,2),ne=r(ve,!0);a(ve),a(U);var X=v(U,2),g=r(X),m=r(g,!0);a(g);var P=v(g,2),c=r(P,!0);a(P),a(X);var S=v(X,2),te=r(S),ue=r(te);a(te);var f=v(te,2),W=r(f,!0);a(f),a(S);var T=v(S,2),D=r(T),A=r(D,!0);a(D);var J=v(D,2),F=r(J),de=r(F,!0);a(F);var se=v(F,2);{var ye=B=>{var re=Lr(),ce=r(re);xe(ce,{get ariaLabel(){return t.account.providerUnlink},level:3,onclick:K,children:(Ce,Be)=>{fe();var Ge=we();y(()=>l(Ge,t.account.providerUnlink)),i(Ce,Ge)},$$slots:{default:!0}});var he=v(ce,2);{var me=Ce=>{var Be=qr(),Ge=r(Be,!0);a(Be),y(()=>l(Ge,t.account.providerUnlinkDesc)),i(Ce,Be)};k(he,Ce=>{e(q)&&Ce(me)})}a(re),i(B,re)},V=B=>{var re=ge(),ce=Q(re);{var he=me=>{var Ce=Wr(),Be=Q(Ce);xe(Be,{level:2,onclick:()=>n(o,!0),children:(Oe,Ka)=>{fe();var Ye=we();y(()=>l(Ye,t.account.providerLink)),i(Oe,Ye)},$$slots:{default:!0}});var Ge=v(Be,2);or(Ge,{get showModal(){return e(o)},set showModal(Oe){n(o,h(Oe))},children:(Oe,Ka)=>{var Ye=Dr(),ia=Q(Ye),Ga=r(ia,!0);a(ia);var la=v(ia,2),Ha=r(la,!0);a(la);var ya=v(la,2);ka(ya,21,()=>p.providers,ca=>ca.id,(ca,ba)=>{var Ra=ke(()=>`${t.account.providerLink}: ${e(ba).name}`);lr(ca,{get ariaLabel(){return e(Ra)},get provider(){return e(ba)},onclick:u})}),a(ya),y(()=>{l(Ga,t.account.providerLink),l(Ha,t.account.providerLinkDesc)}),i(Oe,Ye)},$$slots:{default:!0}}),i(me,Ce)};k(ce,me=>{p.providers.length>0&&me(he)},!0)}i(B,re)};k(se,B=>{e(C)?B(ye):B(V,!1)})}a(J),a(T);var x=v(T,2),b=r(x),N=r(b,!0);a(b);var Z=v(b,2),pe=r(Z,!0);a(Z),a(x);var _=v(x,2),j=r(_),oe=r(j,!0);a(j);var _e=v(j,2),Ie=r(_e,!0);a(_e),a(_);var be=v(_,2),Pe=r(be),Ze=r(Pe,!0);a(Pe);var Se=v(Pe,2),ea=ke(()=>!!s().webauthn_user_id);fa(Se,{get checked(){return e(ea)}}),a(be);var Me=v(be,2),De=r(Me),na=r(De,!0);a(De);var aa=v(De,2);fa(aa,{get checked(){return s().enabled}}),a(Me);var Fe=v(Me,2),Ke=r(Fe),oa=r(Ke,!0);a(Ke);var Ne=v(Ke,2);fa(Ne,{get checked(){return s().email_verified}}),a(Fe);var We=v(Fe,2);{var je=B=>{var re=Tr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,He(s().last_login))),a(me),a(re),y(()=>{G(re,H(e(d)),"svelte-1tea8v4"),G(ce,H(e(w)),"svelte-1tea8v4"),l(he,t.account.lastLogin)}),i(B,re)};k(We,B=>{s().last_login&&B(je)})}var ze=v(We,2),Te=r(ze),ga=r(Te,!0);a(Te);var Qe=v(Te,2),Va=r(Qe,!0);y(()=>l(Va,s().password_expires&&He(s().password_expires)||t.common.never)),a(Qe),a(ze);var ra=v(ze,2),ta=r(ra),Aa=r(ta,!0);a(ta);var ha=v(ta,2),Ba=r(ha,!0);y(()=>l(Ba,He(s().created_at))),a(ha),a(ra);var wa=v(ra,2);{var Ua=B=>{var re=Vr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,He(s().user_expires))),a(me),a(re),y(()=>{G(re,H(e(d)),"svelte-1tea8v4"),G(ce,H(e(w)),"svelte-1tea8v4"),l(he,t.account.userExpiry)}),i(B,re)};k(wa,B=>{s().user_expires&&B(Ua)})}var Sa=v(wa,2);{var Fa=B=>{var re=Ar(),ce=r(re),he=v(ce,2),me=r(he);y(()=>Ve(me,"href",da(s().id)));var Ce=r(me);$a(Ce,()=>da(s().id).replace("/auth/","/auth/<wbr/>")),a(me),a(he),a(re),y(()=>{G(re,H(e(d)),"svelte-1tea8v4"),G(ce,H(e(w)),"svelte-1tea8v4")}),i(B,re)};k(Sa,B=>{p.webIdData&&B(Fa)})}a(L),y(()=>{G(R,H(e(d)),"svelte-1tea8v4"),G(ae,H(e(w)),"svelte-1tea8v4"),l(ie,t.common.email),l(z,s().email),G(U,H(e(d)),"svelte-1tea8v4"),G(Y,H(e(w)),"svelte-1tea8v4"),l(le,t.account.givenName),l(ne,s().given_name),G(X,H(e(d)),"svelte-1tea8v4"),G(g,H(e(w)),"svelte-1tea8v4"),l(m,t.account.familyName),l(c,s().family_name),G(S,H(e(d)),"svelte-1tea8v4"),G(te,H(e(w)),"svelte-1tea8v4"),l(ue,`${t.account.user??""} ID`),l(W,s().id),G(T,H(e(d)),"svelte-1tea8v4"),G(D,H(e(w)),"svelte-1tea8v4"),l(A,t.account.accType),l(de,e($)||""),G(x,H(e(d)),"svelte-1tea8v4"),G(b,H(e(w)),"svelte-1tea8v4"),l(N,t.account.roles),l(pe,s().roles||"None"),G(_,H(e(d)),"svelte-1tea8v4"),G(j,H(e(w)),"svelte-1tea8v4"),l(oe,t.account.groups),l(Ie,s().groups||"None"),G(be,H(e(d)),"svelte-1tea8v4"),G(Pe,H(e(w)),"svelte-1tea8v4"),l(Ze,t.account.mfaActivated),G(Me,H(e(d)),"svelte-1tea8v4"),G(De,H(e(w)),"svelte-1tea8v4"),l(na,t.account.userEnabled),G(Fe,H(e(d)),"svelte-1tea8v4"),G(Ke,H(e(w)),"svelte-1tea8v4"),l(oa,t.account.emailVerified),G(ze,H(e(d)),"svelte-1tea8v4"),G(Te,H(e(w)),"svelte-1tea8v4"),l(ga,t.account.passwordExpiry),G(ra,H(e(d)),"svelte-1tea8v4"),G(ta,H(e(w)),"svelte-1tea8v4"),l(Aa,t.account.userCreated)}),i(ee,L),qe()}var Ur=I('<div class="success svelte-4ogr3z"><!></div>'),Sr=I("<p> </p>"),Fr=I('<div class="err svelte-4ogr3z"> </div>'),Kr=I('<div class="formInner svelte-4ogr3z"><div><!> <!> <!> <!></div> <div><!> <!> <!> <!> <!></div></div> <div class="bottom svelte-4ogr3z"><div><!></div> <!></div> <!>',1),Gr=I('<div class="container svelte-4ogr3z"><!></div>');function qa(ee,p){var O;Ee(p,!0);let s=$e(p,"user",15);(O=s().user_values)!=null&&O.birthdate||s(s().user_values.birthdate="",!0);let t=Ae(),q=E(""),o=E(!1),C=E(!1);async function $(K,L){var m;const R=L.get("email"),ae=L.get("family_name")||void 0,ie=L.get("given_name")||void 0,M=L.get("birthdate")||void 0,z=((m=L.get("phone"))==null?void 0:m.replaceAll(" ",""))||void 0,U=L.get("street")||void 0,Y=L.get("zip")||void 0,le=Y?Number.parseInt(Y):void 0,ve=L.get("city")||void 0,ne=L.get("country")||void 0;let X={email:R,family_name:ae,given_name:ie,user_values:{birthdate:M,phone:z,street:U,zip:le,city:ve,country:ne}},g=await Ia(`/auth/v1/users/${s().id}/self`,X);if(g.body){n(o,!0),s(g.body);let P=3e3;g.status===202&&(n(C,!0),P=3e4),setTimeout(()=>{n(o,!1)},P)}else g.error&&(console.error(g.error),n(q,h(g.error.message)))}var d=Gr(),w=r(d),u=ke(()=>`/auth/v1/users/${s().id}/self`);dr(w,{get action(){return e(u)},onSubmit:$,children:(K,L)=>{var R=Kr(),ae=Q(R),ie=r(ae),M=r(ie);Le(M,{typ:"email",name:"email",get label(){return t.common.email},get placeholder(){return t.common.email},get value(){return s().email},required:!0});var z=v(M,2);Le(z,{name:"given_name",autocomplete:"given-name",get label(){return t.account.givenName},get placeholder(){return t.account.givenName},get value(){return s().given_name},required:!0,maxLength:32,pattern:pa});var U=v(z,2);Le(U,{name:"family_name",autocomplete:"family-name",get label(){return t.account.familyName},get placeholder(){return t.account.familyName},get value(){return s().family_name},maxLength:32,pattern:pa});var Y=v(U,2);mr(Y,{name:"birthdate",get label(){return t.account.birthdate},withDelete:!0,get value(){return s().user_values.birthdate},set value(D){s(s().user_values.birthdate=D,!0)}}),a(ie);var le=v(ie,2),ve=r(le);Le(ve,{name:"street",autocomplete:"street-address",get label(){return t.account.street},get placeholder(){return t.account.street},get value(){return s().user_values.street},maxLength:48,pattern:ur});var ne=v(ve,2);Le(ne,{typ:"number",name:"zip",autocomplete:"postal-code",get label(){return t.account.zip},get placeholder(){return t.account.zip},get value(){return s().user_values.zip},min:"1000",max:"9999999"});var X=v(ne,2);Le(X,{name:"city",autocomplete:"address-level2",get label(){return t.account.city},get placeholder(){return t.account.city},get value(){return s().user_values.city},maxLength:48,pattern:Ca});var g=v(X,2);Le(g,{name:"country",autocomplete:"country",get label(){return t.account.country},get placeholder(){return t.account.country},get value(){return s().user_values.country},maxLength:48,pattern:Ca});var m=v(g,2);Le(m,{name:"phone",autocomplete:"tel",get label(){return t.account.phone},get placeholder(){return t.account.phone},get value(){return s().user_values.phone},maxLength:32,pattern:pr}),a(le),a(ae);var P=v(ae,2),c=r(P),S=r(c);xe(S,{type:"submit",children:(D,A)=>{fe();var J=we();y(()=>l(J,t.common.save)),i(D,J)},$$slots:{default:!0}}),a(c);var te=v(c,2);{var ue=D=>{var A=Ur(),J=r(A);va(J,{}),a(A),Ue(3,A,()=>Re),i(D,A)};k(te,D=>{e(o)&&D(ue)})}a(P);var f=v(P,2);{var W=D=>{var A=Sr(),J=r(A,!0);a(A),y(()=>l(J,t.account.emailUpdateConfirm)),i(D,A)},T=D=>{var A=ge(),J=Q(A);{var F=de=>{var se=Fr(),ye=r(se,!0);a(se),y(()=>l(ye,e(q))),Ue(3,se,()=>Re),i(de,se)};k(J,de=>{e(q)&&de(F)},!0)}i(D,A)};k(f,D=>{e(C)?D(W):D(T,!1)})}i(K,R)},$$slots:{default:!0}}),a(d),i(ee,d),qe()}var Hr=Qa('<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7.864 4.243A7.5 7.5 0 0119.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 004.5 10.5a7.464 7.464 0 01-1.15 3.993m1.989 3.559A11.209 11.209 0 008.25 10.5a3.75 3.75 0 117.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 01-3.6 9.75m6.633-4.596a18.666 18.666 0 01-2.485 5.33"></path></svg>');function Rr(ee,p){let s=$e(p,"opacity",3,.9),t=$e(p,"width",3,24),q=$e(p,"color",3,"currentColor");var o=Hr();Ve(o,"stroke-width",2),y(()=>{Ve(o,"stroke",q()),Ve(o,"width",t()),Ve(o,"opacity",s())}),i(ee,o)}var Zr=I('<div class="err svelte-qkgdvy"><b>Your browser does not support Webauthn credentials and must be updated.</b></div>'),jr=I('<!> <div class="regBtns svelte-qkgdvy"><!> <!></div>',1),Qr=I('<div class="regNewBtn svelte-qkgdvy"><!></div>'),Or=I('<div class="keysHeader svelte-qkgdvy"> </div>'),Yr=I("<div><!></div>"),Jr=I('<div class="row svelte-qkgdvy"><div></div> <div class="deleteBtn svelte-qkgdvy"><!></div></div>'),Xr=I('<div class="keyContainer svelte-qkgdvy"><div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <div class="nameUv svelte-qkgdvy"><b> </b> <!></div></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <!></div>'),et=I('<div class="button svelte-qkgdvy"><!></div>'),at=I('<!> <p class="svelte-qkgdvy"> <br><br> </p> <!> <!> <div class="keysContainer svelte-qkgdvy"></div> <!> <div class="svelte-qkgdvy"> </div>',1),rt=I('<div class="container svelte-qkgdvy"><!></div>');function La(ee,p){Ee(p,!0);const s="credentials"in navigator;let t=Ae(),q=Pa("account"),o=ke(()=>{var g;return(g=q.get())==null?void 0:g.user_id}),C=E(void 0),$=E(!1),d=E(""),w=E(!1),u=E(p.user.account_type==="password"),O=E(void 0),K=E(""),L=E(!1),R=E(h([]));sa(()=>{ie()}),Je(()=>{e(R).length>0&&p.user.account_type==="passkey"&&n(u,e(R).length>1)}),Je(()=>{var g;(g=e(C))==null||g.focus()});function ae(){n($,!1),n(d,"")}async function ie(){var m;let g=await Xe(`/auth/v1/users/${(m=q.get())==null?void 0:m.user_id}/webauthn`);g.body?n(R,h(g.body)):console.error(g.error)}async function M(){if(ae(),e(L)||!e(o))return;if(e(K).length<1){n($,!0),n(d,h(t.mfa.passkeyNameErr));return}let g=await wr(e(o),e(K),t.authorize.invalidKeyUsed,t.authorize.requestExpired);g.error?(n($,!0),n(d,`${t.mfa.errorReg} - ${g.error}`)):(n(w,!1),n(K,""),await ie())}async function z(g){let m=await fr(p.user.id,g);if(m.status===200)await ie();else{let P=await m.json();n($,!0),n(d,h(P.message))}}function U(g){n(O,void 0),n($,!0),n(d,h(g)),setTimeout(()=>{n($,!1),n(d,"")},5e3)}function Y(g){n(O,void 0),n(d,h(t.mfa.testSuccess)),setTimeout(()=>{n(d,"")},3e3)}var le=rt(),ve=r(le);{var ne=g=>{var m=Zr();i(g,m)},X=g=>{var m=at(),P=Q(m);{var c=V=>{Ma(V,{get userId(){return p.user.id},get purpose(){return e(O)},onSuccess:Y,onError:U})};k(P,V=>{e(O)&&V(c)})}var S=v(P,2),te=r(S),ue=v(te,3);a(S);var f=v(S,2);{var W=V=>{var x=jr(),b=Q(x);Le(b,{autocomplete:"off",get label(){return t.mfa.passkeyName},get placeholder(){return t.mfa.passkeyName},maxLength:32,pattern:pa,onEnter:M,get ref(){return e(C)},set ref(_){n(C,h(_))},get value(){return e(K)},set value(_){n(K,h(_))},get isError(){return e(L)},set isError(_){n(L,h(_))}});var N=v(b,2),Z=r(N);xe(Z,{onclick:M,children:(_,j)=>{fe();var oe=we();y(()=>l(oe,t.mfa.register)),i(_,oe)},$$slots:{default:!0}});var pe=v(Z,2);xe(pe,{level:3,onclick:()=>n(w,!1),children:(_,j)=>{fe();var oe=we();y(()=>l(oe,t.common.cancel)),i(_,oe)},$$slots:{default:!0}}),a(N),i(V,x)},T=V=>{var x=Qr(),b=r(x),N=ke(()=>e(R).length===0?1:2);xe(b,{get level(){return e(N)},onclick:()=>n(w,!0),children:(Z,pe)=>{fe();var _=we();y(()=>l(_,t.mfa.registerNew)),i(Z,_)},$$slots:{default:!0}}),a(x),i(V,x)};k(f,V=>{e(w)?V(W):V(T,!1)})}var D=v(f,2);{var A=V=>{var x=Or(),b=r(x,!0);a(x),y(()=>l(b,t.mfa.registerdKeys)),i(V,x)};k(D,V=>{e(R).length>0&&V(A)})}var J=v(D,2);ka(J,21,()=>e(R),V=>V.name,(V,x)=>{var b=Xr(),N=r(b),Z=r(N),pe=r(Z,!0);a(Z);var _=v(Z,2),j=r(_),oe=r(j,!0);a(j);var _e=v(j,2);{var Ie=Ne=>{yr(Ne,{get text(){return t.account.userVerifiedTooltip},children:(We,je)=>{var ze=Yr();ua(ze,"margin-bottom","-.25rem");var Te=r(ze);Rr(Te,{width:18,color:"var(--col-acnt)"}),a(ze),i(We,ze)},$$slots:{default:!0}})};k(_e,Ne=>{e(x).user_verified&&Ne(Ie)})}a(_),a(N);var be=v(N,2),Pe=r(be),Ze=r(Pe,!0);a(Pe);var Se=v(Pe,2),ea=r(Se,!0);y(()=>l(ea,He(e(x).registered))),a(Se),a(be);var Me=v(be,2),De=r(Me),na=r(De,!0);a(De);var aa=v(De,2),Fe=r(aa,!0);y(()=>l(Fe,He(e(x).last_used))),a(aa),a(Me);var Ke=v(Me,2);{var oa=Ne=>{var We=Jr(),je=v(r(We),2),ze=r(je);xe(ze,{level:-3,onclick:()=>z(e(x).name),children:(Te,ga)=>{fe();var Qe=we();y(()=>l(Qe,t.common.delete)),i(Te,Qe)},$$slots:{default:!0}}),a(je),a(We),i(Ne,We)};k(Ke,Ne=>{e(u)&&Ne(oa)})}a(b),y(()=>{l(pe,t.mfa.passkeyName),l(oe,e(x).name),l(Ze,t.mfa.registerd),l(na,t.mfa.lastUsed)}),i(V,b)}),a(J);var F=v(J,2);{var de=V=>{var x=et(),b=r(x);xe(b,{onclick:()=>n(O,"Test"),children:(N,Z)=>{fe();var pe=we();y(()=>l(pe,t.mfa.test)),i(N,pe)},$$slots:{default:!0}}),a(x),i(V,x)};k(F,V=>{e(R).length>0&&V(de)})}var se=v(F,2),ye=r(se,!0);a(se),y(()=>{l(te,`${t.mfa.p1??""} `),l(ue,` ${t.mfa.p2??""}`),xa(se,"success",!e($)),xa(se,"err",e($)),l(ye,e(d))}),i(g,m)};k(ve,g=>{s?g(X,!1):g(ne)})}a(le),i(ee,le),qe()}var tt=I('<div class="container svelte-ue7bk2"><!> <!> <!> <!> <div class="btn svelte-ue7bk2"><!></div> <div class="err svelte-ue7bk2"> </div></div>');function st(ee,p){Ee(p,!0);let s=$e(p,"passwords",15),t=$e(p,"hideCurrentPassword",3,!1),q=$e(p,"isValid",15),o=Ae();q(K);let C=E(!1),$=E(""),d=E(void 0),w=ke(()=>{var M;return((M=s().new)==null?void 0:M.length)>6&&s().new===s().newConfirm}),u=E(void 0),O=E(void 0);sa(async()=>{let M=await Xe("/auth/v1/password_policy");M.body?n(d,h(M.body)):console.error(M.error)});function K(){return n($,""),!t()&&!s().current?(n($,h(o.account.passwordCurrReq)),!1):s().new?s().newConfirm?e(C)?s().new.length>256?(n($,"max 256"),!1):s().new!==s().newConfirm?(n($,h(o.account.passwordNoMatch)),!1):!0:(n($,h(o.account.passwordPolicyFollow)),!1):(n($,h(o.account.passwordNewReq)),!1):(n($,h(o.account.passwordNewReq)),!1)}function L(){if(n($,""),e(d)){let M=ar(e(d));s(s().new=M,!0),s(s().newConfirm=M,!0)}requestAnimationFrame(()=>{var M,z;(M=e(u))==null||M(),(z=e(O))==null||z()})}var R=ge(),ae=Q(R);{var ie=M=>{var z=tt(),U=r(z);br(U,{get policy(){return e(d)},get password(){return s().new},get accepted(){return e(C)},set accepted(c){n(C,h(c))}});var Y=v(U,2);{var le=c=>{ma(c,{autocomplete:"current-password",get label(){return o.account.passwordCurr},get placeholder(){return o.account.passwordCurr},onInput:K,get width(){return p.inputWidth},get value(){return s().current},set value(S){s(s().current=S,!0)}})};k(Y,c=>{t()||c(le)})}var ve=v(Y,2);ma(ve,{autocomplete:"new-password",get label(){return o.account.passwordNew},get placeholder(){return o.account.passwordNew},onInput:K,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().new},set value(c){s(s().new=c,!0)},get reportValidity(){return e(u)},set reportValidity(c){n(u,h(c))}});var ne=v(ve,2);ma(ne,{autocomplete:"new-password",get label(){return o.account.passwordConfirm},get placeholder(){return o.account.passwordConfirm},onInput:K,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().newConfirm},set value(c){s(s().newConfirm=c,!0)},get reportValidity(){return e(O)},set reportValidity(c){n(O,h(c))}});var X=v(ne,2),g=r(X);xe(g,{onclick:L,level:2,children:(c,S)=>{fe();var te=we();y(()=>l(te,o.account.generateRandom)),i(c,te)},$$slots:{default:!0}}),a(X);var m=v(X,2),P=r(m,!0);a(m),a(z),y(()=>l(P,e($))),i(M,z)};k(ae,M=>{e(d)&&M(ie)})}return i(ee,R),qe({isPwdValid:K})}var vt=I('<div class="m-05 svelte-1h4zvzu"><p> </p> <p><b> </b></p> <div></div> <p> </p> <!></div>'),nt=I("<p> </p> <p> </p> <p> </p> <div><!></div>",1),ot=I('<div class="success svelte-1h4zvzu"><!></div>'),it=I('<div class="err"> </div>'),lt=I('<div class="cancel"><!></div>'),ct=I('<div class="convertPasskey svelte-1h4zvzu"><h3> </h3> <p> </p> <!></div>'),dt=I('<div><!> <div class="save svelte-1h4zvzu"><!> <!></div></div> <!>',1),ut=I('<div class="container svelte-1h4zvzu"><!> <!> <!> <!></div>');function Da(ee,p){Ee(p,!0);let s=$e(p,"user",15),t=Ae(),q=ke(()=>p.viewModePhone?"calc(100vw - 1.5rem)":"300px"),o=E(h(s().account_type)),C=E(h([])),$=E(void 0),d=E(!1),w=E(!1),u=E(""),O=E(!1),K=E(void 0),L=E(h({current:"",new:"",newConfirm:""})),R=ke(()=>e(C).filter(f=>f.user_verified).length>0);sa(()=>{ae()});async function ae(){let f=await Xe(`/auth/v1/users/${s().id}/webauthn`);f.body?n(C,h(f.body)):console.error("error fetching passkeys: "+f.error)}async function ie(){let f=await _a(`/auth/v1/users/${s().id}/self/convert_passkey`);f.error?console.error("error fetching passkeys: "+f.error):window.location.reload()}async function M(){n(u,""),e(C).length>0?await z():await U()}async function z(){var f;if(!((f=e($))!=null&&f())){n(u,h(t.common.invalidInput));return}n(K,"PasswordNew")}async function U(f){var D,A;if(!((D=e($))!=null&&D())){n(u,h(t.common.invalidInput));return}n(w,!0);let W={password_new:e(L).new};f?W.mfa_code=f:W.password_current=e(L).current;let T=await Ia(`/auth/v1/users/${s().id}/self`,W);T.body?(n(O,!0),n(L,h({current:"",new:"",newConfirm:""})),s(T.body),n(o,h(T.body.account_type)),setTimeout(()=>{n(O,!1),n(d,!1)},3e3)):n(u,h(((A=T.error)==null?void 0:A.message)||"Error")),n(w,!1)}function Y(f){n(K,void 0),n(u,h(f)),setTimeout(()=>{n(u,"")},5e3)}function le(f){n(K,void 0),f&&"code"in f&&U(f.code)}async function ve(){let f=await gr({email:s().email});if(f.ok)n(O,!0);else{let W=await f.json();n(u,h(W.message))}}var ne=ut(),X=r(ne);{var g=f=>{Ma(f,{get userId(){return s().id},get purpose(){return e(K)},onSuccess:le,onError:Y})};k(X,f=>{e(K)&&f(g)})}var m=v(X,2);{var P=f=>{var W=vt(),T=r(W),D=r(T,!0);a(T);var A=v(T,2),J=r(A),F=r(J,!0);a(J),a(A);var de=v(A,2);ua(de,"height",".3rem");var se=v(de,2),ye=r(se,!0);a(se);var V=v(se,2);{var x=N=>{kr(N,{check:!0})},b=N=>{xe(N,{level:2,onclick:ve,children:(Z,pe)=>{fe();var _=we();y(()=>l(_,t.account.passwordReset)),i(Z,_)},$$slots:{default:!0}})};k(V,N=>{e(O)?N(x):N(b,!1)})}a(W),y(()=>{var N;l(D,t.account.federatedConvertPassword1),l(F,((N=p.authProvider)==null?void 0:N.name)||"UNKNOWN"),l(ye,t.account.federatedConvertPassword2)}),i(f,W)};k(m,f=>{e(o)==="federated"&&f(P)})}var c=v(m,2);{var S=f=>{var W=nt(),T=Q(W),D=r(T,!0);a(T);var A=v(T,2),J=r(A,!0);a(A);var F=v(A,2),de=r(F,!0);a(F);var se=v(F,2),ye=r(se);xe(ye,{level:2,onclick:()=>n(d,!0),children:(V,x)=>{fe();var b=we();y(()=>l(b,t.account.convertAccount)),i(V,b)},$$slots:{default:!0}}),a(se),y(()=>{l(D,t.account.accTypePasskeyText1),l(J,t.account.accTypePasskeyText2),l(de,t.account.accTypePasskeyText3)}),i(f,W)};k(c,f=>{(e(o)==="passkey"||e(o)==="federated_passkey")&&!e(d)&&f(S)})}var te=v(c,2);{var ue=f=>{var W=dt(),T=Q(W),D=r(T),A=ke(()=>!(e(o)==="password"&&e(C).length<1));st(D,{get inputWidth(){return e(q)},get hideCurrentPassword(){return e(A)},get passwords(){return e(L)},set passwords(b){n(L,h(b))},get isValid(){return e($)},set isValid(b){n($,h(b))}});var J=v(D,2),F=r(J);xe(F,{onclick:M,level:1,get isLoading(){return e(w)},children:(b,N)=>{fe();var Z=we();y(()=>l(Z,t.common.save)),i(b,Z)},$$slots:{default:!0}});var de=v(F,2);{var se=b=>{var N=ot(),Z=r(N);va(Z,{}),a(N),Ue(3,N,()=>Re),i(b,N)},ye=b=>{var N=ge(),Z=Q(N);{var pe=j=>{var oe=it(),_e=r(oe,!0);a(oe),y(()=>l(_e,e(u))),Ue(3,oe,()=>Re),i(j,oe)},_=j=>{var oe=ge(),_e=Q(oe);{var Ie=be=>{var Pe=lt(),Ze=r(Pe);xe(Ze,{level:3,onclick:()=>n(d,!1),children:(Se,ea)=>{fe();var Me=we();y(()=>l(Me,t.common.cancel)),i(Se,Me)},$$slots:{default:!0}}),a(Pe),i(be,Pe)};k(_e,be=>{e(d)&&!e(w)&&be(Ie)},!0)}i(j,oe)};k(Z,j=>{e(u)?j(pe):j(_,!1)},!0)}i(b,N)};k(de,b=>{e(O)?b(se):b(ye,!1)})}a(J),a(T);var V=v(T,2);{var x=b=>{var N=ct(),Z=r(N),pe=r(Z,!0);a(Z);var _=v(Z,2),j=r(_,!0);a(_);var oe=v(_,2);xe(oe,{level:2,onclick:ie,children:(_e,Ie)=>{fe();var be=we();y(()=>l(be,t.account.convertAccount)),i(_e,be)},$$slots:{default:!0}}),a(N),y(()=>{l(pe,t.account.convertAccount),l(j,t.account.convertAccountP1)}),i(b,N)};k(V,b=>{!e(d)&&e(R)&&b(x)})}i(f,W)};k(te,f=>{(e(o)==="password"||e(o)==="federated_password"||e(d))&&f(ue)})}a(ne),i(ee,ne),qe()}function pt(ee,p){ee.code==="Enter"&&p()}var mt=I('<div class="flex"><div class="label font-label noselect svelte-1xf5lr3"><!></div> <label class="switch svelte-1xf5lr3"><input type="checkbox" class="svelte-1xf5lr3"> <span class="slider slider-round svelte-1xf5lr3"></span></label></div>');function Wa(ee,p){Ee(p,!0);let s=$e(p,"checked",15,!1),t=$e(p,"ariaLabel",3,""),q=$e(p,"name",3,"");function o(){s(!s())}var C=mt(),$=r(C),d=r($);$r(d,()=>p.children),a($);var w=v($,2),u=r(w);vr(u),u.__click=o,u.__keydown=[pt,o],fe(2),a(w),a(C),y(()=>{ua($,"width",p.labelWidth),Ve(u,"name",q()),u.disabled=p.disabled,Ve(u,"aria-checked",s()),Ve(u,"aria-label",t())}),xr(u,s),i(ee,C),qe()}Oa(["click","keydown"]);var ft=I("<div><p> </p> <!></div>"),gt=I('<div class="success svelte-5kivuv"><!></div>'),ht=I('<div class="err svelte-5kivuv"> </div>'),wt=I('<div class="container svelte-5kivuv"><p> </p> <p><!></p> <div class="switch svelte-5kivuv"><!></div> <div class="switch svelte-5kivuv"><!></div> <!> <div class="bottom svelte-5kivuv"><!> <!></div></div>');function Ta(ee,p){Ee(p,!0);let s=$e(p,"webIdData",15),t=Ae();const q="14rem";let o=E(""),C=E(!1),$=E(!!s().custom_triples),d=da(s().user_id);Je(()=>{e(C)&&setTimeout(()=>{n(C,!1)},3e3)});async function w(){n(o,"");let m=await hr(s().user_id,s());if(m.ok)n(C,!0);else{let P=await m.json();n(o,h(P.message))}}var u=wt(),O=r(u),K=r(O,!0);a(O);var L=v(O,2),R=r(L);_r(R,{href:d,target:"_blank",children:(m,P)=>{var c=ge(),S=Q(c);$a(S,()=>d.replace("/auth/","/auth/<wbr/>")),i(m,c)},$$slots:{default:!0}}),a(L);var ae=v(L,2),ie=r(ae);Wa(ie,{ariaLabel:"E-Mail",labelWidth:q,get checked(){return s().expose_email},set checked(m){s(s().expose_email=m,!0)},children:(m,P)=>{fe();var c=we("E-Mail");i(m,c)},$$slots:{default:!0}}),a(ae);var M=v(ae,2),z=r(M);Wa(z,{get ariaLabel(){return t.account.webIdExpertMode},labelWidth:q,get checked(){return e($)},set checked(m){n($,h(m))},children:(m,P)=>{fe();var c=we();y(()=>l(c,t.account.webIdExpertMode)),i(m,c)},$$slots:{default:!0}}),a(M);var U=v(M,2);{var Y=m=>{var P=ft(),c=r(P),S=r(c,!0);a(c);var te=v(c,2);Ir(te,{placeholder:"FOAF",rows:15,get value(){return s().custom_triples},set value(ue){s(s().custom_triples=ue,!0)}}),a(P),y(()=>l(S,t.account.webIdDescData)),Ue(3,P,()=>cr),i(m,P)};k(U,m=>{e($)&&m(Y)})}var le=v(U,2),ve=r(le);xe(ve,{onclick:w,children:(m,P)=>{fe();var c=we();y(()=>l(c,t.common.save)),i(m,c)},$$slots:{default:!0}});var ne=v(ve,2);{var X=m=>{var P=gt(),c=r(P);va(c,{}),a(P),Ue(3,P,()=>Re),i(m,P)},g=m=>{var P=ge(),c=Q(P);{var S=te=>{var ue=ht(),f=r(ue,!0);a(ue),y(()=>l(f,e(o))),Ue(3,ue,()=>Re),i(te,ue)};k(c,te=>{e(o)&&te(S)},!0)}i(m,P)};k(ne,m=>{e(C)?m(X):m(g,!1)})}a(le),a(u),y(()=>l(K,t.account.webIdDesc)),i(ee,u),qe()}function yt(ee){za(ee,{viewMode:"account"})}var bt=I("<h3> </h3>"),kt=I('<div class="headerPhone svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="innerPhone svelte-k6hxbm"><!></div></div>',1),$t=I('<div class="header svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="inner svelte-k6hxbm"><!></div></div>',1),xt=I('<!> <div class="wrapper svelte-k6hxbm"><!></div>',1);function _t(ee,p){Ee(p,!0);const s=z=>{var U=bt(),Y=r(U,!0);a(U),y(()=>l(Y,`${t().given_name} ${t().family_name||""}`)),i(z,U)};let t=$e(p,"user",15),q=$e(p,"webIdData",15),o=Ae(),C=E(void 0),$=E(h([])),d=ke(()=>{var z;if((z=t().account_type)!=null&&z.startsWith("federated"))return e($).filter(U=>U.id===t().auth_provider_id)[0]}),w=ke(()=>e(C)&&e(C)<500),u=E(h(o.account.navInfo)),O=h(q()?[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,"WebID",o.account.devices,o.account.navLogout]:[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,o.account.devices,o.account.navLogout]);sa(()=>{Pr("v").get()==="devices"&&n(u,h(o.account.devices))}),Je(()=>{e(u)===o.account.navLogout&&rr()});var K=xt(),L=Q(K);Cr(L,{id:tr,get value(){return e($)},set value(z){n($,h(z))}});var R=v(L,2),ae=r(R);{var ie=z=>{var U=kt(),Y=Q(U),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);Na(ne,{get tabs(){return O},get selected(){return e(u)},set selected(c){n(u,h(c))}});var X=v(ne,2),g=r(X);{var m=c=>{Ea(c,{get providers(){return e($)},get authProvider(){return e(d)},viewModePhone:!0,get webIdData(){return q()},get user(){return t()},set user(S){t(S)}})},P=c=>{var S=ge(),te=Q(S);{var ue=W=>{qa(W,{viewModePhone:!0,get user(){return t()},set user(T){t(T)}})},f=W=>{var T=ge(),D=Q(T);{var A=F=>{Da(F,{get user(){return t()},get authProvider(){return e(d)},viewModePhone:!0})},J=F=>{var de=ge(),se=Q(de);{var ye=x=>{La(x,{get user(){return t()}})},V=x=>{var b=ge(),N=Q(b);{var Z=_=>{Ta(_,{get webIdData(){return q()},set webIdData(j){q(j)}})},pe=_=>{var j=ge(),oe=Q(j);{var _e=Ie=>{za(Ie,{viewMode:"account"})};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,j)};k(N,_=>{e(u)==="WebID"?_(Z):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(V,!1)},!0)}i(F,de)};k(D,F=>{e(u)===o.common.password?F(A):F(J,!1)},!0)}i(W,T)};k(te,W=>{e(u)===o.account.navEdit?W(ue):W(f,!1)},!0)}i(c,S)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(X),a(ve),i(z,U)},M=z=>{var U=$t(),Y=Q(U),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);Na(ne,{get tabs(){return O},center:!0,get selected(){return e(u)},set selected(c){n(u,h(c))}});var X=v(ne,2),g=r(X);{var m=c=>{Ea(c,{get webIdData(){return q()},get providers(){return e($)},get authProvider(){return e(d)},get user(){return t()},set user(S){t(S)}})},P=c=>{var S=ge(),te=Q(S);{var ue=W=>{qa(W,{get user(){return t()},set user(T){t(T)}})},f=W=>{var T=ge(),D=Q(T);{var A=F=>{Da(F,{get user(){return t()},get authProvider(){return e(d)}})},J=F=>{var de=ge(),se=Q(de);{var ye=x=>{La(x,{get user(){return t()}})},V=x=>{var b=ge(),N=Q(b);{var Z=_=>{Ta(_,{get webIdData(){return q()},set webIdData(j){q(j)}})},pe=_=>{var j=ge(),oe=Q(j);{var _e=Ie=>{yt(Ie)};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,j)};k(N,_=>{e(u)==="WebID"?_(Z):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(V,!1)},!0)}i(F,de)};k(D,F=>{e(u)===o.common.password?F(A):F(J,!1)},!0)}i(W,T)};k(te,W=>{e(u)===o.account.navEdit?W(ue):W(f,!1)},!0)}i(c,S)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(X),a(ve),i(z,U)};k(ae,z=>{e(w)?z(ie):z(M,!1)})}a(R),Ya("innerWidth",z=>n(C,h(z))),i(ee,K),qe()}var It=I("<!> <!> <!>",1);function Ct(ee,p){Ee(p,!0);let s=Ae(),t=Pa("account"),q=E(void 0),o=E(void 0),C=E(!1);Je(()=>{let d=t.get();d&&$(d)});async function $(d){const w=d.user_id;if(w){let u=await Promise.all([Xe(`/auth/v1/users/${w}`),Xe(`/auth/v1/users/${w}/webid/data`)]);u[0].body?n(q,h(u[0].body)):sr("account"),u[1].body?n(o,h(u[1].body)):u[1].status===404&&n(o,h({user_id:w,expose_email:!1})),n(C,!0)}else console.error("no user_id in session")}ja(d=>{y(()=>{var w;return Za.title=`${((s==null?void 0:s.account.account)||"Account")??""} ${((w=e(q))==null?void 0:w.email)??""}`})}),Mr(ee,{children:(d,w)=>{zr(d,{children:(u,O)=>{var K=It(),L=Q(K);{var R=M=>{_t(M,{get user(){return e(q)},set user(z){n(q,h(z))},get webIdData(){return e(o)},set webIdData(z){n(o,h(z))}})};k(L,M=>{e(C)&&t&&e(q)&&M(R)})}var ae=v(L,2);Nr(ae,{absolute:!0});var ie=v(ae,2);Er(ie,{absolute:!0}),i(u,K)},$$slots:{default:!0}})},$$slots:{default:!0}}),qe()}export{Ct as component};
