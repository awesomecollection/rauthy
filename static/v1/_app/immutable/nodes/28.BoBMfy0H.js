import"../chunks/disclose-version.BDr9Qe-U.js";import{p as se,P as N,o as me,Q as C,a as oe,T as v,$ as le,g as t,j as i,R as o,X as ne,U as y,W as h,V as R}from"../chunks/index-client.CzqVbBUo.js";import{s as l}from"../chunks/render.DOFZNw8l.js";import{p as n,i as I}from"../chunks/if.BnegfJmL.js";import{a as c,b as E,t as _,c as ce}from"../chunks/template.C3U8HW1x.js";import{h as ve}from"../chunks/svelte-head.BSz900xL.js";import{r as ue}from"../chunks/legacy-client.DtCljIS0.js";import{I as P,c as de,a as Q}from"../chunks/Input.BRe7i--g.js";import{g as ge,r as pe,n as fe,t as $e,u as Ne,v as ye}from"../chunks/dataFetching.BAMt2mQp.js";import{B as he}from"../chunks/Button.65naIT6w.js";import{L as ke}from"../chunks/LangSelector.Co2kZP41.js";import{f as we}from"../chunks/pow.Dzo3VwU2.js";import{M as xe,C as Ee}from"../chunks/ContentCenter.D3vmDIv7.js";import{u as Ue}from"../chunks/i18n.svelte.C_qSL0ZA.js";import{T as be}from"../chunks/Template.CJON1Uel.js";var Ce=E(" <br> <code> </code>",1),Re=E('<div class="success svelte-1ks9oi1"> <br> </div>'),_e=E('<div class="err svelte-1ks9oi1"> </div>'),qe=E('<div class="container svelte-1ks9oi1"><div class="domainTxt svelte-1ks9oi1"><h1> </h1> <!></div> <!> <!> <!> <!> <!></div> <!>',1),Le=E("<!> <!>",1);function Te(J,S){se(S,!0);let a=Ue(),p=N(""),k,U=N(!1),g=N(""),q=N(!1),m=n({email:"",givenName:"",familyName:""}),u=N(n({})),W=N(n({}));ue(()=>{a&&i(W,n(de().shape({email:Q().required(a.common.required).email(a.register.emailBadFormat),givenName:Q().required(a.common.required).matches(Ne,a.register.regexName),familyName:Q().matches(ye,a.register.regexName)})))}),me(()=>{k=ge().redirect_uri});function L(d){d.detail.code==="Enter"&&A()}async function A(){i(q,!1),i(g,"");try{await t(W).validate(m,{abortEarly:!1}),i(u,n({}))}catch(w){i(u,n(fe(w)));return}if(t(p)&&!m.email.endsWith(t(p))){i(g,n(a.register.domainErr));return}i(U,!0),await ne();let d=await we();const T={email:m.email,given_name:m.givenName,family_name:m.familyName.length>0?m.familyName:void 0,pow:d};k&&(T.redirect_uri=k);const b=await $e(T);if(b.ok)i(g,""),i(q,!0),k&&setTimeout(()=>{window.location.replace(k)},3e3);else{const w=await b.json();w.message.includes("UNIQUE constraint")?i(g,"E-Mail is already registered"):i(g,n(w.message))}i(U,!1)}var F=Le();ve(d=>{v(()=>le.title=(a==null?void 0:a.register)||"Register")});var K=C(F);be(K,{id:pe,get value(){return t(p)},set value(d){i(p,n(d))}});var Y=o(K,2);xe(Y,{children:(d,T)=>{Ee(d,{children:(b,w)=>{var V=qe(),M=C(V),j=y(M),B=y(j),z=y(B,!0);h(B);var O=o(B,2);{var Z=e=>{var s=Ce(),r=C(s,!0),f=o(r,2),$=o(f),x=y($);h($),v(()=>{l(r,a.register.domainRestricted),l(f,` ${a.register.domainAllowed??""} `),l(x,`@${t(p)??""}`)}),c(e,s)};I(O,e=>{t(p)&&e(Z)})}h(j);var X=o(j,2);P(X,{type:"email",autocomplete:"email",get placeholder(){return a.common.email},get value(){return m.email},set value(e){m.email=e},get error(){return t(u).email},set error(e){t(u).email=e},$$events:{keypress:L},children:(e,s)=>{R();var r=_();v(()=>l(r,a.common.email.toUpperCase())),c(e,r)},$$slots:{default:!0}});var D=o(X,2);P(D,{autocomplete:"given-name",get placeholder(){return a.account.givenName},get value(){return m.givenName},set value(e){m.givenName=e},get error(){return t(u).givenName},set error(e){t(u).givenName=e},$$events:{keypress:L},children:(e,s)=>{R();var r=_();v(()=>l(r,a.account.givenName.toUpperCase())),c(e,r)},$$slots:{default:!0}});var G=o(D,2);P(G,{autocomplete:"family-name",get placeholder(){return a.account.familyName},get value(){return m.familyName},set value(e){m.familyName=e},get error(){return t(u).familyName},set error(e){t(u).familyName=e},$$events:{keypress:L},children:(e,s)=>{R();var r=_();v(()=>l(r,a.account.familyName.toUpperCase())),c(e,r)},$$slots:{default:!0}});var H=o(G,2);he(H,{get isLoading(){return t(U)},set isLoading(e){i(U,n(e))},$$events:{click:A},children:(e,s)=>{R();var r=_();v(()=>l(r,a.register.register)),c(e,r)},$$slots:{default:!0}});var ee=o(H,2);{var ae=e=>{var s=Re(),r=y(s,!0),f=o(r,2);h(s),v(()=>{l(r,a.register.success),l(f,` ${a.register.emailCheck??""}`)}),c(e,s)},re=e=>{var s=ce(),r=C(s);{var f=$=>{var x=_e(),ie=y(x,!0);h(x),v(()=>l(ie,t(g))),c($,x)};I(r,$=>{t(g)&&$(f)},!0)}c(e,s)};I(ee,e=>{t(q)?e(ae):e(re,!1)})}h(M);var te=o(M,2);ke(te,{absolute:!0}),v(()=>l(z,a.register.userReg)),c(b,V)},$$slots:{default:!0}})},$$slots:{default:!0}}),c(J,F),oe()}export{Te as component};
