import"../chunks/disclose-version.BDr9Qe-U.js";import{a5 as z,p as kr,a6 as n,b as V,a3 as A,a as yr,$ as Ir,g as e,j as r,a4 as c,a7 as h,a9 as m,a8 as de,h as ue}from"../chunks/index-client.C1uYfxHd.js";import{s as R}from"../chunks/render.DlGhCWX2.js";import{i as f}from"../chunks/if.DL6pUnI4.js";import{T as Mr,B as pe,e as Sr,a as Re}from"../chunks/ThemeSwitch.B8t8VQsu.js";import{a as s,n as Tr,t as u,b as ge,c as Ve}from"../chunks/template.BehheIQn.js";import{h as qr}from"../chunks/svelte-head.76d9LV1R.js";import{b as D}from"../chunks/index.BcsnDkjo.js";import{p as l}from"../chunks/proxy.bZKuG6wn.js";import{p as Rr}from"../chunks/dataFetching.Dq7bE0Ok.js";import{z as Ur,A as Wr,B as Br,m as Cr,D as Fr,T as jr,b as Ar,E as Dr,_ as Er,P as Hr,F as Nr}from"../chunks/helpers.EoWe9H8J.js";import{W as Or}from"../chunks/WebauthnRequest.CziMDAcN.js";import{I as Pr}from"../chunks/Input.Dq3XA-_Z.js";import{L as Qr}from"../chunks/LangSelector.Bntt9KZe.js";import{p as Ue}from"../chunks/props.OoymhrXq.js";import{M as Xr,C as Gr}from"../chunks/ContentCenter.BU-nX73m.js";import{u as Kr}from"../chunks/i18n.svelte.C5UT6hSp.js";import{T as O,u as er}from"../chunks/Template.DxkxrmTY.js";import{u as U}from"../chunks/param.svelte.vEd3x5XR.js";import{F as Yr,B as Zr,I as Jr}from"../chunks/InputPassword.Bx-qin_F.js";var Vr=Tr('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>');function et(he,P){let ee=Ue(P,"color",3,"var(--col-text)"),d=Ue(P,"opacity",3,.9),me=Ue(P,"width",3,24);var v=Vr();D(v,"stroke-width",2),z(()=>{D(v,"width",me()),D(v,"color",ee()),D(v,"opacity",d())}),s(he,v)}var rt=u('<img alt="No Logo Available">'),tt=u('<a class="home svelte-1rplcwr"><!></a>'),at=u('<div class="forgotten svelte-1rplcwr"><!></div>'),ot=u("<!> <!>",1),it=u('<div class="btn flex-col svelte-1rplcwr"><!></div>'),st=u('<div class="btn flex-col svelte-1rplcwr"><!></div>'),lt=u("<!> <!> <!>",1),nt=u('<a class="reg svelte-1rplcwr" target="_blank"> </a>'),ct=u('<a class="reg svelte-1rplcwr" href="/auth/v1/users/register" target="_blank"> </a>'),vt=u("<!> <!>",1),dt=u('<div class="errMsg svelte-1rplcwr"> </div>'),ut=u('<div class="success svelte-1rplcwr"> </div>'),pt=u('<div class="btn flex-col svelte-1rplcwr"><!></div>'),gt=u('<div class="providers flex-col svelte-1rplcwr"><div class="providersSeparator svelte-1rplcwr"><div class="separator svelte-1rplcwr"></div> <div class="loginWith svelte-1rplcwr"><div class="svelte-1rplcwr">or login with</div></div></div> <!></div>'),ht=u('<div class="container svelte-1rplcwr"><div class="head svelte-1rplcwr"><div class="logo svelte-1rplcwr"><!></div> <!></div> <div class="name svelte-1rplcwr"><h2> </h2></div> <!> <!> <!> <!> <!> <!></div> <!> <!>',1),mt=u("<!> <!> <!> <!> <!> <!> <!>",1);function ft(he,P){var Oe;kr(P,!0);const ee="18rem";let d=Kr(),me=ue(()=>er().get()?"/auth/v1/dev/authorize":"/auth/v1/oidc/authorize"),v=U("client_id").get(),re=n(""),S=n(""),Q=U("redirect_uri").get(),fe=U("nonce").get(),we=((Oe=U("scope").get())==null?void 0:Oe.split(" "))||[],_e=n(void 0),be=U("state").get(),X=U("code_challenge").get(),k=U("code_challenge_method").get(),We=!1,$e=n(void 0),te=n(l([])),ae=n(void 0),E=n(!1),p=n(""),G=n(""),oe=n(""),W=n(!1),B=n(!1),ie=n(!1),se=n(!1),le=n(!1),C=n(!1),Be=n(""),ze=n(!1),$=n(l(U("login_hint").get()||"")),T=n(""),Le=n("");V(()=>{We&&(v!=null&&v.length)&&tr()}),V(()=>{e(le)&&setTimeout(()=>{r(le,!1),r(ie,!1),r(se,!1)},3e3)}),V(()=>{var t;(t=e(_e))==null||t.focus()}),V(()=>{var t;if(e(G)==="Refresh")We=!0;else if((t=e(G))!=null&&t.startsWith("MfaLogin ")){let i=e(G).replace("MfaLogin ","");r($,l(i)),r($e,l(i))}}),V(()=>{e(oe)&&Ar(e(oe))});function rr(){r(p,""),r(ie,!0),r(T,"")}async function tr(){if(!v){console.error("clientId is undefined");return}if(!Q){console.error("redirectUri is undefined");return}r(E,!0);const t={client_id:v,redirect_uri:Q,state:be,nonce:fe,scopes:we};X&&k&&(k==="plain"||k==="S256")&&(t.code_challenge=X,t.code_challenge_method=k);let i=await Re("/auth/v1/oidc/authorize/refresh",t);await Ce(i)}async function ar(t,i){if(r(p,""),!v){console.error("clientId is undefined");return}if(!Q){console.error("redirectUri is undefined");return}const w={email:e($),client_id:v,redirect_uri:Q,state:be,nonce:fe,scopes:we};if(X&&k&&(k==="plain"||k==="S256")&&(w.code_challenge=X,w.code_challenge_method=k),e(W)&&e($)!==e($e)){if(!e(T)){r(p,l(d.authorize.passwordRequired));return}if(e(T).length>256){r(p,"max 256");return}w.password=e(T)}r(E,!0);let _="/auth/v1/oidc/authorize";er().get()&&(_="/auth/v1/dev/authorize");let L=await Re(_,w);await Ce(L)}async function Ce(t){if(t.status===202){let i=t.headers.get("location");if(!i){console.error("location header missing");return}window.location.replace(i)}else if(t.status===200){r(p,"");let i=t.body;i&&"user_id"in i&&"code"in i?(r(Le,l(i.user_id)),r(ae,l({Login:i.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else if(t.status===406)r(p,l(d.authorize.clientForceMfa)),r(B,!0);else if(t.status===429){let i=t.headers.get("x-retry-not-before");if(!i){console.error("x-retry-not-before header missing");return}let w=Number.parseInt(i),_=Dr(w),L=w*1e3-new Date().getTime();r(C,!0),r(p,`${d.authorize.http429} ${_}`),r($,""),r(T,""),r(W,!1),setTimeout(()=>{r(C,!1),r(p,"")},L)}else e(W)?(r(p,l(d.authorize.invalidCredentials)),r(se,!0)):(r(W,!0),r(Be,l(e($))));r(E,!1)}function or(){e(W)&&e(Be)!==e($)&&(r(W,!1),r(T,""),r(p,""))}function ir(t){Er(64,(i,{challenge:w,verifier:_})=>{i||(localStorage.setItem(Hr,_),sr(t,w))})}async function sr(t,i){let w={email:e($)||null,client_id:v,redirect_uri:Q,scopes:we,state:be,nonce:fe,code_challenge:X,code_challenge_method:k,provider_id:t,pkce_challenge:i},_=await Rr(w);if(_.ok){const L=await _.text();Nr(L);let H=_.headers.get("location");if(!H){console.error("no location header set for provider login");return}window.location.href=H}else{let L=await _.json();r(p,l(L.message))}}function lr(t){r(ae,void 0),r(p,l(t))}function nr(t){console.log("onWebauthnSuccess",t),t&&"loc"in t&&window.location.replace(t.loc)}async function cr(){let t={email:e($)};e(S)&&(t.redirect_uri=encodeURI(e(S))),r(E,!0);let i=await Re("/auth/v1/users/request_reset",t);i.error?r(p,l(i.error.message)):r(le,!0),r(E,!1)}var Fe=mt();qr(t=>{z(()=>Ir.title=`Login ${(e(re)||v)??""}`)});var je=A(Fe);O(je,{id:Ur,get value(){return e(te)},set value(t){r(te,l(t))}});var Ae=c(je,2);O(Ae,{id:Wr,get value(){return e(re)},set value(t){r(re,l(t))}});var De=c(Ae,2);O(De,{id:Br,get value(){return e(S)},set value(t){r(S,l(t))}});var Ee=c(De,2);O(Ee,{id:Cr,get value(){return e(oe)},set value(t){r(oe,l(t))}});var He=c(Ee,2);O(He,{id:Fr,get value(){return e(G)},set value(t){r(G,l(t))}});var Ne=c(He,2);O(Ne,{id:jr,get value(){return e(ze)},set value(t){r(ze,l(t))}});var vr=c(Ne,2);Xr(vr,{children:(t,i)=>{Gr(t,{children:(w,_)=>{var L=ht(),H=A(L),xe=h(H),ke=h(xe),dr=h(ke);{var ur=a=>{var o=rt();D(o,"src",`/auth/v1/clients/${v}/logo`),s(a,o)};f(dr,a=>{v&&a(ur)})}m(ke);var pr=c(ke,2);{var gr=a=>{var o=tt(),b=h(o);et(b,{opacity:.5}),m(o),z(()=>D(o,"href",e(S))),s(a,o)};f(pr,a=>{e(S)&&a(gr)})}m(xe);var ye=c(xe,2),Pe=h(ye),hr=h(Pe,!0);m(Pe),m(ye);var Qe=c(ye,2);{var mr=a=>{Or(a,{get userId(){return e(Le)},get purpose(){return e(ae)},onSuccess:nr,onError:lr})};f(Qe,a=>{e(ae)&&e(Le)&&a(mr)})}var Xe=c(Qe,2);{var fr=a=>{var o=vt(),b=A(o);Yr(b,{get action(){return e(me)},onSubmit:ar,children:(y,Ie)=>{var ne=lt(),ce=A(ne),Me=ue(()=>e(C)||e(B));Pr(ce,{typ:"email",name:"email",autocomplete:"email",get label(){return d.common.email},get placeholder(){return d.common.email},get disabled(){return e(Me)},onInput:or,width:ee,required:!0,get value(){return e($)},set value(M){r($,l(M))}});var I=c(ce,2);{var x=M=>{var Z=ot(),ve=A(Z),Se=ue(()=>e(C)||e(B));Jr(ve,{name:"password",autocomplete:"current-password",get label(){return d.common.password},get placeholder(){return d.common.password},maxLength:256,get disabled(){return e(Se)},width:ee,required:!0,get ref(){return e(_e)},set ref(g){r(_e,l(g))},get value(){return e(T)},set value(g){r(T,l(g))}});var Te=c(ve,2);{var q=g=>{var j=at(),J=h(j);pe(J,{invisible:!0,onclick:rr,children:(qe,N)=>{de();var Je=ge();z(()=>R(Je,d.authorize.passwordForgotten)),s(qe,Je)},$$slots:{default:!0}}),m(j),s(g,j)};f(Te,g=>{e(se)&&!e(C)&&g(q)})}s(M,Z)};f(I,M=>{e(W)&&e($e)!==e($)&&!e(ie)&&M(x)})}var Y=c(I,2);{var xr=M=>{var Z=Ve(),ve=A(Z);{var Se=q=>{var g=it(),j=h(g);pe(j,{onclick:cr,children:(J,qe)=>{de();var N=ge();z(()=>R(N,d.authorize.passwordRequest)),s(J,N)},$$slots:{default:!0}}),m(g),s(q,g)},Te=q=>{var g=st(),j=h(g);pe(j,{type:"submit",get isLoading(){return e(E)},children:(J,qe)=>{de();var N=ge();z(()=>R(N,d.authorize.login)),s(J,N)},$$slots:{default:!0}}),m(g),s(q,g)};f(ve,q=>{e(ie)?q(Se):q(Te,!1)})}s(M,Z)};f(Y,M=>{!e(C)&&!e(B)&&M(xr)})}s(y,ne)},$$slots:{default:!0}});var F=c(b,2);{var K=y=>{var Ie=Ve(),ne=A(Ie);{var ce=I=>{var x=nt(),Y=h(x,!0);m(x),z(()=>{D(x,"href",`/auth/v1/users/register?redirect_uri=${e(S)??""}`),R(Y,d.authorize.signUp)}),s(I,x)},Me=I=>{var x=ct(),Y=h(x,!0);m(x),z(()=>R(Y,d.authorize.signUp)),s(I,x)};f(ne,I=>{e(S)?I(ce):I(Me,!1)})}s(y,Ie)};f(F,y=>{e(ze)&&!e(se)&&!e(C)&&y(K)})}s(a,o)};f(Xe,a=>{e(B)||a(fr)})}var Ge=c(Xe,2);{var wr=a=>{var o=dt(),b=h(o,!0);m(o),z(()=>R(b,e(p))),s(a,o)};f(Ge,a=>{e(p)&&a(wr)})}var Ke=c(Ge,2);{var _r=a=>{var o=ut(),b=h(o,!0);m(o),z(()=>R(b,d.authorize.emailSentMsg)),s(a,o)};f(Ke,a=>{e(le)&&a(_r)})}var Ye=c(Ke,2);{var br=a=>{var o=pt(),b=h(o);pe(b,{onclick:()=>window.location.href="/auth/v1/account",children:(F,K)=>{de();var y=ge("Account");s(F,y)},$$slots:{default:!0}}),m(o),s(a,o)};f(Ye,a=>{e(B)&&a(br)})}var $r=c(Ye,2);{var zr=a=>{var o=gt(),b=c(h(o),2);Sr(b,17,()=>e(te),F=>F.id,(F,K)=>{var y=ue(()=>`Login: ${e(K).name}`);Zr(F,{get ariaLabel(){return e(y)},get provider(){return e(K)},onclick:ir})}),m(o),s(a,o)};f($r,a=>{!e(B)&&e(te)&&a(zr)})}m(H);var Ze=c(H,2);Mr(Ze,{absolute:!0});var Lr=c(Ze,2);Qr(Lr,{absolute:!0}),z(()=>R(hr,e(re)||v)),s(w,L)},$$slots:{default:!0}})},$$slots:{default:!0}}),s(he,Fe),yr()}export{ft as component};
