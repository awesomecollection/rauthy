import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DJEB66nf.js";import{t as _,p as re,A as k,c as z,r as L,a as ae,s as C,y as e,f as N,ar as E,z as r,ab as $e,ap as we,a6 as _e}from"../chunks/index-client.Di99sPv0.js";import{s as P}from"../chunks/render.Cjc4CIr8.js";import{i as ee}from"../chunks/if.DgeUjMU2.js";import{e as ie}from"../chunks/each.DxtmCefA.js";import{a as v,n as Ce,t as O,d as q,e as ne}from"../chunks/template.BEKX6jgL.js";import{p as m}from"../chunks/proxy.BQ2dmY0t.js";import{l as se,r as xe}from"../chunks/helpers.D3KrX4pz.js";import{B as J}from"../chunks/Button.D-14suAe.js";import{P as be}from"../chunks/Pagination.CzQK1Fhb.js";import{P as ke}from"../chunks/PaginationServer.BuRiZ-7H.js";import{s as K,t as Pe}from"../chunks/class.BCapn1bP.js";import{C as ye}from"../chunks/CheckIcon.CxdBm3CC.js";import{E as Ie}from"../chunks/Expandable.BetfjEnN.js";import{T as Q}from"../chunks/Tooltip.59ZAsezP.js";import{u as De}from"../chunks/i18n.svelte.Bc6aINkd.js";import{u as le}from"../chunks/i18n_admin.svelte.DI6l2V4l.js";import{L as R}from"../chunks/LabeledValue.D0BXhgF2.js";import{p as te}from"../chunks/props.ClgLgKUv.js";import{c as de,f as Se}from"../chunks/fetch.DxJS_Pk_.js";import{C as ze}from"../chunks/ContentAdmin.BWiTVMIY.js";import{O as Le}from"../chunks/OrderSearchBar.CS_Hs5DC.js";import{u as Te}from"../chunks/session.svelte.BocnM0Us.js";var Ue=Ce(`<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25
            2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0
            0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5
            0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5
            0a48.667 48.667 0 0 0-7.5 0"></path></svg>`);function Fe(G,i){let y=te(i,"opacity",3,.9),x=te(i,"width",3,"1.5rem"),c=te(i,"color",3,"hsl(var(--error))");var $=Ue();K($,"stroke-width",2),_(()=>{K($,"stroke",c()),K($,"width",x()),K($,"opacity",y())}),v(G,$)}var Oe=O('<div class="uid font-mono svelte-79owtg"> </div>'),Ae=O('<div class="date svelte-79owtg"> </div>'),Be=O('<div class="ip font-mono svelte-79owtg"> </div>'),je=O('<div class="trash svelte-79owtg"><!></div>'),Ee=O('<div class="header svelte-79owtg"><!> <div class="headerRight svelte-79owtg"><!> <!> <!></div></div>'),qe=O("<!> <!> <!> <!> <!> <!> <!> <!>",1),Ge=O('<div class="container svelte-79owtg"><!></div>');function me(G,i){re(i,!0);let y=De(),x=le(),c=k(m(y.common.copyToClip));function $(){i.session.remote_ip&&(navigator.clipboard.writeText(i.session.remote_ip),r(c,m(x.common.copiedToClip)),setTimeout(()=>{r(c,m(y.common.copyToClip))},3e3))}async function V(){let F=await de(`/auth/v1/sessions/id/${i.session.id}`);F.error?console.error(F.error):i.onDeleted(i.session.id)}var A=Ge(),W=z(A);Ie(W,{summary:F=>{var I=Ee(),b=z(I);Q(b,{text:"User ID",children:(u,T)=>{var g=Oe(),n=z(g,!0);L(g),_(()=>P(n,i.session.user_id)),v(u,g)},$$slots:{default:!0}});var w=C(b,2),D=z(w);Q(D,{get text(){return x.options.lastSeen},children:(u,T)=>{var g=Ae(),n=z(g,!0);_(()=>P(n,se(i.session.last_seen))),L(g),v(u,g)},$$slots:{default:!0}});var S=C(D,2);J(S,{invisible:!0,onclick:$,children:(u,T)=>{var g=$e(()=>`IP - ${e(c)}`);Q(u,{get text(){return e(g)},children:(n,h)=>{var s=Be(),X=z(s,!0);L(s),_(()=>P(X,i.session.remote_ip)),v(n,s)},$$slots:{default:!0}})},$$slots:{default:!0}});var B=C(S,2);J(B,{invisible:!0,onclick:V,children:(u,T)=>{Q(u,{get text(){return y.common.delete},children:(g,n)=>{var h=je(),s=z(h);Fe(s,{width:"1.2rem"}),L(h),v(g,h)},$$slots:{default:!0}})},$$slots:{default:!0}}),L(w),L(I),v(F,I)},details:F=>{var I=qe(),b=N(I);R(b,{label:"Session ID",children:(n,h)=>{E();var s=q();_(()=>P(s,i.session.id)),v(n,s)},$$slots:{default:!0}});var w=C(b,2);R(w,{label:"User ID",children:(n,h)=>{E();var s=q();_(()=>P(s,i.session.user_id)),v(n,s)},$$slots:{default:!0}});var D=C(w,2);R(D,{get label(){return x.options.expires},children:(n,h)=>{E();var s=q();_(()=>P(s,se(i.session.exp))),v(n,s)},$$slots:{default:!0}});var S=C(D,2);R(S,{get label(){return x.options.lastSeen},children:(n,h)=>{E();var s=q();_(()=>P(s,se(i.session.last_seen))),v(n,s)},$$slots:{default:!0}});var B=C(S,2);R(B,{get label(){return x.options.state},children:(n,h)=>{E();var s=q();_(()=>P(s,i.session.state)),v(n,s)},$$slots:{default:!0}});var u=C(B,2);R(u,{label:"IP",children:(n,h)=>{E();var s=q();_(()=>P(s,i.session.remote_ip)),v(n,s)},$$slots:{default:!0}});var T=C(u,2);R(T,{label:"MFA",children:(n,h)=>{ye(n,{get check(){return i.session.is_mfa}})},$$slots:{default:!0}});var g=C(T,2);J(g,{level:-1,onclick:V,children:(n,h)=>{E();var s=q();_(()=>P(s,y.common.delete)),v(n,s)},$$slots:{default:!0}}),v(F,I)},$$slots:{summary:!0,details:!0}}),L(A),_(()=>Pe(A,"expired",i.session.exp<i.now)),v(G,A),ae()}var He=O('<div class="err"> </div>'),Re=O('<div class="top svelte-1sljqh8"><!> <div class="btn svelte-1sljqh8"><!></div></div> <!> <div id="sessions"><!></div> <!>',1);function Ve(G,i){re(i,!0);let y=le(),x=k(""),c=k(m([])),$=k(m([])),V=k(m([])),A=k(Date.now()/1e3),W=k(""),F=!1,I=k(15),b=k(""),w=k(1),D=["User ID","Session ID","IP"],S=k(m(D[0])),B=k(""),u=[y.options.expires,y.options.lastSeen,"Session ID","User ID",y.options.state,"IP"];we(()=>{T()}),_e(()=>{let a=e(B).toLowerCase();a?e(S)===D[0]?r($,m(e(c).filter(f=>{var l;return(l=f.user_id)==null?void 0:l.toLowerCase().includes(a)}))):e(S)===D[1]?r($,m(e(c).filter(f=>f.id.toLowerCase().includes(a)))):e(S)===D[2]&&r($,m(e(c).filter(f=>{var l;return(l=f.remote_ip)==null?void 0:l.toLowerCase().includes(a)}))):r($,m(e(c)))});async function T(a,f,l,o){let t="/auth/v1/sessions";a===!0&&(t+=`page_size=${o||e(I)}`,f&&(t+=`&offset=${f}`),l&&(t+=`&backwards=${l}`,e(w)!==2&&e(b)&&(t+=`&continuation_token=${e(b)}`)));let U=await Se(t);if(U.error)r(x,"Error fetching sessions: "+U.error.message);else if(U.body){if(U.status===206){let M=U.headers.get("x-page-size");if(!M){console.error("Did not receive x-page-size with SSP");return}r(I,m(Number.parseInt(M))),r(b,m(U.headers.get("x-continuation-token")||"")),r(W,"session")}else r(W,"");r(c,m(U.body)),r(A,Date.now()/1e3)}}async function g(a,f){await T(!0,a,f),f?r(w,e(w)-1):r(w,e(w)+1)}function n(a,f){let l=f==="up";a===u[0]?e(c).sort((o,t)=>l?o.exp-t.exp:t.exp-o.exp):a===u[1]?e(c).sort((o,t)=>l?o.last_seen-t.last_seen:t.last_seen-o.last_seen):a===u[2]?e(c).sort((o,t)=>l?o.id.localeCompare(t.id):t.id.localeCompare(o.id)):a===u[3]?e(c).sort((o,t)=>o.user_id&&t.user_id?l?o.user_id.localeCompare(t.user_id):t.user_id.localeCompare(o.user_id):o.user_id?l?-1:1:l?1:-1):a===u[4]?e(c).sort((o,t)=>l?o.state.localeCompare(t.state):t.state.localeCompare(o.state)):a===u[5]&&e(c).sort((o,t)=>o.remote_ip&&t.remote_ip?l?o.remote_ip.localeCompare(t.remote_ip):t.remote_ip.localeCompare(o.remote_ip):o.remote_ip?l?-1:1:l?1:-1)}function h(a){var f;r(c,m(e(c).filter(l=>l.id!==a))),((f=Te("admin").get())==null?void 0:f.id)===a&&window.location.reload()}async function s(a){r(b,""),await T(!0,0,!1,a),r(w,1)}async function X(){let a=await de("/auth/v1/sessions");a.error?r(x,m(a.error.message)):xe()}ze(G,{children:(a,f)=>{var l=Re(),o=N(l),t=z(o);Le(t,{searchOptions:D,orderOptions:u,onChangeOrder:n,searchWidth:"min(25rem, calc(100dvw - 1rem))",get value(){return e(B)},set value(d){r(B,m(d))},get searchOption(){return e(S)},set searchOption(d){r(S,m(d))}});var U=C(t,2),M=z(U);J(M,{level:-1,onclick:X,children:(d,p)=>{E();var j=q();_(()=>P(j,y.sessions.invalidateAll)),v(d,j)},$$slots:{default:!0}}),L(U),L(o);var oe=C(o,2);{var ce=d=>{var p=He(),j=z(p,!0);L(p),_(()=>P(j,e(x))),v(d,p)};ee(oe,d=>{e(x)&&d(ce)})}var Y=C(oe,2),pe=z(Y);{var ve=d=>{var p=ne(),j=N(p);ie(j,17,()=>e(c),H=>H.id,(H,Z)=>{me(H,{get session(){return e(Z)},get now(){return e(A)},onDeleted:h})}),v(d,p)},ue=d=>{var p=ne(),j=N(p);ie(j,17,()=>e(V),H=>H.id,(H,Z)=>{me(H,{get session(){return e(Z)},get now(){return e(A)},onDeleted:h})}),v(d,p)};ee(pe,d=>{e(W)&&!F?d(ve):d(ue,!1)})}L(Y);var fe=C(Y,2);{var ge=d=>{ke(d,{fetchPageCallback:g,sspPageSizeChange:s,get sspPage(){return e(w)},set sspPage(p){r(w,m(p))},get sspPageSize(){return e(I)},set sspPageSize(p){r(I,m(p))},get sspContinuationToken(){return e(b)},set sspContinuationToken(p){r(b,m(p))}})},he=d=>{be(d,{get items(){return e($)},set items(p){r($,m(p))},get itemsPaginated(){return e(V)},set itemsPaginated(p){r(V,m(p))}})};ee(fe,d=>{e(W)&&!F?d(ge):d(he,!1)})}v(a,l)},$$slots:{default:!0}}),ae()}function We(G){Ve(G,{})}export{We as component};
