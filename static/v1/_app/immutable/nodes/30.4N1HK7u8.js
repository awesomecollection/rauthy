import{d as k,a as p,t as g}from"../chunks/disclose-version.BP4T4xdV.js";import{a5 as j,f as y,p as S,a as b,k as n,a6 as x,j as d,l as A,c as C,r as T,t as z}from"../chunks/index-client.hxMyB_b4.js";import{h as P,s as R}from"../chunks/render.yNX9q8-B.js";import{i as $}from"../chunks/if.BeBa1Kxb.js";import{p as f}from"../chunks/proxy.DaVNR9vk.js";import{b as B,c as E,s as L,d as U,e as D,f as F,R as G,h as I}from"../chunks/helpers.CchIKxjM.js";import{u as l}from"../chunks/param.svelte.BbzO27-O.js";var O=g('<div class="err"> </div>');function Q(m,h){b(h,!0);let s=A(""),v=l("code"),u=l("state");j(async()=>{let a=G,e=u.get();e&&(e==="account"?a=I:e.startsWith("device")&&(a=`/auth/v1/${e}`));let r=v.get();if(!r){console.error("no `code` given");return}const o=new URLSearchParams;o.append("grant_type","authorization_code"),o.append("code",r),o.append("redirect_uri",a),o.append("client_id",B),o.append("code_verifier",E());let t=await(await fetch("/auth/v1/oidc/token",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded",Accept:"application/json"},body:o})).json();if(t.error)n(s,f(t.error.toString()));else if(t.access_token){L(t.access_token),t.id_token&&U(t.id_token);let i=await(await fetch("/auth/v1/oidc/sessioninfo/xsrf",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${t.access_token}`}})).json();if(i.csrf_token)D(i.csrf_token);else{n(s,f(i.toString()));return}F(),window.location.replace(a)}else n(s,"")});var c=k();P(a=>{x.title="Callback"});var _=y(c);{var w=a=>{var e=O(),r=C(e,!0);T(e),z(()=>R(r,d(s))),p(a,e)};$(_,a=>{d(s)&&a(w)})}p(m,c),S()}export{Q as component};
