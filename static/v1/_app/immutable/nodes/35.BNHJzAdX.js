import{a as t,t as h,d as O,e as P}from"../chunks/disclose-version.BP4T4xdV.js";import{aa as ce,f as $,p as pr,a as ur,j as e,k as s,t as b,a6 as Ae,s as o,l as u,c as w,a7 as q,r as f,a9 as oe}from"../chunks/index-client.hxMyB_b4.js";import{h as vr,s as v}from"../chunks/render.yNX9q8-B.js";import{i as g}from"../chunks/if.BeBa1Kxb.js";import{B as S,t as Ve,s as De}from"../chunks/Button.BR1gOfNn.js";import{p as l}from"../chunks/proxy.DaVNR9vk.js";import{z as mr,A as wr}from"../chunks/helpers.CchIKxjM.js";import{P as fr}from"../chunks/PasswordPolicy.D0N2k_FZ.js";import{I as gr}from"../chunks/pow.BMnvYon0.js";import{W as hr}from"../chunks/WebauthnRequest.DmvtxDuu.js";import{L as $r}from"../chunks/LangSelector.Bl8L6Wq4.js";import{u as yr}from"../chunks/i18n.svelte.Ci9wvqOq.js";import{M as _r}from"../chunks/Main.Rc9oYaw1.js";import{C as kr}from"../chunks/ContentCenter.lHeEkgTE.js";import{T as Rr}from"../chunks/Template.Ih924_PB.js";import{u as br}from"../chunks/param.svelte.BbzO27-O.js";import{T as Ar}from"../chunks/ThemeSwitch.DTJa252X.js";import{I as Te}from"../chunks/InputPassword.DvK4K3vC.js";import{A as Ue}from"../chunks/A.Dq2NLtXl.js";import{u as jr}from"../chunks/is_dev.svelte.CWG7yUVe.js";import{w as xr}from"../chunks/registration.DIsXT3LM.js";import{F as ze}from"../chunks/Form.BnvI_UPN.js";import{b as Lr}from"../chunks/patterns.BRCxk8by.js";var Cr=h('<!> <!> <!> <div class="generate svelte-1w50bpj"><!></div> <!>',1),Pr=h('<div class="dev svelte-1w50bpj"><p>This window shows up during local dev,<br> only to be able to switch modes easily.<br></p> <!> <!></div>'),qr=h("<p> <br> <br> <br> <!></p>"),Nr=h("<div><!></div>"),Ir=h("<!> <!>",1),Wr=h('<div class="success"><p> </p> <p> </p> <!></div>'),Fr=h("<div><!> <!></div>"),Mr=h('<h1> </h1> <p> </p> <p> <!></p> <div class="typeChoice svelte-1w50bpj"><!> <!></div> <!>',1),Er=h("<h1>Password Reset</h1> <!>",1),Sr=h('<div class="err svelte-1w50bpj"> </div>'),Vr=h('<div class="container"><!> <!></div>'),Dr=h("<!> <!> <!>",1),Tr=h("<!> <!> <!> <!>",1);function Ur(Je,Ke){ur(Ke,!0);const je=r=>{var c=O(),p=$(c);{var I=m=>{ze(m,{action:"",onSubmit:Ge,children:(y,W)=>{var D=Cr(),G=$(D);fr(G,{get policy(){return e(n).password_policy},get password(){return e(N)},get accepted(){return e(me)},set accepted(i){s(me,l(i))}});var H=o(G,2),F=oe(()=>e(N).length>=e(n).password_policy.length_min);Te(H,{autocomplete:"new-password",get label(){return a.account.passwordNew},get placeholder(){return a.account.passwordNew},get maxLength(){return e(n).password_policy.length_max},required:!0,get showCopy(){return e(F)},width:pe,get ref(){return e(ve)},set ref(i){s(ve,l(i))},get value(){return e(N)},set value(i){s(N,l(i))},get reportValidity(){return e(we)},set reportValidity(i){s(we,l(i))}});var d=o(H,2);Te(d,{autocomplete:"new-password",get label(){return a.account.passwordConfirm},get placeholder(){return a.account.passwordConfirm},get maxLength(){return e(n).password_policy.length_max},required:!0,width:pe,get value(){return e(re)},set value(i){s(re,l(i))},get reportValidity(){return e(fe)},set reportValidity(i){s(fe,l(i))}});var _=o(d,2),E=w(_);S(E,{level:2,onclick:Qe,children:(i,T)=>{q();var x=P();b(()=>v(x,a.passwordReset.generate)),t(i,x)},$$slots:{default:!0}}),f(_);var M=o(_,2);S(M,{type:"submit",get isLoading(){return e(Z)},children:(i,T)=>{q();var x=P();b(()=>v(x,a.common.save)),t(i,x)},$$slots:{default:!0}}),t(y,D)},$$slots:{default:!0}})};g(p,m=>{e(n)&&m(I)})}t(r,c)},pe="20rem";let a=yr(),Oe=jr().get(),n=u(void 0),ue=u(void 0),ve=u(void 0),Z=u(!1),A=u(""),Q=br("type","password_reset"),V=u(""),ie=u(""),B=u(!1),me=u(!1),Y=u(void 0),ee=u(""),N=u(""),re=u(""),we=u(void 0),fe=u(void 0);ce(()=>{e(V)&&ge()}),ce(()=>{var r;(r=e(ue))==null||r.focus()}),ce(()=>{var r;(r=e(ve))==null||r.focus()}),ce(()=>{e(B)&&setTimeout(()=>{e(ie)?window.location.replace(e(ie)):xe()},5e3)});function xe(){window.location.replace("/auth/v1/account")}function Qe(){if(e(n)){let r=wr(e(n).password_policy);s(N,l(r)),s(re,l(r)),requestAnimationFrame(()=>{var c,p;(c=e(we))==null||c(),(p=e(fe))==null||p()})}}async function Be(){if(!e(n)){console.error("template data is undefined");return}if(s(A,""),e(ee).length<1){s(A,l(a.mfa.passkeyNameErr));return}let r=await xr(e(n).user_id,e(ee),a.authorize.invalidKeyUsed,a.authorize.requestExpired);r.error?s(A,`${a.mfa.errorReg} - ${r.error}`):(ge(),s(B,!0))}async function Ge(){var r;if(s(A,""),!!e(me)){if(e(N)!==e(re)){s(A,l(a.passwordReset.passwordNoMatch));return}if(e(N).length>256){s(A,"max 256");return}(r=e(n))!=null&&r.needs_mfa?s(Y,"PasswordReset"):await Le()}}async function Le(r){var I;if(!e(n))return;s(Z,!0);const c={password:e(N),magic_link_id:e(n).magic_link_id,mfa_code:r};let p=await fetch(`/auth/v1/users/${e(n).user_id}/reset`,{method:"PUT",headers:{"content-type":"application/json","pwd-csrf-token":(I=e(n))==null?void 0:I.csrf_token},body:JSON.stringify(c)});if(p.ok)ge(),s(ie,l(p.headers.get("location")||"/auth/v1/account")),s(B,!0);else{const m=await p.json();s(A,l(m.message))}s(Z,!1)}function He(r){s(A,l(r)),s(Y,void 0)}function Xe(r){s(Y,void 0),r&&"code"in r?Le(r.code):console.error("invalid webauthn response",r)}function ge(){s(A,""),s(ee,""),s(N,""),s(re,"")}var Ce=Tr();vr(r=>{var c=O(),p=$(c);{var I=y=>{var W=O(),D=$(W);{var G=F=>{b(()=>Ae.title=a.passwordReset.newAccount)},H=F=>{var d=O(),_=$(d);{var E=M=>{b(()=>Ae.title=a.passwordReset.passwordReset)};g(_,M=>{Q.get()==="password_reset"&&M(E)},!0)}t(F,d)};g(D,F=>{var d;(d=Q.get())!=null&&d.startsWith("new_user")?F(G):F(H,!1)})}t(y,W)},m=y=>{Ae.title="Password"};g(p,y=>{a?y(I):y(m,!1)})}t(r,c)});var Pe=$(Ce);Rr(Pe,{id:mr,get value(){return e(n)},set value(r){s(n,l(r))}});var qe=o(Pe,2);{var Ze=r=>{var c=Pr(),p=o(w(c),2);S(p,{level:2,onclick:()=>Q.set("new_user"),children:(m,y)=>{q();var W=P("new_user");t(m,W)},$$slots:{default:!0}});var I=o(p,2);S(I,{level:2,onclick:()=>Q.set("password_reset"),children:(m,y)=>{q();var W=P("password_reset");t(m,W)},$$slots:{default:!0}}),f(c),t(r,c)};g(qe,r=>{Oe&&r(Ze)})}var Ne=o(qe,2);_r(Ne,{children:(r,c)=>{kr(r,{children:(p,I)=>{var m=Dr(),y=$(m);{var W=d=>{hr(d,{get userId(){return e(n).user_id},get purpose(){return e(Y)},onSuccess:Xe,onError:He})};g(y,d=>{e(Y)&&e(n)&&d(W)})}var D=o(y,2);{var G=d=>{var _=qr(),E=w(_),M=o(E,2),i=o(M,4),T=o(i),x=oe(()=>e(ie)||"/auth/v1/account");Ue(T,{get href(){return e(x)},children:(he,Ie)=>{q();var $e=P("Account");t(he,$e)},$$slots:{default:!0}}),f(_),b(()=>{v(E,`${a.passwordReset.success1??""} `),v(M,` ${a.passwordReset.success2??""} `),v(i,` ${a.passwordReset.success3??""} `)}),t(d,_)},H=d=>{var _=O(),E=$(_);{var M=i=>{var T=Vr(),x=w(T);{var he=L=>{var k=Mr(),U=$(k),ye=w(U,!0);f(U);var z=o(U,2),J=w(z,!0);f(z);var se=o(z,2),We=w(se),rr=o(We);Ue(rr,{get href(){return a.passwordReset.fidoLink},target:"_blank",children:(R,C)=>{q();var j=P("FIDO Alliance");t(R,j)},$$slots:{default:!0}}),f(se);var _e=o(se,2),Fe=w(_e),sr=oe(()=>e(V)?3:1);S(Fe,{get level(){return e(sr)},onclick:()=>s(V,"passkey"),get isLoading(){return e(Z)},children:(R,C)=>{q();var j=P();b(()=>v(j,a.passwordReset.passwordless)),t(R,j)},$$slots:{default:!0}});var tr=o(Fe,2),ar=oe(()=>e(V)?3:2);S(tr,{get level(){return e(ar)},onclick:()=>s(V,"password"),get isLoading(){return e(Z)},children:(R,C)=>{q();var j=P();b(()=>v(j,a.passwordReset.password)),t(R,j)},$$slots:{default:!0}}),f(_e);var or=o(_e,2);{var ir=R=>{var C=Nr(),j=w(C);je(j),f(C),Ve(3,C,()=>De),t(R,C)},nr=R=>{var C=O(),j=$(C);{var dr=ke=>{var ne=Fr(),Me=w(ne);ze(Me,{action:"",onSubmit:Be,children:(te,de)=>{var X=Ir(),le=$(X);gr(le,{autocomplete:"off",get label(){return a.mfa.passkeyName},get placeholder(){return a.mfa.passkeyName},width:pe,maxLength:32,pattern:Lr,required:!0,get ref(){return e(ue)},set ref(K){s(ue,l(K))},get value(){return e(ee)},set value(K){s(ee,l(K))}});var ae=o(le,2),Re=oe(()=>e(B)?2:1);S(ae,{type:"submit",get level(){return e(Re)},children:(K,Ee)=>{q();var be=P();b(()=>v(be,a.mfa.register)),t(K,be)},$$slots:{default:!0}}),t(te,X)},$$slots:{default:!0}});var lr=o(Me,2);{var cr=te=>{var de=Wr(),X=w(de),le=w(X,!0);f(X);var ae=o(X,2),Re=w(ae,!0);f(ae);var K=o(ae,2);S(K,{onclick:xe,children:(Ee,be)=>{q();var Se=P();b(()=>v(Se,a.passwordReset.accountLogin)),t(Ee,Se)},$$slots:{default:!0}}),f(de),b(()=>{v(le,a.passwordReset.successPasskey1),v(Re,a.passwordReset.successPasskey2)}),t(te,de)};g(lr,te=>{e(B)&&te(cr)})}f(ne),Ve(3,ne,()=>De),t(ke,ne)};g(j,ke=>{e(V)==="passkey"&&ke(dr)},!0)}t(R,C)};g(or,R=>{e(V)==="password"?R(ir):R(nr,!1)})}b(()=>{v(ye,a.passwordReset.newAccount),v(J,a.passwordReset.newAccDesc1),v(We,`${a.passwordReset.newAccDesc2??""} `)}),t(L,k)},Ie=L=>{var k=O(),U=$(k);{var ye=z=>{var J=Er(),se=o($(J),2);je(se),t(z,J)};g(U,z=>{var J;(J=Q.get())!=null&&J.startsWith("password_reset")&&z(ye)},!0)}t(L,k)};g(x,L=>{var k;(k=Q.get())!=null&&k.startsWith("new_user")?L(he):L(Ie,!1)})}var $e=o(x,2);{var er=L=>{var k=Sr(),U=w(k,!0);f(k),b(()=>v(U,e(A))),t(L,k)};g($e,L=>{e(A)&&L(er)})}f(T),t(i,T)};g(E,i=>{e(n)&&i(M)},!0)}t(d,_)};g(D,d=>{e(B)?d(G):d(H,!1)})}var F=o(D,2);Ar(F,{absolute:!0}),t(p,m)},$$slots:{default:!0}})},$$slots:{default:!0}});var Ye=o(Ne,2);$r(Ye,{absolute:!0}),t(Je,Ce),pr()}export{Ur as component};
