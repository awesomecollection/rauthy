import"../chunks/disclose-version.BDr9Qe-U.js";import{f as J,p as Pe,c as t,r,s as v,l as e,t as x,a as Ce,ab as we,ar as ge,o as D,m as n,ap as Xe,a6 as qe,aq as Xa}from"../chunks/index-client.Ds4XgiuL.js";import{h as Oa}from"../chunks/svelte-head.DUes13UE.js";import{e as de,a as i,t as z,d as be}from"../chunks/template.DXIK6jcH.js";import{i as y}from"../chunks/if.Du7BDhAX.js";import{p as w}from"../chunks/proxy.CB6KOiNf.js";import{s as c,d as Za}from"../chunks/render.Bq2-eTRf.js";import{b as ja}from"../chunks/window.De7Y7RqT.js";import{p as Ie}from"../chunks/props.CvXd4vKV.js";import{l as Oe,V as ta,_ as Ka,P as Ga,O as er,B as ar,W as rr,J as tr,r as sr}from"../chunks/helpers.BTvs6bnN.js";import{e as ha}from"../chunks/each.MnMr4iw5.js";import{h as ga}from"../chunks/html.CbFxqVHf.js";import{a as Q,c as Y,s as Ze,t as fa,r as vr}from"../chunks/class.Ik0ma2JO.js";import{I as je}from"../chunks/IconCheck.CzEyprnz.js";import{I as nr}from"../chunks/IconStop.k1DB1JtH.js";import{B as _e}from"../chunks/Button.nDjAKZm4.js";import{M as or}from"../chunks/Modal.ZY0xB7ph.js";import{u as De}from"../chunks/i18n.svelte.CgUwCKxn.js";import{c as wa,b as ba,d as ya,f as Be}from"../chunks/fetch.DFmyLr06.js";import{B as ir}from"../chunks/ButtonAuthProvider.DHR3CKHc.js";import{t as We,f as Ae,a as ka,s as lr}from"../chunks/index.L0FyJ7Re.js";import{I as ze}from"../chunks/pow.C3ENfqN0.js";import{F as cr}from"../chunks/Form.JHjwURkX.js";import{a as sa,j as ur,k as _a,l as dr}from"../chunks/patterns.D9HtGhEC.js";import{I as mr}from"../chunks/InputDateTimeCombo.COgp9L7N.js";import{u as va}from"../chunks/session.svelte.DX_QqHl_.js";import{w as pr}from"../chunks/registration.Dkz6Q4nk.js";import{W as $a}from"../chunks/WebauthnRequest.B53aO4he.js";import{U as hr,D as xa}from"../chunks/Devices.BQokucmn.js";import{P as gr}from"../chunks/PasswordPolicy.Di91TNZP.js";import{I as na}from"../chunks/InputPassword.DstTXUmk.js";import{d as fr,e as wr}from"../chunks/dataFetching.CfdKJRPX.js";import{C as br}from"../chunks/CheckIcon.D9rG40ob.js";import{s as yr}from"../chunks/snippet.CcKvRcoi.js";import{a as kr}from"../chunks/input.CyORuAkT.js";import{A as _r}from"../chunks/A.CVr_yK1P.js";import{I as $r}from"../chunks/InputArea.b1xJeKQY.js";import{T as xr}from"../chunks/Template.CSY6eNF5.js";import{u as Ir}from"../chunks/param.svelte.D0F_0zrI.js";import{T as Ia}from"../chunks/Tabs.Cqg7xZCh.js";import{M as Nr}from"../chunks/Main.DW0MpFpK.js";import{C as Pr}from"../chunks/ContentCenter.CKh5VTcB.js";import{T as Cr}from"../chunks/ThemeSwitch.DknOd3dX.js";import{L as zr}from"../chunks/LangSelector.BAs7X9bt.js";function oa(ne,m){var s=de(),a=J(s);{var L=k=>{je(k,{color:"hsl(var(--action))"})},o=k=>{nr(k,{color:"hsl(var(--error))"})};y(a,k=>{m.checked?k(L):k(o,!1)})}i(ne,s)}var Lr=z('<div class="link-err value svelte-1tea8v4"> </div>'),Dr=z('<div class="fed-btn svelte-1tea8v4"><!> <!></div>'),Mr=z('<h3> </h3> <p> </p> <div class="providers svelte-1tea8v4"></div>',1),Er=z("<!> <!>",1),Wr=z('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Tr=z('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Ar=z('<div><div>WebID:</div> <span class="value svelte-1tea8v4"><a target="_blank"><!></a></span></div>'),Ur=z('<div><div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <div><div class="value svelte-1tea8v4"> </div> <!></div></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <!> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <!> <!></div>');function Na(ne,m){Pe(m,!0);let s=Ie(m,"user",15),a=De(),L=D(!1),o=D(!1),k=we(()=>{var B;return(B=s().account_type)==null?void 0:B.startsWith("federated")}),g=we(()=>{var B;return e(k)?`${s().account_type}: ${((B=m.authProvider)==null?void 0:B.name)||""}`:s().account_type}),u=we(()=>m.viewModePhone?"rowPhone":"row"),b=we(()=>m.viewModePhone?"labelPhone":"label");function d(B){Ka(64,(ae,{challenge:ce,verifier:he})=>{ae||(localStorage.setItem(Ga,he),X(B,ce))})}async function X(B,ae){let ce={email:s().email,client_id:"rauthy",redirect_uri:window.location.href,provider_id:B,pkce_challenge:ae},he=await ba(`/auth/v1/providers/${B}/link`,ce);if(he.text){er(he.text);let pe=he.headers.get("location");pe&&(window.location.href=pe)}else console.error(he.error)}async function H(){let B=await wa("/auth/v1/providers/link");B.body?s(B.body):(console.error(B.error),n(L,!0))}var M=Ur(),R=t(M),K=t(R),ie=t(K,!0);r(K);var I=v(K,2),N=t(I,!0);r(I),r(R);var V=v(R,2),O=t(V),oe=t(O,!0);r(O);var re=v(O,2),te=t(re,!0);r(re),r(V);var Z=v(V,2),f=t(Z),p=t(f,!0);r(f);var _=v(f,2),l=t(_,!0);r(_),r(Z);var F=v(Z,2),se=t(F),me=t(se);r(se);var h=v(se,2),W=t(h,!0);r(h),r(F);var T=v(F,2),E=t(T),q=t(E,!0);r(E);var j=v(E,2),S=t(j),ue=t(S,!0);r(S);var ve=v(S,2);{var ye=B=>{var ae=Dr(),ce=t(ae);_e(ce,{get ariaLabel(){return a.account.providerUnlink},level:3,onclick:H,children:(ke,Ee)=>{ge();var Te=be();x(()=>c(Te,a.account.providerUnlink)),i(ke,Te)},$$slots:{default:!0}});var he=v(ce,2);{var pe=ke=>{var Ee=Lr(),Te=t(Ee,!0);r(Ee),x(()=>c(Te,a.account.providerUnlinkDesc)),i(ke,Ee)};y(he,ke=>{e(L)&&ke(pe)})}r(ae),i(B,ae)},U=B=>{var ae=de(),ce=J(ae);{var he=pe=>{var ke=Er(),Ee=J(ke);_e(Ee,{level:2,onclick:()=>n(o,!0),children:(Ue,Ja)=>{ge();var Ve=be();x(()=>c(Ve,a.account.providerLink)),i(Ue,Ve)},$$slots:{default:!0}});var Te=v(Ee,2);or(Te,{get showModal(){return e(o)},set showModal(Ue){n(o,w(Ue))},children:(Ue,Ja)=>{var Ve=Mr(),ea=J(Ve),Qa=t(ea,!0);r(ea);var aa=v(ea,2),Ya=t(aa,!0);r(aa);var ma=v(aa,2);ha(ma,21,()=>m.providers,ra=>ra.id,(ra,pa)=>{var Ra=we(()=>`${a.account.providerLink}: ${e(pa).name}`);ir(ra,{get ariaLabel(){return e(Ra)},get provider(){return e(pa)},onclick:d})}),r(ma),x(()=>{c(Qa,a.account.providerLink),c(Ya,a.account.providerLinkDesc)}),i(Ue,Ve)},$$slots:{default:!0}}),i(pe,ke)};y(ce,pe=>{m.providers.length>0&&pe(he)},!0)}i(B,ae)};y(ve,B=>{e(k)?B(ye):B(U,!1)})}r(j),r(T);var P=v(T,2),$=t(P),A=t($,!0);r($);var G=v($,2),fe=t(G,!0);r(G),r(P);var C=v(P,2),ee=t(C),le=t(ee,!0);r(ee);var $e=v(ee,2),xe=t($e,!0);r($e),r(C);var Ne=v(C,2),Le=t(Ne),Ke=t(Le,!0);r(Le);var Ge=v(Le,2),ia=we(()=>!!s().webauthn_user_id);oa(Ge,{get checked(){return e(ia)}}),r(Ne);var Me=v(Ne,2),Fe=t(Me),Ma=t(Fe,!0);r(Fe);var Ea=v(Fe,2);oa(Ea,{get checked(){return s().enabled}}),r(Me);var Se=v(Me,2),He=t(Se),Wa=t(He,!0);r(He);var Ta=v(He,2);oa(Ta,{get checked(){return s().email_verified}}),r(Se);var la=v(Se,2);{var Aa=B=>{var ae=Wr(),ce=t(ae),he=t(ce,!0);r(ce);var pe=v(ce,2),ke=t(pe,!0);x(()=>c(ke,Oe(s().last_login))),r(pe),r(ae),x(()=>{Q(ae,Y(e(u)),"svelte-1tea8v4"),Q(ce,Y(e(b)),"svelte-1tea8v4"),c(he,a.account.lastLogin)}),i(B,ae)};y(la,B=>{s().last_login&&B(Aa)})}var Je=v(la,2),Qe=t(Je),Ua=t(Qe,!0);r(Qe);var ca=v(Qe,2),Va=t(ca,!0);x(()=>c(Va,s().password_expires&&Oe(s().password_expires)||a.common.never)),r(ca),r(Je);var Ye=v(Je,2),Re=t(Ye),qa=t(Re,!0);r(Re);var ua=v(Re,2),Ba=t(ua,!0);x(()=>c(Ba,Oe(s().created_at))),r(ua),r(Ye);var da=v(Ye,2);{var Fa=B=>{var ae=Tr(),ce=t(ae),he=t(ce,!0);r(ce);var pe=v(ce,2),ke=t(pe,!0);x(()=>c(ke,Oe(s().user_expires))),r(pe),r(ae),x(()=>{Q(ae,Y(e(u)),"svelte-1tea8v4"),Q(ce,Y(e(b)),"svelte-1tea8v4"),c(he,a.account.userExpiry)}),i(B,ae)};y(da,B=>{s().user_expires&&B(Fa)})}var Sa=v(da,2);{var Ha=B=>{var ae=Ar(),ce=t(ae),he=v(ce,2),pe=t(he);x(()=>Ze(pe,"href",ta(s().id)));var ke=t(pe);ga(ke,()=>ta(s().id).replace("/auth/","/auth/<wbr/>")),r(pe),r(he),r(ae),x(()=>{Q(ae,Y(e(u)),"svelte-1tea8v4"),Q(ce,Y(e(b)),"svelte-1tea8v4")}),i(B,ae)};y(Sa,B=>{m.webIdData&&B(Ha)})}r(M),x(()=>{Q(R,Y(e(u)),"svelte-1tea8v4"),Q(K,Y(e(b)),"svelte-1tea8v4"),c(ie,a.common.email),c(N,s().email),Q(V,Y(e(u)),"svelte-1tea8v4"),Q(O,Y(e(b)),"svelte-1tea8v4"),c(oe,a.account.givenName),c(te,s().given_name),Q(Z,Y(e(u)),"svelte-1tea8v4"),Q(f,Y(e(b)),"svelte-1tea8v4"),c(p,a.account.familyName),c(l,s().family_name),Q(F,Y(e(u)),"svelte-1tea8v4"),Q(se,Y(e(b)),"svelte-1tea8v4"),c(me,`${a.account.user??""} ID`),c(W,s().id),Q(T,Y(e(u)),"svelte-1tea8v4"),Q(E,Y(e(b)),"svelte-1tea8v4"),c(q,a.account.accType),c(ue,e(g)||""),Q(P,Y(e(u)),"svelte-1tea8v4"),Q($,Y(e(b)),"svelte-1tea8v4"),c(A,a.account.roles),c(fe,s().roles||"None"),Q(C,Y(e(u)),"svelte-1tea8v4"),Q(ee,Y(e(b)),"svelte-1tea8v4"),c(le,a.account.groups),c(xe,s().groups||"None"),Q(Ne,Y(e(u)),"svelte-1tea8v4"),Q(Le,Y(e(b)),"svelte-1tea8v4"),c(Ke,a.account.mfaActivated),Q(Me,Y(e(u)),"svelte-1tea8v4"),Q(Fe,Y(e(b)),"svelte-1tea8v4"),c(Ma,a.account.userEnabled),Q(Se,Y(e(u)),"svelte-1tea8v4"),Q(He,Y(e(b)),"svelte-1tea8v4"),c(Wa,a.account.emailVerified),Q(Je,Y(e(u)),"svelte-1tea8v4"),Q(Qe,Y(e(b)),"svelte-1tea8v4"),c(Ua,a.account.passwordExpiry),Q(Ye,Y(e(u)),"svelte-1tea8v4"),Q(Re,Y(e(b)),"svelte-1tea8v4"),c(qa,a.account.userCreated)}),i(ne,M),Ce()}var Vr=z('<div class="success svelte-4ogr3z"><!></div>'),qr=z("<p> </p>"),Br=z('<div class="err svelte-4ogr3z"> </div>'),Fr=z('<div class="formInner svelte-4ogr3z"><div><!> <!> <!> <!></div> <div><!> <!> <!> <!> <!></div></div> <div class="bottom svelte-4ogr3z"><div><!></div> <!></div> <!>',1),Sr=z('<div class="container svelte-4ogr3z"><!></div>');function Pa(ne,m){var X;Pe(m,!0);let s=Ie(m,"user",15);(X=s().user_values)!=null&&X.birthdate||s(s().user_values.birthdate="",!0);let a=De(),L=D(""),o=D(!1),k=D(!1);async function g(H,M){var p;const R=M.get("email"),K=M.get("family_name")||void 0,ie=M.get("given_name")||void 0,I=M.get("birthdate")||void 0,N=((p=M.get("phone"))==null?void 0:p.replaceAll(" ",""))||void 0,V=M.get("street")||void 0,O=M.get("zip")||void 0,oe=O?Number.parseInt(O):void 0,re=M.get("city")||void 0,te=M.get("country")||void 0;let Z={email:R,family_name:K,given_name:ie};(I||N||V||oe||re||te)&&(Z.user_values={birthdate:I,phone:N,street:V,zip:oe,city:re,country:te});let f=await ya(`/auth/v1/users/${s().id}/self`,Z);if(f.body){n(o,!0),s(f.body);let _=3e3;f.status===202&&(n(k,!0),_=3e4),setTimeout(()=>{n(o,!1)},_)}else f.error&&(console.error(f.error),n(L,w(f.error.message)))}var u=Sr(),b=t(u),d=we(()=>`/auth/v1/users/${s().id}/self`);cr(b,{get action(){return e(d)},onSubmit:g,children:(H,M)=>{var R=Fr(),K=J(R),ie=t(K),I=t(ie);ze(I,{typ:"email",name:"email",get label(){return a.common.email},get placeholder(){return a.common.email},get value(){return s().email},required:!0});var N=v(I,2);ze(N,{name:"given_name",autocomplete:"given-name",get label(){return a.account.givenName},get placeholder(){return a.account.givenName},get value(){return s().given_name},required:!0,maxLength:32,pattern:sa});var V=v(N,2);ze(V,{name:"family_name",autocomplete:"family-name",get label(){return a.account.familyName},get placeholder(){return a.account.familyName},get value(){return s().family_name},maxLength:32,pattern:sa});var O=v(V,2);mr(O,{name:"birthdate",get label(){return a.account.birthdate},withDelete:!0,get value(){return s().user_values.birthdate},set value(E){s(s().user_values.birthdate=E,!0)}}),r(ie);var oe=v(ie,2),re=t(oe);ze(re,{name:"street",autocomplete:"street-address",get label(){return a.account.street},get placeholder(){return a.account.street},get value(){return s().user_values.street},maxLength:48,pattern:ur});var te=v(re,2);ze(te,{typ:"number",name:"zip",autocomplete:"postal-code",get label(){return a.account.zip},get placeholder(){return a.account.zip},get value(){return s().user_values.zip},min:"1000",max:"9999999"});var Z=v(te,2);ze(Z,{name:"city",autocomplete:"address-level2",get label(){return a.account.city},get placeholder(){return a.account.city},get value(){return s().user_values.city},maxLength:48,pattern:_a});var f=v(Z,2);ze(f,{name:"country",autocomplete:"country",get label(){return a.account.country},get placeholder(){return a.account.country},get value(){return s().user_values.country},maxLength:48,pattern:_a});var p=v(f,2);ze(p,{name:"phone",autocomplete:"tel",get label(){return a.account.phone},get placeholder(){return a.account.phone},get value(){return s().user_values.phone},maxLength:32,pattern:dr}),r(oe),r(K);var _=v(K,2),l=t(_),F=t(l);_e(F,{type:"submit",children:(E,q)=>{ge();var j=be();x(()=>c(j,a.common.save)),i(E,j)},$$slots:{default:!0}}),r(l);var se=v(l,2);{var me=E=>{var q=Vr(),j=t(q);je(j,{}),r(q),We(3,q,()=>Ae),i(E,q)};y(se,E=>{e(o)&&E(me)})}r(_);var h=v(_,2);{var W=E=>{var q=qr(),j=t(q,!0);r(q),x(()=>c(j,a.account.emailUpdateConfirm)),i(E,q)},T=E=>{var q=de(),j=J(q);{var S=ue=>{var ve=Br(),ye=t(ve,!0);r(ve),x(()=>c(ye,e(L))),We(3,ve,()=>Ae),i(ue,ve)};y(j,ue=>{e(L)&&ue(S)},!0)}i(E,q)};y(h,E=>{e(k)?E(W):E(T,!1)})}i(H,R)},$$slots:{default:!0}}),r(u),i(ne,u),Ce()}var Hr=z('<div class="err svelte-16mlupu"><b>Your browser does not support Webauthn credentials and must be updated.</b></div>'),Jr=z('<!> <div class="regBtns svelte-16mlupu"><!> <!></div>',1),Qr=z('<div class="regNewBtn svelte-16mlupu"><!></div>'),Yr=z('<div class="keysHeader svelte-16mlupu"> </div>'),Rr=z('<div class="button svelte-16mlupu"><!></div>'),Xr=z('<!> <p class="svelte-16mlupu"> <br><br> </p> <!> <!> <div class="keysContainer svelte-16mlupu"></div> <!> <div class="svelte-16mlupu"> </div>',1),Or=z('<div class="container svelte-16mlupu"><!></div>');function Ca(ne,m){Pe(m,!0);const s="credentials"in navigator;let a=De(),L=va("account"),o=we(()=>{var f;return(f=L.get())==null?void 0:f.user_id}),k=D(void 0),g=D(!1),u=D(""),b=D(!1),d=D(m.user.account_type==="password"),X=D(void 0),H=D(""),M=D(!1),R=D(w([]));Xe(()=>{ie()}),qe(()=>{e(R).length>0&&m.user.account_type==="passkey"&&n(d,e(R).length>1)}),qe(()=>{var f;(f=e(k))==null||f.focus()});function K(){n(g,!1),n(u,"")}async function ie(){var p;let f=await Be(`/auth/v1/users/${(p=L.get())==null?void 0:p.user_id}/webauthn`);f.body?n(R,w(f.body)):console.error(f.error)}async function I(){if(K(),e(M)||!e(o))return;if(e(H).length<1){n(g,!0),n(u,w(a.mfa.passkeyNameErr));return}let f=await pr(e(o),e(H),a.authorize.invalidKeyUsed,a.authorize.requestExpired);f.error?(n(g,!0),n(u,`${a.mfa.errorReg} - ${f.error}`)):(n(b,!1),n(H,""),await ie())}async function N(f){var _;let p=await wa(`/auth/v1/users/${m.user.id}/webauthn/delete/${f}`);p.status===200?await ie():n(u,w(((_=p.error)==null?void 0:_.message)||"Error"))}function V(f){n(X,void 0),n(g,!0),n(u,w(f)),setTimeout(()=>{n(g,!1),n(u,"")},5e3)}function O(f){n(X,void 0),n(u,w(a.mfa.testSuccess)),setTimeout(()=>{n(u,"")},3e3)}var oe=Or(),re=t(oe);{var te=f=>{var p=Hr();i(f,p)},Z=f=>{var p=Xr(),_=J(p);{var l=U=>{$a(U,{get userId(){return m.user.id},get purpose(){return e(X)},onSuccess:O,onError:V})};y(_,U=>{e(X)&&U(l)})}var F=v(_,2),se=t(F),me=v(se,3);r(F);var h=v(F,2);{var W=U=>{var P=Jr(),$=J(P);ze($,{autocomplete:"off",get label(){return a.mfa.passkeyName},get placeholder(){return a.mfa.passkeyName},maxLength:32,pattern:sa,onEnter:I,get ref(){return e(k)},set ref(C){n(k,w(C))},get value(){return e(H)},set value(C){n(H,w(C))},get isError(){return e(M)},set isError(C){n(M,w(C))}});var A=v($,2),G=t(A);_e(G,{onclick:I,children:(C,ee)=>{ge();var le=be();x(()=>c(le,a.mfa.register)),i(C,le)},$$slots:{default:!0}});var fe=v(G,2);_e(fe,{level:3,onclick:()=>n(b,!1),children:(C,ee)=>{ge();var le=be();x(()=>c(le,a.common.cancel)),i(C,le)},$$slots:{default:!0}}),r(A),i(U,P)},T=U=>{var P=Qr(),$=t(P),A=we(()=>e(R).length===0?1:2);_e($,{get level(){return e(A)},onclick:()=>n(b,!0),children:(G,fe)=>{ge();var C=be();x(()=>c(C,a.mfa.registerNew)),i(G,C)},$$slots:{default:!0}}),r(P),i(U,P)};y(h,U=>{e(b)?U(W):U(T,!1)})}var E=v(h,2);{var q=U=>{var P=Yr(),$=t(P,!0);r(P),x(()=>c($,a.mfa.registerdKeys)),i(U,P)};y(E,U=>{e(R).length>0&&U(q)})}var j=v(E,2);ha(j,21,()=>e(R),U=>U.name,(U,P)=>{hr(U,{get passkey(){return e(P)},get showDelete(){return e(d)},onDelete:N})}),r(j);var S=v(j,2);{var ue=U=>{var P=Rr(),$=t(P);_e($,{onclick:()=>n(X,"Test"),children:(A,G)=>{ge();var fe=be();x(()=>c(fe,a.mfa.test)),i(A,fe)},$$slots:{default:!0}}),r(P),i(U,P)};y(S,U=>{e(R).length>0&&U(ue)})}var ve=v(S,2),ye=t(ve,!0);r(ve),x(()=>{c(se,`${a.mfa.p1??""} `),c(me,` ${a.mfa.p2??""}`),fa(ve,"success",!e(g)),fa(ve,"err",e(g)),c(ye,e(u))}),i(f,p)};y(re,f=>{s?f(Z,!1):f(te)})}r(oe),i(ne,oe),Ce()}var Zr=z('<div class="container svelte-ue7bk2"><!> <!> <!> <!> <div class="btn svelte-ue7bk2"><!></div> <div class="err svelte-ue7bk2"> </div></div>');function jr(ne,m){Pe(m,!0);let s=Ie(m,"passwords",15),a=Ie(m,"hideCurrentPassword",3,!1),L=Ie(m,"isValid",15),o=De();L(H);let k=D(!1),g=D(""),u=D(void 0),b=we(()=>{var I;return((I=s().new)==null?void 0:I.length)>6&&s().new===s().newConfirm}),d=D(void 0),X=D(void 0);Xe(async()=>{let I=await Be("/auth/v1/password_policy");I.body?n(u,w(I.body)):console.error(I.error)});function H(){return n(g,""),!a()&&!s().current?(n(g,w(o.account.passwordCurrReq)),!1):s().new?s().newConfirm?e(k)?s().new.length>256?(n(g,"max 256"),!1):s().new!==s().newConfirm?(n(g,w(o.account.passwordNoMatch)),!1):!0:(n(g,w(o.account.passwordPolicyFollow)),!1):(n(g,w(o.account.passwordNewReq)),!1):(n(g,w(o.account.passwordNewReq)),!1)}function M(){if(n(g,""),e(u)){let I=ar(e(u));s(s().new=I,!0),s(s().newConfirm=I,!0)}requestAnimationFrame(()=>{var I,N;(I=e(d))==null||I(),(N=e(X))==null||N()})}var R=de(),K=J(R);{var ie=I=>{var N=Zr(),V=t(N);gr(V,{get policy(){return e(u)},get password(){return s().new},get accepted(){return e(k)},set accepted(l){n(k,w(l))}});var O=v(V,2);{var oe=l=>{na(l,{autocomplete:"current-password",get label(){return o.account.passwordCurr},get placeholder(){return o.account.passwordCurr},onInput:H,get width(){return m.inputWidth},get value(){return s().current},set value(F){s(s().current=F,!0)}})};y(O,l=>{a()||l(oe)})}var re=v(O,2);na(re,{autocomplete:"new-password",get label(){return o.account.passwordNew},get placeholder(){return o.account.passwordNew},onInput:H,get showCopy(){return e(b)},get width(){return m.inputWidth},get value(){return s().new},set value(l){s(s().new=l,!0)},get reportValidity(){return e(d)},set reportValidity(l){n(d,w(l))}});var te=v(re,2);na(te,{autocomplete:"new-password",get label(){return o.account.passwordConfirm},get placeholder(){return o.account.passwordConfirm},onInput:H,get showCopy(){return e(b)},get width(){return m.inputWidth},get value(){return s().newConfirm},set value(l){s(s().newConfirm=l,!0)},get reportValidity(){return e(X)},set reportValidity(l){n(X,w(l))}});var Z=v(te,2),f=t(Z);_e(f,{onclick:M,level:2,children:(l,F)=>{ge();var se=be();x(()=>c(se,o.account.generateRandom)),i(l,se)},$$slots:{default:!0}}),r(Z);var p=v(Z,2),_=t(p,!0);r(p),r(N),x(()=>c(_,e(g))),i(I,N)};y(K,I=>{e(u)&&I(ie)})}return i(ne,R),Ce({isPwdValid:H})}var Kr=z('<div class="m-05 svelte-1h4zvzu"><p> </p> <p><b> </b></p> <div></div> <p> </p> <!></div>'),Gr=z("<p> </p> <p> </p> <p> </p> <div><!></div>",1),et=z('<div class="success svelte-1h4zvzu"><!></div>'),at=z('<div class="err"> </div>'),rt=z('<div class="cancel"><!></div>'),tt=z('<div class="convertPasskey svelte-1h4zvzu"><h3> </h3> <p> </p> <!></div>'),st=z('<div><!> <div class="save svelte-1h4zvzu"><!> <!></div></div> <!>',1),vt=z('<div class="container svelte-1h4zvzu"><!> <!> <!> <!></div>');function za(ne,m){Pe(m,!0);let s=Ie(m,"user",15),a=De(),L=we(()=>m.viewModePhone?"calc(100vw - 1.5rem)":"300px"),o=D(w(s().account_type)),k=D(w([])),g=D(void 0),u=D(!1),b=D(!1),d=D(""),X=D(!1),H=D(void 0),M=D(w({current:"",new:"",newConfirm:""})),R=we(()=>e(k).filter(h=>h.user_verified).length>0);Xe(()=>{K()});async function K(){let h=await Be(`/auth/v1/users/${s().id}/webauthn`);h.body?n(k,w(h.body)):console.error("error fetching passkeys: "+h.error)}async function ie(){let h=await ba(`/auth/v1/users/${s().id}/self/convert_passkey`);h.error?console.error("error fetching passkeys: "+h.error):window.location.reload()}async function I(){n(d,""),e(k).length>0?await N():await V()}async function N(){var h;if(!((h=e(g))!=null&&h())){n(d,w(a.common.invalidInput));return}n(H,"PasswordNew")}async function V(h){var E,q;if(!((E=e(g))!=null&&E())){n(d,w(a.common.invalidInput));return}n(b,!0);let W={password_new:e(M).new};h?W.mfa_code=h:W.password_current=e(M).current;let T=await ya(`/auth/v1/users/${s().id}/self`,W);T.body?(n(X,!0),n(M,w({current:"",new:"",newConfirm:""})),s(T.body),n(o,w(T.body.account_type)),setTimeout(()=>{n(X,!1),n(u,!1)},3e3)):n(d,w(((q=T.error)==null?void 0:q.message)||"Error")),n(b,!1)}function O(h){n(H,void 0),n(d,w(h)),setTimeout(()=>{n(d,"")},5e3)}function oe(h){n(H,void 0),h&&"code"in h&&V(h.code)}async function re(){let h=await fr({email:s().email});if(h.ok)n(X,!0);else{let W=await h.json();n(d,w(W.message))}}var te=vt(),Z=t(te);{var f=h=>{$a(h,{get userId(){return s().id},get purpose(){return e(H)},onSuccess:oe,onError:O})};y(Z,h=>{e(H)&&h(f)})}var p=v(Z,2);{var _=h=>{var W=Kr(),T=t(W),E=t(T,!0);r(T);var q=v(T,2),j=t(q),S=t(j,!0);r(j),r(q);var ue=v(q,2);ka(ue,"height",".3rem");var ve=v(ue,2),ye=t(ve,!0);r(ve);var U=v(ve,2);{var P=A=>{br(A,{check:!0})},$=A=>{_e(A,{level:2,onclick:re,children:(G,fe)=>{ge();var C=be();x(()=>c(C,a.account.passwordReset)),i(G,C)},$$slots:{default:!0}})};y(U,A=>{e(X)?A(P):A($,!1)})}r(W),x(()=>{var A;c(E,a.account.federatedConvertPassword1),c(S,((A=m.authProvider)==null?void 0:A.name)||"UNKNOWN"),c(ye,a.account.federatedConvertPassword2)}),i(h,W)};y(p,h=>{e(o)==="federated"&&h(_)})}var l=v(p,2);{var F=h=>{var W=Gr(),T=J(W),E=t(T,!0);r(T);var q=v(T,2),j=t(q,!0);r(q);var S=v(q,2),ue=t(S,!0);r(S);var ve=v(S,2),ye=t(ve);_e(ye,{level:2,onclick:()=>n(u,!0),children:(U,P)=>{ge();var $=be();x(()=>c($,a.account.convertAccount)),i(U,$)},$$slots:{default:!0}}),r(ve),x(()=>{c(E,a.account.accTypePasskeyText1),c(j,a.account.accTypePasskeyText2),c(ue,a.account.accTypePasskeyText3)}),i(h,W)};y(l,h=>{(e(o)==="passkey"||e(o)==="federated_passkey")&&!e(u)&&h(F)})}var se=v(l,2);{var me=h=>{var W=st(),T=J(W),E=t(T),q=we(()=>!(e(o)==="password"&&e(k).length<1));jr(E,{get inputWidth(){return e(L)},get hideCurrentPassword(){return e(q)},get passwords(){return e(M)},set passwords($){n(M,w($))},get isValid(){return e(g)},set isValid($){n(g,w($))}});var j=v(E,2),S=t(j);_e(S,{onclick:I,level:1,get isLoading(){return e(b)},children:($,A)=>{ge();var G=be();x(()=>c(G,a.common.save)),i($,G)},$$slots:{default:!0}});var ue=v(S,2);{var ve=$=>{var A=et(),G=t(A);je(G,{}),r(A),We(3,A,()=>Ae),i($,A)},ye=$=>{var A=de(),G=J(A);{var fe=ee=>{var le=at(),$e=t(le,!0);r(le),x(()=>c($e,e(d))),We(3,le,()=>Ae),i(ee,le)},C=ee=>{var le=de(),$e=J(le);{var xe=Ne=>{var Le=rt(),Ke=t(Le);_e(Ke,{level:3,onclick:()=>n(u,!1),children:(Ge,ia)=>{ge();var Me=be();x(()=>c(Me,a.common.cancel)),i(Ge,Me)},$$slots:{default:!0}}),r(Le),i(Ne,Le)};y($e,Ne=>{e(u)&&!e(b)&&Ne(xe)},!0)}i(ee,le)};y(G,ee=>{e(d)?ee(fe):ee(C,!1)},!0)}i($,A)};y(ue,$=>{e(X)?$(ve):$(ye,!1)})}r(j),r(T);var U=v(T,2);{var P=$=>{var A=tt(),G=t(A),fe=t(G,!0);r(G);var C=v(G,2),ee=t(C,!0);r(C);var le=v(C,2);_e(le,{level:2,onclick:ie,children:($e,xe)=>{ge();var Ne=be();x(()=>c(Ne,a.account.convertAccount)),i($e,Ne)},$$slots:{default:!0}}),r(A),x(()=>{c(fe,a.account.convertAccount),c(ee,a.account.convertAccountP1)}),i($,A)};y(U,$=>{!e(u)&&e(R)&&$(P)})}i(h,W)};y(se,h=>{(e(o)==="password"||e(o)==="federated_password"||e(u))&&h(me)})}r(te),i(ne,te),Ce()}function nt(ne,m){ne.code==="Enter"&&m()}var ot=z('<div class="flex"><div class="label font-label noselect svelte-1xf5lr3"><!></div> <label class="switch svelte-1xf5lr3"><input type="checkbox" class="svelte-1xf5lr3"> <span class="slider slider-round svelte-1xf5lr3"></span></label></div>');function La(ne,m){Pe(m,!0);let s=Ie(m,"checked",15,!1),a=Ie(m,"ariaLabel",3,""),L=Ie(m,"name",3,"");function o(){s(!s())}var k=ot(),g=t(k),u=t(g);yr(u,()=>m.children),r(g);var b=v(g,2),d=t(b);vr(d),d.__click=o,d.__keydown=[nt,o],ge(2),r(b),r(k),x(()=>{ka(g,"width",m.labelWidth),Ze(d,"name",L()),d.disabled=m.disabled,Ze(d,"aria-checked",s()),Ze(d,"aria-label",a())}),kr(d,s),i(ne,k),Ce()}Za(["click","keydown"]);var it=z("<div><p> </p> <!></div>"),lt=z('<div class="success svelte-5kivuv"><!></div>'),ct=z('<div class="err svelte-5kivuv"> </div>'),ut=z('<div class="container svelte-5kivuv"><p> </p> <p><!></p> <div class="switch svelte-5kivuv"><!></div> <div class="switch svelte-5kivuv"><!></div> <!> <div class="bottom svelte-5kivuv"><!> <!></div></div>');function Da(ne,m){Pe(m,!0);let s=Ie(m,"webIdData",15),a=De();const L="14rem";let o=D(""),k=D(!1),g=D(!!s().custom_triples),u=ta(s().user_id);qe(()=>{e(k)&&setTimeout(()=>{n(k,!1)},3e3)});async function b(){n(o,"");let p=await wr(s().user_id,s());if(p.ok)n(k,!0);else{let _=await p.json();n(o,w(_.message))}}var d=ut(),X=t(d),H=t(X,!0);r(X);var M=v(X,2),R=t(M);_r(R,{href:u,target:"_blank",children:(p,_)=>{var l=de(),F=J(l);ga(F,()=>u.replace("/auth/","/auth/<wbr/>")),i(p,l)},$$slots:{default:!0}}),r(M);var K=v(M,2),ie=t(K);La(ie,{ariaLabel:"E-Mail",labelWidth:L,get checked(){return s().expose_email},set checked(p){s(s().expose_email=p,!0)},children:(p,_)=>{ge();var l=be("E-Mail");i(p,l)},$$slots:{default:!0}}),r(K);var I=v(K,2),N=t(I);La(N,{get ariaLabel(){return a.account.webIdExpertMode},labelWidth:L,get checked(){return e(g)},set checked(p){n(g,w(p))},children:(p,_)=>{ge();var l=be();x(()=>c(l,a.account.webIdExpertMode)),i(p,l)},$$slots:{default:!0}}),r(I);var V=v(I,2);{var O=p=>{var _=it(),l=t(_),F=t(l,!0);r(l);var se=v(l,2);$r(se,{placeholder:"FOAF",rows:15,get value(){return s().custom_triples},set value(me){s(s().custom_triples=me,!0)}}),r(_),x(()=>c(F,a.account.webIdDescData)),We(3,_,()=>lr),i(p,_)};y(V,p=>{e(g)&&p(O)})}var oe=v(V,2),re=t(oe);_e(re,{onclick:b,children:(p,_)=>{ge();var l=be();x(()=>c(l,a.common.save)),i(p,l)},$$slots:{default:!0}});var te=v(re,2);{var Z=p=>{var _=lt(),l=t(_);je(l,{}),r(_),We(3,_,()=>Ae),i(p,_)},f=p=>{var _=de(),l=J(_);{var F=se=>{var me=ct(),h=t(me,!0);r(me),x(()=>c(h,e(o))),We(3,me,()=>Ae),i(se,me)};y(l,se=>{e(o)&&se(F)},!0)}i(p,_)};y(te,p=>{e(k)?p(Z):p(f,!1)})}r(oe),r(d),x(()=>c(H,a.account.webIdDesc)),i(ne,d),Ce()}function dt(ne,m){Pe(m,!0);let s=va("account"),a=we(()=>{var g;return(g=s.get())==null?void 0:g.user_id});var L=de(),o=J(L);{var k=g=>{xa(g,{viewMode:"account",get userId(){return e(a)}})};y(o,g=>{e(a)&&g(k)})}i(ne,L),Ce()}var mt=z("<h3> </h3>"),pt=z('<div class="headerPhone svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="innerPhone svelte-k6hxbm"><!></div></div>',1),ht=z('<div class="header svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="inner svelte-k6hxbm"><!></div></div>',1),gt=z('<!> <div class="wrapper svelte-k6hxbm"><!></div>',1);function ft(ne,m){Pe(m,!0);const s=N=>{var V=mt(),O=t(V,!0);r(V),x(()=>c(O,`${a().given_name} ${a().family_name||""}`)),i(N,V)};let a=Ie(m,"user",15),L=Ie(m,"webIdData",15),o=De(),k=D(void 0),g=D(w([])),u=we(()=>{var N;if((N=a().account_type)!=null&&N.startsWith("federated"))return e(g).filter(V=>V.id===a().auth_provider_id)[0]}),b=we(()=>e(k)&&e(k)<500),d=D(w(o.account.navInfo)),X=w(L()?[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,"WebID",o.account.devices,o.account.navLogout]:[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,o.account.devices,o.account.navLogout]);Xe(()=>{Ir("v").get()==="devices"&&n(d,w(o.account.devices))}),qe(()=>{e(d)===o.account.navLogout&&rr()});var H=gt(),M=J(H);xr(M,{id:tr,get value(){return e(g)},set value(N){n(g,w(N))}});var R=v(M,2),K=t(R);{var ie=N=>{var V=pt(),O=J(V),oe=t(O);s(oe),r(O);var re=v(O,2),te=t(re);Ia(te,{get tabs(){return X},get selected(){return e(d)},set selected(l){n(d,w(l))}});var Z=v(te,2),f=t(Z);{var p=l=>{Na(l,{get providers(){return e(g)},get authProvider(){return e(u)},viewModePhone:!0,get webIdData(){return L()},get user(){return a()},set user(F){a(F)}})},_=l=>{var F=de(),se=J(F);{var me=W=>{Pa(W,{viewModePhone:!0,get user(){return a()},set user(T){a(T)}})},h=W=>{var T=de(),E=J(T);{var q=S=>{za(S,{get user(){return a()},get authProvider(){return e(u)},viewModePhone:!0})},j=S=>{var ue=de(),ve=J(ue);{var ye=P=>{Ca(P,{get user(){return a()}})},U=P=>{var $=de(),A=J($);{var G=C=>{Da(C,{get webIdData(){return L()},set webIdData(ee){L(ee)}})},fe=C=>{var ee=de(),le=J(ee);{var $e=xe=>{xa(xe,{viewMode:"account"})};y(le,xe=>{e(d)===o.account.devices&&xe($e)},!0)}i(C,ee)};y(A,C=>{e(d)==="WebID"?C(G):C(fe,!1)},!0)}i(P,$)};y(ve,P=>{e(d)===o.account.navMfa?P(ye):P(U,!1)},!0)}i(S,ue)};y(E,S=>{e(d)===o.common.password?S(q):S(j,!1)},!0)}i(W,T)};y(se,W=>{e(d)===o.account.navEdit?W(me):W(h,!1)},!0)}i(l,F)};y(f,l=>{e(d)===o.account.navInfo?l(p):l(_,!1)})}r(Z),r(re),i(N,V)},I=N=>{var V=ht(),O=J(V),oe=t(O);s(oe),r(O);var re=v(O,2),te=t(re);Ia(te,{get tabs(){return X},center:!0,get selected(){return e(d)},set selected(l){n(d,w(l))}});var Z=v(te,2),f=t(Z);{var p=l=>{Na(l,{get webIdData(){return L()},get providers(){return e(g)},get authProvider(){return e(u)},get user(){return a()},set user(F){a(F)}})},_=l=>{var F=de(),se=J(F);{var me=W=>{Pa(W,{get user(){return a()},set user(T){a(T)}})},h=W=>{var T=de(),E=J(T);{var q=S=>{za(S,{get user(){return a()},get authProvider(){return e(u)}})},j=S=>{var ue=de(),ve=J(ue);{var ye=P=>{Ca(P,{get user(){return a()}})},U=P=>{var $=de(),A=J($);{var G=C=>{Da(C,{get webIdData(){return L()},set webIdData(ee){L(ee)}})},fe=C=>{var ee=de(),le=J(ee);{var $e=xe=>{dt(xe,{})};y(le,xe=>{e(d)===o.account.devices&&xe($e)},!0)}i(C,ee)};y(A,C=>{e(d)==="WebID"?C(G):C(fe,!1)},!0)}i(P,$)};y(ve,P=>{e(d)===o.account.navMfa?P(ye):P(U,!1)},!0)}i(S,ue)};y(E,S=>{e(d)===o.common.password?S(q):S(j,!1)},!0)}i(W,T)};y(se,W=>{e(d)===o.account.navEdit?W(me):W(h,!1)},!0)}i(l,F)};y(f,l=>{e(d)===o.account.navInfo?l(p):l(_,!1)})}r(Z),r(re),i(N,V)};y(K,N=>{e(b)?N(ie):N(I,!1)})}r(R),ja("innerWidth",N=>n(k,w(N))),i(ne,H),Ce()}var wt=z("<!> <!> <!>",1);function bt(ne,m){Pe(m,!0);let s=De(),a=va("account"),L=D(void 0),o=D(void 0),k=D(!1);qe(()=>{let u=a.get();u&&g(u)});async function g(u){const b=u.user_id;if(b){let d=await Promise.all([Be(`/auth/v1/users/${b}`),Be(`/auth/v1/users/${b}/webid/data`)]);d[0].body?n(L,w(d[0].body)):sr("account"),d[1].body?n(o,w(d[1].body)):d[1].status===404&&n(o,w({user_id:b,expose_email:!1})),n(k,!0)}else console.error("no user_id in session")}Oa(u=>{x(()=>{var b;return Xa.title=`${((s==null?void 0:s.account.account)||"Account")??""} ${((b=e(L))==null?void 0:b.email)??""}`})}),Nr(ne,{children:(u,b)=>{Pr(u,{children:(d,X)=>{var H=wt(),M=J(H);{var R=I=>{ft(I,{get user(){return e(L)},set user(N){n(L,w(N))},get webIdData(){return e(o)},set webIdData(N){n(o,w(N))}})};y(M,I=>{e(k)&&a&&e(L)&&I(R)})}var K=v(M,2);Cr(K,{absolute:!0});var ie=v(K,2);zr(ie,{absolute:!0}),i(d,H)},$$slots:{default:!0}})},$$slots:{default:!0}}),Ce()}export{bt as component};
