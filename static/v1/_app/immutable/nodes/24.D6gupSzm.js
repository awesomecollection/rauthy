import{a as l,n as sa,b as g,t as re,c as Be}from"../chunks/disclose-version.DZhRUPAc.js";import"../chunks/legacy.BuHyzquP.js";import{a2 as w,p as ia,o as oa,a8 as se,a9 as la,a as na,j as a,g as e,aa as T,$ as ca,a0 as ie,a1 as j,ab as o,a3 as p,a5 as u,a4 as oe,a6 as da,ac as Ce}from"../chunks/index-client.CGppiJvc.js";import{h as va,s as z,e as Ie}from"../chunks/render.D4MwAWTL.js";import{i as _}from"../chunks/if.DUA6Hpfn.js";import{e as ma}from"../chunks/OptionSelect.BCgZksOM.js";import{s as I,t as ua,a as fa}from"../chunks/Loading.FF_EHyHU.js";import{i as ha}from"../chunks/lifecycle.CRex4y9i.js";import{e as pa,g as ga,m as Le,I as wa,J as $a,_ as ja,P as _a,K as ya,M as ba,N as ka,O as xa}from"../chunks/dataFetching.Dto1xJW6.js";import{I as Ma,c as Na,a as Ta,y as za}from"../chunks/Input.Bj_i2TLU.js";import{B as ce}from"../chunks/Button.BH2_dPry.js";import{W as Ea}from"../chunks/WebauthnRequest.CHVZELhw.js";import{P as Ra}from"../chunks/PasswordInput.6uXzPAl-.js";import{L as qa}from"../chunks/LangSelector.mSh8cV6Q.js";import{p as _e}from"../chunks/props.Df_pGDSd.js";import{M as Ba,C as Ca}from"../chunks/ContentCenter.CsjyBf2d.js";import{u as Ia}from"../chunks/i18n.svelte.BTGsPiz_.js";var La=sa('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>');function Ua(de,W){let d=_e(W,"color",3,"var(--col-text)"),b=_e(W,"opacity",3,.9),D=_e(W,"width",3,24);var y=La();I(y,"stroke-width",2),w(()=>{I(y,"width",D()),I(y,"color",d()),I(y,"opacity",b())}),l(de,y)}var Aa=g('<img alt="No Logo Available">'),Fa=g('<a class="home svelte-1ljcjf3"><!></a>'),Oa=g('<div role="button" tabindex="0" class="forgotten svelte-1ljcjf3"> </div>'),Sa=g("<!> <!>",1),Pa=g('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),Ha=g('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),Ja=g("<!> <!> <!>",1),Wa=g('<div class="flex-inline svelte-1ljcjf3"><img alt="" width="20" height="20"> <span class="providerName svelte-1ljcjf3"> </span></div>'),Da=g('<div class="providers flex-col svelte-1ljcjf3"></div>'),Ka=g('<div class="errMsg errMsgApi svelte-1ljcjf3"> </div>'),Ga=g('<div class="success svelte-1ljcjf3"> </div>'),Qa=g('<a class="reg svelte-1ljcjf3" target="_blank"> </a>'),Va=g('<a class="reg svelte-1ljcjf3" href="/auth/v1/users/register" target="_blank"> </a>'),Xa=g('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),Ya=g('<div class="container svelte-1ljcjf3"><div class="head svelte-1ljcjf3"><div class="logo svelte-1ljcjf3"><!></div> <!></div> <div class="name svelte-1ljcjf3"><h2> </h2></div> <!> <!> <!> <!> <!> <!> <!></div> <!>',1);function Za(de,W){ia(W,!1);let d=Ia(),b=o(),D=o(""),y=o(""),P=o(""),K=o(""),G=o([]),Q=o(),V=o(),X=o(),Y=o(),Z=o(""),ve=o(!1),H=o(),me=o([]),ee=o(),L=o(!1),k=o(""),U=o(!1),A=o(!1),le=o(!1),ne=o(!1),ae=o(!1),F=o(!1),ye="",be=o(!1),s=o({email:"",password:""}),x=o({}),ue=o({});oa(async()=>{const i=window.document.getElementsByName("rauthy-data")[0].id.split(`
`);a(D,i[0]),a(y,i[1]),a(be,i[2]==="true");const n=window.document.getElementsByName("rauthy-action")[0].id;n==="Refresh"?a(ve,!0):n!=null&&n.startsWith("MfaLogin ")&&a(H,n.replace("MfaLogin ","")),a(Z,window.document.getElementsByName("rauthy-csrf-token")[0].id),pa(e(Z));const v=document.getElementsByTagName("template").namedItem("auth_providers").innerHTML;v&&a(me,JSON.parse(v));const c=ga();a(b,c.client_id),a(P,c.redirect_uri),a(K,c.nonce),a(G,c.scope.split(" ")),a(V,c.state),a(X,c.code_challenge),a(Y,c.code_challenge_method),c.login_hint&&T(s,e(s).email=c.login_hint)});function ke(){a(k,""),a(le,!0),T(s,e(s).password="")}async function fe(){a(k,"");try{await e(ue).validate(e(s),{abortEarly:!1}),a(x,{})}catch(v){a(x,Le(v));return}const i={email:e(s).email,client_id:e(b),redirect_uri:e(P),state:e(V),code_challenge:e(X),code_challenge_method:e(Y),nonce:e(K),scopes:e(G)};if(e(U)&&e(s).email!==e(H)){if(!e(s).password){T(x,e(x).password=d.passwordRequired);return}if(e(s).password.length>256){T(x,e(x).password="max 256");return}i.password=e(s).password}a(L,!0);let n=await wa(i,e(Z));await xe(n)}async function xe(i){if(i.status===202)window.location.replace(i.headers.get("location"));else if(i.status===200)a(k,""),a(ee,await i.json());else if(i.status===406)a(k,d.authorize.clientForceMfa),a(A,!0);else if(i.status===429){let n=Number.parseInt(i.headers.get("x-retry-not-before")),v=$a(n),c=n*1e3-new Date().getTime();a(F,!0),a(k,`${d.authorize.http429} ${v}`),T(s,e(s).email=""),T(s,e(s).password=""),a(U,!1),setTimeout(()=>{a(F,!1),a(k,"")},c)}else e(U)?(a(k,d.authorize.invalidCredentials),a(ne,!0)):(a(U,!0),ye=e(s).email);a(L,!1)}function Ue(){e(U)&&ye!==e(s).email&&(a(U,!1),T(s,e(s).password=""),a(k,""))}function Ae(i){ja(64,(n,{challenge:v,verifier:c})=>{n||(localStorage.setItem(_a,c),Fe(i,v))})}async function Fe(i,n){let v={email:e(s).email||null,client_id:e(b),redirect_uri:e(P),scopes:e(G),state:e(V),nonce:e(K),code_challenge:e(X),code_challenge_method:e(Y),provider_id:i,pkce_challenge:n},c=await ya(v);if(c.ok){const J=await c.text();ba(J),window.location.href=c.headers.get("location")}else{let J=await c.json();a(k,J.message)}}function Oe(){a(ee,void 0)}function Se(i){i&&window.location.replace(i.loc)}async function Pe(){try{await e(ue).validate(e(s),{abortEarly:!1}),a(x,{})}catch(v){a(x,Le(v));return}let i={email:e(s).email};e(y)&&(i.redirect_uri=encodeURI(e(y))),a(L,!0);let n=await xa(i);if(n.ok)a(ae,!0);else{let v=await n.json();a(k,v.message)}a(L,!1)}se(()=>za,()=>{d&&a(ue,Na().shape({email:Ta().required(d.authorize.emailRequired).email(d.authorize.emailBadFormat)}))}),se(()=>(e(ve),e(b),e(P),e(V),e(X),e(Y),e(K),e(G),e(Z)),()=>{var i,n;if(e(ve)&&((i=e(b))==null?void 0:i.length)>0&&((n=e(P))==null?void 0:n.length)>0){a(L,!0);const v={client_id:e(b),redirect_uri:e(P),state:e(V),code_challenge:e(X),code_challenge_method:e(Y),nonce:e(K),scopes:e(G)};da().then(()=>ka(v,e(Z)).then(c=>xe(c)))}}),se(()=>e(H),()=>{e(H)&&T(s,e(s).email=e(H))}),se(()=>e(ae),()=>{e(ae)&&setTimeout(()=>{a(ae,!1),a(le,!1),a(ne,!1)},3e3)}),se(()=>e(Q),()=>{e(Q)&&e(Q).focus()}),la(),ha(),va(i=>{w(()=>ca.title=`Login ${(e(D)||e(b))??""}`)}),Ba(de,{children:(i,n)=>{Ca(i,{children:(v,c)=>{var J=Ya(),he=ie(J),pe=p(he),ge=p(pe),He=p(ge);{var Je=t=>{var r=Aa();w(()=>I(r,"src",`/auth/v1/clients/${e(b)}/logo`)),l(t,r)};_(He,t=>{e(b)&&t(Je)})}u(ge);var We=j(ge,2);{var De=t=>{var r=Fa(),f=p(r);Ua(f,{opacity:.5}),u(r),w(()=>I(r,"href",e(y))),l(t,r)};_(We,t=>{e(y)&&t(De)})}u(pe);var we=j(pe,2),Me=p(we),Ke=p(Me,!0);u(Me),u(we);var Ne=j(we,2);{var Ge=t=>{Ea(t,{t:d,onSuccess:Se,onError:Oe,get data(){return e(ee)},set data(r){a(ee,r)},$$legacy:!0})};_(Ne,t=>{e(ee)&&t(Ge)})}var Te=j(Ne,2);{var Qe=t=>{var r=Ja(),f=ie(r),R=Ce(()=>e(F)||e(A));Ma(f,{type:"email",name:"rauthyEmail",autocomplete:"email",get placeholder(){return d.common.email},get disabled(){return e(R)},get value(){return e(s).email},set value(h){T(s,e(s).email=h)},get error(){return e(x).email},set error(h){T(x,e(x).email=h)},$$events:{enter:fe,input:Ue},children:(h,B)=>{oe();var S=re();w(()=>z(S,d.common.email.toUpperCase())),l(h,S)},$$slots:{default:!0},$$legacy:!0});var O=j(f,2);{var M=h=>{var B=Sa(),S=ie(B),$e=Ce(()=>e(F)||e(A));Ra(S,{name:"rauthyPassword",get error(){return e(x).password},autocomplete:"current-password",get placeholder(){return d.common.password},get disabled(){return e($e)},get bindThis(){return e(Q)},set bindThis(m){a(Q,m)},get value(){return e(s).password},set value(m){T(s,e(s).password=m)},$$events:{enter:fe},children:(m,N)=>{oe();var E=re();w(()=>z(E,d.common.password.toUpperCase())),l(m,E)},$$slots:{default:!0},$$legacy:!0});var je=j(S,2);{var C=m=>{var N=Oa(),E=p(N,!0);u(N),w(()=>z(E,d.authorize.passwordForgotten)),ua(7,N,()=>fa),Ie("click",N,ke),Ie("keypress",N,ke),l(m,N)};_(je,m=>{e(ne)&&!e(F)&&m(C)})}l(h,B)};_(O,h=>{e(U)&&e(H)!==e(s).email&&!e(le)&&h(M)})}var $=j(O,2);{var q=h=>{var B=Be(),S=ie(B);{var $e=C=>{var m=Pa(),N=p(m);ce(N,{$$events:{click:Pe},children:(E,ra)=>{oe();var te=re();w(()=>z(te,d.authorize.passwordRequest)),l(E,te)},$$slots:{default:!0}}),u(m),l(C,m)},je=C=>{var m=Ha(),N=p(m);ce(N,{get isLoading(){return e(L)},set isLoading(E){a(L,E)},$$events:{click:fe},children:(E,ra)=>{oe();var te=re();w(()=>z(te,d.authorize.login)),l(E,te)},$$slots:{default:!0},$$legacy:!0}),u(m),l(C,m)};_(S,C=>{e(le)?C($e):C(je,!1)})}l(h,B)};_($,h=>{!e(F)&&!e(A)&&h(q)})}l(t,r)};_(Te,t=>{e(A)||t(Qe)})}var ze=j(Te,2);{var Ve=t=>{var r=Da();ma(r,5,()=>e(me),f=>f.id,(f,R)=>{ce(f,{level:3,$$events:{click:()=>Ae(e(R).id)},children:(O,M)=>{var $=Wa(),q=p($),h=j(q,2),B=p(h,!0);u(h),u($),w(()=>{I(q,"src",`/auth/v1/providers/${e(R).id}/img`),z(B,e(R).name)}),l(O,$)},$$slots:{default:!0}})}),u(r),l(t,r)};_(ze,t=>{e(me)&&t(Ve)})}var Ee=j(ze,2);{var Xe=t=>{var r=Ka(),f=p(r,!0);u(r),w(()=>z(f,e(k))),l(t,r)};_(Ee,t=>{e(k)&&t(Xe)})}var Re=j(Ee,2);{var Ye=t=>{var r=Ga(),f=p(r,!0);u(r),w(()=>z(f,d.authorize.emailSentMsg)),l(t,r)};_(Re,t=>{e(ae)&&t(Ye)})}var qe=j(Re,2);{var Ze=t=>{var r=Be(),f=ie(r);{var R=M=>{var $=Qa(),q=p($,!0);u($),w(()=>{I($,"href",`/auth/v1/users/register?redirect_uri=${e(y)??""}`),z(q,d.authorize.signUp)}),l(M,$)},O=M=>{var $=Va(),q=p($,!0);u($),w(()=>z(q,d.authorize.signUp)),l(M,$)};_(f,M=>{e(y)?M(R):M(O,!1)})}l(t,r)};_(qe,t=>{e(be)&&!e(A)&&!e(ne)&&!e(F)&&t(Ze)})}var ea=j(qe,2);{var aa=t=>{var r=Xa(),f=p(r);ce(f,{$$events:{click:()=>window.location.href="/auth/v1/account"},children:(R,O)=>{oe();var M=re("ACCOUNT");l(R,M)},$$slots:{default:!0}}),u(r),l(t,r)};_(ea,t=>{e(A)&&t(aa)})}u(he);var ta=j(he,2);qa(ta,{absolute:!0}),w(()=>z(Ke,e(D)||e(b))),l(v,J)},$$slots:{default:!0}})},$$slots:{default:!0}}),na()}export{Za as component};
