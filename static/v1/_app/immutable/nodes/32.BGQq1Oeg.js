import"../chunks/disclose-version.BDr9Qe-U.js";import{p as U,ap as q,s as C,f as m,a as B,z as a,y as c,A as p,K as G,aq as J,c as F,ar as N,r as I,t as O}from"../chunks/index-client.Di99sPv0.js";import{s as Q}from"../chunks/render.Cjc4CIr8.js";import{i as _}from"../chunks/if.DgeUjMU2.js";import{a as i,t as x,e as W,d as V}from"../chunks/template.BEKX6jgL.js";import{h as X}from"../chunks/svelte-head.B7nS6fh6.js";import{p as f}from"../chunks/proxy.BQ2dmY0t.js";import{G as Z,H as D}from"../chunks/helpers.D3KrX4pz.js";import{W as ee}from"../chunks/WebauthnRequest.BW_iBuNs.js";import{s as oe}from"../chunks/snippet.D2r9qTNj.js";import{L as re}from"../chunks/LangSelector.4LOWcG6_.js";import{B as ae}from"../chunks/Button.D-14suAe.js";import{u as te}from"../chunks/i18n.svelte.Bc6aINkd.js";import{u as P}from"../chunks/param.svelte.Bg3Frte-.js";import{T as se}from"../chunks/ThemeSwitch._9IF3ElF.js";import{b as ie}from"../chunks/fetch.DxJS_Pk_.js";import{u as ne}from"../chunks/is_dev.svelte.DF22tCPV.js";var ce=x("<div><h2>Cookies disabled</h2> <p>You need to enable Cookies.<br> Without them, a safe login cannot be executed.</p></div>"),le=x("<noscript></noscript> <!>",1);function ue(R,y){U(y,!0);let L=p(!1),g=p(!1);q(()=>{a(g,f(navigator.cookieEnabled)),a(L,!0)});var t=le(),h=C(m(t),2);{var u=b=>{var T=W(),e=m(T);{var k=s=>{var n=W(),o=m(n);oe(o,()=>y.children??G),i(s,n)},l=s=>{var n=ce();i(s,n)};_(e,s=>{c(g)?s(k):s(l,!1)})}i(b,T)};_(h,b=>{c(L)&&b(u)})}i(R,t),B()}var ve=x('<div class="btn flex-col svelte-17xvymb"><!></div>'),de=x('<div class="err"> </div>'),me=x("<!> <!> <!>",1);function pe(R,y){U(y,!0);let L=te(),g=p(!1),t=p(""),h=p(void 0),u=p(void 0);q(async()=>{var w,E;let e=P("error").get();if(e){let r=P("error_description").get();a(t,`${e}: ${r}`);return}let k=P("state").get();if(!k){a(t,"'state' is missing in URL");return}let l=P("code").get();if(!l){a(t,"'code' is missing in URL");return}let s={state:k,code:l,pkce_verifier:Z(),xsrf_token:D()},n="/auth/v1/providers/callback";ne().get()&&(n="/auth/v1/dev/providers_callback");let o=await ie(n,s);if(o.status===202)window.location.replace(o.headers.get("location")||"/auth/v1/account");else if(o.status===200){a(t,"");let r=o.body;r&&"user_id"in r&&"code"in r?(a(h,f(r.user_id)),a(u,f({Login:r.code}))):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else o.status===204?window.location.replace("/auth/v1/account"):o.status===403?a(t,f(((w=o.error)==null?void 0:w.message)||"HTTP 403 Forbidden")):o.status===406?(a(t,f(L.authorize.clientForceMfa)),a(g,!0)):a(t,`HTTP ${o.status}: ${(E=o.error)==null?void 0:E.message}`)});function b(e){a(t,f(e)),a(u,void 0)}function T(e){console.log("onWebauthnSuccess",e),e&&"loc"in e&&window.location.replace(e.loc)}X(e=>{J.title="Callback"}),ue(R,{children:(e,k)=>{var l=me(),s=m(l);{var n=r=>{ee(r,{get userId(){return c(h)},get purpose(){return c(u)},onSuccess:T,onError:b})},o=r=>{var S=W(),K=m(S);{var M=v=>{var d=ve(),z=F(d);ae(z,{onclick:()=>window.location.href="/auth/v1/account",children:(A,H)=>{N();var $=V("Account");i(A,$)},$$slots:{default:!0}}),I(d),i(v,d)},Y=v=>{var d=W(),z=m(d);{var A=H=>{var $=de(),j=F($,!0);I($),O(()=>Q(j,c(t))),i(H,$)};_(z,H=>{c(t)&&H(A)},!0)}i(v,d)};_(K,v=>{c(g)?v(M):v(Y,!1)},!0)}i(r,S)};_(s,r=>{c(u)&&c(h)?r(n):r(o,!1)})}var w=C(s,2);se(w,{absolute:!0});var E=C(w,2);re(E,{absolute:!0}),i(e,l)},$$slots:{default:!0}}),B()}export{pe as component};
