import"../chunks/disclose-version.BDr9Qe-U.js";import{f as j,p as Ee,c as r,r as a,s as v,g as e,t as y,a as qe,a9 as ke,aq as fe,i as E,h as n,ao as sa,a4 as Qe,ap as Ra}from"../chunks/index-client.CzvcfCLI.js";import{h as Xa}from"../chunks/svelte-head.DAqZ84H4.js";import{e as ge,a as i,t as I,d as we,n as ja}from"../chunks/template.CQASMEo4.js";import{i as k}from"../chunks/if.Dlf0zx3_.js";import{p as h}from"../chunks/proxy.CHyqegA9.js";import{s as l,d as Oa}from"../chunks/render.BjwlFNsb.js";import{b as Ya}from"../chunks/window.DGy9O2Cx.js";import{p as $e}from"../chunks/props.BRvF51YW.js";import{k as He,$ as da,_ as Qa,P as Za,J as er,z as ar,a0 as rr,F as tr,r as sr}from"../chunks/helpers.DC_VHWHA.js";import{e as ka}from"../chunks/each.BtetwUOf.js";import{h as $a}from"../chunks/html.DAmxUMld.js";import{a as G,c as H,s as Ve,t as xa,r as vr}from"../chunks/class.CZuJD32d.js";import{I as va}from"../chunks/IconCheck.CP7b1sho.js";import{I as nr}from"../chunks/IconStop.BebJWjvf.js";import{B as xe}from"../chunks/Button.6IA1Uwqq.js";import{M as or,T as _a}from"../chunks/Tabs.CvJGPoeP.js";import{u as Ae}from"../chunks/i18n.svelte.CQpTABT5.js";import{d as ir,b as Ia,c as Ca,f as Ze}from"../chunks/fetch.jldij1e_.js";import{B as lr}from"../chunks/ButtonAuthProvider.BlADryXf.js";import{t as Fe,f as Je,s as ua,a as cr}from"../chunks/index.DIq6rU-s.js";import{I as Le}from"../chunks/Input.rIT8d5f_.js";import{F as dr}from"../chunks/Form.BuIMl9-6.js";import{a as pa,g as ur,h as Pa,i as pr}from"../chunks/patterns.Dy_ah9_D.js";import{I as mr}from"../chunks/InputDateTimeCombo.C63yl3I1.js";import{w as fr,d as gr,e as hr}from"../chunks/dataFetching.B2v-K1dd.js";import{u as za}from"../chunks/session.svelte.DGZtZKFW.js";import{w as wr}from"../chunks/registration.CuQJRit-.js";import{W as Da}from"../chunks/WebauthnRequest.DmutWEG-.js";import{T as yr}from"../chunks/Tooltip.BkfdH2C0.js";import{P as br}from"../chunks/PasswordPolicy.CeK5lBv8.js";import{I as ma}from"../chunks/InputPassword.BNYdHBG0.js";import{C as kr}from"../chunks/CheckIcon.BDv4yyYh.js";import{s as $r}from"../chunks/snippet.Cu-MpcXt.js";import{a as xr}from"../chunks/input.DcPY3vts.js";import{A as _r}from"../chunks/A.BlBsJtzF.js";import{I as Ir}from"../chunks/InputArea.CIFUWHFV.js";import"../chunks/legacy.DUFkTaXF.js";import{D as Na}from"../chunks/Devices.CZQHerd6.js";import{T as Cr}from"../chunks/Template.BQ8OuikZ.js";import{u as Pr}from"../chunks/param.svelte.BMhroPqj.js";import{M as zr}from"../chunks/Main.icgLvyRI.js";import{C as Dr}from"../chunks/ContentCenter.BEC6assz.js";import{T as Nr,L as Er}from"../chunks/LangSelector.ChfH0xop.js";function fa(ee,p){var s=ge(),t=j(s);{var q=C=>{va(C,{color:"hsl(var(--action))"})},o=C=>{nr(C,{color:"hsl(var(--error))"})};k(t,C=>{p.checked?C(q):C(o,!1)})}i(ee,s)}var qr=I('<div class="link-err value svelte-1tea8v4"> </div>'),Lr=I('<div class="fed-btn svelte-1tea8v4"><!> <!></div>'),Mr=I('<h3> </h3> <p> </p> <div class="providers svelte-1tea8v4"></div>',1),Wr=I("<!> <!>",1),Tr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Vr=I('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Ar=I('<div><div>WebID:</div> <span class="value svelte-1tea8v4"><a target="_blank"><!></a></span></div>'),Br=I('<div><div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <div><div class="value svelte-1tea8v4"> </div> <!></div></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <!> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <!> <!></div>');function Ea(ee,p){Ee(p,!0);let s=$e(p,"user",15),t=Ae(),q=E(!1),o=E(!1),C=ke(()=>{var B;return(B=s().account_type)==null?void 0:B.startsWith("federated")}),$=ke(()=>{var B;return e(C)?`${s().account_type}: ${((B=p.authProvider)==null?void 0:B.name)||""}`:s().account_type}),d=ke(()=>p.viewModePhone?"rowPhone":"row"),w=ke(()=>p.viewModePhone?"labelPhone":"label");function u(B){Qa(64,(re,{challenge:ce,verifier:he})=>{re||(localStorage.setItem(Za,he),O(B,ce))})}async function O(B,re){let ce={email:s().email,client_id:"rauthy",redirect_uri:window.location.href,provider_id:B,pkce_challenge:re},he=await Ia(`/auth/v1/providers/${B}/link`,ce);if(he.text){er(he.text);let me=he.headers.get("location");me&&(window.location.href=me)}else console.error(he.error)}async function K(){let B=await ir("/auth/v1/providers/link");B.body?s(B.body):(console.error(B.error),n(q,!0))}var L=Br(),J=r(L),ae=r(J),ie=r(ae,!0);a(ae);var z=v(ae,2),D=r(z,!0);a(z),a(J);var F=v(J,2),Y=r(F),le=r(Y,!0);a(Y);var ve=v(Y,2),ne=r(ve,!0);a(ve),a(F);var Z=v(F,2),g=r(Z),m=r(g,!0);a(g);var P=v(g,2),c=r(P,!0);a(P),a(Z);var U=v(Z,2),te=r(U),ue=r(te);a(te);var f=v(te,2),W=r(f,!0);a(f),a(U);var T=v(U,2),M=r(T),A=r(M,!0);a(M);var Q=v(M,2),S=r(Q),de=r(S,!0);a(S);var se=v(S,2);{var ye=B=>{var re=Lr(),ce=r(re);xe(ce,{get ariaLabel(){return t.account.providerUnlink},level:3,onclick:K,children:(Ce,Be)=>{fe();var Ge=we();y(()=>l(Ge,t.account.providerUnlink)),i(Ce,Ge)},$$slots:{default:!0}});var he=v(ce,2);{var me=Ce=>{var Be=qr(),Ge=r(Be,!0);a(Be),y(()=>l(Ge,t.account.providerUnlinkDesc)),i(Ce,Be)};k(he,Ce=>{e(q)&&Ce(me)})}a(re),i(B,re)},V=B=>{var re=ge(),ce=j(re);{var he=me=>{var Ce=Wr(),Be=j(Ce);xe(Be,{level:2,onclick:()=>n(o,!0),children:(Oe,Ka)=>{fe();var Ye=we();y(()=>l(Ye,t.account.providerLink)),i(Oe,Ye)},$$slots:{default:!0}});var Ge=v(Be,2);or(Ge,{get showModal(){return e(o)},set showModal(Oe){n(o,h(Oe))},children:(Oe,Ka)=>{var Ye=Mr(),ia=j(Ye),Ga=r(ia,!0);a(ia);var la=v(ia,2),Ha=r(la,!0);a(la);var ya=v(la,2);ka(ya,21,()=>p.providers,ca=>ca.id,(ca,ba)=>{var Ja=ke(()=>`${t.account.providerLink}: ${e(ba).name}`);lr(ca,{get ariaLabel(){return e(Ja)},get provider(){return e(ba)},onclick:u})}),a(ya),y(()=>{l(Ga,t.account.providerLink),l(Ha,t.account.providerLinkDesc)}),i(Oe,Ye)},$$slots:{default:!0}}),i(me,Ce)};k(ce,me=>{p.providers.length>0&&me(he)},!0)}i(B,re)};k(se,B=>{e(C)?B(ye):B(V,!1)})}a(Q),a(T);var x=v(T,2),b=r(x),N=r(b,!0);a(b);var R=v(b,2),pe=r(R,!0);a(R),a(x);var _=v(x,2),X=r(_),oe=r(X,!0);a(X);var _e=v(X,2),Ie=r(_e,!0);a(_e),a(_);var be=v(_,2),Pe=r(be),Re=r(Pe,!0);a(Pe);var Ue=v(Pe,2),ea=ke(()=>!!s().webauthn_user_id);fa(Ue,{get checked(){return e(ea)}}),a(be);var ze=v(be,2),Me=r(ze),na=r(Me,!0);a(Me);var aa=v(Me,2);fa(aa,{get checked(){return s().enabled}}),a(ze);var Se=v(ze,2),Ke=r(Se),oa=r(Ke,!0);a(Ke);var Ne=v(Ke,2);fa(Ne,{get checked(){return s().email_verified}}),a(Se);var We=v(Se,2);{var Xe=B=>{var re=Tr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,He(s().last_login))),a(me),a(re),y(()=>{G(re,H(e(d)),"svelte-1tea8v4"),G(ce,H(e(w)),"svelte-1tea8v4"),l(he,t.account.lastLogin)}),i(B,re)};k(We,B=>{s().last_login&&B(Xe)})}var De=v(We,2),Te=r(De),ga=r(Te,!0);a(Te);var je=v(Te,2),Va=r(je,!0);y(()=>l(Va,s().password_expires&&He(s().password_expires)||t.common.never)),a(je),a(De);var ra=v(De,2),ta=r(ra),Aa=r(ta,!0);a(ta);var ha=v(ta,2),Ba=r(ha,!0);y(()=>l(Ba,He(s().created_at))),a(ha),a(ra);var wa=v(ra,2);{var Fa=B=>{var re=Vr(),ce=r(re),he=r(ce,!0);a(ce);var me=v(ce,2),Ce=r(me,!0);y(()=>l(Ce,He(s().user_expires))),a(me),a(re),y(()=>{G(re,H(e(d)),"svelte-1tea8v4"),G(ce,H(e(w)),"svelte-1tea8v4"),l(he,t.account.userExpiry)}),i(B,re)};k(wa,B=>{s().user_expires&&B(Fa)})}var Ua=v(wa,2);{var Sa=B=>{var re=Ar(),ce=r(re),he=v(ce,2),me=r(he);y(()=>Ve(me,"href",da(s().id)));var Ce=r(me);$a(Ce,()=>da(s().id).replace("/auth/","/auth/<wbr/>")),a(me),a(he),a(re),y(()=>{G(re,H(e(d)),"svelte-1tea8v4"),G(ce,H(e(w)),"svelte-1tea8v4")}),i(B,re)};k(Ua,B=>{p.webIdData&&B(Sa)})}a(L),y(()=>{G(J,H(e(d)),"svelte-1tea8v4"),G(ae,H(e(w)),"svelte-1tea8v4"),l(ie,t.common.email),l(D,s().email),G(F,H(e(d)),"svelte-1tea8v4"),G(Y,H(e(w)),"svelte-1tea8v4"),l(le,t.account.givenName),l(ne,s().given_name),G(Z,H(e(d)),"svelte-1tea8v4"),G(g,H(e(w)),"svelte-1tea8v4"),l(m,t.account.familyName),l(c,s().family_name),G(U,H(e(d)),"svelte-1tea8v4"),G(te,H(e(w)),"svelte-1tea8v4"),l(ue,`${t.account.user??""} ID`),l(W,s().id),G(T,H(e(d)),"svelte-1tea8v4"),G(M,H(e(w)),"svelte-1tea8v4"),l(A,t.account.accType),l(de,e($)||""),G(x,H(e(d)),"svelte-1tea8v4"),G(b,H(e(w)),"svelte-1tea8v4"),l(N,t.account.roles),l(pe,s().roles||"None"),G(_,H(e(d)),"svelte-1tea8v4"),G(X,H(e(w)),"svelte-1tea8v4"),l(oe,t.account.groups),l(Ie,s().groups||"None"),G(be,H(e(d)),"svelte-1tea8v4"),G(Pe,H(e(w)),"svelte-1tea8v4"),l(Re,t.account.mfaActivated),G(ze,H(e(d)),"svelte-1tea8v4"),G(Me,H(e(w)),"svelte-1tea8v4"),l(na,t.account.userEnabled),G(Se,H(e(d)),"svelte-1tea8v4"),G(Ke,H(e(w)),"svelte-1tea8v4"),l(oa,t.account.emailVerified),G(De,H(e(d)),"svelte-1tea8v4"),G(Te,H(e(w)),"svelte-1tea8v4"),l(ga,t.account.passwordExpiry),G(ra,H(e(d)),"svelte-1tea8v4"),G(ta,H(e(w)),"svelte-1tea8v4"),l(Aa,t.account.userCreated)}),i(ee,L),qe()}var Fr=I('<div class="success svelte-4ogr3z"><!></div>'),Ur=I("<p> </p>"),Sr=I('<div class="err svelte-4ogr3z"> </div>'),Kr=I('<div class="formInner svelte-4ogr3z"><div><!> <!> <!> <!></div> <div><!> <!> <!> <!> <!></div></div> <div class="bottom svelte-4ogr3z"><div><!></div> <!></div> <!>',1),Gr=I('<div class="container svelte-4ogr3z"><!></div>');function qa(ee,p){var O;Ee(p,!0);let s=$e(p,"user",15);(O=s().user_values)!=null&&O.birthdate||s(s().user_values.birthdate="",!0);let t=Ae(),q=E(""),o=E(!1),C=E(!1);async function $(K,L){var m;const J=L.get("email"),ae=L.get("family_name")||void 0,ie=L.get("given_name")||void 0,z=L.get("birthdate")||void 0,D=((m=L.get("phone"))==null?void 0:m.replaceAll(" ",""))||void 0,F=L.get("street")||void 0,Y=L.get("zip")||void 0,le=Y?Number.parseInt(Y):void 0,ve=L.get("city")||void 0,ne=L.get("country")||void 0;let Z={email:J,family_name:ae,given_name:ie,user_values:{birthdate:z,phone:D,street:F,zip:le,city:ve,country:ne}},g=await Ca(`/auth/v1/users/${s().id}/self`,Z);if(g.body){n(o,!0),s(g.body);let P=3e3;g.status===202&&(n(C,!0),P=3e4),setTimeout(()=>{n(o,!1)},P)}else g.error&&(console.error(g.error),n(q,h(g.error.message)))}var d=Gr(),w=r(d),u=ke(()=>`/auth/v1/users/${s().id}/self`);dr(w,{get action(){return e(u)},onSubmit:$,children:(K,L)=>{var J=Kr(),ae=j(J),ie=r(ae),z=r(ie);Le(z,{typ:"email",name:"email",get label(){return t.common.email},get placeholder(){return t.common.email},get value(){return s().email},required:!0});var D=v(z,2);Le(D,{name:"given_name",autocomplete:"given-name",get label(){return t.account.givenName},get placeholder(){return t.account.givenName},get value(){return s().given_name},required:!0,maxLength:32,pattern:pa});var F=v(D,2);Le(F,{name:"family_name",autocomplete:"family-name",get label(){return t.account.familyName},get placeholder(){return t.account.familyName},get value(){return s().family_name},maxLength:32,pattern:pa});var Y=v(F,2);mr(Y,{name:"birthdate",get label(){return t.account.birthdate},withDelete:!0,get value(){return s().user_values.birthdate},set value(M){s(s().user_values.birthdate=M,!0)}}),a(ie);var le=v(ie,2),ve=r(le);Le(ve,{name:"street",autocomplete:"street-address",get label(){return t.account.street},get placeholder(){return t.account.street},get value(){return s().user_values.street},maxLength:48,pattern:ur});var ne=v(ve,2);Le(ne,{typ:"number",name:"zip",autocomplete:"postal-code",get label(){return t.account.zip},get placeholder(){return t.account.zip},get value(){return s().user_values.zip},min:"1000",max:"9999999"});var Z=v(ne,2);Le(Z,{name:"city",autocomplete:"address-level2",get label(){return t.account.city},get placeholder(){return t.account.city},get value(){return s().user_values.city},maxLength:48,pattern:Pa});var g=v(Z,2);Le(g,{name:"country",autocomplete:"country",get label(){return t.account.country},get placeholder(){return t.account.country},get value(){return s().user_values.country},maxLength:48,pattern:Pa});var m=v(g,2);Le(m,{name:"phone",autocomplete:"tel",get label(){return t.account.phone},get placeholder(){return t.account.phone},get value(){return s().user_values.phone},maxLength:32,pattern:pr}),a(le),a(ae);var P=v(ae,2),c=r(P),U=r(c);xe(U,{type:"submit",children:(M,A)=>{fe();var Q=we();y(()=>l(Q,t.common.save)),i(M,Q)},$$slots:{default:!0}}),a(c);var te=v(c,2);{var ue=M=>{var A=Fr(),Q=r(A);va(Q,{}),a(A),Fe(3,A,()=>Je),i(M,A)};k(te,M=>{e(o)&&M(ue)})}a(P);var f=v(P,2);{var W=M=>{var A=Ur(),Q=r(A,!0);a(A),y(()=>l(Q,t.account.emailUpdateConfirm)),i(M,A)},T=M=>{var A=ge(),Q=j(A);{var S=de=>{var se=Sr(),ye=r(se,!0);a(se),y(()=>l(ye,e(q))),Fe(3,se,()=>Je),i(de,se)};k(Q,de=>{e(q)&&de(S)},!0)}i(M,A)};k(f,M=>{e(C)?M(W):M(T,!1)})}i(K,J)},$$slots:{default:!0}}),a(d),i(ee,d),qe()}var Hr=ja('<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7.864 4.243A7.5 7.5 0 0119.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 004.5 10.5a7.464 7.464 0 01-1.15 3.993m1.989 3.559A11.209 11.209 0 008.25 10.5a3.75 3.75 0 117.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 01-3.6 9.75m6.633-4.596a18.666 18.666 0 01-2.485 5.33"></path></svg>');function Jr(ee,p){let s=$e(p,"opacity",3,.9),t=$e(p,"width",3,24),q=$e(p,"color",3,"currentColor");var o=Hr();Ve(o,"stroke-width",2),y(()=>{Ve(o,"stroke",q()),Ve(o,"width",t()),Ve(o,"opacity",s())}),i(ee,o)}var Rr=I('<div class="err svelte-qkgdvy"><b>Your browser does not support Webauthn credentials and must be updated.</b></div>'),Xr=I('<!> <div class="regBtns svelte-qkgdvy"><!> <!></div>',1),jr=I('<div class="regNewBtn svelte-qkgdvy"><!></div>'),Or=I('<div class="keysHeader svelte-qkgdvy"> </div>'),Yr=I("<div><!></div>"),Qr=I('<div class="row svelte-qkgdvy"><div></div> <div class="deleteBtn svelte-qkgdvy"><!></div></div>'),Zr=I('<div class="keyContainer svelte-qkgdvy"><div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <div class="nameUv svelte-qkgdvy"><b> </b> <!></div></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <div class="row svelte-qkgdvy"><span class="label svelte-qkgdvy"> </span> <span class="font-mono"> </span></div> <!></div>'),et=I('<div class="button svelte-qkgdvy"><!></div>'),at=I('<!> <p class="svelte-qkgdvy"> <br><br> </p> <!> <!> <div class="keysContainer svelte-qkgdvy"></div> <!> <div class="svelte-qkgdvy"> </div>',1),rt=I('<div class="container svelte-qkgdvy"><!></div>');function La(ee,p){Ee(p,!0);const s="credentials"in navigator;let t=Ae(),q=za("account"),o=ke(()=>{var g;return(g=q.get())==null?void 0:g.user_id}),C=E(void 0),$=E(!1),d=E(""),w=E(!1),u=E(p.user.account_type==="password"),O=E(void 0),K=E(""),L=E(!1),J=E(h([]));sa(()=>{ie()}),Qe(()=>{e(J).length>0&&p.user.account_type==="passkey"&&n(u,e(J).length>1)}),Qe(()=>{var g;(g=e(C))==null||g.focus()});function ae(){n($,!1),n(d,"")}async function ie(){var m;let g=await Ze(`/auth/v1/users/${(m=q.get())==null?void 0:m.user_id}/webauthn`);g.body?n(J,h(g.body)):console.error(g.error)}async function z(){if(ae(),e(L)||!e(o))return;if(e(K).length<1){n($,!0),n(d,h(t.mfa.passkeyNameErr));return}let g=await wr(e(o),e(K),t.authorize.invalidKeyUsed,t.authorize.requestExpired);g.error?(n($,!0),n(d,`${t.mfa.errorReg} - ${g.error}`)):(n(w,!1),n(K,""),await ie())}async function D(g){let m=await fr(p.user.id,g);if(m.status===200)await ie();else{let P=await m.json();n($,!0),n(d,h(P.message))}}function F(g){n(O,void 0),n($,!0),n(d,h(g)),setTimeout(()=>{n($,!1),n(d,"")},5e3)}function Y(g){n(O,void 0),n(d,h(t.mfa.testSuccess)),setTimeout(()=>{n(d,"")},3e3)}var le=rt(),ve=r(le);{var ne=g=>{var m=Rr();i(g,m)},Z=g=>{var m=at(),P=j(m);{var c=V=>{Da(V,{get userId(){return p.user.id},get purpose(){return e(O)},onSuccess:Y,onError:F})};k(P,V=>{e(O)&&V(c)})}var U=v(P,2),te=r(U),ue=v(te,3);a(U);var f=v(U,2);{var W=V=>{var x=Xr(),b=j(x);Le(b,{autocomplete:"off",get label(){return t.mfa.passkeyName},get placeholder(){return t.mfa.passkeyName},maxLength:32,pattern:pa,onEnter:z,get ref(){return e(C)},set ref(_){n(C,h(_))},get value(){return e(K)},set value(_){n(K,h(_))},get isError(){return e(L)},set isError(_){n(L,h(_))}});var N=v(b,2),R=r(N);xe(R,{onclick:z,children:(_,X)=>{fe();var oe=we();y(()=>l(oe,t.mfa.register)),i(_,oe)},$$slots:{default:!0}});var pe=v(R,2);xe(pe,{level:3,onclick:()=>n(w,!1),children:(_,X)=>{fe();var oe=we();y(()=>l(oe,t.common.cancel)),i(_,oe)},$$slots:{default:!0}}),a(N),i(V,x)},T=V=>{var x=jr(),b=r(x),N=ke(()=>e(J).length===0?1:2);xe(b,{get level(){return e(N)},onclick:()=>n(w,!0),children:(R,pe)=>{fe();var _=we();y(()=>l(_,t.mfa.registerNew)),i(R,_)},$$slots:{default:!0}}),a(x),i(V,x)};k(f,V=>{e(w)?V(W):V(T,!1)})}var M=v(f,2);{var A=V=>{var x=Or(),b=r(x,!0);a(x),y(()=>l(b,t.mfa.registerdKeys)),i(V,x)};k(M,V=>{e(J).length>0&&V(A)})}var Q=v(M,2);ka(Q,21,()=>e(J),V=>V.name,(V,x)=>{var b=Zr(),N=r(b),R=r(N),pe=r(R,!0);a(R);var _=v(R,2),X=r(_),oe=r(X,!0);a(X);var _e=v(X,2);{var Ie=Ne=>{yr(Ne,{get text(){return t.account.userVerifiedTooltip},children:(We,Xe)=>{var De=Yr();ua(De,"margin-bottom","-.25rem");var Te=r(De);Jr(Te,{width:18,color:"var(--col-acnt)"}),a(De),i(We,De)},$$slots:{default:!0}})};k(_e,Ne=>{e(x).user_verified&&Ne(Ie)})}a(_),a(N);var be=v(N,2),Pe=r(be),Re=r(Pe,!0);a(Pe);var Ue=v(Pe,2),ea=r(Ue,!0);y(()=>l(ea,He(e(x).registered))),a(Ue),a(be);var ze=v(be,2),Me=r(ze),na=r(Me,!0);a(Me);var aa=v(Me,2),Se=r(aa,!0);y(()=>l(Se,He(e(x).last_used))),a(aa),a(ze);var Ke=v(ze,2);{var oa=Ne=>{var We=Qr(),Xe=v(r(We),2),De=r(Xe);xe(De,{level:-3,onclick:()=>D(e(x).name),children:(Te,ga)=>{fe();var je=we();y(()=>l(je,t.common.delete)),i(Te,je)},$$slots:{default:!0}}),a(Xe),a(We),i(Ne,We)};k(Ke,Ne=>{e(u)&&Ne(oa)})}a(b),y(()=>{l(pe,t.mfa.passkeyName),l(oe,e(x).name),l(Re,t.mfa.registerd),l(na,t.mfa.lastUsed)}),i(V,b)}),a(Q);var S=v(Q,2);{var de=V=>{var x=et(),b=r(x);xe(b,{onclick:()=>n(O,"Test"),children:(N,R)=>{fe();var pe=we();y(()=>l(pe,t.mfa.test)),i(N,pe)},$$slots:{default:!0}}),a(x),i(V,x)};k(S,V=>{e(J).length>0&&V(de)})}var se=v(S,2),ye=r(se,!0);a(se),y(()=>{l(te,`${t.mfa.p1??""} `),l(ue,` ${t.mfa.p2??""}`),xa(se,"success",!e($)),xa(se,"err",e($)),l(ye,e(d))}),i(g,m)};k(ve,g=>{s?g(Z,!1):g(ne)})}a(le),i(ee,le),qe()}var tt=I('<div class="container svelte-ue7bk2"><!> <!> <!> <!> <div class="btn svelte-ue7bk2"><!></div> <div class="err svelte-ue7bk2"> </div></div>');function st(ee,p){Ee(p,!0);let s=$e(p,"passwords",15),t=$e(p,"hideCurrentPassword",3,!1),q=$e(p,"isValid",15),o=Ae();q(K);let C=E(!1),$=E(""),d=E(void 0),w=ke(()=>{var z;return((z=s().new)==null?void 0:z.length)>6&&s().new===s().newConfirm}),u=E(void 0),O=E(void 0);sa(async()=>{let z=await Ze("/auth/v1/password_policy");z.body?n(d,h(z.body)):console.error(z.error)});function K(){return n($,""),!t()&&!s().current?(n($,h(o.account.passwordCurrReq)),!1):s().new?s().newConfirm?e(C)?s().new.length>256?(n($,"max 256"),!1):s().new!==s().newConfirm?(n($,h(o.account.passwordNoMatch)),!1):!0:(n($,h(o.account.passwordPolicyFollow)),!1):(n($,h(o.account.passwordNewReq)),!1):(n($,h(o.account.passwordNewReq)),!1)}function L(){if(n($,""),e(d)){let z=ar(e(d));s(s().new=z,!0),s(s().newConfirm=z,!0)}requestAnimationFrame(()=>{var z,D;(z=e(u))==null||z(),(D=e(O))==null||D()})}var J=ge(),ae=j(J);{var ie=z=>{var D=tt(),F=r(D);br(F,{get policy(){return e(d)},get password(){return s().new},get accepted(){return e(C)},set accepted(c){n(C,h(c))}});var Y=v(F,2);{var le=c=>{ma(c,{autocomplete:"current-password",get label(){return o.account.passwordCurr},get placeholder(){return o.account.passwordCurr},onInput:K,get width(){return p.inputWidth},get value(){return s().current},set value(U){s(s().current=U,!0)}})};k(Y,c=>{t()||c(le)})}var ve=v(Y,2);ma(ve,{autocomplete:"new-password",get label(){return o.account.passwordNew},get placeholder(){return o.account.passwordNew},onInput:K,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().new},set value(c){s(s().new=c,!0)},get reportValidity(){return e(u)},set reportValidity(c){n(u,h(c))}});var ne=v(ve,2);ma(ne,{autocomplete:"new-password",get label(){return o.account.passwordConfirm},get placeholder(){return o.account.passwordConfirm},onInput:K,get showCopy(){return e(w)},get width(){return p.inputWidth},get value(){return s().newConfirm},set value(c){s(s().newConfirm=c,!0)},get reportValidity(){return e(O)},set reportValidity(c){n(O,h(c))}});var Z=v(ne,2),g=r(Z);xe(g,{onclick:L,level:2,children:(c,U)=>{fe();var te=we();y(()=>l(te,o.account.generateRandom)),i(c,te)},$$slots:{default:!0}}),a(Z);var m=v(Z,2),P=r(m,!0);a(m),a(D),y(()=>l(P,e($))),i(z,D)};k(ae,z=>{e(d)&&z(ie)})}return i(ee,J),qe({isPwdValid:K})}var vt=I('<div class="m-05 svelte-1h4zvzu"><p> </p> <p><b> </b></p> <div></div> <p> </p> <!></div>'),nt=I("<p> </p> <p> </p> <p> </p> <div><!></div>",1),ot=I('<div class="success svelte-1h4zvzu"><!></div>'),it=I('<div class="err"> </div>'),lt=I('<div class="cancel"><!></div>'),ct=I('<div class="convertPasskey svelte-1h4zvzu"><h3> </h3> <p> </p> <!></div>'),dt=I('<div><!> <div class="save svelte-1h4zvzu"><!> <!></div></div> <!>',1),ut=I('<div class="container svelte-1h4zvzu"><!> <!> <!> <!></div>');function Ma(ee,p){Ee(p,!0);let s=$e(p,"user",15),t=Ae(),q=ke(()=>p.viewModePhone?"calc(100vw - 1.5rem)":"300px"),o=E(h(s().account_type)),C=E(h([])),$=E(void 0),d=E(!1),w=E(!1),u=E(""),O=E(!1),K=E(void 0),L=E(h({current:"",new:"",newConfirm:""})),J=ke(()=>e(C).filter(f=>f.user_verified).length>0);sa(()=>{ae()});async function ae(){let f=await Ze(`/auth/v1/users/${s().id}/webauthn`);f.body?n(C,h(f.body)):console.error("error fetching passkeys: "+f.error)}async function ie(){let f=await Ia(`/auth/v1/users/${s().id}/self/convert_passkey`);f.error?console.error("error fetching passkeys: "+f.error):window.location.reload()}async function z(){n(u,""),e(C).length>0?await D():await F()}async function D(){var f;if(!((f=e($))!=null&&f())){n(u,h(t.common.invalidInput));return}n(K,"PasswordNew")}async function F(f){var M,A;if(!((M=e($))!=null&&M())){n(u,h(t.common.invalidInput));return}n(w,!0);let W={password_new:e(L).new};f?W.mfa_code=f:W.password_current=e(L).current;let T=await Ca(`/auth/v1/users/${s().id}/self`,W);T.body?(n(O,!0),n(L,h({current:"",new:"",newConfirm:""})),s(T.body),n(o,h(T.body.account_type)),setTimeout(()=>{n(O,!1),n(d,!1)},3e3)):n(u,h(((A=T.error)==null?void 0:A.message)||"Error")),n(w,!1)}function Y(f){n(K,void 0),n(u,h(f)),setTimeout(()=>{n(u,"")},5e3)}function le(f){n(K,void 0),f&&"code"in f&&F(f.code)}async function ve(){let f=await gr({email:s().email});if(f.ok)n(O,!0);else{let W=await f.json();n(u,h(W.message))}}var ne=ut(),Z=r(ne);{var g=f=>{Da(f,{get userId(){return s().id},get purpose(){return e(K)},onSuccess:le,onError:Y})};k(Z,f=>{e(K)&&f(g)})}var m=v(Z,2);{var P=f=>{var W=vt(),T=r(W),M=r(T,!0);a(T);var A=v(T,2),Q=r(A),S=r(Q,!0);a(Q),a(A);var de=v(A,2);ua(de,"height",".3rem");var se=v(de,2),ye=r(se,!0);a(se);var V=v(se,2);{var x=N=>{kr(N,{check:!0})},b=N=>{xe(N,{level:2,onclick:ve,children:(R,pe)=>{fe();var _=we();y(()=>l(_,t.account.passwordReset)),i(R,_)},$$slots:{default:!0}})};k(V,N=>{e(O)?N(x):N(b,!1)})}a(W),y(()=>{var N;l(M,t.account.federatedConvertPassword1),l(S,((N=p.authProvider)==null?void 0:N.name)||"UNKNOWN"),l(ye,t.account.federatedConvertPassword2)}),i(f,W)};k(m,f=>{e(o)==="federated"&&f(P)})}var c=v(m,2);{var U=f=>{var W=nt(),T=j(W),M=r(T,!0);a(T);var A=v(T,2),Q=r(A,!0);a(A);var S=v(A,2),de=r(S,!0);a(S);var se=v(S,2),ye=r(se);xe(ye,{level:2,onclick:()=>n(d,!0),children:(V,x)=>{fe();var b=we();y(()=>l(b,t.account.convertAccount)),i(V,b)},$$slots:{default:!0}}),a(se),y(()=>{l(M,t.account.accTypePasskeyText1),l(Q,t.account.accTypePasskeyText2),l(de,t.account.accTypePasskeyText3)}),i(f,W)};k(c,f=>{(e(o)==="passkey"||e(o)==="federated_passkey")&&!e(d)&&f(U)})}var te=v(c,2);{var ue=f=>{var W=dt(),T=j(W),M=r(T),A=ke(()=>!(e(o)==="password"&&e(C).length<1));st(M,{get inputWidth(){return e(q)},get hideCurrentPassword(){return e(A)},get passwords(){return e(L)},set passwords(b){n(L,h(b))},get isValid(){return e($)},set isValid(b){n($,h(b))}});var Q=v(M,2),S=r(Q);xe(S,{onclick:z,level:1,get isLoading(){return e(w)},children:(b,N)=>{fe();var R=we();y(()=>l(R,t.common.save)),i(b,R)},$$slots:{default:!0}});var de=v(S,2);{var se=b=>{var N=ot(),R=r(N);va(R,{}),a(N),Fe(3,N,()=>Je),i(b,N)},ye=b=>{var N=ge(),R=j(N);{var pe=X=>{var oe=it(),_e=r(oe,!0);a(oe),y(()=>l(_e,e(u))),Fe(3,oe,()=>Je),i(X,oe)},_=X=>{var oe=ge(),_e=j(oe);{var Ie=be=>{var Pe=lt(),Re=r(Pe);xe(Re,{level:3,onclick:()=>n(d,!1),children:(Ue,ea)=>{fe();var ze=we();y(()=>l(ze,t.common.cancel)),i(Ue,ze)},$$slots:{default:!0}}),a(Pe),i(be,Pe)};k(_e,be=>{e(d)&&!e(w)&&be(Ie)},!0)}i(X,oe)};k(R,X=>{e(u)?X(pe):X(_,!1)},!0)}i(b,N)};k(de,b=>{e(O)?b(se):b(ye,!1)})}a(Q),a(T);var V=v(T,2);{var x=b=>{var N=ct(),R=r(N),pe=r(R,!0);a(R);var _=v(R,2),X=r(_,!0);a(_);var oe=v(_,2);xe(oe,{level:2,onclick:ie,children:(_e,Ie)=>{fe();var be=we();y(()=>l(be,t.account.convertAccount)),i(_e,be)},$$slots:{default:!0}}),a(N),y(()=>{l(pe,t.account.convertAccount),l(X,t.account.convertAccountP1)}),i(b,N)};k(V,b=>{!e(d)&&e(J)&&b(x)})}i(f,W)};k(te,f=>{(e(o)==="password"||e(o)==="federated_password"||e(d))&&f(ue)})}a(ne),i(ee,ne),qe()}function pt(ee,p){ee.code==="Enter"&&p()}var mt=I('<div class="flex"><div class="label font-label noselect svelte-1xf5lr3"><!></div> <label class="switch svelte-1xf5lr3"><input type="checkbox" class="svelte-1xf5lr3"> <span class="slider slider-round svelte-1xf5lr3"></span></label></div>');function Wa(ee,p){Ee(p,!0);let s=$e(p,"checked",15,!1),t=$e(p,"ariaLabel",3,""),q=$e(p,"name",3,"");function o(){s(!s())}var C=mt(),$=r(C),d=r($);$r(d,()=>p.children),a($);var w=v($,2),u=r(w);vr(u),u.__click=o,u.__keydown=[pt,o],fe(2),a(w),a(C),y(()=>{ua($,"width",p.labelWidth),Ve(u,"name",q()),u.disabled=p.disabled,Ve(u,"aria-checked",s()),Ve(u,"aria-label",t())}),xr(u,s),i(ee,C),qe()}Oa(["click","keydown"]);var ft=I("<div><p> </p> <!></div>"),gt=I('<div class="success svelte-5kivuv"><!></div>'),ht=I('<div class="err svelte-5kivuv"> </div>'),wt=I('<div class="container svelte-5kivuv"><p> </p> <p><!></p> <div class="switch svelte-5kivuv"><!></div> <div class="switch svelte-5kivuv"><!></div> <!> <div class="bottom svelte-5kivuv"><!> <!></div></div>');function Ta(ee,p){Ee(p,!0);let s=$e(p,"webIdData",15),t=Ae();const q="14rem";let o=E(""),C=E(!1),$=E(!!s().custom_triples),d=da(s().user_id);Qe(()=>{e(C)&&setTimeout(()=>{n(C,!1)},3e3)});async function w(){n(o,"");let m=await hr(s().user_id,s());if(m.ok)n(C,!0);else{let P=await m.json();n(o,h(P.message))}}var u=wt(),O=r(u),K=r(O,!0);a(O);var L=v(O,2),J=r(L);_r(J,{href:d,target:"_blank",children:(m,P)=>{var c=ge(),U=j(c);$a(U,()=>d.replace("/auth/","/auth/<wbr/>")),i(m,c)},$$slots:{default:!0}}),a(L);var ae=v(L,2),ie=r(ae);Wa(ie,{ariaLabel:"E-Mail",labelWidth:q,get checked(){return s().expose_email},set checked(m){s(s().expose_email=m,!0)},children:(m,P)=>{fe();var c=we("E-Mail");i(m,c)},$$slots:{default:!0}}),a(ae);var z=v(ae,2),D=r(z);Wa(D,{get ariaLabel(){return t.account.webIdExpertMode},labelWidth:q,get checked(){return e($)},set checked(m){n($,h(m))},children:(m,P)=>{fe();var c=we();y(()=>l(c,t.account.webIdExpertMode)),i(m,c)},$$slots:{default:!0}}),a(z);var F=v(z,2);{var Y=m=>{var P=ft(),c=r(P),U=r(c,!0);a(c);var te=v(c,2);Ir(te,{placeholder:"FOAF",rows:15,get value(){return s().custom_triples},set value(ue){s(s().custom_triples=ue,!0)}}),a(P),y(()=>l(U,t.account.webIdDescData)),Fe(3,P,()=>cr),i(m,P)};k(F,m=>{e($)&&m(Y)})}var le=v(F,2),ve=r(le);xe(ve,{onclick:w,children:(m,P)=>{fe();var c=we();y(()=>l(c,t.common.save)),i(m,c)},$$slots:{default:!0}});var ne=v(ve,2);{var Z=m=>{var P=gt(),c=r(P);va(c,{}),a(P),Fe(3,P,()=>Je),i(m,P)},g=m=>{var P=ge(),c=j(P);{var U=te=>{var ue=ht(),f=r(ue,!0);a(ue),y(()=>l(f,e(o))),Fe(3,ue,()=>Je),i(te,ue)};k(c,te=>{e(o)&&te(U)},!0)}i(m,P)};k(ne,m=>{e(C)?m(Z):m(g,!1)})}a(le),a(u),y(()=>l(K,t.account.webIdDesc)),i(ee,u),qe()}function yt(ee){Na(ee,{viewMode:"account"})}var bt=I("<h3> </h3>"),kt=I('<div class="headerPhone svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="innerPhone svelte-k6hxbm"><!></div></div>',1),$t=I('<div class="header svelte-k6hxbm"><!></div> <div class="container svelte-k6hxbm"><!> <div class="inner svelte-k6hxbm"><!></div></div>',1),xt=I('<!> <div class="wrapper svelte-k6hxbm"><!></div>',1);function _t(ee,p){Ee(p,!0);const s=D=>{var F=bt(),Y=r(F,!0);a(F),y(()=>l(Y,`${t().given_name} ${t().family_name||""}`)),i(D,F)};let t=$e(p,"user",15),q=$e(p,"webIdData",15),o=Ae(),C=E(void 0),$=E(h([])),d=ke(()=>{var D;if((D=t().account_type)!=null&&D.startsWith("federated"))return e($).filter(F=>F.id===t().auth_provider_id)[0]}),w=ke(()=>e(C)&&e(C)<500),u=E(h(o.account.navInfo)),O=h(q()?[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,"WebID",o.account.devices,o.account.navLogout]:[o.account.navInfo,o.account.navEdit,o.common.password,o.account.navMfa,o.account.devices,o.account.navLogout]);sa(()=>{Pr("v").get()==="devices"&&n(u,h(o.account.devices))}),Qe(()=>{e(u)===o.account.navLogout&&rr()});var K=xt(),L=j(K);Cr(L,{id:tr,get value(){return e($)},set value(D){n($,h(D))}});var J=v(L,2),ae=r(J);{var ie=D=>{var F=kt(),Y=j(F),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);_a(ne,{get tabs(){return O},get selected(){return e(u)},set selected(c){n(u,h(c))}});var Z=v(ne,2),g=r(Z);{var m=c=>{Ea(c,{get providers(){return e($)},get authProvider(){return e(d)},viewModePhone:!0,get webIdData(){return q()},get user(){return t()},set user(U){t(U)}})},P=c=>{var U=ge(),te=j(U);{var ue=W=>{qa(W,{viewModePhone:!0,get user(){return t()},set user(T){t(T)}})},f=W=>{var T=ge(),M=j(T);{var A=S=>{Ma(S,{get user(){return t()},get authProvider(){return e(d)},viewModePhone:!0})},Q=S=>{var de=ge(),se=j(de);{var ye=x=>{La(x,{get user(){return t()}})},V=x=>{var b=ge(),N=j(b);{var R=_=>{Ta(_,{get webIdData(){return q()},set webIdData(X){q(X)}})},pe=_=>{var X=ge(),oe=j(X);{var _e=Ie=>{Na(Ie,{viewMode:"account"})};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,X)};k(N,_=>{e(u)==="WebID"?_(R):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(V,!1)},!0)}i(S,de)};k(M,S=>{e(u)===o.common.password?S(A):S(Q,!1)},!0)}i(W,T)};k(te,W=>{e(u)===o.account.navEdit?W(ue):W(f,!1)},!0)}i(c,U)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(Z),a(ve),i(D,F)},z=D=>{var F=$t(),Y=j(F),le=r(Y);s(le),a(Y);var ve=v(Y,2),ne=r(ve);_a(ne,{get tabs(){return O},center:!0,get selected(){return e(u)},set selected(c){n(u,h(c))}});var Z=v(ne,2),g=r(Z);{var m=c=>{Ea(c,{get webIdData(){return q()},get providers(){return e($)},get authProvider(){return e(d)},get user(){return t()},set user(U){t(U)}})},P=c=>{var U=ge(),te=j(U);{var ue=W=>{qa(W,{get user(){return t()},set user(T){t(T)}})},f=W=>{var T=ge(),M=j(T);{var A=S=>{Ma(S,{get user(){return t()},get authProvider(){return e(d)}})},Q=S=>{var de=ge(),se=j(de);{var ye=x=>{La(x,{get user(){return t()}})},V=x=>{var b=ge(),N=j(b);{var R=_=>{Ta(_,{get webIdData(){return q()},set webIdData(X){q(X)}})},pe=_=>{var X=ge(),oe=j(X);{var _e=Ie=>{yt(Ie)};k(oe,Ie=>{e(u)===o.account.devices&&Ie(_e)},!0)}i(_,X)};k(N,_=>{e(u)==="WebID"?_(R):_(pe,!1)},!0)}i(x,b)};k(se,x=>{e(u)===o.account.navMfa?x(ye):x(V,!1)},!0)}i(S,de)};k(M,S=>{e(u)===o.common.password?S(A):S(Q,!1)},!0)}i(W,T)};k(te,W=>{e(u)===o.account.navEdit?W(ue):W(f,!1)},!0)}i(c,U)};k(g,c=>{e(u)===o.account.navInfo?c(m):c(P,!1)})}a(Z),a(ve),i(D,F)};k(ae,D=>{e(w)?D(ie):D(z,!1)})}a(J),Ya("innerWidth",D=>n(C,h(D))),i(ee,K),qe()}var It=I("<!> <!> <!>",1);function Ct(ee,p){Ee(p,!0);let s=Ae(),t=za("account"),q=E(void 0),o=E(void 0),C=E(!1);Qe(()=>{let d=t.get();d&&$(d)});async function $(d){const w=d.user_id;if(w){let u=await Promise.all([Ze(`/auth/v1/users/${w}`),Ze(`/auth/v1/users/${w}/webid/data`)]);u[0].body?n(q,h(u[0].body)):sr("account"),u[1].body?n(o,h(u[1].body)):u[1].status===404&&n(o,h({user_id:w,expose_email:!1})),n(C,!0)}else console.error("no user_id in session")}Xa(d=>{y(()=>{var w;return Ra.title=`${((s==null?void 0:s.account.account)||"Account")??""} ${((w=e(q))==null?void 0:w.email)??""}`})}),zr(ee,{children:(d,w)=>{Dr(d,{children:(u,O)=>{var K=It(),L=j(K);{var J=z=>{_t(z,{get user(){return e(q)},set user(D){n(q,h(D))},get webIdData(){return e(o)},set webIdData(D){n(o,h(D))}})};k(L,z=>{e(C)&&t&&e(q)&&z(J)})}var ae=v(L,2);Nr(ae,{absolute:!0});var ie=v(ae,2);Er(ie,{absolute:!0}),i(u,K)},$$slots:{default:!0}})},$$slots:{default:!0}}),qe()}export{Ct as component};
