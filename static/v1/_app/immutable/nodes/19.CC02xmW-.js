import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DvmPJwhI.js";import{p as W,a6 as Y,l as e,f as R,m as n,s as q,t as x,a as j,o as y,c as L,ar as H,r as M,ab as J,ap as ae}from"../chunks/index-client.Ds4XgiuL.js";import{s as B}from"../chunks/render.Bq2-eTRf.js";import{i as D}from"../chunks/if.Du7BDhAX.js";import{e as se}from"../chunks/each.MnMr4iw5.js";import{d as K,a as m,t as w,e as X}from"../chunks/template.DXIK6jcH.js";import{a as ne}from"../chunks/index.L0FyJ7Re.js";import{p as i}from"../chunks/proxy.CB6KOiNf.js";import{u as Q}from"../chunks/i18n_admin.svelte.B9VY-ZfA.js";import{B as ie}from"../chunks/ButtonAddModal.mDcrP-vd.js";import{C as le}from"../chunks/ContentAdmin.COLOikfe.js";import{N as me}from"../chunks/NavButtonTile.ClPY4kTr.js";import{N as de}from"../chunks/NavSub.9PtxGldh.js";import{O as ve}from"../chunks/OrderSearchBar.LuMLhfeB.js";import{b as ue,d as ce,c as fe,f as pe}from"../chunks/fetch.DFmyLr06.js";import{u as ge}from"../chunks/param.svelte.D0F_0zrI.js";import{B as V}from"../chunks/Button.nDjAKZm4.js";import{I as Z}from"../chunks/pow.C3ENfqN0.js";import{e as ee}from"../chunks/patterns.D9HtGhEC.js";import{F as re}from"../chunks/Form.JHjwURkX.js";import{u as U}from"../chunks/i18n.svelte.CgUwCKxn.js";import{T as he}from"../chunks/Tabs.Cqg7xZCh.js";import{h as oe}from"../chunks/html.CbFxqVHf.js";import{I as be}from"../chunks/IconCheck.CzEyprnz.js";import{L as $e}from"../chunks/LabeledValue.CfdJ335t.js";var ye=w('<div class="err"> </div>'),we=w("<!> <!> <!>",1),Ce=w('<div class="container svelte-s1196z"><!></div>');function Se(A,t){W(t,!0);let E=U(),p=Q(),v=y(void 0),s=y(""),g=y("");Y(()=>{requestAnimationFrame(()=>{var c;(c=e(v))==null||c.focus()})});async function h(c,f){var b;if(t.roles.find(O=>O.name===e(g))){n(s,i(p.common.nameExistsAlready));return}n(s,"");let d={role:e(g)},o=await ue(c.action,d);o.body?t.onSave(o.body.id):n(s,i(((b=o.error)==null?void 0:b.message)||"Error"))}var $=Ce(),F=L($);re(F,{action:"/auth/v1/roles",onSubmit:h,children:(c,f)=>{var d=we(),o=R(d);Z(o,{autocomplete:"off",get label(){return p.roles.name},get placeholder(){return p.roles.name},required:!0,pattern:ee,get ref(){return e(v)},set ref(u){n(v,i(u))},get value(){return e(g)},set value(u){n(g,i(u))}});var b=q(o,2);V(b,{type:"submit",children:(u,C)=>{H();var _=K();x(()=>B(_,E.common.save)),m(u,_)},$$slots:{default:!0}});var O=q(b,2);{var k=u=>{var C=ye(),_=L(C,!0);M(C),x(()=>B(_,e(s))),m(u,C)};D(O,u=>{e(s)&&u(k)})}m(c,d)},$$slots:{default:!0}}),M($),m(A,$),j()}var Ie=w("<p><!></p>"),Ne=w('<div class="flex gap-05"><!> <!></div>'),Oe=w('<div class="err"> </div>'),_e=w("<!> <!> <!> <!>",1);function qe(A,t){W(t,!0);let E=U(),p=Q(),v=y(""),s=y(!1),g=J(()=>t.role.name==="rauthy_admin"),h=y(i(t.role.name));Y(()=>{t.role.id&&n(h,i(t.role.name))});async function $(c,f){if(n(v,""),e(h)!==t.role.name&&t.roles.find(b=>b.name===e(h))){n(v,i(p.common.nameExistsAlready));return}let d={role:e(h)},o=await ce(c.action,d);o.error?n(v,i(o.error.message)):(n(s,!0),t.onSave(),setTimeout(()=>{n(s,!1)},2e3))}var F=J(()=>`/auth/v1/roles/${t.role.id}`);re(A,{get action(){return e(F)},onSubmit:$,children:(c,f)=>{var d=_e(),o=R(d);$e(o,{label:"ID",mono:!0,children:(r,a)=>{H();var l=K();x(()=>B(l,t.role.id)),m(r,l)},$$slots:{default:!0}});var b=q(o,2);Z(b,{autocomplete:"off",get label(){return p.scopes.name},get placeholder(){return p.scopes.name},get disabled(){return e(g)},width:"14.5rem",required:!0,pattern:ee,get value(){return e(h)},set value(r){n(h,i(r))}});var O=q(b,2);{var k=r=>{var a=Ie(),l=L(a);oe(l,()=>p.roles.adminNoMod),M(a),m(r,a)},u=r=>{var a=Ne(),l=L(a);V(l,{type:"submit",children:(N,T)=>{H();var z=K();x(()=>B(z,E.common.save)),m(N,z)},$$slots:{default:!0}});var S=q(l,2);{var I=N=>{be(N,{})};D(S,N=>{e(s)&&N(I)})}M(a),m(r,a)};D(O,r=>{e(g)?r(k):r(u,!1)})}var C=q(O,2);{var _=r=>{var a=Oe(),l=L(a,!0);M(a),x(()=>B(l,e(v))),m(r,a)};D(C,r=>{e(v)&&r(_)})}m(c,d)},$$slots:{default:!0}}),j()}var Fe=w("<p><!></p>"),Te=w('<div class="err"> </div>'),Ae=w("<p> </p> <!> <!>",1);function Ee(A,t){W(t,!0);let E=U(),p=Q(),v=y(""),s=J(()=>t.role.name==="rauthy_admin");async function g(){n(v,"");let f=await fe(`/auth/v1/roles/${t.role.id}`);f.error?n(v,i(f.error.message)):t.onSave()}var h=X(),$=R(h);{var F=f=>{var d=Fe(),o=L(d);oe(o,()=>p.roles.adminNoMod),M(d),m(f,d)},c=f=>{var d=Ae(),o=R(d),b=L(o,!0);M(o);var O=q(o,2);V(O,{level:-1,onclick:g,children:(C,_)=>{H();var r=K();x(()=>B(r,E.common.delete)),m(C,r)},$$slots:{default:!0}});var k=q(O,2);{var u=C=>{var _=Te(),r=L(_,!0);M(_),x(()=>B(r,e(v))),m(C,_)};D(k,C=>{e(v)&&C(u)})}x(()=>B(b,p.roles.delete1)),m(f,d)};D($,f=>{e(s)?f(F):f(c,!1)})}m(A,h),j()}var Le=w('<div class="flex"><!></div> <!>',1);function Me(A,t){W(t,!0);let E=U(),p=Q();const v=[p.nav.config,E.common.delete];let s=y(i(v[0])),g=y(void 0);Y(()=>{t.role.id&&requestAnimationFrame(()=>{var o;(o=e(g))==null||o()})});var h=Le(),$=R(h),F=L($);he(F,{tabs:v,get selected(){return e(s)},set selected(o){n(s,i(o))},get focusFirst(){return e(g)},set focusFirst(o){n(g,i(o))}}),M($);var c=q($,2);{var f=o=>{qe(o,{get role(){return t.role},get roles(){return t.roles},get onSave(){return t.onSave}})},d=o=>{var b=X(),O=R(b);{var k=u=>{Ee(u,{get role(){return t.role},get onSave(){return t.onSave}})};D(O,u=>{e(s)===E.common.delete&&u(k)},!0)}m(o,b)};D(c,o=>{e(s)===p.nav.config?o(f):o(d,!1)})}m(A,h),j()}var Re=w("<div></div> <!>",1),xe=w("<!> <!>",1),Be=w('<div class="err"> </div>'),De=w('<!> <div id="groups"><!></div>',1),ke=w("<!> <!>",1);function Ge(A,t){W(t,!0);let E=Q(),p=y(void 0),v=y(""),s=y(i([])),g=y(i([])),h=y(void 0),$=ge("rid");const F=[E.common.name,"ID"];let c=y(i(F[0])),f=y("");const d=[E.common.name,"ID"];ae(()=>{o()}),Y(()=>{n(h,i(e(s).find(r=>r.id===$.get())))}),Y(()=>{let r=e(f).toLowerCase();r?e(c)===F[0]?n(g,i(e(s).filter(a=>{var l;return(l=a.name)==null?void 0:l.toLowerCase().includes(r)}))):e(c)===F[1]&&n(g,i(e(s).filter(a=>a.id.toLowerCase().includes(r)))):n(g,i(e(s)))});async function o(){var a;let r=await pe("/auth/v1/roles");r.body?n(s,i(r.body)):n(v,i(((a=r.error)==null?void 0:a.message)||"Error"))}function b(r,a){let l=a==="up";r===d[0]?e(s).sort((S,I)=>l?S.name.localeCompare(I.name):I.name.localeCompare(S.name)):r===d[1]&&e(s).sort((S,I)=>l?S.id.localeCompare(I.id):I.id.localeCompare(S.id))}function O(){o()}async function k(r){var a;(a=e(p))==null||a(),await o(),$.set(r)}var u=ke(),C=R(u);de(C,{paddingTop:"2.1rem",buttonTilesAriaControls:"groups",width:"min(20rem, 100dvw)",thresholdNavSub:700,buttonTiles:r=>{var a=Re(),l=R(a);ne(l,"height",".5rem");var S=q(l,2);se(S,17,()=>e(g),I=>I.id,(I,N)=>{var T=J(()=>$.get()===e(N).id);me(I,{onclick:()=>$.set(e(N).id),get selected(){return e(T)},children:(z,G)=>{H();var P=K();x(()=>B(P,e(N).name)),m(z,P)},$$slots:{default:!0}})}),m(r,a)},children:(r,a)=>{var l=xe(),S=R(l),I=J(()=>e(s).length===0?1:2);ie(S,{get level(){return e(I)},alignRight:!0,get closeModal(){return e(p)},set closeModal(T){n(p,i(T))},children:(T,z)=>{Se(T,{onSave:k,get roles(){return e(s)}})},$$slots:{default:!0}});var N=q(S,2);ve(N,{searchOptions:F,orderOptions:d,onChangeOrder:b,searchWidth:"min(19.5rem, 100dvw - .5rem)",get searchOption(){return e(c)},set searchOption(T){n(c,i(T))},get value(){return e(f)},set value(T){n(f,i(T))}}),m(r,l)},$$slots:{buttonTiles:!0,default:!0}});var _=q(C,2);le(_,{children:(r,a)=>{var l=De(),S=R(l);{var I=G=>{var P=Be(),te=L(P,!0);M(P),x(()=>B(te,e(v))),m(G,P)};D(S,G=>{e(v)&&G(I)})}var N=q(S,2),T=L(N);{var z=G=>{Me(G,{get role(){return e(h)},get roles(){return e(s)},onSave:O})};D(T,G=>{e(h)&&G(z)})}M(N),m(r,l)},$$slots:{default:!0}}),m(A,u),j()}function ze(A){Ge(A,{})}export{ze as component};
