import{a as c,b as k,t as W,c as ve}from"../chunks/disclose-version.DZhRUPAc.js";import{p as ye,_ as f,o as ne,a as Ae,j as t,a2 as n,$ as je,a0 as D,g as s,a1 as l,a3 as r,a5 as o,a4 as _}from"../chunks/index-client.CGppiJvc.js";import{h as Ie,s as d}from"../chunks/render.D4MwAWTL.js";import{i as q}from"../chunks/if.DUA6Hpfn.js";import{e as be,i as Ee}from"../chunks/OptionSelect.BCgZksOM.js";import{p as i}from"../chunks/proxy.DB4Km9hY.js";import{r as Ne}from"../chunks/legacy-client.CgqodnwN.js";import{g as Se,k as Te,r as le,l as Be,p as De,m as Me}from"../chunks/dataFetching.Dto1xJW6.js";import{L as ze}from"../chunks/Loading.wZ55XKP1.js";import{L as Fe}from"../chunks/LangSelector.mSh8cV6Q.js";import{c as He,a as Oe,I as Re}from"../chunks/Input.Bj_i2TLU.js";import{B as X}from"../chunks/Button.BH2_dPry.js";import{f as Ue}from"../chunks/pow.r0U0E3f9.js";import{M as We,C as _e}from"../chunks/ContentCenter.CsjyBf2d.js";import{u as qe}from"../chunks/i18n.svelte.BTGsPiz_.js";var Ge=k('<div class="desc svelte-19xxeot"> </div> <!> <!>',1),Je=k('<div class="desc svelte-19xxeot"><p> </p> <p> </p></div>'),Ke=k('<div class="desc svelte-19xxeot"><p class="declined svelte-19xxeot"> </p> <p> </p></div>'),Pe=k("<li> </li>"),Qe=k('<div class="desc svelte-19xxeot"> <ul></ul></div> <div class="inline svelte-19xxeot"><!> <!></div>',1),Ve=k('<div class="container svelte-19xxeot"><div class="name svelte-19xxeot"><h2> </h2></div> <!> <div class="err svelte-19xxeot"> </div></div>'),Xe=k("<!> <!>",1);function Ye(ue,me){ye(me,!0);const Y="8rem";let e=qe(),Z=f(void 0),M=f(""),I=f(8),x=f(!1),ee=!1,G=f(void 0),se=f(!1),ae=f(!1),b=i({userCode:""}),z=f(i({userCode:""})),te=f(i({}));Ne(()=>{e&&s(I)&&t(te,i(He().shape({userCode:Oe().trim().min(s(I),e.common.errTooShort).max(s(I),e.common.errTooLong).matches(Be,e.common.invalidInput)})))}),ne(()=>{t(I,i(Number.parseInt(window.document.getElementsByName("rauthy-data")[0].id)))}),ne(async()=>{const v=Se();v.code&&(b.userCode=v.code);let E=await Te();E.ok?t(Z,i(await E.json())):v.code?le(`device?code=${v.code}`):le("device")});function pe(){ee&&oe()}async function F(v){var N;if(t(M,""),ee=!0,!await oe())return;t(x,!0);let E=await Ue(),J={user_code:b.userCode,pow:E,device_accepted:v};const w=await De(J);if(w.status===200){const g=await w.json();console.log(g),t(G,i(((N=g.scopes)==null?void 0:N.split(" "))||["openid"]))}else if(w.status===202)t(se,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3);else if(w.status===204)t(ae,!0);else if(w.status===404)t(M,i(e.device.wrongOrExpired));else{const g=await w.json();t(M,i(g.message))}t(x,!1)}async function oe(){try{return await s(te).validate(b,{abortEarly:!1}),t(z,i({userCode:""})),!0}catch(v){return t(z,i(Me(v))),!1}}Ie(v=>{n(()=>je.title=(e==null?void 0:e.device.title)||"Device Authorization")}),We(ue,{children:(v,E)=>{_e(v,{children:(J,w)=>{var N=Xe(),g=D(N);{var fe=y=>{ze(y,{})},xe=y=>{var K=Ve(),P=r(K),re=r(P),he=r(re,!0);o(re),o(P);var ie=l(P,2);{var we=A=>{var S=Ge(),T=D(S),Q=r(T,!0);n(()=>d(Q,e.device.desc.replaceAll("{{count}}",s(I)))),o(T);var H=l(T,2);Re(H,{name:"userCode",autocomplete:"off",get placeholder(){return e.device.userCode},get value(){return b.userCode},set value(a){b.userCode=a},get error(){return s(z).userCode},set error(a){s(z).userCode=a},$$events:{enter:F,input:pe},children:(a,C)=>{_();var u=W();n(()=>d(u,e.device.userCode.toUpperCase())),c(a,u)},$$slots:{default:!0}});var $=l(H,2);X($,{get isLoading(){return s(x)},set isLoading(a){t(x,i(a))},$$events:{click:()=>F("pending")},children:(a,C)=>{_();var u=W();n(()=>d(u,e.device.submit)),c(a,u)},$$slots:{default:!0}}),c(A,S)},ge=A=>{var S=ve(),T=D(S);{var Q=$=>{var a=Je(),C=r(a),u=r(C,!0);o(C);var O=l(C,2),h=r(O,!0);o(O),o(a),n(()=>{d(u,e.device.isAccepted),d(h,e.device.autoRedirectAccount)}),c($,a)},H=$=>{var a=ve(),C=D(a);{var u=h=>{var j=Ke(),L=r(j),R=r(L,!0);o(L);var B=l(L,2),U=r(B,!0);o(B),o(j),n(()=>{d(R,e.device.isDeclined),d(U,e.device.closeWindow)}),c(h,j)},O=h=>{var j=Qe(),L=D(j),R=r(L),B=l(R);be(B,21,()=>s(G),Ee,(m,V)=>{var p=Pe(),ke=r(p,!0);o(p),n(()=>d(ke,s(V))),c(m,p)}),o(B),o(L);var U=l(L,2),de=r(U);X(de,{level:1,width:Y,get isLoading(){return s(x)},set isLoading(m){t(x,i(m))},$$events:{click:()=>F("accept")},children:(m,V)=>{_();var p=W();n(()=>d(p,e.device.accept)),c(m,p)},$$slots:{default:!0}});var Le=l(de,2);X(Le,{level:3,width:Y,get isLoading(){return s(x)},set isLoading(m){t(x,i(m))},$$events:{click:()=>F("decline")},children:(m,V)=>{_();var p=W();n(()=>d(p,e.device.decline)),c(m,p)},$$slots:{default:!0}}),o(U),n(()=>d(R,`${e.device.descScopes??""} `)),c(h,j)};q(C,h=>{s(ae)?h(u):h(O,!1)},!0)}c($,a)};q(T,$=>{s(se)?$(Q):$(H,!1)},!0)}c(A,S)};q(ie,A=>{s(G)===void 0?A(we):A(ge,!1)})}var ce=l(ie,2),Ce=r(ce,!0);o(ce),o(K),n(()=>{d(he,e.device.title),d(Ce,s(M))}),c(y,K)};q(g,y=>{s(Z)?y(xe,!1):y(fe)})}var $e=l(g,2);Fe($e,{absolute:!0}),c(J,N)},$$slots:{default:!0}})},$$slots:{default:!0}}),Ae()}export{Ye as component};
