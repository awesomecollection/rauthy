import{a as o,t as c,e as ne,d as ce}from"../chunks/disclose-version.BP4T4xdV.js";import{f as E,p as ue,a as ve,t as u,a6 as de,j as i,k as s,s as r,l as I,a9 as ge,c as v,r as d,a7 as pe}from"../chunks/index-client.hxMyB_b4.js";import{h as fe,s as m}from"../chunks/render.yNX9q8-B.js";import{i as M}from"../chunks/if.BeBa1Kxb.js";import{r as he,b as be}from"../chunks/class.CF2J4YCf.js";import{p as j}from"../chunks/proxy.DaVNR9vk.js";import{B as we}from"../chunks/Button.BR1gOfNn.js";import{w as _e}from"../chunks/helpers.CchIKxjM.js";import{I as B}from"../chunks/pow.BMnvYon0.js";import{L as $e}from"../chunks/LangSelector.Bl8L6Wq4.js";import{M as ye}from"../chunks/Main.Rc9oYaw1.js";import{C as Ne}from"../chunks/ContentCenter.lHeEkgTE.js";import{u as Te}from"../chunks/i18n.svelte.Ci9wvqOq.js";import{T as Ee}from"../chunks/Template.Ih924_PB.js";import{u as xe}from"../chunks/param.svelte.BbzO27-O.js";import{T as Ce}from"../chunks/ThemeSwitch.DTJa252X.js";import{F as Ie}from"../chunks/Form.BnvI_UPN.js";import{u as Me}from"../chunks/is_dev.svelte.CWG7yUVe.js";import{b as K}from"../chunks/patterns.BRCxk8by.js";import{b as Re}from"../chunks/fetch.Bq59EV_b.js";var ke=c(" <br> <code> </code>",1),Ae=c('<input type="hidden" name="redirect_uri">'),Le=c('<div class="success svelte-cul8ah"> <br> </div>'),qe=c('<div class="err svelte-cul8ah"> </div>'),Pe=c('<!> <!> <!> <!> <div class="submit svelte-cul8ah"><!></div> <!>',1),Se=c('<div class="container svelte-cul8ah"><div class="domainTxt svelte-cul8ah"><h1> </h1> <!></div> <!></div> <!> <!>',1),Ue=c("<!> <!>",1);function je(O,V){ve(V,!0);let e=Te(),X=Me(),g=I(""),D=xe("redirect_uri"),R=I(!1),l=I(""),k=I(!1),Y=ge(()=>X.get()?"/auth/v1/dev/register":"/auth/v1/users/register");async function Z(p,f){s(k,!1),s(l,"");let _=f.get("email"),A=f.get("given_name"),$=f.get("pow");if(!_||!A||!$){console.error("email, given_name, pow missing");return}if(i(g)&&!_.endsWith(i(g))){s(l,j(e.register.domainErr));return}let h={email:_,given_name:A,family_name:f.get("family_name")||void 0,pow:$,redirect_uri:f.get("redirect_uri")||void 0};s(R,!0);const b=await Re(p.action,h);if(b.error){let w=b.error.message||"Error";w.includes("UNIQUE constraint")?s(l,"E-Mail is already registered"):s(l,j(w))}else s(l,""),s(k,!0),setTimeout(()=>{window.location.replace(h.redirect_uri||"/auth/v1/account")},3e3);s(R,!1)}var F=Ue();fe(p=>{u(()=>de.title=(e==null?void 0:e.register)||"Register")});var Q=E(F);Ee(Q,{id:_e,get value(){return i(g)},set value(p){s(g,j(p))}});var H=r(Q,2);ye(H,{children:(p,f)=>{Ne(p,{children:(_,A)=>{var $=Se(),h=E($),b=v(h),w=v(b),J=v(w,!0);d(w);var ee=r(w,2);{var re=y=>{var L=ke(),N=E(L,!0),T=r(N,2),x=r(T),C=v(x);d(x),u(()=>{m(N,e.register.domainRestricted),m(T,` ${e.register.domainAllowed??""} `),m(C,`@${i(g)??""}`)}),o(y,L)};M(ee,y=>{i(g)&&y(re)})}d(b);var ae=r(b,2);Ie(ae,{get action(){return i(Y)},onSubmit:Z,withPowAs:"pow",children:(y,L)=>{var N=Pe(),T=E(N);{var x=a=>{var t=Ae();he(t),u(()=>be(t,D.get())),o(a,t)};M(T,a=>{D.get()&&a(x)})}var C=r(T,2);B(C,{typ:"email",name:"email",autocomplete:"email",get label(){return e.common.email},get placeholder(){return e.common.email},required:!0});var z=r(C,2);B(z,{name:"given_name",autocomplete:"given-name",get label(){return e.account.givenName},get placeholder(){return e.account.givenName},pattern:K,required:!0});var G=r(z,2);B(G,{name:"family_name",autocomplete:"family-name",get label(){return e.account.familyName},get placeholder(){return e.account.familyName},pattern:K});var q=r(G,2),ie=v(q);we(ie,{type:"submit",get isLoading(){return i(R)},children:(a,t)=>{pe();var n=ne();u(()=>m(n,e.register.register)),o(a,n)},$$slots:{default:!0}}),d(q);var se=r(q,2);{var oe=a=>{var t=Le(),n=v(t,!0),P=r(n,2);d(t),u(()=>{m(n,e.register.success),m(P,` ${e.register.emailCheck??""}`)}),o(a,t)},me=a=>{var t=ce(),n=E(t);{var P=S=>{var U=qe(),le=v(U,!0);d(U),u(()=>m(le,i(l))),o(S,U)};M(n,S=>{i(l)&&S(P)},!0)}o(a,t)};M(se,a=>{i(k)?a(oe):a(me,!1)})}o(y,N)},$$slots:{default:!0}}),d(h);var W=r(h,2);Ce(W,{absolute:!0});var te=r(W,2);$e(te,{absolute:!0}),u(()=>m(J,e.register.userReg)),o(_,$)},$$slots:{default:!0}})},$$slots:{default:!0}}),o(O,F),ue()}export{je as component};
