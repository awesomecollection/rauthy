import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.CyS2OsSI.js";import{a6 as w,p as wa,ad as o,ae as I,af as ja,a4 as K,a as _a,$ as ya,g as e,j as a,a5 as c,a7 as g,a9 as d,ag as L,a8 as re,aa as ba,ah as Ve}from"../chunks/index-client.Bsb9hq-M.js";import{s as z,e as He}from"../chunks/render.Cl_nSOQQ.js";import{i as j}from"../chunks/if.Mw_hWmq0.js";import{T as ka,e as xa}from"../chunks/ThemeSwitch.Zeh_8WtX.js";import{a as l,n as Ma,t as p,b as se,c as Oe}from"../chunks/template.D54H5ZkF.js";import{h as za}from"../chunks/svelte-head.YbFS2hoE.js";import{a as B,b as Ca,d as La}from"../chunks/index.DiuQmtU3.js";import{i as Ta}from"../chunks/lifecycle.p6g1zolU.js";import{h as Ea,p as Pa,i as Je,j as Ua}from"../chunks/dataFetching.D_YOETHp.js";import{I as Aa,c as Ba,a as qa,y as Da}from"../chunks/Input.BHI3aq7I.js";import{z as Fa,A as Na,B as Ra,l as Sa,D as Wa,T as Ga,k as Ke,E as Ia,_ as Va,P as Ha,F as Oa,b as Xe}from"../chunks/helpers.Cfg4Q1a_.js";import{B as ce}from"../chunks/Button.BbZR8hhL.js";import{W as Ja}from"../chunks/WebauthnRequest.CFGMqx9K.js";import{P as Ka}from"../chunks/PasswordInput.B_ynErOb.js";import{L as Xa}from"../chunks/LangSelector.4aRmjdrU.js";import{p as xe}from"../chunks/props.CcMnSFiY.js";import{M as Ya,C as Za}from"../chunks/ContentCenter.Dpb8rCa1.js";import{u as Qa}from"../chunks/i18n.svelte.B0RF3bDg.js";import{T as X}from"../chunks/Template.CCszvfWi.js";import{u as q}from"../chunks/param.svelte.CjFurolb.js";var et=Ma('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>');function at(ne,Y){let n=xe(Y,"color",3,"var(--col-text)"),y=xe(Y,"opacity",3,.9),V=xe(Y,"width",3,24);var f=et();B(f,"stroke-width",2),w(()=>{B(f,"width",V()),B(f,"color",n()),B(f,"opacity",y())}),l(ne,f)}var tt=p('<img alt="No Logo Available">'),rt=p('<a class="home svelte-1ljcjf3"><!></a>'),st=p('<div role="button" tabindex="0" class="forgotten svelte-1ljcjf3"> </div>'),it=p("<!> <!>",1),lt=p('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),ot=p('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),ct=p("<!> <!> <!>",1),nt=p('<div class="flex-inline svelte-1ljcjf3"><img alt="" width="20" height="20"> <span class="providerName svelte-1ljcjf3"> </span></div>'),vt=p('<div class="providers flex-col svelte-1ljcjf3"></div>'),dt=p('<div class="errMsg errMsgApi svelte-1ljcjf3"> </div>'),ut=p('<div class="success svelte-1ljcjf3"> </div>'),mt=p('<a class="reg svelte-1ljcjf3" target="_blank"> </a>'),gt=p('<a class="reg svelte-1ljcjf3" href="/auth/v1/users/register" target="_blank"> </a>'),pt=p('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),ft=p('<div class="container svelte-1ljcjf3"><div class="head svelte-1ljcjf3"><div class="logo svelte-1ljcjf3"><!></div> <!></div> <div class="name svelte-1ljcjf3"><h2> </h2></div> <!> <!> <!> <!> <!> <!> <!></div> <!> <!>',1),ht=p("<!> <!> <!> <!> <!> <!> <!>",1);function $t(ne,Y){var qe;wa(Y,!1);let n=Qa(),y=q("client_id").get(),V=o(""),f=o(""),H=q("redirect_uri").get(),ve=q("nonce").get(),de=((qe=q("scopes").get())==null?void 0:qe.split(" "))||[],Z=o(),ue=q("state").get(),me=q("code_challenge").get(),ge=q("code_challenge_method").get(),pe=o(!1),O=o(),ie=o([]),Q=o(),D=o(!1),b=o(""),F=o(""),ee=o(""),N=o(!1),R=o(!1),le=o(!1),oe=o(!1),ae=o(!1),S=o(!1),Me="",fe=o(!1),i=o({email:q("login_hint").get()||"",password:""}),k=o({}),he=o({});function ze(){a(b,""),a(le,!0),L(i,e(i).password="")}async function $e(){a(b,"");try{await e(he).validate(e(i),{abortEarly:!1}),a(k,{})}catch(_){a(k,Ke(_));return}const t={email:e(i).email,client_id:y,redirect_uri:H,state:ue,code_challenge:me,code_challenge_method:ge,nonce:ve,scopes:de};if(e(N)&&e(i).email!==e(O)){if(!e(i).password){L(k,e(k).password=n.passwordRequired);return}if(e(i).password.length>256){L(k,e(k).password="max 256");return}t.password=e(i).password}a(D,!0);let h=await Ea(t);await Ce(h)}async function Ce(t){if(t.status===202)window.location.replace(t.headers.get("location"));else if(t.status===200)a(b,""),a(Q,await t.json());else if(t.status===406)a(b,n.authorize.clientForceMfa),a(R,!0);else if(t.status===429){let h=Number.parseInt(t.headers.get("x-retry-not-before")),_=Ia(h),T=h*1e3-new Date().getTime();a(S,!0),a(b,`${n.authorize.http429} ${_}`),L(i,e(i).email=""),L(i,e(i).password=""),a(N,!1),setTimeout(()=>{a(S,!1),a(b,"")},T)}else e(N)?(a(b,n.authorize.invalidCredentials),a(oe,!0)):(a(N,!0),Me=e(i).email);a(D,!1)}function Ye(){e(N)&&Me!==e(i).email&&(a(N,!1),L(i,e(i).password=""),a(b,""))}function Ze(t){Va(64,(h,{challenge:_,verifier:T})=>{h||(localStorage.setItem(Ha,T),Qe(t,_))})}async function Qe(t,h){let _={email:e(i).email||null,client_id:y,redirect_uri:H,scopes:de,state:ue,nonce:ve,code_challenge:me,code_challenge_method:ge,provider_id:t,pkce_challenge:h},T=await Pa(_);if(T.ok){const J=await T.text();Oa(J),window.location.href=T.headers.get("location")}else{let J=await T.json();a(b,J.message)}}function ea(){a(Q,void 0)}function aa(t){t&&window.location.replace(t.loc)}async function ta(){try{await e(he).validate(e(i),{abortEarly:!1}),a(k,{})}catch(_){a(k,Ke(_));return}let t={email:e(i).email};e(f)&&(t.redirect_uri=encodeURI(e(f))),a(D,!0);let h=await Ua(t);if(h.ok)a(ae,!0);else{let _=await h.json();a(b,_.message)}a(D,!1)}I(()=>Da,()=>{n&&a(he,Ba().shape({email:qa().required(n.authorize.emailRequired).email(n.authorize.emailBadFormat)}))}),I(()=>e(F),()=>{var t;e(F)&&(e(F)==="Refresh"?a(pe,!0):(t=e(F))!=null&&t.startsWith("MfaLogin ")&&a(O,e(F).replace("MfaLogin ","")))}),I(()=>(e(pe),Je),()=>{if(e(pe)&&(y==null?void 0:y.length)>0&&(H==null?void 0:H.length)>0){a(D,!0);const t={client_id:y,redirect_uri:H,state:ue,code_challenge:me,code_challenge_method:ge,nonce:ve,scopes:de};ba().then(()=>Je(t).then(h=>Ce(h)))}}),I(()=>e(O),()=>{e(O)&&L(i,e(i).email=e(O))}),I(()=>e(ae),()=>{e(ae)&&setTimeout(()=>{a(ae,!1),a(le,!1),a(oe,!1)},3e3)}),I(()=>e(Z),()=>{e(Z)&&e(Z).focus()}),I(()=>(e(ee),Xe),()=>{e(ee)&&Xe(e(ee))}),ja(),Ta();var Le=ht();za(t=>{w(()=>ya.title=`Login ${(e(V)||y)??""}`)});var Te=K(Le);X(Te,{id:Fa,get value(){return e(ie)},set value(t){a(ie,t)},$$legacy:!0});var Ee=c(Te,2);X(Ee,{id:Na,get value(){return e(V)},set value(t){a(V,t)},$$legacy:!0});var Pe=c(Ee,2);X(Pe,{id:Ra,get value(){return e(f)},set value(t){a(f,t)},$$legacy:!0});var Ue=c(Pe,2);X(Ue,{id:Sa,get value(){return e(ee)},set value(t){a(ee,t)},$$legacy:!0});var Ae=c(Ue,2);X(Ae,{id:Wa,get value(){return e(F)},set value(t){a(F,t)},$$legacy:!0});var Be=c(Ae,2);X(Be,{id:Ga,get value(){return e(fe)},set value(t){a(fe,t)},$$legacy:!0});var ra=c(Be,2);Ya(ra,{children:(t,h)=>{Za(t,{children:(_,T)=>{var J=ft(),we=K(J),je=g(we),_e=g(je),sa=g(_e);{var ia=r=>{var s=tt();B(s,"src",`/auth/v1/clients/${y}/logo`),l(r,s)};j(sa,r=>{y&&r(ia)})}d(_e);var la=c(_e,2);{var oa=r=>{var s=rt(),u=g(s);at(u,{opacity:.5}),d(s),w(()=>B(s,"href",e(f))),l(r,s)};j(la,r=>{e(f)&&r(oa)})}d(je);var ye=c(je,2),De=g(ye),ca=g(De,!0);d(De),d(ye);var Fe=c(ye,2);{var na=r=>{Ja(r,{t:n,onSuccess:aa,onError:ea,get data(){return e(Q)},set data(s){a(Q,s)},$$legacy:!0})};j(Fe,r=>{e(Q)&&r(na)})}var Ne=c(Fe,2);{var va=r=>{var s=ct(),u=K(s),E=Ve(()=>e(S)||e(R));Aa(u,{type:"email",name:"rauthyEmail",autocomplete:"email",get placeholder(){return n.common.email},get disabled(){return e(E)},get value(){return e(i).email},set value(m){L(i,e(i).email=m)},get error(){return e(k).email},set error(m){L(k,e(k).email=m)},$$events:{enter:$e,input:Ye},children:(m,U)=>{re();var G=se();w(()=>z(G,n.common.email.toUpperCase())),l(m,G)},$$slots:{default:!0},$$legacy:!0});var W=c(u,2);{var x=m=>{var U=it(),G=K(U),be=Ve(()=>e(S)||e(R));Ka(G,{name:"rauthyPassword",get error(){return e(k).password},autocomplete:"current-password",get placeholder(){return n.common.password},get disabled(){return e(be)},get bindThis(){return e(Z)},set bindThis(v){a(Z,v)},get value(){return e(i).password},set value(v){L(i,e(i).password=v)},$$events:{enter:$e},children:(v,M)=>{re();var C=se();w(()=>z(C,n.common.password.toUpperCase())),l(v,C)},$$slots:{default:!0},$$legacy:!0});var ke=c(G,2);{var A=v=>{var M=st(),C=g(M,!0);d(M),w(()=>z(C,n.authorize.passwordForgotten)),Ca(7,M,()=>La),He("click",M,ze),He("keypress",M,ze),l(v,M)};j(ke,v=>{e(oe)&&!e(S)&&v(A)})}l(m,U)};j(W,m=>{e(N)&&e(O)!==e(i).email&&!e(le)&&m(x)})}var $=c(W,2);{var P=m=>{var U=Oe(),G=K(U);{var be=A=>{var v=lt(),M=g(v);ce(M,{$$events:{click:ta},children:(C,$a)=>{re();var te=se();w(()=>z(te,n.authorize.passwordRequest)),l(C,te)},$$slots:{default:!0}}),d(v),l(A,v)},ke=A=>{var v=ot(),M=g(v);ce(M,{get isLoading(){return e(D)},set isLoading(C){a(D,C)},$$events:{click:$e},children:(C,$a)=>{re();var te=se();w(()=>z(te,n.authorize.login)),l(C,te)},$$slots:{default:!0},$$legacy:!0}),d(v),l(A,v)};j(G,A=>{e(le)?A(be):A(ke,!1)})}l(m,U)};j($,m=>{!e(S)&&!e(R)&&m(P)})}l(r,s)};j(Ne,r=>{e(R)||r(va)})}var Re=c(Ne,2);{var da=r=>{var s=vt();xa(s,5,()=>e(ie),u=>u.id,(u,E)=>{ce(u,{level:3,$$events:{click:()=>Ze(e(E).id)},children:(W,x)=>{var $=nt(),P=g($),m=c(P,2),U=g(m,!0);d(m),d($),w(()=>{B(P,"src",`/auth/v1/providers/${e(E).id}/img`),z(U,e(E).name)}),l(W,$)},$$slots:{default:!0}})}),d(s),l(r,s)};j(Re,r=>{e(ie)&&r(da)})}var Se=c(Re,2);{var ua=r=>{var s=dt(),u=g(s,!0);d(s),w(()=>z(u,e(b))),l(r,s)};j(Se,r=>{e(b)&&r(ua)})}var We=c(Se,2);{var ma=r=>{var s=ut(),u=g(s,!0);d(s),w(()=>z(u,n.authorize.emailSentMsg)),l(r,s)};j(We,r=>{e(ae)&&r(ma)})}var Ge=c(We,2);{var ga=r=>{var s=Oe(),u=K(s);{var E=x=>{var $=mt(),P=g($,!0);d($),w(()=>{B($,"href",`/auth/v1/users/register?redirect_uri=${e(f)??""}`),z(P,n.authorize.signUp)}),l(x,$)},W=x=>{var $=gt(),P=g($,!0);d($),w(()=>z(P,n.authorize.signUp)),l(x,$)};j(u,x=>{e(f)?x(E):x(W,!1)})}l(r,s)};j(Ge,r=>{e(fe)&&!e(R)&&!e(oe)&&!e(S)&&r(ga)})}var pa=c(Ge,2);{var fa=r=>{var s=pt(),u=g(s);ce(u,{$$events:{click:()=>window.location.href="/auth/v1/account"},children:(E,W)=>{re();var x=se("ACCOUNT");l(E,x)},$$slots:{default:!0}}),d(s),l(r,s)};j(pa,r=>{e(R)&&r(fa)})}d(we);var Ie=c(we,2);ka(Ie,{absolute:!0});var ha=c(Ie,2);Xa(ha,{absolute:!0}),w(()=>z(ca,e(V)||y)),l(_,J)},$$slots:{default:!0}})},$$slots:{default:!0}}),l(ne,Le),_a()}export{$t as component};
