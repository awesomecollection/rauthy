import"../chunks/disclose-version.BDr9Qe-U.js";import{j as e,a7 as v,g as t,a5 as c,a9 as o,a6 as m,a3 as f,p as De,o as Oe,a4 as S,a as Pe,$ as Se,a8 as ee}from"../chunks/index-client.Cqn5bTAA.js";import{e as W,s as p}from"../chunks/render.BxZ_8nPF.js";import{i as M}from"../chunks/if.CfO-_epY.js";import{T as We,e as Be,i as Ee}from"../chunks/ThemeSwitch.Nnphyg3I.js";import{a as s,t as x,b as ae,c as Ce}from"../chunks/template.A7ni-K4i.js";import{h as Ge}from"../chunks/svelte-head.DTZb8QfM.js";import{p as l}from"../chunks/proxy.Ce5Ub1RB.js";import{r as He}from"../chunks/legacy-client.B3KsQmEJ.js";import{a0 as Je,a1 as we,a2 as Ue,l as Xe,a3 as Ye,n as Ze}from"../chunks/dataFetching.BTF7Y2Cd.js";import{c as Z,t as ce,s as qe,e as le,h as be}from"../chunks/helpers.CZ9R9OcM.js";import{p as ne}from"../chunks/props.YICxVAwD.js";import{L as Ke}from"../chunks/LangSelector.BJ1Lurmb.js";import{c as Ne,a as Qe,I as Re}from"../chunks/Input.DikYy5qt.js";import{B as ue}from"../chunks/Button.Ch35LVs2.js";import{f as Ve}from"../chunks/pow.dgjdRmCA.js";import{M as Fe,C as ea}from"../chunks/ContentCenter.DAqX6TIP.js";import{u as aa}from"../chunks/i18n.svelte.CZcZQkVy.js";import{T as ta}from"../chunks/Template.DXDiqOj9.js";import{u as sa}from"../chunks/param.svelte.BjpJyl57.js";var ra=x('<div class="circle svelte-10pff2x"></div>'),oa=x('<div class="circle svelte-10pff2x"></div>'),ia=x('<div class="circle svelte-10pff2x"></div>'),da=x('<div class="container svelte-10pff2x"><div class="inner svelte-10pff2x"><!> <!> <!></div></div>');function va(te,B){let q=ne(B,"offset",3,0),a=ne(B,"background",3,!0),E=ne(B,"local",3,!1),b=f(!0),$=f(!1),n=f(!1);setTimeout(()=>{e($,!0)},300),setTimeout(()=>{e(n,!0)},600);var g=da(),y=v(g),G=v(y);{var K=i=>{var r=ra();W("introend",r,()=>e(b,!1)),W("outroend",r,()=>e(b,!0)),Z(7,r,()=>le,()=>({delay:600,duration:1e3})),s(i,r)};M(G,i=>{t(b)&&i(K)})}var L=c(G,2);{var z=i=>{var r=oa();W("introend",r,()=>e($,!1)),W("outroend",r,()=>e($,!0)),Z(7,r,()=>le,()=>({delay:600,duration:1e3})),s(i,r)};M(L,i=>{t($)&&i(z)})}var N=c(L,2);{var se=i=>{var r=ia();W("introend",r,()=>e(n,!1)),W("outroend",r,()=>e(n,!0)),Z(7,r,()=>le,()=>({delay:600,duration:1e3})),s(i,r)};M(N,i=>{t(n)&&i(se)})}o(y),o(g),m(()=>{ce(g,"global",!E()),ce(g,"local",E()),ce(g,"background",a()),qe(y,"style",`margin-top: ${`${q()}px`??""}`)}),Z(3,y,()=>be,()=>({duration:100})),Z(7,g,()=>be,()=>({duration:100})),s(te,g)}var ca=x('<div class="desc svelte-19xxeot"> </div> <!> <!>',1),la=x('<div class="desc svelte-19xxeot"><p> </p> <p> </p></div>'),na=x('<div class="desc svelte-19xxeot"><p class="declined svelte-19xxeot"> </p> <p> </p></div>'),ua=x("<li> </li>"),pa=x('<div class="desc svelte-19xxeot"> <ul></ul></div> <div class="inline svelte-19xxeot"><!> <!></div>',1),ma=x('<div class="container svelte-19xxeot"><div class="name svelte-19xxeot"><h2> </h2></div> <!> <div class="err svelte-19xxeot"> </div></div>'),fa=x("<!> <!> <!>",1),xa=x("<!> <!>",1);function $a(te,B){De(B,!0);const q="8rem";let a=aa(),E=f(void 0),b=f(""),$=f(8),n=f(!1),g=!1,y=f(void 0),G=f(!1),K=f(!1),L=l({userCode:""}),z=f(l({userCode:""})),N=f(l({}));He(()=>{a&&t($)&&e(N,l(Ne().shape({userCode:Qe().trim().min(t($),a.common.errTooShort).max(t($),a.common.errTooLong).matches(Xe,a.common.invalidInput)})))}),Oe(async()=>{let u=sa("code").get();u&&(L.userCode=u);let H=await Je();H.ok?e(E,l(await H.json())):u?we(`device?code=${u}`):we("device")});function se(){g&&r()}async function i(u){var J;if(e(b,""),g=!0,!await r())return;e(n,!0);let H=await Ve(),re={user_code:L.userCode,pow:H,device_accepted:u};const j=await Ye(re);if(j.status===200){const A=await j.json();console.log(A),e(y,l(((J=A.scopes)==null?void 0:J.split(" "))||["openid"]))}else if(j.status===202)e(G,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3);else if(j.status===204)e(K,!0);else if(j.status===404)e(b,l(a.device.wrongOrExpired));else{const A=await j.json();e(b,l(A.message))}e(n,!1)}async function r(){try{return await t(N).validate(L,{abortEarly:!1}),e(z,l({userCode:""})),!0}catch(u){return e(z,l(Ze(u))),!1}}var pe=xa();Ge(u=>{m(()=>Se.title=(a==null?void 0:a.device.title)||"Device Authorization")});var me=S(pe);ta(me,{id:Ue,get value(){return t($)},set value(u){e($,l(u))}});var ye=c(me,2);Fe(ye,{children:(u,H)=>{ea(u,{children:(re,j)=>{var J=fa(),A=S(J);{var Le=D=>{va(D,{})},ke=D=>{var oe=ma(),ie=v(oe),xe=v(ie),je=v(xe,!0);o(xe),o(ie);var $e=c(ie,2);{var Ae=O=>{var U=ca(),X=S(U),de=v(X,!0);m(()=>p(de,a.device.desc.replace("{{count}}",t($)))),o(X);var Q=c(X,2);Re(Q,{name:"userCode",autocomplete:"off",get placeholder(){return a.device.userCode},get value(){return L.userCode},set value(d){L.userCode=d},get error(){return t(z).userCode},set error(d){t(z).userCode=d},$$events:{enter:i,input:se},children:(d,_)=>{ee();var h=ae();m(()=>p(h,a.device.userCode.toUpperCase())),s(d,h)},$$slots:{default:!0}});var k=c(Q,2);ue(k,{get isLoading(){return t(n)},set isLoading(d){e(n,l(d))},$$events:{click:()=>i("pending")},children:(d,_)=>{ee();var h=ae();m(()=>p(h,a.device.submit)),s(d,h)},$$slots:{default:!0}}),s(O,U)},_e=O=>{var U=Ce(),X=S(U);{var de=k=>{var d=la(),_=v(d),h=v(_,!0);o(_);var R=c(_,2),T=v(R,!0);o(R),o(d),m(()=>{p(h,a.device.isAccepted),p(T,a.device.autoRedirectAccount)}),s(k,d)},Q=k=>{var d=Ce(),_=S(d);{var h=T=>{var P=na(),I=v(P),V=v(I,!0);o(I);var Y=c(I,2),F=v(Y,!0);o(Y),o(P),m(()=>{p(V,a.device.isDeclined),p(F,a.device.closeWindow)}),s(T,P)},R=T=>{var P=pa(),I=S(P),V=v(I),Y=c(V);Be(Y,21,()=>t(y),Ee,(C,ve)=>{var w=ua(),ze=v(w,!0);o(w),m(()=>p(ze,t(ve))),s(C,w)}),o(Y),o(I);var F=c(I,2),he=v(F);ue(he,{level:1,width:q,get isLoading(){return t(n)},set isLoading(C){e(n,l(C))},$$events:{click:()=>i("accept")},children:(C,ve)=>{ee();var w=ae();m(()=>p(w,a.device.accept)),s(C,w)},$$slots:{default:!0}});var Me=c(he,2);ue(Me,{level:3,width:q,get isLoading(){return t(n)},set isLoading(C){e(n,l(C))},$$events:{click:()=>i("decline")},children:(C,ve)=>{ee();var w=ae();m(()=>p(w,a.device.decline)),s(C,w)},$$slots:{default:!0}}),o(F),m(()=>p(V,`${a.device.descScopes??""} `)),s(T,P)};M(_,T=>{t(K)?T(h):T(R,!1)},!0)}s(k,d)};M(X,k=>{t(G)?k(de):k(Q,!1)},!0)}s(O,U)};M($e,O=>{t(y)===void 0?O(Ae):O(_e,!1)})}var ge=c($e,2),Ie=v(ge,!0);o(ge),o(oe),m(()=>{p(je,a.device.title),p(Ie,t(b))}),s(D,oe)};M(A,D=>{t(E)?D(ke,!1):D(Le)})}var fe=c(A,2);We(fe,{absolute:!0});var Te=c(fe,2);Ke(Te,{absolute:!0}),s(re,J)},$$slots:{default:!0}})},$$slots:{default:!0}}),s(te,pe),Pe()}export{$a as component};
