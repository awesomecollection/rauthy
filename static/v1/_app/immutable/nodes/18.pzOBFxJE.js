import{a as n,t as $,e as D,d as Ze}from"../chunks/disclose-version.BP4T4xdV.js";import{a as ke,s as a,c as s,r as l,t as I,p as we,l as x,aa as Ge,j as e,f as Q,a7 as S,k as v,a9 as ie,a5 as Et,O as Ot}from"../chunks/index-client.hxMyB_b4.js";import{s as u}from"../chunks/render.yNX9q8-B.js";import{i as q}from"../chunks/if.BeBa1Kxb.js";import{e as yt}from"../chunks/each.BUp7aLCc.js";import{s as Qe}from"../chunks/class.CF2J4YCf.js";import{a as dt,B as Fe,t as He,s as Je}from"../chunks/Button.BR1gOfNn.js";import{p as g}from"../chunks/proxy.DaVNR9vk.js";import{d as Bt,f as Yt,c as Vt,b as vt}from"../chunks/fetch.Bq59EV_b.js";import{C as Xt}from"../chunks/ContentAdmin.YSUtpxca.js";import{N as Zt}from"../chunks/NavSub.DILgx03i.js";import{u as Qt}from"../chunks/param.svelte.BbzO27-O.js";import{N as Ht}from"../chunks/NavButtonTile.DRctQzgA.js";import{B as Jt}from"../chunks/ButtonAddModal.DsDc6nUh.js";import{p as ut}from"../chunks/props.DNAkfByl.js";import{k as Wt}from"../chunks/key.DIUIfgzP.js";import{h as Ce}from"../chunks/html.704f8A94.js";import{I as L}from"../chunks/pow.BMnvYon0.js";import{u as Ae}from"../chunks/i18n_admin.svelte.lt3dD7TQ.js";import{g as pt}from"../chunks/helpers.CchIKxjM.js";import{I as Tt}from"../chunks/IconCheck.C6tGCpWy.js";import{I as _t}from"../chunks/InputArea.DJ93M0Cm.js";import{I as At}from"../chunks/InputPassword.DvK4K3vC.js";import{F as Lt}from"../chunks/Form.BnvI_UPN.js";import{u as mt}from"../chunks/i18n.svelte.Ci9wvqOq.js";import{L as ft}from"../chunks/LabeledValue.CxxfjE_4.js";import{I as te}from"../chunks/InputCheckbox.BFLz2Hte.js";import{a as G,h as Mt,g as Nt,i as ht}from"../chunks/patterns.BRCxk8by.js";import{I as er}from"../chunks/InputFile.BNBX2-L3.js";import{E as tr}from"../chunks/Expandable.CyA69Mcx.js";import{T as rr}from"../chunks/Tabs.DUIpSMWU.js";import{C as Pt}from"../chunks/CheckIcon.7gB29NsI.js";import{O as ar}from"../chunks/Options.CjsqRicG.js";var ir=$('<div class="desc svelte-6fcb3i"><h4 class="svelte-6fcb3i">ID token claim mappings</h4> <p class="svelte-6fcb3i"> </p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p></div>');function qt(B,z){ke(z,!0);let t=Ae();var c=ir(),o=a(s(c),2),h=s(o,!0);l(o);var k=a(o,2),f=s(k);Ce(f,()=>t.providers.config.jsonPath.p2),l(k);var M=a(k,2),N=s(M);Ce(N,()=>t.providers.config.jsonPath.p3),l(M);var b=a(M,2),r=s(b);Ce(r,()=>t.providers.config.jsonPath.p4),l(b);var j=a(b,2),p=s(j);Ce(p,()=>t.providers.config.jsonPath.p5),l(j);var A=a(j,2),_=s(A);Ce(_,()=>t.providers.config.jsonPath.p6),l(A),l(c),I(()=>u(h,t.providers.config.jsonPath.p1)),n(B,c),we()}var or=$('<img alt="No Logo Available">');function sr(B,z){ke(z,!0);var t=or();I(()=>Qe(t,"src",`/auth/v1/providers/${z.providerId}/img?${pt()}}`)),Qe(t,"width",20),Qe(t,"height",20),n(B,t),we()}var lr=$("<div><!></div>"),nr=$('<div class="checkbox svelte-iec8od"><!></div>'),cr=$('<div class="err"> </div>'),dr=$('<div class="svelte-iec8od"><!></div>'),vr=$('<span class="err"> </span>'),ur=$('<!> <div></div> <div class="checkbox svelte-iec8od"><!></div> <div class="checkbox svelte-iec8od"><!></div> <!> <!> <!> <!> <!> <div class="checkbox svelte-iec8od"><!></div> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p><!></p> <div class="checkbox svelte-iec8od"><!></div> <div class="checkbox svelte-iec8od"><!></div> <!> <!> <p class="desc svelte-iec8od"> </p> <!> <!> <p class="desc svelte-iec8od"> </p> <!> <!> <div class="logo svelte-iec8od"><!> <!></div> <div class="flex gap-05"><!> <!> <!></div>',1),pr=$('<div class="container svelte-iec8od"><!></div>');function _r(B,z){ke(z,!0);let t=ut(z,"provider",15),c=mt(),o=Ae();const h="min(calc(100dvw - .5rem), 30rem)";let k=!1,f=x(""),M=x(!1),N=x(!!t().root_pem),b=x(g(pt()));Ge(()=>{t().id&&(t(t().client_secret=t().client_secret||"",!0),t(t().admin_claim_path=t().admin_claim_path||"",!0),t(t().admin_claim_value=t().admin_claim_value||"",!0),t(t().mfa_claim_path=t().mfa_claim_path||"",!0),t(t().mfa_claim_value=t().mfa_claim_value||"",!0),t(t().root_pem=t().root_pem||"",!0))}),Ge(()=>{t().scope&&t(t().scope=t().scope.replaceAll("+"," "),!0)});async function r(_,y){if(v(f,""),t().client_secret&&!(t().client_secret_basic||t().client_secret_post)){v(f,g(o.providers.config.errNoAuthMethod));return}if(!t().use_pkce&&!t().client_secret){v(f,g(o.providers.config.errConfidential));return}let E={name:t().name,typ:t().typ,enabled:t().enabled,issuer:t().issuer,authorization_endpoint:t().authorization_endpoint,token_endpoint:t().token_endpoint,userinfo_endpoint:t().userinfo_endpoint,danger_allow_insecure:e(N)&&t().root_pem?!1:t().danger_allow_insecure,use_pkce:t().use_pkce,client_secret_basic:t().client_secret_basic,client_secret_post:t().client_secret_post,client_id:t().client_id,client_secret:t().client_secret||void 0,scope:t().scope.trim(),root_pem:e(N)&&t().root_pem?t().root_pem.trim():void 0,admin_claim_path:t().admin_claim_path||void 0,admin_claim_value:t().admin_claim_value||void 0,mfa_claim_path:t().mfa_claim_path||void 0,mfa_claim_value:t().mfa_claim_value||void 0},P=await Bt(_.action,E);P.error?v(f,g(P.error.message)):(v(M,!0),z.onSave(),setTimeout(()=>{v(M,!1)},3e3))}var j=pr(),p=s(j),A=ie(()=>`/auth/v1/providers/${t().id}`);Lt(p,{get action(){return e(A)},onSubmit:r,children:(_,y)=>{var E=ur(),P=Q(E);ft(P,{label:"ID",mono:!0,children:(i,w)=>{S();var C=D();I(()=>u(C,t().id)),n(i,C)},$$slots:{default:!0}});var H=a(P,2);dt(H,"height",".15rem");var Y=a(H,2),V=s(Y);te(V,{get ariaLabel(){return o.common.enabled},get checked(){return t().enabled},set checked(i){t(t().enabled=i,!0)},children:(i,w)=>{S();var C=D();I(()=>u(C,o.common.enabled)),n(i,C)},$$slots:{default:!0}}),l(Y);var U=a(Y,2),oe=s(U);te(oe,{get ariaLabel(){return o.providers.config.custRootCa},get checked(){return e(N)},set checked(i){v(N,g(i))},children:(i,w)=>{S();var C=D();I(()=>u(C,o.providers.config.custRootCa)),n(i,C)},$$slots:{default:!0}}),l(U);var ue=a(U,2);{var de=i=>{var w=lr(),C=s(w);_t(C,{rows:15,name:"rootPem",get label(){return o.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
 -----END CERTIFICATE-----`,errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - .5rem))",fontMono:!0,pattern:ht,get value(){return t().root_pem},set value(ne){t(t().root_pem=ne,!0)}}),l(w),He(3,w,()=>Je,()=>({duration:150})),n(i,w)},$e=i=>{var w=nr(),C=s(w);te(C,{get ariaLabel(){return o.providers.config.allowInsecureTls},get checked(){return t().danger_allow_insecure},set checked(ne){t(t().danger_allow_insecure=ne,!0)},children:(ne,gt)=>{S();var De=D();I(()=>u(De,o.providers.config.allowInsecureTls)),n(ne,De)},$$slots:{default:!0}}),l(w),n(i,w)};q(ue,i=>{e(N)?i(de):i($e,!1)})}var pe=a(ue,2);L(pe,{autocomplete:"off",label:"Issuer URL",placeholder:"Issuer URL",required:!0,pattern:G,width:h,get value(){return t().issuer},set value(i){t(t().issuer=i,!0)}});var O=a(pe,2);L(O,{typ:"url",autocomplete:"off",label:"Authorization Endpoint",placeholder:"Authorization Endpoint",required:!0,pattern:G,width:h,get value(){return t().authorization_endpoint},set value(i){t(t().authorization_endpoint=i,!0)}});var R=a(O,2);L(R,{typ:"url",autocomplete:"off",label:"Token Endpoint",placeholder:"Token Endpoint",required:!0,pattern:G,width:h,get value(){return t().token_endpoint},set value(i){t(t().token_endpoint=i,!0)}});var X=a(R,2);L(X,{typ:"url",autocomplete:"off",label:"Userinfo Endpoint",placeholder:"Userinfo Endpoint",required:!0,pattern:G,width:h,get value(){return t().userinfo_endpoint},set value(i){t(t().userinfo_endpoint=i,!0)}});var m=a(X,2),_e=s(m);te(_e,{ariaLabel:"PKCE",get checked(){return t().use_pkce},set checked(i){t(t().use_pkce=i,!0)},children:(i,w)=>{S();var C=D("PKCE");n(i,C)},$$slots:{default:!0}}),l(m);var le=a(m,2),me=s(le,!0);l(le);var fe=a(le,2);L(fe,{autocomplete:"off",label:"Scope",placeholder:"openid profile email",required:!0,pattern:Mt,width:h,get value(){return t().scope},set value(i){t(t().scope=i,!0)}});var he=a(fe,2),Ke=s(he,!0);l(he);var Le=a(he,2);L(Le,{autocomplete:"off",get label(){return o.providers.config.clientName},get placeholder(){return o.providers.config.clientName},required:!0,pattern:Nt,width:h,get value(){return t().name},set value(i){t(t().name=i,!0)}});var Ie=a(Le,2),We=s(Ie,!0);l(Ie);var Me=a(Ie,2);L(Me,{autocomplete:"off",label:"Client ID",placeholder:"Client ID",required:!0,pattern:G,width:h,get value(){return t().client_id},set value(i){t(t().client_id=i,!0)}});var Ne=a(Me,2),et=s(Ne,!0);l(Ne);var je=a(Ne,2),T=ie(()=>!t().use_pkce);At(je,{autocomplete:"off",label:"Client Secret",placeholder:"Client Secret",maxLength:256,get errMsg(){return o.providers.config.errConfidential},get required(){return e(T)},width:h,get value(){return t().client_secret},set value(i){t(t().client_secret=i,!0)}});var F=a(je,2),J=s(F);Ce(J,()=>o.providers.config.descAuthMethod),l(F);var se=a(F,2),Pe=s(se);te(Pe,{ariaLabel:"client_secret_basic",get checked(){return t().client_secret_basic},set checked(i){t(t().client_secret_basic=i,!0)},children:(i,w)=>{S();var C=D("client_secret_basic");n(i,C)},$$slots:{default:!0}}),l(se);var re=a(se,2),ve=s(re);te(ve,{ariaLabel:"client_secret_post",get checked(){return t().client_secret_post},set checked(i){t(t().client_secret_post=i,!0)},children:(i,w)=>{S();var C=D("client_secret_post");n(i,C)},$$slots:{default:!0}}),l(re);var Z=a(re,2);{var W=i=>{var w=cr(),C=s(w,!0);l(w),I(()=>u(C,o.providers.config.errNoAuthMethod)),He(3,w,()=>Je,()=>({duration:150})),n(i,w)};q(Z,i=>{!t().use_pkce&&!t().client_secret_basic&&!t().client_secret_post&&i(W)})}var ee=a(Z,2);qt(ee,{});var ae=a(ee,2),qe=s(ae,!0);l(ae);var ge=a(ae,2);L(ge,{autocomplete:"off",get label(){return o.providers.config.pathAdminClaim},placeholder:"$.roles.*",pattern:G,width:h,get value(){return t().admin_claim_path},set value(i){t(t().admin_claim_path=i,!0)}});var Oe=a(ge,2);L(Oe,{autocomplete:"off",get label(){return o.providers.config.valueAdminClaim},placeholder:"rauthy_admin",pattern:G,width:h,get value(){return t().admin_claim_value},set value(i){t(t().admin_claim_value=i,!0)}});var Ee=a(Oe,2),Be=s(Ee,!0);l(Ee);var ze=a(Ee,2);L(ze,{autocomplete:"off",get label(){return o.providers.config.pathMfaClaim},placeholder:"$.amr.*",pattern:G,width:h,get value(){return t().mfa_claim_path},set value(i){t(t().mfa_claim_path=i,!0)}});var Re=a(ze,2);L(Re,{autocomplete:"off",get label(){return o.providers.config.valueMfaClaim},placeholder:"mfa",pattern:G,width:h,get value(){return t().mfa_claim_value},set value(i){t(t().mfa_claim_value=i,!0)}});var be=a(Re,2),Ye=s(be);Wt(Ye,()=>e(b),i=>{var w=dr(),C=s(w);sr(C,{get providerId(){return t().id}}),l(w),n(i,w)});var tt=a(Ye,2),rt=ie(()=>`/auth/v1/providers/${t().id}/img`);er(tt,{method:"PUT",get url(){return e(rt)},fileName:"logo",onSuccess:()=>v(b,g(pt()))}),l(be);var ye=a(be,2),Ve=s(ye);Fe(Ve,{type:"submit",get isLoading(){return k},children:(i,w)=>{S();var C=D();I(()=>u(C,c.common.save)),n(i,C)},$$slots:{default:!0}});var xe=a(Ve,2);{var Ue=i=>{Tt(i,{})};q(xe,i=>{e(M)&&i(Ue)})}var at=a(xe,2);{var Xe=i=>{var w=vr(),C=s(w,!0);l(w),I(()=>u(C,e(f))),n(i,w)};q(at,i=>{e(f)&&i(Xe)})}l(ye),I(()=>{u(me,o.providers.config.descScope),u(Ke,o.providers.config.descClientName),u(We,o.providers.config.descClientId),u(et,o.providers.config.descClientSecret),u(qe,o.providers.config.mapUser),u(Be,o.providers.config.mapMfa)}),n(_,E)},$$slots:{default:!0}}),l(j),n(B,j),we()}var mr=$('<div class="user svelte-1vu6qeb"> <span class="muted font-mono svelte-1vu6qeb"> </span></div>'),fr=$('<div class="forceDelete svelte-1vu6qeb"> </div>'),hr=$('<p class="err"><b> </b></p> <p> </p> <!> <p> </p> <!> <!>',1),gr=$("<p> </p> <!>",1),br=$('<div class="err"> </div>'),kr=$('<div class="container svelte-1vu6qeb"><!> <!></div>');function wr(B,z){ke(z,!0);let t=mt(),c=Ae(),o=x(!0),h=x(""),k=x(!1),f=x(g([]));Et(async()=>{let _=await Yt(`/auth/v1/providers/${z.provider.id}/delete_safe`);_.status===406&&_.error&&v(f,g(_.error)),v(o,!1)});async function M(){v(h,""),v(o,!0);let _=await Vt(`/auth/v1/providers/${z.provider.id}`);_.error?v(h,g(_.error.message)):z.onSave(),v(o,!1)}var N=kr(),b=s(N);{var r=_=>{var y=hr(),E=Q(y),P=s(E),H=s(P,!0);l(P),l(E);var Y=a(E,2),V=s(Y,!0);l(Y);var U=a(Y,2);tr(U,{summary:O=>{S();var R=D();I(()=>u(R,c.providers.delete.linkedUsers)),n(O,R)},details:O=>{var R=Ze(),X=Q(R);yt(X,17,()=>e(f),m=>m.id,(m,_e)=>{var le=mr(),me=s(le),fe=a(me),he=s(fe);l(fe),l(le),I(()=>{u(me,`${e(_e).email??""} `),u(he,`/ ${e(_e).id??""}`)}),n(m,le)}),n(O,R)},$$slots:{summary:!0,details:!0}});var oe=a(U,2),ue=s(oe,!0);l(oe);var de=a(oe,2);te(de,{get ariaLabel(){return c.providers.delete.forceDelete},get checked(){return e(k)},set checked(O){v(k,g(O))},children:(O,R)=>{var X=fr(),m=s(X,!0);l(X),I(()=>u(m,c.providers.delete.forceDelete)),n(O,X)},$$slots:{default:!0}});var $e=a(de,2);{var pe=O=>{Fe(O,{level:-1,onclick:M,get isLoading(){return e(o)},children:(R,X)=>{S();var m=D();I(()=>u(m,t.common.delete)),n(R,m)},$$slots:{default:!0}})};q($e,O=>{e(k)&&O(pe)})}I(()=>{u(H,c.providers.delete.isInUse1),u(V,c.providers.delete.isInUse2),u(ue,c.providers.delete.areYouSure)}),n(_,y)},j=_=>{var y=gr(),E=Q(y),P=s(E,!0);l(E);var H=a(E,2);Fe(H,{level:-1,onclick:M,get isLoading(){return e(o)},children:(Y,V)=>{S();var U=D();I(()=>u(U,t.common.delete)),n(Y,U)},$$slots:{default:!0}}),I(()=>u(P,c.providers.delete.areYouSure)),n(_,y)};q(b,_=>{e(f).length>0?_(r):_(j,!1)})}var p=a(b,2);{var A=_=>{var y=br(),E=s(y,!0);l(y),I(()=>u(E,e(h))),n(_,y)};q(p,_=>{e(h)&&_(A)})}l(N),n(B,N),we()}var Cr=$('<div class="flex"><!></div> <!>',1);function $r(B,z){ke(z,!0);let t=ut(z,"provider",15),c=ut(z,"onSave",15),o=Ae();const h=[o.tabs.config,o.tabs.delete];let k=x(g(h[0]));var f=Cr(),M=Q(f),N=s(M);rr(N,{tabs:h,get selected(){return e(k)},set selected(p){v(k,g(p))}}),l(M);var b=a(M,2);{var r=p=>{_r(p,{get provider(){return t()},set provider(A){t(A)},get onSave(){return c()},set onSave(A){c(A)}})},j=p=>{var A=Ze(),_=Q(A);{var y=E=>{wr(E,{get provider(){return t()},get onSave(){return c()},set onSave(P){c(P)}})};q(_,E=>{e(k)===o.tabs.delete&&E(y)},!0)}n(p,A)};q(b,p=>{e(k)===o.tabs.config?p(r):p(j,!1)})}n(B,f),we()}var Ir=$("<div><!></div>"),Er=$('<div class="checkbox svelte-f8e9ia"><!></div>'),yr=$('<div class="checkbox svelte-f8e9ia"><!></div> <!>',1),Tr=$('<div class="ml mb"><!></div>'),Ar=$('<div class="err"> </div>'),Lr=$('<!> <!> <!> <!> <!> <div class="checkbox svelte-f8e9ia"><!></div> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p><!></p> <div class="checkbox svelte-f8e9ia"><!></div> <div class="checkbox svelte-f8e9ia"><!></div> <!> <!> <p class="desc svelte-f8e9ia"> </p> <!> <!> <p class="desc svelte-f8e9ia"> </p> <!> <!>',1),Mr=$('<div class="err"> </div>'),Nr=$('<!> <!> <div class="flex gap-05"><!> <!> <!> <!></div>',1),Pr=$('<div class="container svelte-f8e9ia"><!> <div></div> <!></div>');function qr(B,z){ke(z,!0);let t=mt(),c=Ae();const o="min(calc(100dvw - 1.75rem), 30rem)";let h=x(!1),k=x(""),f=x(!1),M=x(!1),N=x(!1),b=x(g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),r=x(g({enabled:!0,typ:"oidc",issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",token_auth_method_basic:!1,userinfo_endpoint:"",use_pkce:!0,client_secret_basic:!0,client_secret_post:!1,name:"",client_id:"",client_secret:"",scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""})),j=["OIDC","Auto","Custom","Github","Google"],p=x(g(j[0])),A=ie(()=>e(p)==="Auto"),_=ie(()=>e(p)==="Custom"),y=ie(()=>e(p)==="OIDC"),E=ie(()=>!e(A)&&!e(_)&&!e(y)),P=ie(()=>!(e(E)||e(_)||e(f)));const H="/auth/v1/providers/lookup";let Y=ie(()=>e(P)?H:"/auth/v1/providers/create");Ge(()=>{if(e(p))switch(v(f,!1),v(b,g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),e(p)){case"Github":v(r,g({enabled:!0,issuer:"github.com",typ:"github",danger_allow_insecure:!1,authorization_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",client_secret_basic:!0,client_secret_post:!0,userinfo_endpoint:"https://api.github.com/user",use_pkce:!1,name:"Github",client_id:"",client_secret:"",scope:"user:email",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"$.two_factor_authentication",mfa_claim_value:"true"}));break;case"Google":v(b,g({issuer:"accounts.google.com",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),Ot(()=>{oe(H)});break;default:v(r,g({enabled:!0,issuer:"",typ:"oidc",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",client_secret_basic:!0,client_secret_post:!1,userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret:"",scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""}))}}),Ge(()=>{e(M)&&setTimeout(()=>{z.onSave(),ue()},1500)});async function V(R,X){e(P)?await oe(R.action):await U(R.action)}async function U(R){if(e(r).client_secret&&!(e(r).client_secret_basic||e(r).client_secret_post)){v(k,g(c.providers.config.errNoAuthMethod));return}if(!e(r).use_pkce&&!e(r).client_secret){v(k,g(c.providers.config.errConfidential));return}v(k,""),v(h,!0);let X={name:e(r).name,typ:e(A)?"custom":e(p).toLowerCase(),enabled:e(r).enabled,issuer:e(r).issuer,authorization_endpoint:e(r).authorization_endpoint,token_endpoint:e(r).token_endpoint,userinfo_endpoint:e(r).userinfo_endpoint,danger_allow_insecure:e(N)&&e(r).root_pem?!1:e(r).danger_allow_insecure,use_pkce:e(r).use_pkce,client_secret_basic:e(r).client_secret_basic,client_secret_post:e(r).client_secret_post,client_id:e(r).client_id,client_secret:e(r).client_secret,scope:e(r).scope.trim(),root_pem:e(N)&&e(r).root_pem?e(r).root_pem.trim():void 0,admin_claim_path:e(r).admin_claim_path||void 0,admin_claim_value:e(r).admin_claim_value||void 0,mfa_claim_path:e(r).mfa_claim_path||void 0,mfa_claim_value:e(r).mfa_claim_value||void 0},m=await vt(R,X);m.error?m.error.message.includes("InvalidCertificate")?v(k,"Insecure connection not allowed"):v(k,g(m.error.message)):v(M,!0),v(h,!1)}async function oe(R){if(!e(b).issuer&&!e(b).metadata_url){v(k,"Provide at least one of Issuer / Metadata URL");return}v(k,""),v(h,!0);let X={issuer:e(b).issuer||void 0,metadata_url:e(b).metadata_url||void 0,danger_allow_insecure:e(b).danger_allow_insecure,root_pem:e(b).root_pem||void 0},m=await vt(R,X);m.body?(e(r).issuer=m.body.issuer,e(r).authorization_endpoint=m.body.authorization_endpoint,e(r).danger_allow_insecure=m.body.danger_allow_insecure,e(r).token_endpoint=m.body.token_endpoint,e(r).userinfo_endpoint=m.body.userinfo_endpoint,e(r).client_secret_basic=m.body.client_secret_basic,e(r).client_secret_post=m.body.client_secret_post,e(r).use_pkce=m.body.use_pkce,e(r).client_secret_basic=m.body.client_secret_basic,e(r).client_secret_post=!m.body.client_secret_basic&&m.body.client_secret_post,e(r).scope=m.body.scope,e(r).root_pem=m.body.root_pem,v(f,!0)):m.error&&(m.error.message.includes("InvalidCertificate")?v(k,"Insecure connection not allowed"):v(k,g(m.error.message))),v(h,!1)}function ue(){v(b,g({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),v(r,g({enabled:!0,issuer:"",typ:"oidc",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret_basic:!0,client_secret_post:!1,scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""})),v(M,!1),v(f,!1),v(N,!1)}var de=Pr(),$e=s(de);ar($e,{ariaLabel:"Select Mode",options:j,get value(){return e(p)},set value(R){v(p,g(R))}});var pe=a($e,2);dt(pe,"height",".5rem");var O=a(pe,2);Lt(O,{get action(){return e(Y)},onSubmit:V,children:(R,X)=>{var m=Nr(),_e=Q(m);{var le=T=>{var F=yr(),J=Q(F),se=s(J);te(se,{get ariaLabel(){return c.providers.config.custRootCa},get checked(){return e(N)},set checked(Z){v(N,g(Z))},children:(Z,W)=>{S();var ee=D();I(()=>u(ee,c.providers.config.custRootCa)),n(Z,ee)},$$slots:{default:!0}}),l(J);var Pe=a(J,2);{var re=Z=>{var W=Ir(),ee=s(W);_t(ee,{rows:15,name:"rootPem",get label(){return c.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - 1.75rem))",fontMono:!0,pattern:ht,get value(){return e(b).root_pem},set value(ae){e(b).root_pem=ae}}),l(W),He(3,W,()=>Je,()=>({duration:150})),n(Z,W)},ve=Z=>{var W=Er(),ee=s(W);te(ee,{get ariaLabel(){return c.providers.config.allowInsecureTls},get checked(){return e(b).danger_allow_insecure},set checked(ae){e(b).danger_allow_insecure=ae},children:(ae,qe)=>{S();var ge=D();I(()=>u(ge,c.providers.config.allowInsecureTls)),n(ae,ge)},$$slots:{default:!0}}),l(W),n(Z,W)};q(Pe,Z=>{e(N)?Z(re):Z(ve,!1)})}n(T,F)};q(_e,T=>{e(f)||T(le)})}var me=a(_e,2);{var fe=T=>{L(T,{name:"issuer",label:"Issuer URL",placeholder:"Issuer URL",width:o,required:!0,pattern:G,get value(){return e(b).issuer},set value(F){e(b).issuer=F}})},he=T=>{var F=Ze(),J=Q(F);{var se=re=>{L(re,{typ:"url",name:"metadata",label:"Metadata URL",placeholder:".../.well-known/openid-configuration",width:o,required:!0,pattern:G,get value(){return e(b).metadata_url},set value(ve){e(b).metadata_url=ve}})},Pe=re=>{var ve=Ze(),Z=Q(ve);{var W=ee=>{var ae=Lr(),qe=Q(ae);{var ge=d=>{_t(d,{rows:17,name:"rootPem",get label(){return c.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,get disabled(){return e(f)},errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - 1.75rem))",fontMono:!0,pattern:ht,get value(){return e(r).root_pem},set value(K){e(r).root_pem=K}})},Oe=d=>{var K=Tr(),ce=s(K);{var ct=Te=>{ft(Te,{get label(){return c.providers.config.allowInsecureTls},children:(Se,jt)=>{Pt(Se,{get check(){return e(r).danger_allow_insecure}})},$$slots:{default:!0}})},Kt=Te=>{te(Te,{get ariaLabel(){return c.providers.config.allowInsecureTls},get checked(){return e(r).danger_allow_insecure},set checked(Se){e(r).danger_allow_insecure=Se},children:(Se,jt)=>{S();var It=D();I(()=>u(It,c.providers.config.allowInsecureTls)),n(Se,It)},$$slots:{default:!0}})};q(ce,Te=>{e(f)?Te(ct):Te(Kt,!1)})}l(K),n(d,K)};q(qe,d=>{e(N)?d(ge):d(Oe,!1)})}var Ee=a(qe,2);L(Ee,{name:"issuer",label:"Issuer URL",placeholder:"Issuer URL",width:o,get disabled(){return e(f)},required:!0,pattern:G,get value(){return e(r).issuer},set value(d){e(r).issuer=d}});var Be=a(Ee,2);L(Be,{typ:"url",name:"auth_endpoint",label:"Authorization Endpoint",placeholder:"Authorization Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:G,get value(){return e(r).authorization_endpoint},set value(d){e(r).authorization_endpoint=d}});var ze=a(Be,2);L(ze,{typ:"url",name:"token_endpoint",label:"Token Endpoint",placeholder:"Token Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:G,get value(){return e(r).token_endpoint},set value(d){e(r).token_endpoint=d}});var Re=a(ze,2);L(Re,{typ:"url",name:"userinfo_endpoint",label:"Userinfo Endpoint",placeholder:"Userinfo Endpoint",width:o,get disabled(){return e(f)},required:!0,pattern:G,get value(){return e(r).userinfo_endpoint},set value(d){e(r).userinfo_endpoint=d}});var be=a(Re,2),Ye=s(be);{var tt=d=>{ft(d,{label:"PKCE",children:(K,ce)=>{Pt(K,{get check(){return e(r).use_pkce}})},$$slots:{default:!0}})},rt=d=>{te(d,{ariaLabel:"PKCE",get checked(){return e(r).use_pkce},set checked(K){e(r).use_pkce=K},children:(K,ce)=>{S();var ct=D("PKCE");n(K,ct)},$$slots:{default:!0}})};q(Ye,d=>{e(f)?d(tt):d(rt,!1)})}l(be);var ye=a(be,2),Ve=s(ye,!0);l(ye);var xe=a(ye,2);L(xe,{name:"scope",label:"Scope",placeholder:"openid profile email",width:o,required:!0,pattern:Mt,get value(){return e(r).scope},set value(d){e(r).scope=d}});var Ue=a(xe,2),at=s(Ue,!0);l(Ue);var Xe=a(Ue,2);L(Xe,{name:"client_name",label:"Client Name",placeholder:"Client Name",width:o,required:!0,pattern:Nt,get value(){return e(r).name},set value(d){e(r).name=d}});var i=a(Xe,2),w=s(i,!0);l(i);var C=a(i,2);L(C,{name:"client_id",autocomplete:"off",label:"Client ID",placeholder:"Client ID",width:o,required:!0,pattern:G,get value(){return e(r).client_id},set value(d){e(r).client_id=d}});var ne=a(C,2),gt=s(ne,!0);l(ne);var De=a(ne,2),zt=ie(()=>!e(r).use_pkce);At(De,{name:"client_secret",autocomplete:"off",label:"Client Secret",placeholder:"Client Secret",width:o,get errMsg(){return c.providers.config.errConfidential},maxLength:256,get required(){return e(zt)},get value(){return e(r).client_secret},set value(d){e(r).client_secret=d}});var it=a(De,2),Rt=s(it);Ce(Rt,()=>c.providers.config.descAuthMethod),l(it);var ot=a(it,2),xt=s(ot);te(xt,{ariaLabel:"client_secret_basic",get checked(){return e(r).client_secret_basic},set checked(d){e(r).client_secret_basic=d},children:(d,K)=>{S();var ce=D("client_secret_basic");n(d,ce)},$$slots:{default:!0}}),l(ot);var st=a(ot,2),Ut=s(st);te(Ut,{ariaLabel:"client_secret_post",get checked(){return e(r).client_secret_post},set checked(d){e(r).client_secret_post=d},children:(d,K)=>{S();var ce=D("client_secret_post");n(d,ce)},$$slots:{default:!0}}),l(st);var bt=a(st,2);{var Dt=d=>{var K=Ar(),ce=s(K,!0);l(K),I(()=>u(ce,c.providers.config.errNoAuthMethod)),He(3,K,()=>Je,()=>({duration:150})),n(d,K)};q(bt,d=>{!e(r).use_pkce&&!e(r).client_secret_basic&&!e(r).client_secret_post&&d(Dt)})}var kt=a(bt,2);qt(kt,{});var lt=a(kt,2),St=s(lt,!0);l(lt);var wt=a(lt,2);L(wt,{name:"admin_claim_path",get label(){return c.providers.config.pathAdminClaim},placeholder:"$.roles.*",width:o,pattern:G,get value(){return e(r).admin_claim_path},set value(d){e(r).admin_claim_path=d}});var Ct=a(wt,2);L(Ct,{name:"admin_claim_value",get label(){return c.providers.config.valueAdminClaim},placeholder:"rauthy_admin",width:o,pattern:G,get value(){return e(r).admin_claim_value},set value(d){e(r).admin_claim_value=d}});var nt=a(Ct,2),Gt=s(nt,!0);l(nt);var $t=a(nt,2);L($t,{name:"mfa_claim_path",get label(){return c.providers.config.pathMfaClaim},placeholder:"$.amr.*",width:o,pattern:G,get value(){return e(r).mfa_claim_path},set value(d){e(r).mfa_claim_path=d}});var Ft=a($t,2);L(Ft,{name:"mfa_claim_value",get label(){return c.providers.config.valueMfaClaim},placeholder:"mfa",width:o,pattern:G,get value(){return e(r).mfa_claim_value},set value(d){e(r).mfa_claim_value=d}}),I(()=>{u(Ve,c.providers.config.descScope),u(at,c.providers.config.descClientName),u(w,c.providers.config.descClientId),u(gt,c.providers.config.descClientId),u(St,c.providers.config.mapUser),u(Gt,c.providers.config.mapMfa)}),n(ee,ae)};q(Z,ee=>{(e(E)||e(_)||e(f))&&ee(W)},!0)}n(re,ve)};q(J,re=>{e(A)&&!e(f)?re(se):re(Pe,!1)},!0)}n(T,F)};q(me,T=>{e(y)&&!e(f)?T(fe):T(he,!1)})}var Ke=a(me,2),Le=s(Ke);Fe(Le,{type:"submit",get isLoading(){return e(h)},children:(T,F)=>{S();var J=D();I(()=>u(J,e(P)?c.providers.config.lookup:t.common.save)),n(T,J)},$$slots:{default:!0}});var Ie=a(Le,2);{var We=T=>{Fe(T,{level:3,onclick:ue,get isLoading(){return e(h)},children:(F,J)=>{S();var se=D();I(()=>u(se,c.common.reset)),n(F,se)},$$slots:{default:!0}})};q(Ie,T=>{e(P)||T(We)})}var Me=a(Ie,2);{var Ne=T=>{Tt(T,{})};q(Me,T=>{e(M)&&T(Ne)})}var et=a(Me,2);{var je=T=>{var F=Mr(),J=s(F,!0);l(F),I(()=>u(J,e(k))),n(T,F)};q(et,T=>{e(k)&&T(je)})}l(Ke),n(R,m)},$$slots:{default:!0}}),l(de),n(B,de),we()}var zr=$("<div></div> <!>",1),Rr=$('<div class="err"> </div>'),xr=$('<div id="federation"><!></div> <!>',1),Ur=$("<!> <!>",1);function Dr(B,z){ke(z,!0);let t=Ae(),c=x(void 0),o=Qt("pid"),h=x(""),k=x(g([])),f=x(void 0);Et(()=>{M()}),Ge(()=>{v(f,g(e(k).find(p=>p.id===o.get())))});async function M(){var A;let p=await vt("/auth/v1/providers");p.body?v(k,g(p.body)):v(h,g(((A=p.error)==null?void 0:A.message)||"Error"))}function N(){var p;o.set(void 0),(p=e(c))==null||p(),M()}var b=Ur(),r=Q(b);Zt(r,{width:"11rem",buttonTilesAriaControls:"federation",buttonTiles:p=>{var A=zr(),_=Q(A);dt(_,"height",".5rem");var y=a(_,2);yt(y,17,()=>e(k),E=>E.id,(E,P)=>{var H=ie(()=>o.get()===e(P).id);Ht(E,{onclick:()=>o.set(e(P).id),get selected(){return e(H)},children:(Y,V)=>{S();var U=D();I(()=>u(U,e(P).name)),n(Y,U)},$$slots:{default:!0}})}),n(p,A)},children:(p,A)=>{var _=ie(()=>e(k).length===0?1:2);Jt(p,{get level(){return e(_)},get closeModal(){return e(c)},set closeModal(y){v(c,g(y))},children:(y,E)=>{qr(y,{onSave:N})},$$slots:{default:!0}})},$$slots:{buttonTiles:!0,default:!0}});var j=a(r,2);Xt(j,{children:(p,A)=>{var _=xr(),y=Q(_),E=s(y);{var P=V=>{$r(V,{onSave:M,get provider(){return e(f)},set provider(U){v(f,g(U))}})};q(E,V=>{e(f)&&V(P)})}l(y);var H=a(y,2);{var Y=V=>{var U=Rr(),oe=s(U,!0);l(U),I(()=>u(oe,e(h))),n(V,U)};q(H,V=>{e(h)&&V(Y)})}I(()=>Qe(y,"aria-label",t.common.details)),n(p,_)},$$slots:{default:!0}}),n(B,b),we()}function Sr(B){Dr(B,{})}export{Sr as component};
