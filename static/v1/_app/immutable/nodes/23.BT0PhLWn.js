import"../chunks/disclose-version.BDr9Qe-U.js";import{p as le,a6 as p,o as ce,a3 as R,a as de,j as c,a4 as r,a7 as i,g as t,a9 as s,a8 as h,a5 as ve}from"../chunks/index-client.C1uYfxHd.js";import{s as z}from"../chunks/render.DlGhCWX2.js";import{i as T}from"../chunks/if.DL6pUnI4.js";import{a as n,t as b,b as y}from"../chunks/template.BehheIQn.js";import{p as m}from"../chunks/proxy.bZKuG6wn.js";import{c as ue,a as A,I as K,g as fe}from"../chunks/Input.CUOUCx9V.js";import{B as Q}from"../chunks/Button.BCobGyYN.js";import{j as S,k as ge}from"../chunks/helpers.EoWe9H8J.js";import{C as V}from"../chunks/CheckIcon.DzhsoKrH.js";import{c as pe}from"../chunks/dataFetching.Dq7bE0Ok.js";import{M as me,C as $e}from"../chunks/ContentCenter.BU-nX73m.js";var he=b("<br>-> enable idp registration:<br> <code>chrome://flags/#fedcm-idp-registration</code>",1),be=b('<p><!></p> <p><!> <!> <!></p> <div class="row svelte-wuqbvo"><b>Logged In:</b> <div class="check svelte-wuqbvo"><!></div></div>',1),Ie=b('<div class="flex-col"><h1>FedCM Testing</h1> <div class="row svelte-wuqbvo"><div><b>FedCM supported:</b></div> <div class="check svelte-wuqbvo"><!></div></div> <!> <!></div>'),we=b('<div class="row svelte-wuqbvo"><b>Credential Type:</b> <span> </span></div> <div class="token svelte-wuqbvo"> </div>',1),Ce=b("<!> <!>",1);function ye(W,X){le(X,!0);let _=p(""),I=p(!1),U=p(!1),k=p(""),j=p(""),l=m({clientId:"fedcm",configUrl:"any"}),u=p(m({}));const Y=ue().shape({clientId:A().required("Client ID is required").trim().matches(S,"Must be URL safe"),configUrl:A().nullable().trim().matches(S,"Must be URL safe")});ce(async()=>{if(c(_,`${window.location.origin}/auth/v1/fed_cm/config`),l.clientId=`${window.location.origin}/auth/v1/fed_cm/client_config`,(await pe()).ok?(console.log("FedCM status is: logged-in"),c(U,!0)):console.log("FedCM status is: logged-out"),window.IdentityProvider&&IdentityProvider.register!=null)console.log("FedCM is supported"),c(I,!0);else{console.error("FedCM is not supported");return}});async function Z(){if(!await M())return;let a=l.configUrl||void 0,f=l.clientId;console.log("using credentials get values: configUrl: "+a+" / clientId: "+f);try{let o=await navigator.credentials.get({identity:{mode:"button",providers:[{configURL:a,clientId:f,nonce:fe(48)}]}});console.log(o),c(j,m(o.type)),c(k,m(o.token)),c(U,!0)}catch(o){console.error("FedCM credentials error: "+o)}}function H(){IdentityProvider.register(t(_))}async function M(){try{return await Y.validate(l,{abortEarly:!1}),c(u,m({})),!0}catch(a){return c(u,m(ge(a))),!1}}var x=Ce(),D=R(x);me(D,{children:(a,f)=>{$e(a,{children:(o,q)=>{var $=Ie(),g=r(i($),2),w=r(i(g),2),re=i(w);V(re,{get check(){return t(I)}}),s(w),s(g);var E=r(g,2);{var te=d=>{var C=he();h(4),n(d,C)};T(E,d=>{t(I)||d(te)})}var oe=r(E,2);{var ae=d=>{var C=be(),F=R(C),ie=i(F);Q(ie,{level:3,$$events:{click:H},children:(e,P)=>{h();var v=y("Register IdP");n(e,v)},$$slots:{default:!0}}),s(F);var L=r(F,2),N=i(L);K(N,{autocomplete:"off",placeholder:"Client Id",get value(){return l.clientId},set value(e){l.clientId=e},get error(){return t(u).clientId},set error(e){t(u).clientId=e},$$events:{input:M},children:(e,P)=>{h();var v=y("CLIENT ID");n(e,v)},$$slots:{default:!0}});var B=r(N,2);K(B,{autocomplete:"off",placeholder:"Config URL",get value(){return l.configUrl},set value(e){l.configUrl=e},get error(){return t(u).configUrl},set error(e){t(u).configUrl=e},$$events:{input:M},children:(e,P)=>{h();var v=y("CONFIG URL");n(e,v)},$$slots:{default:!0}});var se=r(B,2);Q(se,{$$events:{click:Z},children:(e,P)=>{h();var v=y("Login");n(e,v)},$$slots:{default:!0}}),s(L);var G=r(L,2),O=r(i(G),2),ne=i(O);V(ne,{get check(){return t(U)}}),s(O),s(G),n(d,C)};T(oe,d=>{t(I)&&d(ae)})}s($),n(o,$)},$$slots:{default:!0}})},$$slots:{default:!0}});var J=r(D,2);{var ee=a=>{var f=we(),o=R(f),q=r(i(o),2),$=i(q,!0);s(q),s(o);var g=r(o,2),w=i(g,!0);s(g),ve(()=>{z($,t(j)),z(w,t(k))}),n(a,f)};T(J,a=>{t(k)&&a(ee)})}n(W,x),de()}export{ye as component};
