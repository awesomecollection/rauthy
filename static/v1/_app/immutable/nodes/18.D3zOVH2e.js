import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.DUFkTaXF.js";import{k as Er,l as Kr,an as Xr,aX as Yr,G as Hr,j as Or,P as Vr,m as Qr,n as Zr,U as et,p as ue,c as l,r as s,t as k,a as pe,f as Z,h as v,s as a,g as e,i as x,aq as F,F as rt,a4 as Ue,a9 as de,ao as Tr,_ as tt}from"../chunks/index-client.CzvcfCLI.js";import{s as f,d as at,e as it}from"../chunks/render.BJBkrb2f.js";import{i as z}from"../chunks/if.Dlf0zx3_.js";import{e as Lr}from"../chunks/each.BtetwUOf.js";import{a as d,t as C,d as B,e as Je,n as ot}from"../chunks/template.CQASMEo4.js";import{s as W,r as lt}from"../chunks/class.DOSp4p8N.js";import{s as Re,t as Ze,a as er}from"../chunks/index.CqGLefLa.js";import{p as I}from"../chunks/proxy.CHyqegA9.js";import{u as st,c as nt,f as ct,d as dt,b as ur}from"../chunks/fetch.DVUNovhB.js";import{C as vt}from"../chunks/ContentAdmin.lyR6-tld.js";import{N as ut}from"../chunks/NavSub.CrZVZZGr.js";import{u as pt}from"../chunks/param.svelte.MG9klZHr.js";import{s as pr}from"../chunks/snippet.Cu-MpcXt.js";import{B as ye}from"../chunks/Button.CjBmYviZ.js";import{p as O}from"../chunks/props.BRvF51YW.js";import{M as _t,I as _r,T as mt}from"../chunks/Tabs.DVYpupb9.js";import{u as Ee}from"../chunks/i18n_admin.svelte.BJXwhDH_.js";import{h as Te}from"../chunks/html.DAmxUMld.js";import{I as D}from"../chunks/Input.DG9-U8Na.js";import{i as ft}from"../chunks/lifecycle.5xT7nXdO.js";import{g as ht}from"../chunks/helpers.mrWtKrwW.js";import{I as Mr}from"../chunks/IconCheck.kaTN2egQ.js";import{I as Ar}from"../chunks/InputPassword.CLwZr0KC.js";import{F as Pr}from"../chunks/Form.HTTUzO_J.js";import{u as mr}from"../chunks/i18n.svelte.BgTCv98Z.js";import{L as fr,E as gt}from"../chunks/LabeledValue.bm1VTFAO.js";import{a as bt,c as kt}from"../chunks/input.mmO6A0Hj.js";import{f as J,g as Ur,b as Rr,h as hr}from"../chunks/patterns.BSnCcuba.js";import{q as gr}from"../chunks/helpers.kNqlWGzE.js";import{L as wt}from"../chunks/Loading.DqrV7Awu.js";import"../chunks/Switch.CwDfiuqK.js";import{C as Sr}from"../chunks/CheckIcon.DLVsj7KZ.js";import{O as $t}from"../chunks/Options.BADoqzxk.js";function Ct(P,n,r){Er&&Kr();var c=P,o=et,p,m=Xr()?Yr:Hr;Or(()=>{m(o,o=n())&&(p&&Vr(p),p=Qr(()=>r(c)))}),Er&&(c=Zr)}var It=C('<div class="svelte-1emf3rj"><!></div>'),yt=C('<li class="svelte-1emf3rj"><!></li>');function Et(P,n){ue(n,!0);var r=yt(),c=l(r);ye(c,{invisible:!0,get onclick(){return n.onclick},children:(o,p)=>{var m=It(),u=l(m);pr(u,()=>n.children),s(m),d(o,m)},$$slots:{default:!0}}),s(r),k(()=>W(r,"aria-current",n.selected?"page":"false")),d(P,r),pe()}var Tt=C("<!> <!>",1);function Lt(P,n){ue(n,!0);let r=O(n,"level",3,2),c=O(n,"closeModal",15),o=Ee(),p=x(!1);var m=Tt(),u=Z(m);ye(u,{get level(){return r()},onclick:()=>v(p,!0),children:(w,$)=>{F();var t=B();k(()=>f(t,o.common.addNew)),d(w,t)},$$slots:{default:!0}});var U=a(u,2);_t(U,{get onClose(){return n.onClose},get showModal(){return e(p)},set showModal(w){v(p,I(w))},get closeModal(){return c()},set closeModal(w){c(w)},children:(w,$)=>{var t=Je(),E=Z(t);pr(E,()=>n.children),d(w,t)},$$slots:{default:!0}}),d(P,m),pe()}var Mt=C('<div class="desc svelte-6fcb3i"><h4 class="svelte-6fcb3i">ID token claim mappings</h4> <p class="svelte-6fcb3i"> </p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p> <p class="svelte-6fcb3i"><!></p></div>');function qr(P,n){ue(n,!1);let r=Ee();ft();var c=Mt(),o=a(l(c),2),p=l(o,!0);s(o);var m=a(o,2),u=l(m);Te(u,()=>r.providers.config.jsonPath.p2),s(m);var U=a(m,2),w=l(U);Te(w,()=>r.providers.config.jsonPath.p3),s(U);var $=a(U,2),t=l($);Te(t,()=>r.providers.config.jsonPath.p4),s($);var E=a($,2),h=l(E);Te(h,()=>r.providers.config.jsonPath.p5),s(E);var R=a(E,2),g=l(R);Te(g,()=>r.providers.config.jsonPath.p6),s(R),s(c),k(()=>f(p,r.providers.config.jsonPath.p1)),d(P,c),pe()}var At=C('<img alt="No Logo Available">');function Pt(P,n){ue(n,!0);var r=At();k(()=>W(r,"src",`/auth/v1/providers/${n.providerId}/img?${ht(6)}`)),W(r,"width",20),W(r,"height",20),d(P,r),pe()}function Ut(P,n){P.code==="Enter"&&n()}var Rt=C('<label class="font-label noselect svelte-t6wfg9"><input type="checkbox" class="svelte-t6wfg9"> <span class="svelte-t6wfg9"><!></span></label>');function le(P,n){ue(n,!0);let r=O(n,"checked",15,!1),c=O(n,"ariaLabel",3,""),o=O(n,"borderColor",3,"hsl(var(--bg-high))");function p(){r(!r())}var m=Rt(),u=l(m);lt(u),u.__click=p,u.__keydown=[Ut,p];var U=a(u,2),w=l(U);pr(w,()=>n.children??rt),s(U),s(m),k(()=>{W(u,"name",n.name),u.disabled=n.disabled,W(u,"aria-disabled",n.disabled),W(u,"aria-checked",r()),W(u,"aria-label",c()),Re(u,"border-color",o())}),bt(u,r),d(P,m),pe()}at(["click","keydown"]);var St=ot('<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"></path></svg>');function qt(P,n){let r=O(n,"opacity",3,.9),c=O(n,"width",3,"1.5rem"),o=O(n,"color",3,"currentColor");var p=St();W(p,"stroke-width",2),k(()=>{W(p,"stroke",o()),W(p,"width",c()),W(p,"opacity",r())}),d(P,p)}var xt=C('<div class="flex space-between loading svelte-1k623j2"><span class="flex gap-05"><span> </span> <span> </span> <span>/</span> <span> </span></span> <!></div>'),jt=C('<label class="svelte-1k623j2"><!></label> <input type="file" class="svelte-1k623j2">',1),Nt=C('<form aria-dropeffect="move" aria-label="Upload" class="flex svelte-1k623j2"><!></form>');function zt(P,n){ue(n,!0);let r=O(n,"method",3,"PUT"),c=O(n,"accept",19,()=>[".image/jpg","image/jpeg","image/png","image/svg"]),o=O(n,"buttonOnly",3,!1),p=O(n,"buttonSize",3,"1.5rem"),m=O(n,"multiple",3,!1),u=O(n,"width",3,"17rem"),U=O(n,"height",3,"2.5rem");const w=gr();let $=Ee(),t=x(!1),E=x(void 0),h=x(0),R=x(0);Ue(()=>{!e(t)&&e(E)&&e(E).length>0&&L(e(E))});function g(S){var T;v(E,I((T=S.dataTransfer)==null?void 0:T.files))}async function L(S){var T;v(h,I(S.length)),v(R,0),v(t,!0);for(let j of S){if(console.log("uploading file",j),c()&&!c().includes(j.type)){v(R,e(R)+1);continue}let ee=await st(r(),n.url,j,n.fileName||j.name);ee.error?console.error(ee.error):(T=n.onSuccess)==null||T.call(n),v(R,e(R)+1)}v(E,void 0),v(t,!1)}var y=Nt(),G=l(y);{var re=S=>{var T=xt(),j=l(T),ee=l(j),X=l(ee);s(ee);var se=a(ee,2),_e=l(se,!0);s(se);var K=a(se,4),N=l(K,!0);s(K),s(j);var Q=a(j,2);wt(Q,{}),s(T),k(()=>{f(X,`${$.common.loading??""}:`),f(_e,e(R)),f(N,e(h))}),d(S,T)},V=S=>{var T=jt(),j=Z(T);W(j,"for",w);var ee=l(j);qt(ee,{get width(){return p()}}),s(j);var X=a(j,2);W(X,"id",w),k(()=>W(X,"accept",c()&&c().join(", "))),k(()=>{W(j,"aria-disabled",n.disabled),W(X,"aria-hidden",o()),W(X,"aria-disabled",n.disabled),X.disabled=n.disabled,X.multiple=m()}),kt(X,()=>e(E),se=>v(E,se)),d(S,T)};z(G,S=>{e(t)?S(re):S(V,!1)})}s(y),k(()=>{W(y,"data-nopad",o()),Re(y,"width",u()),Re(y,"height",U())}),it("drop",y,g),d(P,y),pe()}var Dt=C("<div><!></div>"),Gt=C('<div class="checkbox svelte-iec8od"><!></div>'),Ft=C('<div class="err"> </div>'),Bt=C('<div class="svelte-iec8od"><!></div>'),Wt=C('<span class="err"> </span>'),Jt=C('<!> <div></div> <div class="checkbox svelte-iec8od"><!></div> <div class="checkbox svelte-iec8od"><!></div> <!> <!> <!> <!> <!> <div class="checkbox svelte-iec8od"><!></div> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p class="desc svelte-iec8od"> </p> <!> <p><!></p> <div class="checkbox svelte-iec8od"><!></div> <div class="checkbox svelte-iec8od"><!></div> <!> <!> <p class="desc svelte-iec8od"> </p> <!> <!> <p class="desc svelte-iec8od"> </p> <!> <!> <div class="logo svelte-iec8od"><!> <!></div> <div class="flex gap-05"><!> <!> <!></div>',1),Kt=C('<div class="container svelte-iec8od"><!></div>');function Xt(P,n){ue(n,!0);let r=O(n,"provider",15),c=mr(),o=Ee();const p="min(calc(100dvw - .5rem), 30rem)";let m=!1,u=x(""),U=x(!1),w=x(!!r().root_pem),$=x(I(gr()));Ue(()=>{r().id&&(r(r().client_secret=r().client_secret||"",!0),r(r().admin_claim_path=r().admin_claim_path||"",!0),r(r().admin_claim_value=r().admin_claim_value||"",!0),r(r().mfa_claim_path=r().mfa_claim_path||"",!0),r(r().mfa_claim_value=r().mfa_claim_value||"",!0),r(r().root_pem=r().root_pem||"",!0))}),Ue(()=>{r().scope&&r(r().scope=r().scope.replaceAll("+"," "),!0)});async function t(g,L){if(v(u,""),r().client_secret&&!(r().client_secret_basic||r().client_secret_post)){v(u,I(o.providers.config.errNoAuthMethod));return}if(!r().use_pkce&&!r().client_secret){v(u,I(o.providers.config.errConfidential));return}let y={name:r().name,typ:r().typ,enabled:r().enabled,issuer:r().issuer,authorization_endpoint:r().authorization_endpoint,token_endpoint:r().token_endpoint,userinfo_endpoint:r().userinfo_endpoint,danger_allow_insecure:e(w)&&r().root_pem?!1:r().danger_allow_insecure,use_pkce:r().use_pkce,client_secret_basic:r().client_secret_basic,client_secret_post:r().client_secret_post,client_id:r().client_id,client_secret:r().client_secret||void 0,scope:r().scope.trim(),root_pem:e(w)&&r().root_pem?r().root_pem.trim():void 0,admin_claim_path:r().admin_claim_path||void 0,admin_claim_value:r().admin_claim_value||void 0,mfa_claim_path:r().mfa_claim_path||void 0,mfa_claim_value:r().mfa_claim_value||void 0},G=await nt(g.action,y);G.error?v(u,I(G.error.message)):(v(U,!0),n.onSave(),setTimeout(()=>{v(U,!1)},3e3))}var E=Kt(),h=l(E),R=de(()=>`/auth/v1/providers/${r().id}`);Pr(h,{get action(){return e(R)},onSubmit:t,children:(g,L)=>{var y=Jt(),G=Z(y);fr(G,{label:"ID",mono:!0,children:(i,M)=>{F();var A=B();k(()=>f(A,r().id)),d(i,A)},$$slots:{default:!0}});var re=a(G,2);Re(re,"height",".15rem");var V=a(re,2),S=l(V);le(S,{get ariaLabel(){return o.common.enabled},get checked(){return r().enabled},set checked(i){r(r().enabled=i,!0)},children:(i,M)=>{F();var A=B();k(()=>f(A,o.common.enabled)),d(i,A)},$$slots:{default:!0}}),s(V);var T=a(V,2),j=l(T);le(j,{get ariaLabel(){return o.providers.config.custRootCa},get checked(){return e(w)},set checked(i){v(w,I(i))},children:(i,M)=>{F();var A=B();k(()=>f(A,o.providers.config.custRootCa)),d(i,A)},$$slots:{default:!0}}),s(T);var ee=a(T,2);{var X=i=>{var M=Dt(),A=l(M);_r(A,{rows:15,name:"rootPem",get label(){return o.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
 -----END CERTIFICATE-----`,errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - .5rem))",fontMono:!0,pattern:hr,get value(){return r().root_pem},set value(fe){r(r().root_pem=fe,!0)}}),s(M),Ze(3,M,()=>er,()=>({duration:150})),d(i,M)},se=i=>{var M=Gt(),A=l(M);le(A,{get ariaLabel(){return o.providers.config.allowInsecureTls},get checked(){return r().danger_allow_insecure},set checked(fe){r(r().danger_allow_insecure=fe,!0)},children:(fe,br)=>{F();var Be=B();k(()=>f(Be,o.providers.config.allowInsecureTls)),d(fe,Be)},$$slots:{default:!0}}),s(M),d(i,M)};z(ee,i=>{e(w)?i(X):i(se,!1)})}var _e=a(ee,2);D(_e,{autocomplete:"off",label:"Issuer URL",placeholder:"Issuer URL",required:!0,pattern:J,width:p,get value(){return r().issuer},set value(i){r(r().issuer=i,!0)}});var K=a(_e,2);D(K,{typ:"url",autocomplete:"off",label:"Authorization Endpoint",placeholder:"Authorization Endpoint",required:!0,pattern:J,width:p,get value(){return r().authorization_endpoint},set value(i){r(r().authorization_endpoint=i,!0)}});var N=a(K,2);D(N,{typ:"url",autocomplete:"off",label:"Token Endpoint",placeholder:"Token Endpoint",required:!0,pattern:J,width:p,get value(){return r().token_endpoint},set value(i){r(r().token_endpoint=i,!0)}});var Q=a(N,2);D(Q,{typ:"url",autocomplete:"off",label:"Userinfo Endpoint",placeholder:"Userinfo Endpoint",required:!0,pattern:J,width:p,get value(){return r().userinfo_endpoint},set value(i){r(r().userinfo_endpoint=i,!0)}});var b=a(Q,2),be=l(b);le(be,{ariaLabel:"PKCE",get checked(){return r().use_pkce},set checked(i){r(r().use_pkce=i,!0)},children:(i,M)=>{F();var A=B("PKCE");d(i,A)},$$slots:{default:!0}}),s(b);var me=a(b,2),ke=l(me,!0);s(me);var we=a(me,2);D(we,{autocomplete:"off",label:"Scope",placeholder:"openid profile email",required:!0,pattern:Ur,width:p,get value(){return r().scope},set value(i){r(r().scope=i,!0)}});var $e=a(we,2),Ke=l($e,!0);s($e);var Se=a($e,2);D(Se,{autocomplete:"off",get label(){return o.providers.config.clientName},get placeholder(){return o.providers.config.clientName},required:!0,pattern:Rr,width:p,get value(){return r().name},set value(i){r(r().name=i,!0)}});var Le=a(Se,2),rr=l(Le,!0);s(Le);var qe=a(Le,2);D(qe,{autocomplete:"off",label:"Client ID",placeholder:"Client ID",required:!0,pattern:J,width:p,get value(){return r().client_id},set value(i){r(r().client_id=i,!0)}});var xe=a(qe,2),tr=l(xe,!0);s(xe);var Xe=a(xe,2),q=de(()=>!r().use_pkce);Ar(Xe,{autocomplete:"off",label:"Client Secret",placeholder:"Client Secret",maxLength:256,get errMsg(){return o.providers.config.errConfidential},get required(){return e(q)},width:p,get value(){return r().client_secret},set value(i){r(r().client_secret=i,!0)}});var Y=a(Xe,2),ae=l(Y);Te(ae,()=>o.providers.config.descAuthMethod),s(Y);var ve=a(Y,2),je=l(ve);le(je,{ariaLabel:"client_secret_basic",get checked(){return r().client_secret_basic},set checked(i){r(r().client_secret_basic=i,!0)},children:(i,M)=>{F();var A=B("client_secret_basic");d(i,A)},$$slots:{default:!0}}),s(ve);var ne=a(ve,2),ge=l(ne);le(ge,{ariaLabel:"client_secret_post",get checked(){return r().client_secret_post},set checked(i){r(r().client_secret_post=i,!0)},children:(i,M)=>{F();var A=B("client_secret_post");d(i,A)},$$slots:{default:!0}}),s(ne);var te=a(ne,2);{var ie=i=>{var M=Ft(),A=l(M,!0);s(M),k(()=>f(A,o.providers.config.errNoAuthMethod)),Ze(3,M,()=>er,()=>({duration:150})),d(i,M)};z(te,i=>{!r().use_pkce&&!r().client_secret_basic&&!r().client_secret_post&&i(ie)})}var oe=a(te,2);qr(oe,{});var ce=a(oe,2),Ne=l(ce,!0);s(ce);var Ce=a(ce,2);D(Ce,{autocomplete:"off",get label(){return o.providers.config.pathAdminClaim},placeholder:"$.roles.*",pattern:J,width:p,get value(){return r().admin_claim_path},set value(i){r(r().admin_claim_path=i,!0)}});var Ye=a(Ce,2);D(Ye,{autocomplete:"off",get label(){return o.providers.config.valueAdminClaim},placeholder:"rauthy_admin",pattern:J,width:p,get value(){return r().admin_claim_value},set value(i){r(r().admin_claim_value=i,!0)}});var Me=a(Ye,2),He=l(Me,!0);s(Me);var ze=a(Me,2);D(ze,{autocomplete:"off",get label(){return o.providers.config.pathMfaClaim},placeholder:"$.amr.*",pattern:J,width:p,get value(){return r().mfa_claim_path},set value(i){r(r().mfa_claim_path=i,!0)}});var De=a(ze,2);D(De,{autocomplete:"off",get label(){return o.providers.config.valueMfaClaim},placeholder:"mfa",pattern:J,width:p,get value(){return r().mfa_claim_value},set value(i){r(r().mfa_claim_value=i,!0)}});var Ie=a(De,2),Oe=l(Ie);Ct(Oe,()=>e($),i=>{var M=Bt(),A=l(M);Pt(A,{get providerId(){return r().id}}),s(M),d(i,M)});var ar=a(Oe,2),ir=de(()=>`/auth/v1/providers/${r().id}/img`);zt(ar,{method:"PUT",get url(){return e(ir)},fileName:"logo",onSuccess:()=>v($,I(gr()))}),s(Ie);var Ae=a(Ie,2),Ve=l(Ae);ye(Ve,{type:"submit",get isLoading(){return m},children:(i,M)=>{F();var A=B();k(()=>f(A,c.common.save)),d(i,A)},$$slots:{default:!0}});var Ge=a(Ve,2);{var Fe=i=>{Mr(i,{})};z(Ge,i=>{e(U)&&i(Fe)})}var or=a(Ge,2);{var Qe=i=>{var M=Wt(),A=l(M,!0);s(M),k(()=>f(A,e(u))),d(i,M)};z(or,i=>{e(u)&&i(Qe)})}s(Ae),k(()=>{f(ke,o.providers.config.descScope),f(Ke,o.providers.config.descClientName),f(rr,o.providers.config.descClientId),f(tr,o.providers.config.descClientSecret),f(Ne,o.providers.config.mapUser),f(He,o.providers.config.mapMfa)}),d(g,y)},$$slots:{default:!0}}),s(E),d(P,E),pe()}var Yt=C('<div class="user svelte-1vu6qeb"> <span class="muted font-mono svelte-1vu6qeb"> </span></div>'),Ht=C('<div class="forceDelete svelte-1vu6qeb"> </div>'),Ot=C('<p class="err"><b> </b></p> <p> </p> <!> <p> </p> <!> <!>',1),Vt=C("<p> </p> <!>",1),Qt=C('<div class="err"> </div>'),Zt=C('<div class="container svelte-1vu6qeb"><!> <!></div>');function ea(P,n){ue(n,!0);let r=mr(),c=Ee(),o=x(!0),p=x(""),m=x(!1),u=x(I([]));Tr(async()=>{let g=await ct(`/auth/v1/providers/${n.provider.id}/delete_safe`);g.status===406&&g.error&&v(u,I(g.error)),v(o,!1)});async function U(){v(p,""),v(o,!0);let g=await dt(`/auth/v1/providers/${n.provider.id}`);g.error?v(p,I(g.error.message)):n.onSave(),v(o,!1)}var w=Zt(),$=l(w);{var t=g=>{var L=Ot(),y=Z(L),G=l(y),re=l(G,!0);s(G),s(y);var V=a(y,2),S=l(V,!0);s(V);var T=a(V,2);gt(T,{summary:K=>{F();var N=B();k(()=>f(N,c.providers.delete.linkedUsers)),d(K,N)},details:K=>{var N=Je(),Q=Z(N);Lr(Q,17,()=>e(u),b=>b.id,(b,be)=>{var me=Yt(),ke=l(me),we=a(ke),$e=l(we);s(we),s(me),k(()=>{f(ke,`${e(be).email??""} `),f($e,`/ ${e(be).id??""}`)}),d(b,me)}),d(K,N)},$$slots:{summary:!0,details:!0}});var j=a(T,2),ee=l(j,!0);s(j);var X=a(j,2);le(X,{get ariaLabel(){return c.providers.delete.forceDelete},get checked(){return e(m)},set checked(K){v(m,I(K))},children:(K,N)=>{var Q=Ht(),b=l(Q,!0);s(Q),k(()=>f(b,c.providers.delete.forceDelete)),d(K,Q)},$$slots:{default:!0}});var se=a(X,2);{var _e=K=>{ye(K,{level:-1,onclick:U,get isLoading(){return e(o)},children:(N,Q)=>{F();var b=B();k(()=>f(b,r.common.delete)),d(N,b)},$$slots:{default:!0}})};z(se,K=>{e(m)&&K(_e)})}k(()=>{f(re,c.providers.delete.isInUse1),f(S,c.providers.delete.isInUse2),f(ee,c.providers.delete.areYouSure)}),d(g,L)},E=g=>{var L=Vt(),y=Z(L),G=l(y,!0);s(y);var re=a(y,2);ye(re,{level:-1,onclick:U,get isLoading(){return e(o)},children:(V,S)=>{F();var T=B();k(()=>f(T,r.common.delete)),d(V,T)},$$slots:{default:!0}}),k(()=>f(G,c.providers.delete.areYouSure)),d(g,L)};z($,g=>{e(u).length>0?g(t):g(E,!1)})}var h=a($,2);{var R=g=>{var L=Qt(),y=l(L,!0);s(L),k(()=>f(y,e(p))),d(g,L)};z(h,g=>{e(p)&&g(R)})}s(w),d(P,w),pe()}var ra=C('<div class="flex"><!></div> <!>',1);function ta(P,n){let r=O(n,"provider",15),c=O(n,"onSave",15);const o=["Config","Delete"];let p=x(I(o[0]));var m=ra(),u=Z(m),U=l(u);mt(U,{tabs:o,get selected(){return e(p)},set selected(E){v(p,I(E))}}),s(u);var w=a(u,2);{var $=E=>{Xt(E,{get provider(){return r()},set provider(h){r(h)},get onSave(){return c()},set onSave(h){c(h)}})},t=E=>{var h=Je(),R=Z(h);{var g=L=>{ea(L,{get provider(){return r()},get onSave(){return c()},set onSave(y){c(y)}})};z(R,L=>{e(p)==="Delete"&&L(g)},!0)}d(E,h)};z(w,E=>{e(p)==="Config"?E($):E(t,!1)})}d(P,m)}var aa=C("<div><!></div>"),ia=C('<div class="checkbox svelte-f8e9ia"><!></div>'),oa=C('<div class="checkbox svelte-f8e9ia"><!></div> <!>',1),la=C('<div class="ml mb"><!></div>'),sa=C('<div class="err"> </div>'),na=C('<!> <!> <!> <!> <!> <div class="checkbox svelte-f8e9ia"><!></div> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p class="desc svelte-f8e9ia"> </p> <!> <p><!></p> <div class="checkbox svelte-f8e9ia"><!></div> <div class="checkbox svelte-f8e9ia"><!></div> <!> <!> <p class="desc svelte-f8e9ia"> </p> <!> <!> <p class="desc svelte-f8e9ia"> </p> <!> <!>',1),ca=C('<div class="err"> </div>'),da=C('<!> <!> <div class="flex gap-05"><!> <!> <!> <!></div>',1),va=C('<div class="container svelte-f8e9ia"><!> <div></div> <!></div>');function ua(P,n){ue(n,!0);let r=mr(),c=Ee();const o="min(calc(100dvw - 1.75rem), 30rem)";let p=x(!1),m=x(""),u=x(!1),U=x(!1),w=x(!1),$=x(I({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),t=x(I({enabled:!0,typ:"oidc",issuer:"",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",token_auth_method_basic:!1,userinfo_endpoint:"",use_pkce:!0,client_secret_basic:!0,client_secret_post:!1,name:"",client_id:"",client_secret:"",scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""})),E=["OIDC","Auto","Custom","Github","Google"],h=x(I(E[0])),R=de(()=>e(h)==="Auto"),g=de(()=>e(h)==="Custom"),L=de(()=>e(h)==="OIDC"),y=de(()=>!e(R)&&!e(g)&&!e(L)),G=de(()=>!(e(y)||e(g)||e(u)));const re="/auth/v1/providers/lookup";let V=de(()=>e(G)?re:"/auth/v1/providers/create");Ue(()=>{if(e(h))switch(v(u,!1),v($,I({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),e(h)){case"Github":v(t,I({enabled:!0,issuer:"github.com",typ:"github",danger_allow_insecure:!1,authorization_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",client_secret_basic:!0,client_secret_post:!0,userinfo_endpoint:"https://api.github.com/user",use_pkce:!1,name:"Github",client_id:"",client_secret:"",scope:"user:email",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"$.two_factor_authentication",mfa_claim_value:"true"}));break;case"Google":v($,I({issuer:"accounts.google.com",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),tt(()=>{j(re)});break;default:v(t,I({enabled:!0,issuer:"",typ:"oidc",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",client_secret_basic:!0,client_secret_post:!1,userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret:"",scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""}))}}),Ue(()=>{e(U)&&setTimeout(()=>{n.onSave(),ee()},1500)});async function S(N,Q){e(G)?await j(N.action):await T(N.action)}async function T(N){if(e(t).client_secret&&!(e(t).client_secret_basic||e(t).client_secret_post)){v(m,I(c.providers.config.errNoAuthMethod));return}if(!e(t).use_pkce&&!e(t).client_secret){v(m,I(c.providers.config.errConfidential));return}v(m,""),v(p,!0);let Q={name:e(t).name,typ:e(R)?"custom":e(h).toLowerCase(),enabled:e(t).enabled,issuer:e(t).issuer,authorization_endpoint:e(t).authorization_endpoint,token_endpoint:e(t).token_endpoint,userinfo_endpoint:e(t).userinfo_endpoint,danger_allow_insecure:e(w)&&e(t).root_pem?!1:e(t).danger_allow_insecure,use_pkce:e(t).use_pkce,client_secret_basic:e(t).client_secret_basic,client_secret_post:e(t).client_secret_post,client_id:e(t).client_id,client_secret:e(t).client_secret,scope:e(t).scope.trim(),root_pem:e(w)&&e(t).root_pem?e(t).root_pem.trim():void 0,admin_claim_path:e(t).admin_claim_path||void 0,admin_claim_value:e(t).admin_claim_value||void 0,mfa_claim_path:e(t).mfa_claim_path||void 0,mfa_claim_value:e(t).mfa_claim_value||void 0},b=await ur(N,Q);b.error?b.error.message.includes("InvalidCertificate")?v(m,"Insecure connection not allowed"):v(m,I(b.error.message)):v(U,!0),v(p,!1)}async function j(N){if(!e($).issuer&&!e($).metadata_url){v(m,"Provide at least one of Issuer / Metadata URL");return}v(m,""),v(p,!0);let Q={issuer:e($).issuer||void 0,metadata_url:e($).metadata_url||void 0,danger_allow_insecure:e($).danger_allow_insecure,root_pem:e($).root_pem||void 0},b=await ur(N,Q);b.body?(e(t).issuer=b.body.issuer,e(t).authorization_endpoint=b.body.authorization_endpoint,e(t).danger_allow_insecure=b.body.danger_allow_insecure,e(t).token_endpoint=b.body.token_endpoint,e(t).userinfo_endpoint=b.body.userinfo_endpoint,e(t).client_secret_basic=b.body.client_secret_basic,e(t).client_secret_post=b.body.client_secret_post,e(t).use_pkce=b.body.use_pkce,e(t).client_secret_basic=b.body.client_secret_basic,e(t).client_secret_post=!b.body.client_secret_basic&&b.body.client_secret_post,e(t).scope=b.body.scope,e(t).root_pem=b.body.root_pem,v(u,!0)):b.error&&(b.error.message.includes("InvalidCertificate")?v(m,"Insecure connection not allowed"):v(m,I(b.error.message))),v(p,!1)}function ee(){v($,I({issuer:"",metadata_url:"",danger_allow_insecure:!1,root_pem:""})),v(t,I({enabled:!0,issuer:"",typ:"oidc",danger_allow_insecure:!1,authorization_endpoint:"",token_endpoint:"",userinfo_endpoint:"",use_pkce:!0,name:"",client_id:"",client_secret_basic:!0,client_secret_post:!1,scope:"",root_pem:"",admin_claim_path:"",admin_claim_value:"",mfa_claim_path:"",mfa_claim_value:""})),v(U,!1),v(u,!1),v(w,!1)}var X=va(),se=l(X);$t(se,{ariaLabel:"Select Mode",options:E,get value(){return e(h)},set value(N){v(h,I(N))}});var _e=a(se,2);Re(_e,"height",".5rem");var K=a(_e,2);Pr(K,{get action(){return e(V)},onSubmit:S,children:(N,Q)=>{var b=da(),be=Z(b);{var me=q=>{var Y=oa(),ae=Z(Y),ve=l(ae);le(ve,{get ariaLabel(){return c.providers.config.custRootCa},get checked(){return e(w)},set checked(te){v(w,I(te))},children:(te,ie)=>{F();var oe=B();k(()=>f(oe,c.providers.config.custRootCa)),d(te,oe)},$$slots:{default:!0}}),s(ae);var je=a(ae,2);{var ne=te=>{var ie=aa(),oe=l(ie);_r(oe,{rows:15,name:"rootPem",get label(){return c.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - 1.75rem))",fontMono:!0,pattern:hr,get value(){return e($).root_pem},set value(ce){e($).root_pem=ce}}),s(ie),Ze(3,ie,()=>er,()=>({duration:150})),d(te,ie)},ge=te=>{var ie=ia(),oe=l(ie);le(oe,{get ariaLabel(){return c.providers.config.allowInsecureTls},get checked(){return e($).danger_allow_insecure},set checked(ce){e($).danger_allow_insecure=ce},children:(ce,Ne)=>{F();var Ce=B();k(()=>f(Ce,c.providers.config.allowInsecureTls)),d(ce,Ce)},$$slots:{default:!0}}),s(ie),d(te,ie)};z(je,te=>{e(w)?te(ne):te(ge,!1)})}d(q,Y)};z(be,q=>{e(u)||q(me)})}var ke=a(be,2);{var we=q=>{D(q,{name:"issuer",label:"Issuer URL",placeholder:"Issuer URL",width:o,required:!0,pattern:J,get value(){return e($).issuer},set value(Y){e($).issuer=Y}})},$e=q=>{var Y=Je(),ae=Z(Y);{var ve=ne=>{D(ne,{typ:"url",name:"metadata",label:"Metadata URL",placeholder:".../.well-known/openid-configuration",width:o,required:!0,pattern:J,get value(){return e($).metadata_url},set value(ge){e($).metadata_url=ge}})},je=ne=>{var ge=Je(),te=Z(ge);{var ie=oe=>{var ce=na(),Ne=Z(ce);{var Ce=_=>{_r(_,{rows:17,name:"rootPem",get label(){return c.providers.config.rootPemCert},placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,get disabled(){return e(u)},errMsg:"-----BEGIN CERTIFICATE----- ...",width:"min(40rem, calc(100dvw - 1.75rem))",fontMono:!0,pattern:hr,get value(){return e(t).root_pem},set value(H){e(t).root_pem=H}})},Ye=_=>{var H=la(),he=l(H);{var vr=Pe=>{fr(Pe,{get label(){return c.providers.config.allowInsecureTls},children:(We,Jr)=>{Sr(We,{get check(){return e(t).danger_allow_insecure}})},$$slots:{default:!0}})},Wr=Pe=>{le(Pe,{get ariaLabel(){return c.providers.config.allowInsecureTls},get checked(){return e(t).danger_allow_insecure},set checked(We){e(t).danger_allow_insecure=We},children:(We,Jr)=>{F();var yr=B();k(()=>f(yr,c.providers.config.allowInsecureTls)),d(We,yr)},$$slots:{default:!0}})};z(he,Pe=>{e(u)?Pe(vr):Pe(Wr,!1)})}s(H),d(_,H)};z(Ne,_=>{e(w)?_(Ce):_(Ye,!1)})}var Me=a(Ne,2);D(Me,{name:"issuer",label:"Issuer URL",placeholder:"Issuer URL",width:o,get disabled(){return e(u)},required:!0,pattern:J,get value(){return e(t).issuer},set value(_){e(t).issuer=_}});var He=a(Me,2);D(He,{typ:"url",name:"auth_endpoint",label:"Authorization Endpoint",placeholder:"Authorization Endpoint",width:o,get disabled(){return e(u)},required:!0,pattern:J,get value(){return e(t).authorization_endpoint},set value(_){e(t).authorization_endpoint=_}});var ze=a(He,2);D(ze,{typ:"url",name:"token_endpoint",label:"Token Endpoint",placeholder:"Token Endpoint",width:o,get disabled(){return e(u)},required:!0,pattern:J,get value(){return e(t).token_endpoint},set value(_){e(t).token_endpoint=_}});var De=a(ze,2);D(De,{typ:"url",name:"userinfo_endpoint",label:"Userinfo Endpoint",placeholder:"Userinfo Endpoint",width:o,get disabled(){return e(u)},required:!0,pattern:J,get value(){return e(t).userinfo_endpoint},set value(_){e(t).userinfo_endpoint=_}});var Ie=a(De,2),Oe=l(Ie);{var ar=_=>{fr(_,{label:"PKCE",children:(H,he)=>{Sr(H,{get check(){return e(t).use_pkce}})},$$slots:{default:!0}})},ir=_=>{le(_,{ariaLabel:"PKCE",get checked(){return e(t).use_pkce},set checked(H){e(t).use_pkce=H},children:(H,he)=>{F();var vr=B("PKCE");d(H,vr)},$$slots:{default:!0}})};z(Oe,_=>{e(u)?_(ar):_(ir,!1)})}s(Ie);var Ae=a(Ie,2),Ve=l(Ae,!0);s(Ae);var Ge=a(Ae,2);D(Ge,{name:"scope",label:"Scope",placeholder:"openid profile email",width:o,required:!0,pattern:Ur,get value(){return e(t).scope},set value(_){e(t).scope=_}});var Fe=a(Ge,2),or=l(Fe,!0);s(Fe);var Qe=a(Fe,2);D(Qe,{name:"client_name",label:"Client Name",placeholder:"Client Name",width:o,required:!0,pattern:Rr,get value(){return e(t).name},set value(_){e(t).name=_}});var i=a(Qe,2),M=l(i,!0);s(i);var A=a(i,2);D(A,{name:"client_id",autocomplete:"off",label:"Client ID",placeholder:"Client ID",width:o,required:!0,pattern:J,get value(){return e(t).client_id},set value(_){e(t).client_id=_}});var fe=a(A,2),br=l(fe,!0);s(fe);var Be=a(fe,2),xr=de(()=>!e(t).use_pkce);Ar(Be,{name:"client_secret",autocomplete:"off",label:"Client Secret",placeholder:"Client Secret",width:o,get errMsg(){return c.providers.config.errConfidential},maxLength:256,get required(){return e(xr)},get value(){return e(t).client_secret},set value(_){e(t).client_secret=_}});var lr=a(Be,2),jr=l(lr);Te(jr,()=>c.providers.config.descAuthMethod),s(lr);var sr=a(lr,2),Nr=l(sr);le(Nr,{ariaLabel:"client_secret_basic",get checked(){return e(t).client_secret_basic},set checked(_){e(t).client_secret_basic=_},children:(_,H)=>{F();var he=B("client_secret_basic");d(_,he)},$$slots:{default:!0}}),s(sr);var nr=a(sr,2),zr=l(nr);le(zr,{ariaLabel:"client_secret_post",get checked(){return e(t).client_secret_post},set checked(_){e(t).client_secret_post=_},children:(_,H)=>{F();var he=B("client_secret_post");d(_,he)},$$slots:{default:!0}}),s(nr);var kr=a(nr,2);{var Dr=_=>{var H=sa(),he=l(H,!0);s(H),k(()=>f(he,c.providers.config.errNoAuthMethod)),Ze(3,H,()=>er,()=>({duration:150})),d(_,H)};z(kr,_=>{!e(t).use_pkce&&!e(t).client_secret_basic&&!e(t).client_secret_post&&_(Dr)})}var wr=a(kr,2);qr(wr,{});var cr=a(wr,2),Gr=l(cr,!0);s(cr);var $r=a(cr,2);D($r,{name:"admin_claim_path",get label(){return c.providers.config.pathAdminClaim},placeholder:"$.roles.*",width:o,pattern:J,get value(){return e(t).admin_claim_path},set value(_){e(t).admin_claim_path=_}});var Cr=a($r,2);D(Cr,{name:"admin_claim_value",get label(){return c.providers.config.valueAdminClaim},placeholder:"rauthy_admin",width:o,pattern:J,get value(){return e(t).admin_claim_value},set value(_){e(t).admin_claim_value=_}});var dr=a(Cr,2),Fr=l(dr,!0);s(dr);var Ir=a(dr,2);D(Ir,{name:"mfa_claim_path",get label(){return c.providers.config.pathMfaClaim},placeholder:"$.amr.*",width:o,pattern:J,get value(){return e(t).mfa_claim_path},set value(_){e(t).mfa_claim_path=_}});var Br=a(Ir,2);D(Br,{name:"mfa_claim_value",get label(){return c.providers.config.valueMfaClaim},placeholder:"mfa",width:o,pattern:J,get value(){return e(t).mfa_claim_value},set value(_){e(t).mfa_claim_value=_}}),k(()=>{f(Ve,c.providers.config.descScope),f(or,c.providers.config.descClientName),f(M,c.providers.config.descClientId),f(br,c.providers.config.descClientId),f(Gr,c.providers.config.mapUser),f(Fr,c.providers.config.mapMfa)}),d(oe,ce)};z(te,oe=>{(e(y)||e(g)||e(u))&&oe(ie)},!0)}d(ne,ge)};z(ae,ne=>{e(R)&&!e(u)?ne(ve):ne(je,!1)},!0)}d(q,Y)};z(ke,q=>{e(L)&&!e(u)?q(we):q($e,!1)})}var Ke=a(ke,2),Se=l(Ke);ye(Se,{type:"submit",get isLoading(){return e(p)},children:(q,Y)=>{F();var ae=B();k(()=>f(ae,e(G)?c.providers.config.lookup:r.common.save)),d(q,ae)},$$slots:{default:!0}});var Le=a(Se,2);{var rr=q=>{ye(q,{level:3,onclick:ee,get isLoading(){return e(p)},children:(Y,ae)=>{F();var ve=B();k(()=>f(ve,c.common.reset)),d(Y,ve)},$$slots:{default:!0}})};z(Le,q=>{e(G)||q(rr)})}var qe=a(Le,2);{var xe=q=>{Mr(q,{})};z(qe,q=>{e(U)&&q(xe)})}var tr=a(qe,2);{var Xe=q=>{var Y=ca(),ae=l(Y,!0);s(Y),k(()=>f(ae,e(m))),d(q,Y)};z(tr,q=>{e(m)&&q(Xe)})}s(Ke),d(N,b)},$$slots:{default:!0}}),s(X),d(P,X),pe()}var pa=C("<div></div> <!>",1),_a=C('<div class="err"> </div>'),ma=C('<div id="federation"><!></div> <!>',1),fa=C("<!> <!>",1);function ha(P,n){ue(n,!0);let r=Ee(),c=x(void 0),o=pt("pid"),p=x(""),m=x(I([])),u=x(void 0);Tr(()=>{U()}),Ue(()=>{v(u,I(e(m).find(h=>h.id===o.get())))});async function U(){var R;let h=await ur("/auth/v1/providers");h.body?v(m,I(h.body)):v(p,I(((R=h.error)==null?void 0:R.message)||"Error"))}function w(){var h;o.set(void 0),(h=e(c))==null||h(),U()}var $=fa(),t=Z($);ut(t,{width:"11rem",buttonTilesAriaControls:"federation",buttonTiles:h=>{var R=pa(),g=Z(R);Re(g,"height",".5rem");var L=a(g,2);Lr(L,17,()=>e(m),y=>y.id,(y,G)=>{var re=de(()=>o.get()===e(G).id);Et(y,{onclick:()=>o.set(e(G).id),get selected(){return e(re)},children:(V,S)=>{F();var T=B();k(()=>f(T,e(G).name)),d(V,T)},$$slots:{default:!0}})}),d(h,R)},children:(h,R)=>{var g=de(()=>e(m).length===0?1:2);Lt(h,{get level(){return e(g)},get closeModal(){return e(c)},set closeModal(L){v(c,I(L))},children:(L,y)=>{ua(L,{onSave:w})},$$slots:{default:!0}})},$$slots:{buttonTiles:!0,default:!0}});var E=a(t,2);vt(E,{children:(h,R)=>{var g=ma(),L=Z(g),y=l(L);{var G=S=>{ta(S,{onSave:U,get provider(){return e(u)},set provider(T){v(u,I(T))}})};z(y,S=>{e(u)&&S(G)})}s(L);var re=a(L,2);{var V=S=>{var T=_a(),j=l(T,!0);s(T),k(()=>f(j,e(p))),d(S,T)};z(re,S=>{e(p)&&S(V)})}k(()=>W(L,"aria-label",r.common.details)),d(h,g)},$$slots:{default:!0}}),d(P,$),pe()}function ga(P){ha(P,{})}export{ga as component};
