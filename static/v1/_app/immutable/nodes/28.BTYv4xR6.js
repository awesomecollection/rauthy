import"../chunks/disclose-version.BDr9Qe-U.js";import{p as ne,f as E,a as ce,t as c,$ as ue,g as i,b as s,s as r,d as I,y as ve,c as u,r as v,a9 as de}from"../chunks/index-client.BTDbhFDr.js";import{s as m}from"../chunks/render.Bnf33Vuq.js";import{i as M}from"../chunks/if.DAPrgfY3.js";import{a as o,t as d,b as ge,c as pe}from"../chunks/template.WjkCsOA4.js";import{h as fe}from"../chunks/svelte-head.j24Rpelw.js";import{r as he,a as $e}from"../chunks/index.C-OHSz9E.js";import{p as B}from"../chunks/proxy.RLXrsQTM.js";import{B as be,T as _e,a as we}from"../chunks/ThemeSwitch.roIqycWj.js";import{m as ye}from"../chunks/helpers.DwhnXD2f.js";import{I as D}from"../chunks/Input.CUSPvo5Z.js";import{L as Ne,u as Te}from"../chunks/LangSelector.C4OT_tcu.js";import{M as Ee,C as xe}from"../chunks/ContentCenter.BfmJnKUc.js";import{u as Ce}from"../chunks/i18n.svelte.CR36i7o7.js";import{T as Ie}from"../chunks/Template.CAvnUEat.js";import{u as Me}from"../chunks/param.svelte.Bo6XdOlX.js";import{F as Re}from"../chunks/Form.D12CCp_z.js";import{a as K}from"../chunks/patterns.BdncpE46.js";var Ae=d(" <br> <code> </code>",1),Le=d('<input type="hidden" name="redirect_uri">'),ke=d('<div class="success svelte-cul8ah"> <br> </div>'),qe=d('<div class="err svelte-cul8ah"> </div>'),Pe=d('<!> <!> <!> <!> <div class="submit svelte-cul8ah"><!></div> <!>',1),Se=d('<div class="container svelte-cul8ah"><div class="domainTxt svelte-cul8ah"><h1> </h1> <!></div> <!></div> <!> <!>',1),Ue=d("<!> <!>",1);function Be(O,V){ne(V,!0);let e=Ce(),X=Te(),g=I(""),F=Me("redirect_uri"),R=I(!1),l=I(""),A=I(!1),Y=ve(()=>X.get()?"/auth/v1/dev/register":"/auth/v1/users/register");async function Z(p,f){s(A,!1),s(l,"");let _=f.get("email"),L=f.get("given_name"),w=f.get("pow");if(!_||!L||!w){console.error("email, given_name, pow missing");return}if(i(g)&&!_.endsWith(i(g))){s(l,B(e.register.domainErr));return}let h={email:_,given_name:L,family_name:f.get("family_name")||void 0,pow:w,redirect_uri:f.get("redirect_uri")||void 0};s(R,!0);const $=await we(p.action,h);if($.error){let b=$.error.message||"Error";b.includes("UNIQUE constraint")?s(l,"E-Mail is already registered"):s(l,B(b))}else s(l,""),s(A,!0),setTimeout(()=>{window.location.replace(h.redirect_uri||"/auth/v1/account")},3e3);s(R,!1)}var Q=Ue();fe(p=>{c(()=>ue.title=(e==null?void 0:e.register)||"Register")});var W=E(Q);Ie(W,{id:ye,get value(){return i(g)},set value(p){s(g,B(p))}});var H=r(W,2);Ee(H,{children:(p,f)=>{xe(p,{children:(_,L)=>{var w=Se(),h=E(w),$=u(h),b=u($),J=u(b,!0);v(b);var ee=r(b,2);{var re=y=>{var k=Ae(),N=E(k,!0),T=r(N,2),x=r(T),C=u(x);v(x),c(()=>{m(N,e.register.domainRestricted),m(T,` ${e.register.domainAllowed??""} `),m(C,`@${i(g)??""}`)}),o(y,k)};M(ee,y=>{i(g)&&y(re)})}v($);var ae=r($,2);Re(ae,{get action(){return i(Y)},onSubmit:Z,withPowAs:"pow",children:(y,k)=>{var N=Pe(),T=E(N);{var x=a=>{var t=Le();he(t),c(()=>$e(t,F.get())),o(a,t)};M(T,a=>{F.get()&&a(x)})}var C=r(T,2);D(C,{typ:"email",name:"email",autocomplete:"email",get label(){return e.common.email},get placeholder(){return e.common.email},required:!0});var z=r(C,2);D(z,{name:"given_name",autocomplete:"given-name",get label(){return e.account.givenName},get placeholder(){return e.account.givenName},pattern:K,required:!0});var G=r(z,2);D(G,{name:"family_name",autocomplete:"family-name",get label(){return e.account.familyName},get placeholder(){return e.account.familyName},pattern:K});var q=r(G,2),ie=u(q);be(ie,{type:"submit",get isLoading(){return i(R)},children:(a,t)=>{de();var n=ge();c(()=>m(n,e.register.register)),o(a,n)},$$slots:{default:!0}}),v(q);var se=r(q,2);{var oe=a=>{var t=ke(),n=u(t,!0),P=r(n,2);v(t),c(()=>{m(n,e.register.success),m(P,` ${e.register.emailCheck??""}`)}),o(a,t)},me=a=>{var t=pe(),n=E(t);{var P=S=>{var U=qe(),le=u(U,!0);v(U),c(()=>m(le,i(l))),o(S,U)};M(n,S=>{i(l)&&S(P)},!0)}o(a,t)};M(se,a=>{i(A)?a(oe):a(me,!1)})}o(y,N)},$$slots:{default:!0}}),v(h);var j=r(h,2);_e(j,{absolute:!0});var te=r(j,2);Ne(te,{absolute:!0}),c(()=>m(J,e.register.userReg)),o(_,w)},$$slots:{default:!0}})},$$slots:{default:!0}}),o(O,Q),ce()}export{Be as component};
