import"../chunks/disclose-version.BDr9Qe-U.js";import{p as ne,f as E,a as ce,t as c,$ as ue,u as i,v as s,s as r,w as M,O as ve,c as u,r as v,ap as de}from"../chunks/runtime.BONl2e88.js";import{s as m}from"../chunks/render.AqJWcVDb.js";import{i as R}from"../chunks/if.DS90EFHs.js";import{a as o,t as d,d as ge,e as pe}from"../chunks/template.B7ldVCvc.js";import{h as fe}from"../chunks/svelte-head.DBtDtmZn.js";import{d as he,g as $e}from"../chunks/index.BJiFQ8Di.js";import{p as B}from"../chunks/proxy.0BECmVET.js";import{B as we,a as ye}from"../chunks/fetch.JUNnB5kv.js";import{o as _e}from"../chunks/helpers.CQGRRstl.js";import{I as D}from"../chunks/Input.DGOkRo_r.js";import{T as be,L as Ne}from"../chunks/LangSelector.Zw9l5r2b.js";import{M as Te}from"../chunks/Main.DMwa1Kwf.js";import{C as Ee}from"../chunks/ContentCenter.BNNwHQjF.js";import{u as Ce}from"../chunks/i18n.svelte.B1gwAzk0.js";import{T as Ie}from"../chunks/Template.DIImK_q5.js";import{u as Me}from"../chunks/param.svelte.BwWxV1Sm.js";import{F as Re}from"../chunks/Form.CE2yJgP5.js";import{u as xe}from"../chunks/is_dev.svelte.CjWXM2Cb.js";import{a as G}from"../chunks/patterns.BdncpE46.js";var Ae=d(" <br> <code> </code>",1),Le=d('<input type="hidden" name="redirect_uri">'),ke=d('<div class="success svelte-cul8ah"> <br> </div>'),qe=d('<div class="err svelte-cul8ah"> </div>'),Pe=d('<!> <!> <!> <!> <div class="submit svelte-cul8ah"><!></div> <!>',1),Se=d('<div class="container svelte-cul8ah"><div class="domainTxt svelte-cul8ah"><h1> </h1> <!></div> <!></div> <!> <!>',1),Ue=d("<!> <!>",1);function Be(K,V){ne(V,!0);let e=Ce(),X=xe(),g=M(""),F=Me("redirect_uri"),x=M(!1),l=M(""),A=M(!1),Y=ve(()=>X.get()?"/auth/v1/dev/register":"/auth/v1/users/register");async function Z(p,f){s(A,!1),s(l,"");let y=f.get("email"),L=f.get("given_name"),_=f.get("pow");if(!y||!L||!_){console.error("email, given_name, pow missing");return}if(i(g)&&!y.endsWith(i(g))){s(l,B(e.register.domainErr));return}let h={email:y,given_name:L,family_name:f.get("family_name")||void 0,pow:_,redirect_uri:f.get("redirect_uri")||void 0};s(x,!0);const $=await ye(p.action,h);if($.error){let w=$.error.message||"Error";w.includes("UNIQUE constraint")?s(l,"E-Mail is already registered"):s(l,B(w))}else s(l,""),s(A,!0),setTimeout(()=>{window.location.replace(h.redirect_uri||"/auth/v1/account")},3e3);s(x,!1)}var O=Ue();fe(p=>{c(()=>ue.title=(e==null?void 0:e.register)||"Register")});var Q=E(O);Ie(Q,{id:_e,get value(){return i(g)},set value(p){s(g,B(p))}});var H=r(Q,2);Te(H,{children:(p,f)=>{Ee(p,{children:(y,L)=>{var _=Se(),h=E(_),$=u(h),w=u($),J=u(w,!0);v(w);var ee=r(w,2);{var re=b=>{var k=Ae(),N=E(k,!0),T=r(N,2),C=r(T),I=u(C);v(C),c(()=>{m(N,e.register.domainRestricted),m(T,` ${e.register.domainAllowed??""} `),m(I,`@${i(g)??""}`)}),o(b,k)};R(ee,b=>{i(g)&&b(re)})}v($);var ae=r($,2);Re(ae,{get action(){return i(Y)},onSubmit:Z,withPowAs:"pow",children:(b,k)=>{var N=Pe(),T=E(N);{var C=a=>{var t=Le();he(t),c(()=>$e(t,F.get())),o(a,t)};R(T,a=>{F.get()&&a(C)})}var I=r(T,2);D(I,{typ:"email",name:"email",autocomplete:"email",get label(){return e.common.email},get placeholder(){return e.common.email},required:!0});var j=r(I,2);D(j,{name:"given_name",autocomplete:"given-name",get label(){return e.account.givenName},get placeholder(){return e.account.givenName},pattern:G,required:!0});var z=r(j,2);D(z,{name:"family_name",autocomplete:"family-name",get label(){return e.account.familyName},get placeholder(){return e.account.familyName},pattern:G});var q=r(z,2),ie=u(q);we(ie,{type:"submit",get isLoading(){return i(x)},children:(a,t)=>{de();var n=ge();c(()=>m(n,e.register.register)),o(a,n)},$$slots:{default:!0}}),v(q);var se=r(q,2);{var oe=a=>{var t=ke(),n=u(t,!0),P=r(n,2);v(t),c(()=>{m(n,e.register.success),m(P,` ${e.register.emailCheck??""}`)}),o(a,t)},me=a=>{var t=pe(),n=E(t);{var P=S=>{var U=qe(),le=u(U,!0);v(U),c(()=>m(le,i(l))),o(S,U)};R(n,S=>{i(l)&&S(P)},!0)}o(a,t)};R(se,a=>{i(A)?a(oe):a(me,!1)})}o(b,N)},$$slots:{default:!0}}),v(h);var W=r(h,2);be(W,{absolute:!0});var te=r(W,2);Ne(te,{absolute:!0}),c(()=>m(J,e.register.userReg)),o(y,_)},$$slots:{default:!0}})},$$slots:{default:!0}}),o(K,O),ce()}export{Be as component};
