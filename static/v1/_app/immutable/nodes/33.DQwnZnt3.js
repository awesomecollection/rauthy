import"../chunks/disclose-version.BDr9Qe-U.js";import{p as ne,f as x,a as ce,t as c,aq as ue,l as i,m as s,s as r,o as C,ab as ve,c as u,r as v,ar as de}from"../chunks/index-client.Ds4XgiuL.js";import{s as m}from"../chunks/render.Bq2-eTRf.js";import{i as I}from"../chunks/if.Du7BDhAX.js";import{a as o,t as d,d as ge,e as pe}from"../chunks/template.DXIK6jcH.js";import{h as fe}from"../chunks/svelte-head.DUes13UE.js";import{r as he,b as be}from"../chunks/class.Ik0ma2JO.js";import{p as B}from"../chunks/proxy.CB6KOiNf.js";import{B as _e}from"../chunks/Button.nDjAKZm4.js";import{x as $e}from"../chunks/helpers.BTvs6bnN.js";import{I as D}from"../chunks/pow.C3ENfqN0.js";import{L as we}from"../chunks/LangSelector.BAs7X9bt.js";import{M as ye}from"../chunks/Main.DW0MpFpK.js";import{C as Ne}from"../chunks/ContentCenter.CKh5VTcB.js";import{u as Te}from"../chunks/i18n.svelte.CgUwCKxn.js";import{T as xe}from"../chunks/Template.CSY6eNF5.js";import{u as Ee}from"../chunks/param.svelte.D0F_0zrI.js";import{T as qe}from"../chunks/ThemeSwitch.DknOd3dX.js";import{F as Ce}from"../chunks/Form.JHjwURkX.js";import{u as Ie}from"../chunks/is_dev.svelte.Ca8K5o-2.js";import{a as K}from"../chunks/patterns.D9HtGhEC.js";import{b as Me}from"../chunks/fetch.DFmyLr06.js";var Re=d(" <br> <code> </code>",1),Ae=d('<input type="hidden" name="redirect_uri">'),Le=d('<div class="success svelte-cul8ah"> <br> </div>'),Pe=d('<div class="err svelte-cul8ah"> </div>'),Se=d('<!> <!> <!> <!> <div class="submit svelte-cul8ah"><!></div> <!>',1),Ue=d('<div class="container svelte-cul8ah"><div class="domainTxt svelte-cul8ah"><h1> </h1> <!></div> <!></div> <!> <!>',1),ke=d("<!> <!>",1);function Be(O,V){ne(V,!0);let e=Te(),X=Ie(),g=C(""),F=Ee("redirect_uri"),M=C(!1),l=C(""),R=C(!1),Y=ve(()=>X.get()?"/auth/v1/dev/register":"/auth/v1/users/register");async function Z(p,f){s(R,!1),s(l,"");let $=f.get("email"),A=f.get("given_name"),w=f.get("pow");if(!$||!A||!w){console.error("email, given_name, pow missing");return}if(i(g)&&!$.endsWith(i(g))){s(l,B(e.register.domainErr));return}let h={email:$,given_name:A,family_name:f.get("family_name")||void 0,pow:w,redirect_uri:f.get("redirect_uri")||void 0};s(M,!0);const b=await Me(p.action,h);if(b.error){let _=b.error.message||"Error";_.includes("UNIQUE constraint")?s(l,"E-Mail is already registered"):s(l,B(_))}else s(l,""),s(R,!0),setTimeout(()=>{window.location.replace(h.redirect_uri||"/auth/v1/account")},3e3);s(M,!1)}var Q=ke();fe(p=>{c(()=>ue.title=(e==null?void 0:e.register)||"Register")});var W=x(Q);xe(W,{id:$e,get value(){return i(g)},set value(p){s(g,B(p))}});var H=r(W,2);ye(H,{children:(p,f)=>{Ne(p,{children:($,A)=>{var w=Ue(),h=x(w),b=u(h),_=u(b),J=u(_,!0);v(_);var ee=r(_,2);{var re=y=>{var L=Re(),N=x(L,!0),T=r(N,2),E=r(T),q=u(E);v(E),c(()=>{m(N,e.register.domainRestricted),m(T,` ${e.register.domainAllowed??""} `),m(q,`@${i(g)??""}`)}),o(y,L)};I(ee,y=>{i(g)&&y(re)})}v(b);var ae=r(b,2);Ce(ae,{get action(){return i(Y)},onSubmit:Z,withPowAs:"pow",children:(y,L)=>{var N=Se(),T=x(N);{var E=a=>{var t=Ae();he(t),c(()=>be(t,F.get())),o(a,t)};I(T,a=>{F.get()&&a(E)})}var q=r(T,2);D(q,{typ:"email",name:"email",autocomplete:"email",get label(){return e.common.email},get placeholder(){return e.common.email},required:!0});var z=r(q,2);D(z,{name:"given_name",autocomplete:"given-name",get label(){return e.account.givenName},get placeholder(){return e.account.givenName},pattern:K,required:!0});var G=r(z,2);D(G,{name:"family_name",autocomplete:"family-name",get label(){return e.account.familyName},get placeholder(){return e.account.familyName},pattern:K});var P=r(G,2),ie=u(P);_e(ie,{type:"submit",get isLoading(){return i(M)},children:(a,t)=>{de();var n=ge();c(()=>m(n,e.register.register)),o(a,n)},$$slots:{default:!0}}),v(P);var se=r(P,2);{var oe=a=>{var t=Le(),n=u(t,!0),S=r(n,2);v(t),c(()=>{m(n,e.register.success),m(S,` ${e.register.emailCheck??""}`)}),o(a,t)},me=a=>{var t=pe(),n=x(t);{var S=U=>{var k=Pe(),le=u(k,!0);v(k),c(()=>m(le,i(l))),o(U,k)};I(n,U=>{i(l)&&U(S)},!0)}o(a,t)};I(se,a=>{i(R)?a(oe):a(me,!1)})}o(y,N)},$$slots:{default:!0}}),v(h);var j=r(h,2);qe(j,{absolute:!0});var te=r(j,2);we(te,{absolute:!0}),c(()=>m(J,e.register.userReg)),o($,w)},$$slots:{default:!0}})},$$slots:{default:!0}}),o(O,Q),ce()}export{Be as component};
